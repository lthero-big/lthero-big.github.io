<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>lthero</title>
  
  <subtitle>个人博客</subtitle>
  <link href="https://blog.lthero.cn/atom.xml" rel="self"/>
  
  <link href="https://blog.lthero.cn/"/>
  <updated>2025-06-24T14:24:27.269Z</updated>
  <id>https://blog.lthero.cn/</id>
  
  <author>
    <name>lthero</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Zerotier自建Planet服务器的使用说明</title>
    <link href="https://blog.lthero.cn/2025/03/11/BuildYourOwnZerotierPlanet/"/>
    <id>https://blog.lthero.cn/2025/03/11/BuildYourOwnZerotierPlanet/</id>
    <published>2025-03-11T02:32:10.000Z</published>
    <updated>2025-06-24T14:24:27.269Z</updated>
    
    <content type="html"><![CDATA[<p><strong>总体分为两大步骤</strong></p><p>第一步、下载并导入 <code>planet</code> 文件：<a href="http://114.66.63.134:3223/planet?key=63122304d122157b">点击下载planet文件</a></p><p>第二步、加入到虚拟局域网网络（由我发送给你的网络ID）</p><h1 id="不同平台的客户端配置过程">不同平台的客户端配置过程</h1><h2 id="windows-配置">Windows 配置</h2><p>1、首先去zerotier官网下载一个zerotier客户端</p><p>2、下载 <code>planet</code> 文件：<a href="http://114.66.63.134:3223/planet?key=63122304d122157b">点击下载planet文件</a></p><p>3、将 <code>planet</code> 文件覆盖粘贴到<code>C:\ProgramData\ZeroTier\One</code>中(这个目录是个隐藏目录，需要运允许查看隐藏目录才行)</p><p>4、按Win+S 搜索 <code>服务</code></p><p>![image-20250310132508140](/Users/lthero/Library/Application Support/typora-user-images/image-20250310132508140.png)</p><p>找到<strong>ZeroTier One</strong>，并且重启服务</p><p>![image-20250310132517587](/Users/lthero/Library/Application Support/typora-user-images/image-20250310132517587.png)</p><h3 id="加入网络">加入网络</h3><p>使用管理员身份打开PowerShell</p><p>执行如下命令，看到<strong>join ok</strong>字样就成功了</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\system32&gt; zerotier-cli <span class="built_in">join</span> 网络<span class="built_in">id</span></span><br><span class="line">200 <span class="built_in">join</span> OK</span><br></pre></td></tr></table></figure><p>如果有加入到其它网络，先离开其它网络</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zerotier-cli leave 网络id</span><br></pre></td></tr></table></figure><h3 id="检查">检查</h3><p>执行如下命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Windows\system32&gt; zerotier-cli peers</span><br><span class="line">200 peers</span><br><span class="line">&lt;ztaddr&gt;   &lt;ver&gt;  &lt;role&gt; &lt;lat&gt; &lt;link&gt; &lt;lastTX&gt; &lt;lastRX&gt; &lt;path&gt;</span><br><span class="line">0651177f3e x.x.x  PLANET    52 DIRECT 16       8994     1.1.1.1/9994</span><br><span class="line">PS C:\Windows\system32&gt;</span><br></pre></td></tr></table></figure><p>可以看到有一个 <strong>PLANTET</strong> 连接方式为 DIRECT(直连) 即可</p><h2 id="linux-客户端">Linux 客户端</h2><ol><li>安装linux客户端软件</li><li>进入目录 <code>/var/lib/zerotier-one</code></li><li>替换目录下的 <code>planet</code> 文件</li><li>重启 <code>zerotier-one</code> 服务(<code>service zerotier-one restart</code>)</li><li>加入网络 <code>zerotier-cli join</code> 网络 <code>id</code></li><li>管理后台同意加入请求</li><li><code>zerotier-cli peers</code> 可以看到<code> planet</code> 角色</li></ol><h2 id="安卓客户端配置">安卓客户端配置</h2><p><strong>ZerotierFix</strong> 软件下载链接：<a href="https://drive.lthero.cn/s/u26yqa">https://drive.lthero.cn/s/u26yqa</a></p><p>一共两个步骤，先点击右上角，找到“设置”</p><img src="/Users/lthero/Desktop/PixPin_2025-03-11_09-03-18.png" alt="一共两大步骤" style="zoom:50%;" /><p>点击“设置planet文件”并从URL导入文件，随后点击启用</p><img src="/Users/lthero/Desktop/PixPin_2025-03-11_09-01-23.png" alt="替换planet文件" style="zoom:50%;" /><p>返回主界面，选择右下角，输入网络ID并添加网络；</p><img src="/Users/lthero/Desktop/PixPin_2025-03-11_09-02-08.png" alt="添加网络" style="zoom:50%;" /><h2 id="macos-客户端配置">MacOS 客户端配置</h2><ol><li>进入 <code>/Library/Application\ Support/ZeroTier/One/</code> 目录，并替换目录下的 <code>planet</code> 文件</li><li>重启 ZeroTier-One：<code>cat /Library/Application\ Support/ZeroTier/One/zerotier-one.pid | sudo xargs kill</code></li><li>加入网络 <code>zerotier-cli join</code> 网络 <code>id</code></li><li>管理后台同意加入请求</li><li><code>zerotier-cli peers</code> 可以看到<code> planet</code> 角色</li></ol><h2 id="openwrt-客户端配置">OpenWRT 客户端配置</h2><ol><li>安装zerotier客户端</li><li>进入目录 <code>/etc/config/zero/planet</code></li><li>替换目录下的 <code>planet</code> 文件</li><li>在openwrt网页后台先关闭zerotier服务，在开启zerotier服务</li><li>在openwrt网页后台加入网络</li><li>管理后台同意加入请求</li><li>执行 <code>ln -s /etc/config/zero /var/lib/zerotier-one </code></li><li><code>zerotier-cli peers</code> 可以看到<code> planet</code> 角色</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;总体分为两大步骤&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;第一步、下载并导入 &lt;code&gt;planet&lt;/code&gt; 文件：&lt;a href=&quot;http://114.66.63.134:3223/planet?key=63122304d122157b&quot;&gt;点击下载pla</summary>
      
    
    
    
    <category term="zerotier" scheme="https://blog.lthero.cn/categories/zerotier/"/>
    
    
    <category term="zerotier" scheme="https://blog.lthero.cn/tags/zerotier/"/>
    
  </entry>
  
  <entry>
    <title>【汇总】代理工具</title>
    <link href="https://blog.lthero.cn/2025/02/10/ProxyTools/"/>
    <id>https://blog.lthero.cn/2025/02/10/ProxyTools/</id>
    <published>2025-02-10T11:42:08.000Z</published>
    <updated>2025-02-11T06:34:58.378Z</updated>
    
    <content type="html"><![CDATA[<table><thead><tr><th>名称</th><th>平台</th><th>备注</th><th>特点</th></tr></thead><tbody><tr><td><a href="https://github.com/2dust/v2rayN">V2rayN</a></td><td><code>Win/Mac/Linux</code></td><td>不适合新人！功能强！</td><td>支持测速、支持最新协议（Xhttp）</td></tr><tr><td><a href="https://github.com/clash-verge-rev/clash-verge-rev/releases">Clash-verge-rev</a></td><td><code>Win/Mac/Linux</code></td><td>简单好用！适合新手！<strong>PC端强烈推荐</strong></td><td>支持测速、多协议</td></tr><tr><td><a href="https://github.com/2dust/v2rayNG">V2rayNG</a></td><td><code>Android</code></td><td>不适合新人！功能强！</td><td>支持测速、支持最新协议（Xhttp）</td></tr><tr><td><a href="https://github.com/MatsuriDayo/NekoBoxForAndroid">Nekobox</a></td><td><code>Android</code></td><td>简单好用！适合新手！<strong>安卓强烈推荐</strong></td><td>支持测速、多协议</td></tr><tr><td><a href="https://sing-box.sagernet.org/">Sing-box</a></td><td>全平台</td><td>不适合新人！功能强！</td><td>支持测速、支持最新协议（Xhttp）</td></tr><tr><td><a href="https://apps.apple.com/ae/app/shadowrocket/id932747118">Shadowrocket</a></td><td><code>IOS/Mac/Apple TV</code></td><td>最常见，更新最多！<strong>苹果手机推荐</strong></td><td>支持多协议</td></tr><tr><td><a href="https://nssurge.com/">Surge</a></td><td><code>IOS/Mac/Apple TV</code></td><td>苹果系通用，付费版可授权5个设备</td><td></td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;名称&lt;/th&gt;
&lt;th&gt;平台&lt;/th&gt;
&lt;th&gt;备注&lt;/th&gt;
&lt;th&gt;特点&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://github.com/2dust/v2ray</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>EnglishPod_S02</title>
    <link href="https://blog.lthero.cn/2025/02/09/EnglishPod-S02/"/>
    <id>https://blog.lthero.cn/2025/02/09/EnglishPod-S02/</id>
    <published>2025-02-09T04:38:44.000Z</published>
    <updated>2025-02-11T06:59:17.793Z</updated>
    
    <content type="html"><![CDATA[<h1 id="englishpodseason02">EnglishPodSeason02</h1><h2 id="105-职场夸奖">105 职场夸奖</h2><h3 id="wiz">wiz</h3><blockquote><p>someone who is <strong>really good at</strong> something.</p></blockquote><h3 id="slides">slides</h3><blockquote><p>ppt slides, one page in that presentation.</p></blockquote><h3 id="to-be-completely-blown-away">to be completely blown away</h3><blockquote><p>to be surprised/amazed but in a very positive way.</p></blockquote><p>Carl <strong>blown me away</strong> with his knowledge of science.</p><h3 id="wow">Wow</h3><blockquote><p>to wow someone / impress someone.</p></blockquote><h3 id="it-s-nothing">It’s nothing</h3><blockquote><p>it’s not a big deal. / it isn’t hard.</p><p>这没什么</p></blockquote><p>Thanks for lending me your car this week i really appreciated it.</p><ul><li>It’s okay really it was nothing</li></ul><p>I can’t believe you organize the surprise birthday party thank you so much</p><ul><li>don’t worry about it, it was nothing.</li></ul><h3 id="give-sb-a-hand">give sb. a hand</h3><blockquote><p>to help/assist someone</p></blockquote><h3 id="quite">quite</h3><blockquote><p>very good + n.</p></blockquote><p>quite the baskball player/dancer/</p><p>Nancy is <strong>quite gifted at math</strong> she can solve any math problem you give her</p><h3 id="take-on-board">take on board</h3><blockquote><p>to accept and <strong>use</strong> it.</p></blockquote><p>take on board my ideads/suggestions</p><h3 id="think-it-through-sth">think (it) through sth.</h3><blockquote><p>take it to consideration all the aspections.</p><p>think carefully about all of the small details or something.</p><p>深思熟虑</p></blockquote><p>Have you <strong>thought through</strong> my suggestions.</p><p>You guys are very young i think you have to <strong>think throught</strong> before you get married.</p><h3 id="原文">原文</h3><p>Elementary ‐ The Office ‐ Job Well Done (C0105)</p><p>A: And so, that concludes my outline for our marketing strategy next year. Thank you very much for your time.</p><p>B: Hey, that was <strong>quite</strong> the Presentation! Honestly, I <strong>was</strong> completely <strong>blown away</strong> by your strategy outline. I’ve gotta say, Alex, you really <strong>wowed</strong> me today.</p><p>A: Aw, come on; it was nothing. Im just doing my job.</p><p>B: No, I think you deserve some recognition here; I mean, if I look back on your previous Presentations, this is a huge improvement.</p><p>A: Well, Kristin did <strong>give me a hand</strong> with the <strong>slides</strong>. She’s a real <strong>wiz</strong> on PowerPoint.</p><p>B: And I saw that you <strong>took on board</strong> my feedback about pricing strategies. I really appreciate you taking the time to <strong>think through</strong> my suggestions.</p><p>A: Yeah, well, that was some good advice. You made some really good points.</p><p>B: Well, I just wanted to say well done. Really you did a great job.</p><h2 id="106-话费套餐">106 话费套餐</h2><h3 id="prepaid-plan-pay-as-you-go">prepaid plan/pay as you go.</h3><blockquote><p>you pay before you use the minutes</p></blockquote><h3 id="monthly-rate-plan">monthly rate plan</h3><blockquote><p>you have to pay each month, you get a bill at the end of the month.</p></blockquote><h3 id="activate">activate</h3><blockquote><p>make sth. work, only do it once.</p></blockquote><p>activate your computer software/credit card</p><h3 id="handset">handset</h3><blockquote><p>the device/phone you can call it a handset.</p></blockquote><h3 id="rollover-option">rollover option</h3><blockquote><p>the minutes you don’t use , you can still use it the following month.</p><p>可转结到下个月的流量|通话时间……</p></blockquote><h3 id="to-rollover">to rollover</h3><blockquote><p>move from one place to another.</p></blockquote><h3 id="fee">fee</h3><blockquote><p>the amount you must pay for a <strong>service</strong></p></blockquote><p>you <strong>can’t</strong> say:“what’s the fee for the bottle of water.”</p><p>you <strong>can</strong> say: “what’s the <strong>fee for filling</strong> the bottle of water.”</p><h3 id="to-be-compatible-with">to be compatible with</h3><blockquote><p><strong>to work well with</strong> something else.</p></blockquote><p>Our applicaiton is compatible with most smartphones.</p><p>我们的软件与大多智能手机兼容</p><p>My roomate and I are just not compatible.</p><p>Your computer is not compatible with our software.</p><h3 id="what-s-the-catch">what’s the catch?</h3><blockquote><p><strong>catch</strong> is something <strong>hidden</strong> and <strong>negative</strong> makes the deal seems not great.</p><p>catch 隐性条款、往往是限制条件(condition.)</p></blockquote><p>If you get a car for free but the <strong>catch</strong> is you only drive it at night.</p><h3 id="you-are-in-luck">you are in luck</h3><blockquote><p>sth. luckcy is happen.</p></blockquote><p>you are in luck, i have the very last one.</p><h3 id="throw-in">throw in</h3><blockquote><p>include sth. for free.</p><p>附赠</p></blockquote><p>if you buy the house I will throw in the dog for free.</p><h3 id="原文">原文</h3><p>Elementary ‐ Daily Life ‐ Mobile Phone Plan (C0106)</p><p>A: Hi there, can I help you?</p><p>B: Yeah, I’ve just moved here, and I’d like to <strong>activate</strong> my cell phone, and I’m not sure if I should go with a <strong>prepaid plan</strong>, or a <strong>monthly rate plan</strong>.<br>A: I see. Well, can I have a look at your phone?Unfortunately, this phone can’t be used in the US; it’s not <strong>compatible with</strong> our 3G network.<br>B: What? Really? I don’t really want to have to buy a new phone.<br>A: Well, <strong>you’re in luck!</strong> You see, if you sign up for our three-year plan, we’ll <strong>throw in</strong> a <strong>handset</strong> for free.<br>B: Really? What’s the <strong>catch</strong>?<br>A: There’s no <strong>catch</strong>! You just choose a plan, sign a three-year contract and, that’s it! Actually, we’re running a special promotion right now, and we’re giving away a Blackberry Curve with our special Mega Value forty dollar plan.<br>B: So what does this plan include?<br>A: Well, you get nine hundred anytime minutes, and you can also enjoy free mobile to mobile calling to other Tel-Mobile clients, one thousand text messages per month, and unlimited evening and weekend minutes. Oh, and we also offer a <strong>rollover</strong> option.<br>B: Wow, all this for forty dollars per month?<br>A: That’s right, plus the activation <strong>fee</strong>, the emergancy services fee, the monthly service fee, oh, and any charges for extra minutes, and…</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;englishpodseason02&quot;&gt;EnglishPodSeason02&lt;/h1&gt;
&lt;h2 id=&quot;105-职场夸奖&quot;&gt;105 职场夸奖&lt;/h2&gt;
&lt;h3 id=&quot;wiz&quot;&gt;wiz&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;someone who is &lt;st</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Diffusion_From_Scratch</title>
    <link href="https://blog.lthero.cn/2025/01/22/Diffusion-From-Scratch/"/>
    <id>https://blog.lthero.cn/2025/01/22/Diffusion-From-Scratch/</id>
    <published>2025-01-22T14:24:54.000Z</published>
    <updated>2025-01-22T14:25:34.817Z</updated>
    
    <content type="html"><![CDATA[<p>1</p><h1 id="diffusion从scratch开始">Diffusion从Scratch开始</h1><p>参考：<a href="https://ucladeepvision.github.io/CS188-Projects-2023Winter/2022/03/27/team27-ddim-inversion.html">https://ucladeepvision.github.io/CS188-Projects-2023Winter/2022/03/27/team27-ddim-inversion.html</a></p><p><a href="https://github.com/Animadversio/DiffusionFromScratch">https://github.com/Animadversio/DiffusionFromScratch</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;1&lt;/p&gt;
&lt;h1 id=&quot;diffusion从scratch开始&quot;&gt;Diffusion从Scratch开始&lt;/h1&gt;
&lt;p&gt;参考：&lt;a href=&quot;https://ucladeepvision.github.io/CS188-Projects-2023Winter/202</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>LLMs_From_Scratch</title>
    <link href="https://blog.lthero.cn/2025/01/22/LLMs-From-Scratch/"/>
    <id>https://blog.lthero.cn/2025/01/22/LLMs-From-Scratch/</id>
    <published>2025-01-22T14:23:00.000Z</published>
    <updated>2025-01-22T14:24:13.661Z</updated>
    
    <content type="html"><![CDATA[<p>1</p><h1 id="llms从scratch开始">LLMs从Scratch开始</h1><p>参考：<a href="https://www.bilibili.com/video/BV1qWwke5E3K/">https://www.bilibili.com/video/BV1qWwke5E3K/</a></p><p><img src="C:/Users/12904/AppData/Roaming/Typora/typora-user-images/image-20250122222320760.png" alt="Transformer架构"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;1&lt;/p&gt;
&lt;h1 id=&quot;llms从scratch开始&quot;&gt;LLMs从Scratch开始&lt;/h1&gt;
&lt;p&gt;参考：&lt;a href=&quot;https://www.bilibili.com/video/BV1qWwke5E3K/&quot;&gt;https://www.bilibili.com/v</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Autoencoder</title>
    <link href="https://blog.lthero.cn/2025/01/17/Autoencoder/"/>
    <id>https://blog.lthero.cn/2025/01/17/Autoencoder/</id>
    <published>2025-01-17T14:20:31.000Z</published>
    <updated>2025-01-23T13:11:30.262Z</updated>
    
    <content type="html"><![CDATA[<h1 id="autoencoder">Autoencoder</h1><blockquote><p>参考：<a href="https://github.com/nathanhubens/Autoencoders">https://github.com/nathanhubens/Autoencoders</a></p></blockquote><p>自动编码器（Autoencoders, AE）是一种神经网络，其目标是将输入复制到输出。它们通过将输入压缩到一个潜在空间表示中，然后从该表示中重建输出。这样的网络由两个部分组成：</p><p>编码器（Encoder）：网络的这一部分负责将输入压缩到潜在空间表示中。可以用编码函数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>=</mo><mi>𝑓</mi><mo stretchy="false">(</mo><mi>𝑥</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ℎ=𝑓(𝑥)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">h</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span></span> 来表示。</p><p>解码器（Decoder）：这一部分旨在从潜在空间表示中重建输入。可以用解码函数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>=</mo><mi>g</mi><mo stretchy="false">(</mo><mi>h</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">r=g(h)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathdefault">h</span><span class="mclose">)</span></span></span></span> 来表示。</p><p>自动编码器的架构：整个自动编码器可以描述为函数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝑔</mi><mo stretchy="false">(</mo><mi>𝑓</mi><mo stretchy="false">(</mo><mi>𝑥</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>=</mo><mi>𝑟</mi></mrow><annotation encoding="application/x-tex">𝑔(𝑓(𝑥))=𝑟</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span>，其中希望 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝑟</mi></mrow><annotation encoding="application/x-tex">𝑟</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span> 尽可能接近原始输入 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝑥</mi></mrow><annotation encoding="application/x-tex">𝑥</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span>。</p><h1 id="ae与vae概念">AE与VAE概念</h1><p>我现在要详细讲解一下变分自编码器（VAE）和传统的自编码器（AE）之间的区别。我对这两个模型有一些基本了解，但具体细节可能还不够深入。</p><p>首先，自编码器（AE）的基本概念是怎样的？它是一个无监督学习模型，用于进行降维和数据压缩。它的结构包括一个编码器（encoder）和解码器（decoder）。编码器将输入数据映射到潜在空间的一个低维向量，称为latent vector或潜在代码。然后，解码器再把这个潜在代码还原回原来的输入数据。这种结构在无监督学习中很常用，比如用于图像压缩或者生成类似的数据。</p><h2 id="传统自动编码器-ae">传统自动编码器（AE）</h2><ul><li>传统<strong>AE学习的是一个确定性的映射</strong>，将输入样本映射到潜在空间中的一个<strong>固定向量</strong></li><li>这个向量是通过编码器网络直接计算出来的，<strong>没有考虑样本的概率分布</strong></li><li>由于AE没有显式地对潜在空间进行正则化或概率建模，<strong>潜在空间的结构可能是非连续的或不规则的</strong>。</li></ul><p>重建能力：</p><p>由于AE学习的是一个确定的映射，它<strong>能够很好地重建输入样本</strong>。</p><p>但是，由于没有学习到潜在空间的概率分布，AE<strong>缺乏生成新样本的能力</strong>。</p><h2 id="变分自动编码器-vae">变分自动编码器（VAE）</h2><ul><li>VAE学习的是<strong>输入样本在潜在空间中的概率分布</strong>，VAE通过KL散度对潜在空间进行正则化，使其接近标准正态分布（人为设定的高斯分布，当然也是可以是其它“已知”分布）</li><li>这意味着潜在空间是<strong>连续的和结构化的</strong>，任何从中采样的向量都更有可能对应于合理的输入数据。</li><li>编码器输出的是这个分布的参数：均值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mrow><mi>m</mi><mi>e</mi><mi>a</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">z_{mean}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和方差 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mi>v</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">z_{log var}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>。</li></ul><p>生成能力：</p><p>通过学习潜在空间的分布，VAE不仅能够重建输入样本，还<strong>能够从潜在空间中采样生成新样本</strong>。</p><p>这种生成能力是通过重参数化技巧实现的，使得VAE可以在训练过程中进行反向传播。</p><h1 id="ae与vae区别">AE与VAE区别</h1><p>那么，传统的自编码器（AE）和变分自编码器（VAE）有什么不同呢？VAE引入了一些统计学的概念，特别是贝叶斯推断。这可能涉及到概率模型，而传统AE更像是一个确定性的模型。</p><p>首先，<strong>目标函数</strong>方面</p><ul><li><strong>AE的目标是最小化重建误差</strong>，也就是说，输入经过编码和解码后的输出与原输入之间的差异尽可能小。通常使用的是均方误差（MSE）或者交叉熵作为损失函数。</li><li><strong>VAE的目标</strong>则不仅仅是重建数据，还引入了一个 latent space 的正则化项，目的是<strong>让潜在向量服从某种先验分布</strong>，通常是标准正态分布。这意味着VAE的损失函数分为两部分：<strong>重建损失和KL散度项</strong>。</li><li><img src="C:/Users/12904/AppData/Roaming/Typora/typora-user-images/image-20250122102207715.png" alt="VAE损失函数的重建损失和KL散度项"></li></ul><p>接下来是模型结构的不同点。</p><p>编码器方面：AE的编码器输出的是一个<strong>确定性的latent vector</strong>，而VAE的编码器输出的是这个向量的均值和方差，这两个参数用于描述潜在变量的正态分布。</p><p>解码器方面：AE直接从latent vector映射回数据，而VAE可能同样如此，但潜在空间是通过<strong>重参数化技巧</strong>（比如将标准正态分布的噪声加到均值上）来实现的。</p><p>潜在空间的性质：在AE中，latent space是一个<strong>确定性的低维向量</strong>，它直接捕捉输入数据的特征。而在VAE中，latent space中的每个点都是一个概率分布，这使得模型具有生成能力，因为它可以采样新的潜在向量并将其解码为新数据。</p><p>生成能力方面：AE通常难以直接用于生成数据，因为它们没有明确的概率建模。而VAE由于其潜在空间是概率性的，并且可以通过对潜在变量进行采样来生成新样本，因此在图像生成等任务中表现更好。</p><p>鲁棒性方面：AE可能对噪声较为敏感，特别是在处理有噪声的数据时，重建可能会受到影响。而VAE通过引入正则化和概率建模，通常在处理带噪数据时表现更稳定，并且对模型的参数有一定的鲁棒性。</p><p>应用方面：AE常用于降维、特征提取和图像修复等任务，而<strong>VAE更多地应用于生成模型</strong>，比如图像生成、语音合成等领域。</p><p>总结一下，VAE通过引入概率建模和潜在空间的正则化，使得它在生成任务上表现更好，并且具有更好的鲁棒性和灵活性。而传统的AE更侧重于数据压缩和降维，功能相对单一。</p><h2 id="从两者encoder察觉出两者区别">从两者Encoder察觉出两者区别</h2><blockquote><p>在传统自动编码器（AE）和变分自动编码器（VAE）中，编码器(Encoder)的输出层设计有所不同，主要是因为它们的目标和结构不同。</p></blockquote><h3 id="传统自动编码器-ae">传统自动编码器（AE）</h3><p>在传统AE中，编码器的输出通常是一个确定性的潜在表示。</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">input_layer = Input(shape=(input_dim,))</span><br><span class="line">hidden_layer = Dense(hidden_dim, activation=<span class="string">&#x27;relu&#x27;</span>)(input_layer)</span><br><span class="line">output_layer = Dense(input_dim, activation=<span class="string">&#x27;sigmoid&#x27;</span>)(hidden_layer)</span><br><span class="line">autoencoder = Model(inputs=input_layer, outputs=output_layer)</span><br><span class="line"><span class="comment"># 看下面outputs=hidden_layer</span></span><br><span class="line">encoder = Model(inputs=input_layer, outputs=hidden_layer)</span><br></pre></td></tr></table></figure><p>例如，<code>hidden_layer=Dense(intermediate_dim, activation='relu')(self.input_layer) </code>表示将输入数据通过一个全连接层映射到一个中间维度的潜在空间。</p><p>这个潜在表示是一个<strong>固定的向量</strong>，直接用于解码器进行重建。</p><h3 id="变分自动编码器-vae">变分自动编码器（VAE）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">input_layer = Input(shape=(input_dim,))</span><br><span class="line">h = Dense(intermediate_dim, activation=<span class="string">&#x27;relu&#x27;</span>)(input_layer)</span><br><span class="line">z_mean = Dense(latent_dim)(h)</span><br><span class="line">z_log_var = Dense(latent_dim)(h)</span><br><span class="line">...</span><br><span class="line"><span class="comment"># 看下面outputs=z_mean</span></span><br><span class="line">encoder = Model(inputs=input_layer, outputs=z_mean)</span><br></pre></td></tr></table></figure><p>在VAE中，<strong>编码器的输出是潜在空间的概率分布参数</strong>，而不是一个确定性的向量。</p><p><code>z_mean = Dense(latent_dim)(self.h)</code> 和 <code>z_log_var = Dense(latent_dim)(self.h)</code> 分别表示潜在空间的均值和对数方差。</p><p>通过学习这两个参数，<strong>VAE可以在潜在空间中定义一个正态分布</strong>。</p><p>采样过程：</p><p>VAE使用重参数化技巧从这个分布中采样潜在变量 z，以便在训练过程中进行反向传播。</p><p>这使得VAE能够生成新样本，并对潜在空间进行正则化。</p><h2 id="总结">总结</h2><p>传统AE：专注于重建输入样本，缺乏生成新样本的能力。</p><p>VAE：通过学习潜在空间的概率分布，既能重建输入样本，又能生成新样本。</p><h2 id="问题">问题</h2><blockquote><p>给传统自动编码器（AE）一个随机的潜在空间向量，解码器会尝试将其映射回输入空间，它确实可以通过解码器生成一些输出数据</p><p>由于潜在空间没有经过正则化，随机向量可能不对应于训练数据的合理表示，因此生成的输出可能是模糊的或不真实的</p><p>效果通常不如变分自动编码器（VAE）好</p></blockquote><h1 id="变分自编码器">变分自编码器</h1><img src="C:/Users/12904/AppData/Roaming/Typora/typora-user-images/image-20250117220552557.png" alt="image-20250117220552557" style="zoom:50%;" /><p>在变分自动编码器（Variational Autoencoder, VAE）中，“变分”（variational）主要体现在以下几个方面：</p><h2 id="潜在空间的概率建模">潜在空间的概率建模</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_dim, intermediate_dim, latent_dim, epsilon_std=<span class="number">1.0</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(input_dim)</span><br><span class="line">        self.input_layer = Input(shape=(input_dim,))</span><br><span class="line">        self.h = Dense(intermediate_dim, activation=<span class="string">&#x27;relu&#x27;</span>)(self.input_layer)</span><br><span class="line">        <span class="comment"># Variational 体现在通过学习潜空间均值与对数方差来建模潜在分布，而不是直接学习潜在变量</span></span><br><span class="line">        <span class="comment"># 可以对 z_mean 和 z_log_var 进行优化，从而间接优化 z 的分布</span></span><br><span class="line">        self.z_mean = Dense(latent_dim)(self.h)</span><br><span class="line">        self.z_log_var = Dense(latent_dim)(self.h)</span><br></pre></td></tr></table></figure><p>这里的<code>input_layer</code>和<code>h</code>与传统AE一样，但VAE通过学习潜在空间的均值 (z_mean) 和对数方差 (z_log_var) 来建模数据的潜在分布。这与传统的AE不同，后者直接学习一个确定性的潜在表示。</p><h2 id="重参数化技巧">重参数化技巧</h2><p>采样过程：VAE使用重参数化技巧来从潜在空间中采样。通过引入噪声 epsilon，VAE能够在训练过程中进行反向传播。这一过程在 sampling 函数中实现：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sampling是一个函数，使用 z_mean 和 z_log_var 生成潜在变量 z</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sampling</span>(<span class="params">self, args</span>):</span><br><span class="line">      z_mean, z_log_var = args</span><br><span class="line">      epsilon = K.random_normal(shape=(K.shape(z_mean)[<span class="number">0</span>], latent_dim), mean=<span class="number">0.0</span>, stddev=epsilon_std)</span><br><span class="line">      <span class="keyword">return</span> z_mean + K.exp(z_log_var / <span class="number">2</span>) * epsilon</span><br></pre></td></tr></table></figure><p>重参数化技巧：它通过将不可导的随机采样过程转化为一个可导的过程，使得我们可以对潜在变量 z 的参数进行优化。以下是更详细的解释：</p><h3 id="原理">原理</h3><p>不可导的采样过程：</p><p>在VAE中，潜在变量 z 是从一个由均值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mrow><mi>m</mi><mi>e</mi><mi>a</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">z_{mean}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和方差 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mi>v</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">z_{log var}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 参数化的正态分布中采样的。</p><p>直接从这个分布中采样的过程是不可导的，因为随机采样本身不具备确定性。</p><p>解决方法（重参数化技巧）</p><p>通过引入一个<strong>独立于模型参数的随机噪声 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>p</mi><mi>s</mi><mi>i</mi><mi>l</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">p</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span></span></span></span></strong>，我们可以将采样过程表示为一个确定性函数：</p><p class='katex-block katex-error' title='Error: Font metrics not found for font: .'>z=z_{mean}+𝜖×exp⁡(z_{log var}/2)</p><p>其中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>p</mi><mi>s</mi><mi>i</mi><mi>l</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">p</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span></span></span></span> 是从标准正态分布 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">N(0, 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span> 中采样的。</p><p>可导性：</p><p>由于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>p</mi><mi>s</mi><mi>i</mi><mi>l</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">p</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span></span></span></span> 是独立的随机噪声，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>m</mi></msub><mi>e</mi><mi>a</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">z_mean</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>l</mi></msub><mi>o</mi><msub><mi>g</mi><mi>v</mi></msub><mi>a</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">z_log_var</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">o</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span> 的梯度可以通过反向传播计算出来。</p><p>这使得我们可以对 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>m</mi></msub><mi>e</mi><mi>a</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">z_mean</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>l</mi></msub><mi>o</mi><msub><mi>g</mi><mi>v</mi></msub><mi>a</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">z_log_var</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">o</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span> 进行优化，从而间接优化 z 的分布。</p><h3 id="优化过程">优化过程</h3><p>目标：通过优化 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>m</mi></msub><mi>e</mi><mi>a</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">z_mean</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>l</mi></msub><mi>o</mi><msub><mi>g</mi><mi>v</mi></msub><mi>a</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">z_log_var</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">o</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span>，使得潜在空间的分布能够更好地表示输入数据。</p><p>损失函数：VAE的损失函数包括重建损失和KL散度，后者用于正则化潜在空间的分布。</p><h3 id="总结">总结</h3><p>重参数化技巧将不可导的采样过程转化为可导的过程，使得我们可以通过反向传播来优化潜在空间的参数。这是VAE能够有效训练的关键技术之一。通过这种方式，我们可以学习到一个更好的潜在表示，并生成新数据样本。</p><h2 id="vae的编码器和解码器结构">VAE的编码器和解码器结构</h2><p>并将它们组合成完整的自动编码器模型</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">BuildModel</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="comment"># z是潜在变量，从潜在空间中采样</span></span><br><span class="line">        self.z = Lambda(self.sampling, output_shape=(self.latent_dim,))([self.z_mean, self.z_log_var])</span><br><span class="line">        <span class="comment"># 解码器的中间层，将潜在空间的表示 z 转换为一个中间表示</span></span><br><span class="line">        self.decoder_h = Dense(self.intermediate_dim, activation=<span class="string">&#x27;relu&#x27;</span>)</span><br><span class="line">        <span class="comment"># 解码器的输出层，将中间表示解码为最终的输出数据。</span></span><br><span class="line">        self.decoder_mean = Dense(self.input_dim, activation=<span class="string">&#x27;sigmoid&#x27;</span>)</span><br><span class="line">        <span class="comment"># self.h_decoded = self.decoder_h(self.z)</span></span><br><span class="line">        <span class="comment"># 将潜在空间的表示 z 通过解码器的中间层和输出层，得到最终的解码结果</span></span><br><span class="line">        self.x_decoded_mean = self.decoder_mean(self.decoder_h(self.z))</span><br><span class="line">        <span class="comment"># VAE的目标是通过编码器和解码器网络，将输入数据 x 经过潜在空间的表示后，重建为 x_decoded_mean</span></span><br><span class="line">        self.autoencoder = Model(inputs=self.input_layer, outputs=self.x_decoded_mean)</span><br><span class="line">        <span class="comment"># 构建编码器模型，输入为原始数据，输出为潜在空间的表示，这里使用z_mean，因为z_mean是潜在空间的均值</span></span><br><span class="line">        self.encoder = Model(inputs=self.input_layer, outputs=self.z_mean)</span><br></pre></td></tr></table></figure><h2 id="kl散度正则化">KL散度正则化</h2><p>损失函数：VAE的损失函数包括重建损失（通常是交叉熵）和KL散度。KL散度用于衡量潜在空间的分布与标准正态分布之间的差异，从而对潜在空间进行正则化。这在 VAELossLayer 中实现：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VAELossLayer</span>(<span class="title class_ inherited__">Layer</span>):</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">      <span class="built_in">super</span>(VAELossLayer, self).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">call</span>(<span class="params">self, inputs</span>):</span><br><span class="line">      x, x_decoded_mean, z_mean, z_log_var = inputs</span><br><span class="line">      xent_loss = input_dim * binary_crossentropy(x, x_decoded_mean)</span><br><span class="line">      kl_loss = -<span class="number">0.5</span> * K.<span class="built_in">sum</span>(<span class="number">1</span> + z_log_var - K.square(z_mean) - K.exp(z_log_var), axis=-<span class="number">1</span>)</span><br><span class="line">      <span class="keyword">return</span> K.mean(xent_loss + kl_loss)</span><br></pre></td></tr></table></figure><h2 id="训练">训练</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">Train</span>(<span class="params">self,x_train,x_test</span>):</span><br><span class="line">    <span class="comment">#VAELossLayer：这是一个自定义的Keras层，用于计算VAE的损失，包括重建损失和KL散度</span></span><br><span class="line">    loss_layer = VAELossLayer()([self.input_layer, self.x_decoded_mean, self.z_mean, self.z_log_var])</span><br><span class="line">    self.autoencoder.add_loss(loss_layer)</span><br><span class="line">    <span class="comment">#optimizer=&#x27;adam&#x27;：使用Adam优化器进行训练，因其在处理大规模数据和高维参数空间时表现良好。</span></span><br><span class="line">    self.autoencoder.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;adam&#x27;</span>, loss=<span class="literal">None</span>)</span><br><span class="line">    <span class="comment"># VAE的训练目标是重建输入数据，因此输入和输出都是相同的数据集</span></span><br><span class="line">    self.autoencoder.fit(x_train, x_train, epochs=epochs, batch_size=batch_size, shuffle=<span class="literal">True</span>, validation_data=(x_test, x_test))</span><br></pre></td></tr></table></figure><p>VAE的Model里设置：通过编码器和解码器网络，将输入数据x重建为输出数据x_decoded_mean。</p><p>训练目标：最小化输入数据x_train和重建数据x_decoded_mean之间的差异，同时正则化潜在空间的分布。</p><blockquote><p>让vae输出的x_decoded_mean尽量像输入数据x_train</p></blockquote><h1 id="vae完整代码">VAE完整代码</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VariationalAutoencoder</span>(<span class="title class_ inherited__">BaseAutoencoder</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_dim, intermediate_dim, latent_dim, epsilon_std=<span class="number">1.0</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(input_dim)</span><br><span class="line">        self.input_layer = Input(shape=(input_dim,))</span><br><span class="line">        self.h = Dense(intermediate_dim, activation=<span class="string">&#x27;relu&#x27;</span>)(self.input_layer)</span><br><span class="line">        <span class="comment"># Variational 体现在通过学习潜空间均值与对数方差来建模潜在分布，而不是直接学习潜在变量</span></span><br><span class="line">        self.z_mean = Dense(latent_dim)(self.h)</span><br><span class="line">        self.z_log_var = Dense(latent_dim)(self.h)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sampling</span>(<span class="params">self,args</span>):</span><br><span class="line">        z_mean, z_log_var = args</span><br><span class="line">        <span class="comment"># 引入噪声epsilon，使用重参数化技巧从潜空间采样</span></span><br><span class="line">        epsilon = K.random_normal(shape=(K.shape(z_mean)[<span class="number">0</span>], latent_dim), mean=<span class="number">0.0</span>, stddev=epsilon_std)</span><br><span class="line">        <span class="keyword">return</span> z_mean + K.exp(z_log_var / <span class="number">2</span>) * epsilon</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">BuildModel</span>(<span class="params">self</span>):</span><br><span class="line">        self.z = Lambda(self.sampling, output_shape=(self.latent_dim,))([self.z_mean, self.z_log_var])</span><br><span class="line">        self.decoder_h = Dense(self.intermediate_dim, activation=<span class="string">&#x27;relu&#x27;</span>)</span><br><span class="line">        self.decoder_mean = Dense(self.input_dim, activation=<span class="string">&#x27;sigmoid&#x27;</span>)</span><br><span class="line">        self.h_decoded = self.decoder_h(self.z)</span><br><span class="line">        self.x_decoded_mean = self.decoder_mean(self.h_decoded)</span><br><span class="line">        self.encoder = Model(inputs=self.input_layer, outputs=self.z_mean)</span><br><span class="line">        self.autoencoder = Model(inputs=self.input_layer, outputs=self.x_decoded_mean)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">VAELossLayer</span>(<span class="title class_ inherited__">Layer</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">            <span class="built_in">super</span>(VAELossLayer, self).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">call</span>(<span class="params">self, inputs</span>):</span><br><span class="line">            x, x_decoded_mean, z_mean, z_log_var = inputs</span><br><span class="line">            xent_loss = input_dim * binary_crossentropy(x, x_decoded_mean)</span><br><span class="line">            <span class="comment"># 计算KL散度，衡量潜在分布与标准正态分布的差异</span></span><br><span class="line">            kl_loss = -<span class="number">0.5</span> * K.<span class="built_in">sum</span>(<span class="number">1</span> + z_log_var - K.square(z_mean) - K.exp(z_log_var), axis=-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> K.mean(xent_loss + kl_loss)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Train</span>(<span class="params">self,x_train,x_test</span>):</span><br><span class="line">        loss_layer = VAELossLayer()([self.input_layer, self.x_decoded_mean, self.z_mean, self.z_log_var])</span><br><span class="line">        self.autoencoder.add_loss(loss_layer)</span><br><span class="line">        self.autoencoder.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;adam&#x27;</span>, loss=<span class="literal">None</span>)</span><br><span class="line">        self.autoencoder.fit(x_train, x_train, epochs=epochs, batch_size=batch_size, shuffle=<span class="literal">True</span>, validation_data=(x_test, x_test))</span><br><span class="line">        self.history=self.autoencoder.fit(x_train,x_train,epochs=EPOCHS,batch_size=BATCH_SIZE,shuffle=<span class="literal">True</span>,validation_data=(x_test,x_test))</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="参考">参考</h1><p><a href="https://towardsdatascience.com/deep-inside-autoencoders-7e41f319999f">https://towardsdatascience.com/deep-inside-autoencoders-7e41f319999f</a></p><p><a href="https://blog.csdn.net/quiet_girl/article/details/84401029">https://blog.csdn.net/quiet_girl/article/details/84401029</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;autoencoder&quot;&gt;Autoencoder&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;参考：&lt;a href=&quot;https://github.com/nathanhubens/Autoencoders&quot;&gt;https://github.com/nathanhub</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>【RackNerd &amp; DigitalOcean】IP被封|IP被GFW封</title>
    <link href="https://blog.lthero.cn/2025/01/10/IP-is-blocked-by-GFW/"/>
    <id>https://blog.lthero.cn/2025/01/10/IP-is-blocked-by-GFW/</id>
    <published>2025-01-10T09:50:15.000Z</published>
    <updated>2025-01-22T02:54:26.676Z</updated>
    
    <content type="html"><![CDATA[<h1 id="racknerd-digitalocean-ip被gfw封了">RackNerd &amp; DigitalOcean IP被GFW封了</h1><blockquote><p>事情起因：最近两台美国服务器被GFW封了（全端口被封，其ip基本就废了）</p></blockquote><h2 id="检测过程">检测过程</h2><p>使用端口检测工具<a href="https://ping.pe/">ping.pe</a> 进行检测，结果如下图1所示，22端口在国外访问正常，国内无法访问；其它端口也是如此，此ip废了。</p><img src="C:/Users/12904/Downloads/PixPin_2025-01-09_20-04-10.png" alt="PixPin_2025-01-09_20-04-10" style="zoom:50%;" /><p>其它检测工具</p><p>1、国内外ping检测 <a href="https://www.itdog.cn/ping/">itdog.cn</a></p><p>2、国内外单个端口检测 <a href="https://www.toolsdaquan.com/ipcheck/">ipcheck</a></p><p>3、国内外ping/端口检测 <a href="https://ping.pe/">ping.pe</a></p><h2 id="解决方案">解决方案</h2><blockquote><p>两台服务器分别是Racknerd和DigitalOcean的，不同商家的解决方案不同。</p></blockquote><h3 id="digitalocean的解决方法">DigitalOcean的解决方法</h3><p>先来说DigitalOcean的解决方法吧</p><h4 id="方案一-推荐">方案一（推荐）</h4><p>不需要删服务器，直接去添加一个免费的<strong>浮动 IP (Reserved IPs)</strong>（每个小鸡可以添加一个，即服务器同时有 2 个 IP）。添加后你什么都不用干，直接就能通过这个 IP 链接服务器了。浮动 IP 可以随时删除，然后重新添加一个（等于换了个浮动 IP）。</p><p><img src="C:/Users/12904/AppData/Roaming/Typora/typora-user-images/image-20250110180758286.png" alt="image-20250110180758286"></p><h4 id="方案二">方案二</h4><p>将服务器关机，然后添加 snapshot。对那个 snapshot 进行 <strong>add to location</strong> 的操作，就能重新选 location 选好再开机，新的 location 以及新的 IP 了，然后旧的 droplet 可以删了</p><h3 id="racknerd的解决方法">Racknerd的解决方法</h3><h4 id="方案一">方案一</h4><p>Racknerd没法添加额外ip，所以只能更换ip；<strong>每台机器有一次免费更换ip的机会</strong>，发起更换ip的请求后系统会自动处理；</p><p>后续更换ip需要钱了，3刀一次；</p><p>如果更换后的ip还是被封了，<s>那……继续换</s>（不是）</p><h4 id="方案二">方案二</h4><p>如果花钱更换后的ip还是被封了，最好就找客服</p><p>描述自己的问题：大概意思是<strong>原ip被封了，然后花钱更换的新ip也被封了</strong></p><p>最好附录两张<a href="https://ping.pe/">ping.pe</a>的检测结果图（要显示22端口，以及其它端口被封了）</p><p>和客服交涉后，客服应该会手动将你的ip换成其它段的，此时应该就能用了（Racknerd大善人！）</p><p>工单申请内容如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">I am experiencing an issue where the server with IP address <span class="number">142.171</span><span class="number">.225</span><span class="number">.6</span> is completely inaccessible from mainland China. This applies to all ports<span class="punctuation">,</span> not just port <span class="number">22</span> (SSH). I have confirmed the issue by testing from multiple locations in China using different ISPs<span class="punctuation">,</span> such as China Telecom<span class="punctuation">,</span> China Unicom<span class="punctuation">,</span> and China Mobile. All attempts to connect to the server from these networks have failed.</span><br><span class="line"></span><br><span class="line">I have successfully connected to the server from multiple servers<span class="punctuation">,</span> including those in the USA<span class="punctuation">,</span> Canada<span class="punctuation">,</span> Europe<span class="punctuation">,</span> and Asia-Pacific regions<span class="punctuation">,</span> using SSH on port <span class="number">22.</span></span><br><span class="line"></span><br><span class="line">The problem persisted even after I changed the server&#x27;s IP address from <span class="number">142.171</span><span class="number">.50</span><span class="number">.112</span> to <span class="number">142.171</span><span class="number">.225</span><span class="number">.6</span>. Despite the new IP<span class="punctuation">,</span> the server is still inaccessible from China.</span><br><span class="line"></span><br><span class="line">If you require any additional information or logs<span class="punctuation">,</span> please let me know<span class="punctuation">,</span> and I will provide them promptly.</span><br><span class="line"></span><br><span class="line">Thank you for your attention to this matter. I look forward to your response.</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;racknerd-digitalocean-ip被gfw封了&quot;&gt;RackNerd &amp;amp; DigitalOcean IP被GFW封了&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;事情起因：最近两台美国服务器被GFW封了（全端口被封，其ip基本就废了）&lt;/p&gt;
&lt;</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
  </entry>
  
  <entry>
    <title>Autolady安装与配置</title>
    <link href="https://blog.lthero.cn/2025/01/04/InstallAutolady/"/>
    <id>https://blog.lthero.cn/2025/01/04/InstallAutolady/</id>
    <published>2025-01-04T08:34:55.000Z</published>
    <updated>2025-01-05T02:20:04.442Z</updated>
    
    <content type="html"><![CDATA[<h1 id="autolady安装与配置">Autolady安装与配置</h1><blockquote><p>前排提醒：注意身体，仅限技术交流；</p></blockquote><p>在你的系统中，创建个目录 <code>autolady</code>，再进入目录后创建一个文件，创建 <code>docker-compose.yml</code>文件</p><p>使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> autolady</span><br><span class="line"><span class="built_in">cd</span> autolady</span><br><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure><p>复制并粘贴以下内容到 <code>docker-compose.yml</code> 文件中：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">auto-lady:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">orekiiiiiiiiiiiii/auto-lady:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">auto-lady</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bridge</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8043:80&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/mnt/user/appdata/auto-lady:/data</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">bridge:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure><p>在文件所在的目录，使用以下命令启动服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><ul><li><code>up -d</code> 表示以后台模式启动所有服务。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure><p>如果成功，应该会看到一个名为 <code>auto-lady</code> 的容器正在运行，并且绑定了 <code>8043:80</code> 的端口</p><h1 id="配置autolady">配置Autolady</h1><p>使用<code>ip:8043</code>即可访问网页，默认账号(admin)，但密码需要查看运行日志获取</p><p>使用命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f auto-lady</span><br></pre></td></tr></table></figure><p>示意图如下</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/QQ_1731994688777.png.webp" alt="默认密码"></p><blockquote><p>如果需要配置nginx反向代理与https，参考后面教程</p></blockquote><h2 id="步骤一-修改密码">步骤一、修改密码</h2><p>修改账号密码，保存后刷新网页，验证能否登录</p><h2 id="步骤二-设置下载器">步骤二、设置下载器</h2><p>首先需要安装下载器，这里有两种选择【qbittorrent、transmission】，具体安装方式在下一节</p><p>假设已经安装好了下载器，需要填写以下信息（以qbit为例）</p><ul><li>qbit地址：方式有二，1、直接填写域名；2、填写<code>ip:端口</code></li><li>qbit用户名、密码</li><li>qbit下载地址：指部署了qbit服务的服务器上，文件想要保存到路径；<ul><li>如果在qbit上设置路径为<code>/root/Downloads/</code>，这里填写<code>/root/Downloads/</code>即可</li></ul></li><li>qbit下载分类：即<strong>子目录名称</strong>，可以是<code>movies</code>或其它</li></ul><p><strong>随后记得保存</strong></p><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20250104164558500.png" alt="image-20250104164558500"></p><h2 id="步骤三-配置令牌">步骤三、配置令牌</h2><p>autolady需要在<code>馒头</code>、<code>飞天拉面神教</code>、<code>PTT</code>三个pt网站下载资源，所以，至少要有一项pt站访问权限</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20250104165409590.png" alt="站点"></p><p>其中，<strong>飞天拉面神教</strong>的apitoken获取方式如下</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20250104165325398.png" alt="image-20250104165325398"></p><p><strong>飞天拉面神教</strong>的passkey获取方式如下</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20250104165457504.png" alt="image-20250104165457504"></p><p>至此就配置完成了，现在请点击一个视频并订阅，<code>docker logs -f auto-lady</code>并查看实时输出，检测是否找到了种子，是否开始下载了</p><h1 id="下载器安装">下载器安装</h1><p>qBittorrent和transmission安装一个即可，从功能上来说，qBittorrent更全</p><h2 id="推荐-qbittorrent安装与配置">（推荐）qBittorrent安装与配置</h2><h3 id="安装qbittorrent">安装qBittorrent</h3><p>使用Ubuntu的官方仓库安装qBittorrent</p><p>Ubuntu的官方仓库通常包含qBittorrent的稳定版本，只需打开终端并执行以下命令即可：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install qbittorrent-nox -y</span><br></pre></td></tr></table></figure><h3 id="开机自启qbittorrent">开机自启qBittorrent</h3><p>在<code>/etc/systemd/system/qbittorrent-nox.service</code>添加下面的内容，作为开机自动启动的服务</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=qBittorrent Command Line Client</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=root</span><br><span class="line">ExecStart=/usr/bin/qbittorrent-nox</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=5s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>随后执行下面两条命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># </span></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"><span class="comment"># </span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> qbittorrent-nox.service</span><br></pre></td></tr></table></figure><p>建议先运行一遍<code>qbittorrent-nox</code>，将端口设置为9090（可以为其它的端口号）【因为它需要你输入一个’y’，哎……新版本的要求】</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo qbittorrent-nox --webui-port=9090</span><br></pre></td></tr></table></figure><p>进入网页后，建议将用户名、密码修改完成后，再将进行关掉，使用systemctl方式重启进程</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果直接运行，因为无法输入&#x27;y&#x27;，从而无法进入网页</span></span><br><span class="line">sudo systemctl start qbittorrent-nox.service</span><br></pre></td></tr></table></figure><p>其它相关命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看状态</span></span><br><span class="line">sudo systemctl status qbittorrent-nox.service</span><br><span class="line"><span class="comment"># 停止</span></span><br><span class="line">sudo systemctl stop qbittorrent-nox</span><br></pre></td></tr></table></figure><h3 id="修改qbittorrent端口">修改qBittorrent端口</h3><ol><li><p><strong>停止qBittorrent-nox服务</strong>（如果正在运行）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop qbittorrent-nox</span><br></pre></td></tr></table></figure><p>如果你没有将qBittorrent-nox作为服务运行，而是直接在终端中运行，你可以直接关闭它。</p></li><li><p><strong>编辑qBittorrent配置文件</strong>： qBittorrent-nox的配置文件通常位于<code>~/.config/qBittorrent/qBittorrent.conf</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.config/qBittorrent/qBittorrent.conf</span><br></pre></td></tr></table></figure><p>如果qBittorrent-nox是以不同的用户运行，你可能需要切换到相应用户的家目录，或者根据实际情况调整路径。</p></li><li><p>在配置文件中找到<code>WebUI\Port=8080</code>这一行（如果没有这一行，你需要添加它），将<code>8080</code>更改为你想要的端口号。例如，如果你想将端口改为<code>9090</code>，则修改为：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WebUI\Port=9090</span><br></pre></td></tr></table></figure><p>保存并关闭文件。</p></li><li><p><strong>重新启动qBittorrent-nox</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start qbittorrent-nox</span><br></pre></td></tr></table></figure></li></ol><h3 id="qbittorrent常用命令">qBittorrent常用命令</h3><p>启动Qbittorrent：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qbittorrent-nox</span><br></pre></td></tr></table></figure><p>在后台启动Qbittorrent：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qbittorrent-nox -d</span><br></pre></td></tr></table></figure><p>查看Qbittorrent版本：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qbittorrent-nox -v</span><br></pre></td></tr></table></figure><p>启动 Qbittorrent 并指定 Web 面板的端口:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qbittorrent-nox --webui-port=xxxx</span><br></pre></td></tr></table></figure><p>查看帮助：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qbittorrent-nox -h</span><br></pre></td></tr></table></figure><h3 id="添加tracker">添加tracker</h3><p>每天都在维护的tracker链接：<a href="https://jsd.cdn.zzko.cn/gh/XIU2/TrackersListCollection/best.txt">https://jsd.cdn.zzko.cn/gh/XIU2/TrackersListCollection/best.txt</a></p><blockquote><p>如果使用了autolady，其实不用手动添加tracker了，如果你的qbit下载器在另一台服务器上，可以手动添加pt站对应的tracker（记得要带id的那种），最好是在一个pt站下载好的文件里把tracker复制下来使用。</p></blockquote><h1 id="一键配置https">一键配置HTTPS</h1><blockquote><p>项目：<a href="https://github.com/lthero-big/QcHTTPS">https://github.com/lthero-big/QcHTTPS</a></p></blockquote><p>一键安装nginx、申请证书、配置https</p><h2 id="功能">功能</h2><p>输入以下三个信息</p><ol><li>域名</li><li>服务端口（docker某个容器运行的端口）</li><li>申请ssl证书的邮箱</li></ol><h2 id="脚本下载与安装">脚本下载与安装</h2><h3 id="脚本下载">脚本下载</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/lthero-big/QcHTTPS/refs/heads/main/install_https.sh -O install_https.sh </span><br></pre></td></tr></table></figure><p>脚本将保存在本地 <code>install_https.sh</code> ，您可以随时执行</p><h3 id="脚本执行">脚本执行</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash install_https.sh</span><br></pre></td></tr></table></figure><h1 id="手动-使用http访问">【手动】使用HTTP访问</h1><p>要将运行在Docker容器中的服务通过域名访问，并使用Nginx作为反向代理来转发到宿主机的8043端口，你需要完成几个步骤。这包括设置DNS记录、配置Nginx以及确保网络安全。下面是具体步骤：</p><h2 id="步骤-1-设置dns记录">步骤 1: 设置DNS记录</h2><p>确保你的域名 <code>lady.lthero.top</code> 的DNS记录指向托管Nginx的服务器的IP地址。这通常在你的域名注册商处进行设置：</p><ul><li><strong>A记录</strong>：将域名指向IPv4地址。</li><li><strong>AAAA记录</strong>：将域名指向IPv6地址（如果适用）。</li></ul><h2 id="步骤-2-安装并启动nginx">步骤 2: 安装并启动Nginx</h2><p>步骤 1: 更新软件包列表</p><p>打开终端，首先使用<code>apt</code>命令更新你的包列表，以确保你安装的是最新版本的Nginx。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><p>步骤 2: 安装Nginx</p><p>使用<code>apt</code>安装Nginx。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure><h2 id="步骤-3-配置nginx">步骤 3: 配置Nginx</h2><p>你需要在Nginx中创建一个新的服务器块（server block），或者在已有的默认配置中修改，以设置反向代理。以下是一个基本的Nginx配置示例，将会把所有到 <code>lady.lthero.top</code> 的请求转发到本地的8043端口：</p><ol><li><p>打开或创建一个新的Nginx配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/lady.lthero.top</span><br></pre></td></tr></table></figure></li><li><p>添加以下配置：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> lady.lthero.top;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:8043;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个配置做了以下几点：</p><ul><li><code>listen 80;</code> 告诉Nginx监听80端口（HTTP标准端口）。</li><li><code>server_name lady.lthero.top;</code> 设置这个块应当响应的域名。</li><li><code>proxy_pass http://localhost:8043;</code> 指定所有传入的请求转发到本地的8043端口。</li><li><code>proxy_set_header</code> 指令将重要的HTTP头信息转发给后端应用。</li></ul></li><li><p>启用配置文件通过创建一个符号链接(一定要做)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /etc/nginx/sites-available/lady.lthero.top /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure></li><li><p>检查Nginx配置文件是否有语法错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure></li><li><p>如果没有错误，重启Nginx以应用配置(一定要做)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure></li></ol><h2 id="步骤-4-调整防火墙规则">步骤 4: 调整防火墙规则</h2><p>确保你的服务器的防火墙规则允许HTTP（端口80）和HTTPS（端口443，如果你使用SSL）的流量。如果你正在使用<code>ufw</code>，可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow <span class="string">&#x27;Nginx Full&#x27;</span></span><br><span class="line">sudo ufw reload</span><br></pre></td></tr></table></figure><h2 id="步骤-5-测试配置">步骤 5: 测试配置</h2><p>在浏览器中输入 <code>http://lady.lthero.top</code> 或使用命令行工具如 <code>curl</code> 来测试你的配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://lady.lthero.top</span><br></pre></td></tr></table></figure><p>你应该能看到从Docker容器中运行的服务响应的内容。</p><p>这样，你就配置好了Nginx作为反向代理，将域名 <code>lady.lthero.top</code> 的流量转发到宿主机的8043端口上的服务。如果你希望使用HTTPS，你还需要设置SSL证书，可以考虑使用Let’s Encrypt免费证书并配置HTTPS。</p><h1 id="手动-使用https访问">【手动】使用HTTPS访问</h1><p>要让你的域名 <code>lady.lthero.top</code> 使用 HTTPS，你需要获取 SSL/TLS 证书，并配置 Nginx 以使用这些证书来加密网页内容。以下是详细的步骤，包括如何使用 Let’s Encrypt 提供的免费证书自动化这个过程。</p><h2 id="步骤-1-安装-certbot">步骤 1: 安装 Certbot</h2><p>Certbot 是一个自动获取并安装 Let’s Encrypt 证书的客户端。在 Ubuntu 上安装 Certbot 及其 Nginx 插件非常简单：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install certbot python3-certbot-nginx</span><br></pre></td></tr></table></figure><h2 id="步骤-2-获取和安装证书">步骤 2: 获取和安装证书</h2><p>使用 Certbot 获取并为你的域名安装证书：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx -d lady.lthero.top</span><br></pre></td></tr></table></figure><p>此命令会自动为指定的域名 <code>lady.lthero.top</code> 配置 SSL 证书，并更新 Nginx 配置以使用这些证书。Certbot 会询问你一些问题，比如电子邮件地址（用于紧急联系和证书续订提醒），以及是否重定向所有 HTTP 请求到 HTTPS（强烈建议启用）。</p><p>生成的证书位置<code>/etc/letsencrypt/live/</code></p><h2 id="步骤-3-更新-nginx-配置">步骤 3: 更新 Nginx 配置</h2><p>如果你想手动编辑 Nginx 配置文件，可以按以下方式配置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/lady.lthero.top</span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> lady.lthero.top;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$server_name</span><span class="variable">$request_uri</span>;  <span class="comment"># 强制重定向所有 HTTP 请求到 HTTPS</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">server_name</span> lady.lthero.top;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/lady.lthero.top/fullchain.pem;  <span class="comment"># 证书文件路径</span></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/lady.lthero.top/privkey.pem;  <span class="comment"># 私钥文件路径</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">1d</span>;</span><br><span class="line">    <span class="attribute">ssl_session_cache</span> shared:MozSSL:<span class="number">10m</span>;  <span class="comment"># 缓存 SSL 会话以提升性能</span></span><br><span class="line">    <span class="attribute">ssl_session_tickets</span> <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 现代加密套件配置</span></span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> <span class="string">&#x27;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384&#x27;</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 其他 SSL 优化设置</span></span><br><span class="line">    <span class="attribute">ssl_stapling</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_stapling_verify</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 允许最大请求体大小为 1000MB</span></span><br><span class="line">    <span class="attribute">client_max_body_size</span> <span class="number">1000m</span>;  </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:8043;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个配置不仅启用了 HTTPS，还包括了一些现代的安全实践，如启用 HTTP/2，配置加密套件和协议等。</p><h2 id="步骤-4-重新加载-nginx">步骤 4: 重新加载 Nginx</h2><p>启用配置文件通过创建一个符号链接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /etc/nginx/sites-available/lady.lthero.top /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure><p>更改配置后，需要重新加载 Nginx 以应用新的配置：</p><blockquote><p>检查配置文件是否有语法错误，如果有warn!直接看“遇到的问题”部分，重新加载配置是不一定能work的</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查配置文件是否有语法错误</span></span><br><span class="line">sudo nginx -t  </span><br><span class="line"><span class="comment"># 重新加载配置</span></span><br><span class="line">sudo systemctl reload nginx  </span><br><span class="line"><span class="comment"># 如果重新加载配置后无效，可以尝试重启nginx</span></span><br><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure><h2 id="步骤-5-验证-https">步骤 5: 验证 HTTPS</h2><p>在浏览器中访问 <code>https://lady.lthero.top</code> 来检查是否配置成功。你应该能够看到一个安全锁标志，表明连接是通过 HTTPS 加密的。</p><h2 id="步骤-6-自动续订证书">步骤 6: 自动续订证书</h2><p>Let’s Encrypt 的证书有效期为90天，因此建议设置自动续订：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew</span><br></pre></td></tr></table></figure><p>这个命令会测试证书续订过程。如果这个测试成功，添加定时任务<code>crontab</code>：</p><p><code>crontab -e</code>再填写下面内容，表示每月第一天会自动执行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 * * /usr/local/bin/certbot renew --manual --preferred-challenges dns --manual-auth-hook <span class="string">&quot;alidns&quot;</span> --manual-cleanup-hook <span class="string">&quot;alidns clean&quot;</span> --deploy-hook <span class="string">&quot;nginx -s reload&quot;</span></span><br></pre></td></tr></table></figure><p>续签的证书位置<code>/etc/letsencrypt/renewal</code></p><p>通过以上步骤，你的站点 <code>lady.lthero.top</code> 现在应该能够安全地使用 HTTPS 进行通信了。</p><p>如果要换编辑器，运行下面的命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select-editor</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;autolady安装与配置&quot;&gt;Autolady安装与配置&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;前排提醒：注意身体，仅限技术交流；&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在你的系统中，创建个目录 &lt;code&gt;autolady&lt;/code&gt;，再进入目录后创建</summary>
      
    
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
  </entry>
  
  <entry>
    <title>日常开发中用到的一些代理配置方式</title>
    <link href="https://blog.lthero.cn/2025/01/03/UseProxyInWindows/"/>
    <id>https://blog.lthero.cn/2025/01/03/UseProxyInWindows/</id>
    <published>2025-01-03T08:56:55.000Z</published>
    <updated>2025-01-03T08:58:20.270Z</updated>
    
    <content type="html"><![CDATA[<h1 id="日常开发中用到的一些代理配置方式">日常开发中用到的一些代理配置方式</h1><blockquote><p>原文：<a href="https://keqingrong.cn/blog/2021-02-19-proxy-and-pac/">https://keqingrong.cn/blog/2021-02-19-proxy-and-pac/</a></p></blockquote><p>本文介绍了内网开发会用到的一些代理配置方式，代理服务器的域名、IP 地址和端口假设为 <code>proxy.example.com</code>、<code>127.0.0.1</code>、<code>8080</code>。</p><h2 id="如何验证-http-代理是否设置成功">如何验证 HTTP 代理是否设置成功</h2><p>首先无法使用 <code>ping</code> 命令，因为 <code>ping</code> 使用的是 ICMP 协议，不是 HTTP 协议。</p><p>类 Unix 系统可以使用 <code>curl</code> 测试是否可以访问外网：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl https://www.baidu.com</span><br></pre></td></tr></table></figure><p>Windows 可以使用 <code>Invoke-WebRequest</code> cmdlet 命令：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">Invoke-WebRequest</span> <span class="literal">-Uri</span> https://www.baidu.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以通过 Get-Help 查看 Invoke-WebRequest 命令的帮助说明</span></span><br><span class="line">&gt; <span class="built_in">Get-Help</span> <span class="built_in">Invoke-WebRequest</span></span><br></pre></td></tr></table></figure><h2 id="在命令行中使用代理">在命令行中使用代理</h2><blockquote><p>代理相关的环境变量，理论上不区分大小写，<code>https_proxy</code> 或 <code>HTTPS_PROXY</code> 都可以生效，具体取决于程序实现。 如果希望配置多个三级域名不走代理，比如 <code>a.example.com</code> / <code>b.example.com</code> / <code>c.example.com</code>，除了将它们全部加入 <code>no_proxy</code>，还可以简化成二级域名 <code>example.com</code>（不支持 <code>*.example.com</code> 写法），更多细节参考 <a href="https://about.gitlab.com/blog/2021/01/27/we-need-to-talk-no-proxy/">We need to talk: Can we standardize NO_PROXY?</a>。</p></blockquote><h3 id="sh-compatible-shell-适用于-macos-linux-wsl-git-bash">sh-compatible Shell（适用于 macOS/Linux/WSL/Git Bash）</h3><p>设置代理：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> http_proxy=http://proxy.example.com:8080</span><br><span class="line"><span class="built_in">export</span> https_proxy=http://proxy.example.com:8080</span><br><span class="line"><span class="built_in">export</span> all_proxy=http://proxy.example.com:8080</span><br><span class="line"><span class="built_in">export</span> no_proxy=localhost,127.0.0.1,example.com</span><br></pre></td></tr></table></figure><blockquote><p>如果希望配置持续生效，可以写入到 <code>.bashrc</code>/<code>.zshrc</code> 等文件中。</p></blockquote><p>除了使用 <code>proxy.example.com</code> 域名，也可以使用对应 IP 地址：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> http_proxy=http://127.0.0.1:8080</span><br><span class="line"><span class="built_in">export</span> https_proxy=http://127.0.0.1:8080</span><br><span class="line"><span class="built_in">export</span> all_proxy=http://127.0.0.1:8080</span><br></pre></td></tr></table></figure><p>取消代理：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> http_proxy</span><br><span class="line"><span class="built_in">unset</span> https_proxy</span><br><span class="line"><span class="built_in">unset</span> all_proxy</span><br><span class="line"><span class="built_in">unset</span> no_proxy</span><br></pre></td></tr></table></figure><h3 id="windows-powershell">Windows PowerShell</h3><p>设置代理：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$env:http_proxy</span>=<span class="string">&quot;http://proxy.example.com:8080&quot;</span></span><br><span class="line"><span class="variable">$env:https_proxy</span>=<span class="string">&quot;http://proxy.example.com:8080&quot;</span></span><br><span class="line"><span class="variable">$env:no_proxy</span>=<span class="string">&quot;localhost,127.0.0.1,example.com&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>如果希望配置持续生效，可以将环境变量加入到系统环境变量中。</p></blockquote><p>取消代理：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$env:http_proxy</span>=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="variable">$env:https_proxy</span>=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="variable">$env:no_proxy</span>=<span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><h3 id="windows-命令提示符-cmd">Windows 命令提示符（cmd）</h3><p>设置代理：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set http_proxy=http://proxy.example.com:8080</span><br><span class="line">set https_proxy=http://proxy.example.com:8080</span><br><span class="line">set no_proxy=localhost,127.0.0.1,example.com</span><br></pre></td></tr></table></figure><p>取消代理：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set http_proxy=</span><br><span class="line">set https_proxy=</span><br><span class="line">set no_proxy=</span><br></pre></td></tr></table></figure><h3 id="git">git</h3><p>设置代理：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.proxy <span class="string">&#x27;socks5://127.0.0.1:8960&#x27;</span></span><br><span class="line">git config --global https.proxy <span class="string">&#x27;socks5://127.0.0.1:8960&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="npm-代理配置">npm 代理配置</h2><p>设置代理：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> proxy http://proxy.example.com:8080</span><br><span class="line">npm config <span class="built_in">set</span> https-proxy http://proxy.example.com:8080</span><br></pre></td></tr></table></figure><p>设置成功后 <code>.npmrc</code> 会新增两条配置：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">proxy</span>=http://proxy.example.com:<span class="number">8080</span></span><br><span class="line"><span class="attr">https-proxy</span>=http://proxy.example.com:<span class="number">8080</span></span><br></pre></td></tr></table></figure><p>另外，公司内部部署了 npm 私服，地址形如 <code>registry.npm.example.com</code>，仅内网能访问，安装、发布私有包不应该走代理，因此需要加上 <code>noproxy</code> 配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> noproxy registry.npm.example.com</span><br></pre></td></tr></table></figure><p>相应地，<code>.npmrc</code> 的代理配置最终变成：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">proxy</span>=http://proxy.example.com:<span class="number">8080</span></span><br><span class="line"><span class="attr">https-proxy</span>=http://proxy.example.com:<span class="number">8080</span></span><br><span class="line"><span class="attr">noproxy</span>=localhost,registry.npm.example.com</span><br></pre></td></tr></table></figure><p>这样便可以同时使用外网的 npm 官方源/淘宝源和内网的 npm 私服：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置为 npm 官方源</span></span><br><span class="line">npm config <span class="built_in">set</span> registry https://registry.npmjs.org/</span><br><span class="line"><span class="comment"># 或者设置为淘宝源</span></span><br><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org/</span><br><span class="line"></span><br><span class="line"><span class="comment"># `@example` 下的私有包始终使用内网 npm 源</span></span><br><span class="line">npm config <span class="built_in">set</span> @example:registry http://registry.npm.example.com/</span><br></pre></td></tr></table></figure><p>再次推荐私有包命名为 <code>@scope/name</code> 形式，参见之前的文章 <a href="https://keqingrong.cn/blog/2019-04-08-npm-issues/">npm 私有包</a>。</p><p>取消代理：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config delete proxy</span><br><span class="line">npm config delete https-proxy</span><br></pre></td></tr></table></figure><h2 id="yarn-1-x-代理配置">Yarn 1.x 代理配置</h2><p>设置代理，和 npm 类似：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yarn config <span class="built_in">set</span> proxy http://proxy.example.com:8080</span><br><span class="line">yarn config <span class="built_in">set</span> https-proxy http://proxy.example.com:8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果 SSL 报错，可以禁用校验</span></span><br><span class="line">yarn config <span class="built_in">set</span> strict-ssl <span class="literal">false</span></span><br><span class="line"><span class="comment"># 设置淘宝源</span></span><br><span class="line">yarn config <span class="built_in">set</span> registry https://registry.npm.taobao.org/</span><br></pre></td></tr></table></figure><p>取消代理：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn config <span class="built_in">unset</span> proxy</span><br><span class="line">yarn config <span class="built_in">unset</span> https-proxy</span><br></pre></td></tr></table></figure><p>注意：Yarn 没有实现 <code>noproxy</code>，所以不存在 <code>yarn config set noproxy registry.npm.example.com</code>，其内部使用的请求库 <a href="https://github.com/request/request/blob/master/lib/getProxyFromURI.js">request</a> 只支持从环境变量 <code>process.env.no_proxy</code> 获取不走代理的 URL 配置，并且如果已经设置了 npm 或者 Yarn 的 <code>proxy</code> 配置项（Yarn 会默认读取 npm 配置），<code>process.env.no_proxy</code> 会被忽略。因此在代理配置时，如果需要排除某些地址，必须删除 npm 或者 Yarn 的代理配置，改为使用命令行环境变量。</p><ul><li>问题追踪 <a href="https://github.com/yarnpkg/yarn/issues/5048">Yarn ignores no_proxy environment variable when proxy property set #5048</a></li><li>相关 PR <a href="https://github.com/yarnpkg/yarn/pull/5757">feat(request): add noProxy setting for configuration (#5048) #5757</a></li></ul><h2 id="yarn-2-berry-代理配置">Yarn 2 Berry 代理配置</h2><p>设置代理：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn config <span class="built_in">set</span> httpProxy http://proxy.example.com:8080</span><br><span class="line">yarn config <span class="built_in">set</span> httpsProxy http://proxy.example.com:8080</span><br></pre></td></tr></table></figure><p>设置 npm registry 源：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn config <span class="built_in">set</span> npmRegistryServer https://registry.npm.taobao.org/</span><br><span class="line">yarn config <span class="built_in">set</span> npmScopes.example.npmRegistryServer http://registry.npm.example.com/</span><br><span class="line">yarn config <span class="built_in">set</span> npmScopes.local.npmRegistryServer http://registry.npm.example.com/</span><br></pre></td></tr></table></figure><p>如果使用了 HTTP 而非 HTTPS 的源，会报 <strong>Unsafe http requests must be explicitly whitelisted in your configuration</strong> 错误，可以将地址加入白名单：</p><p>macOS/Linux：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn config <span class="built_in">set</span> unsafeHttpWhitelist --json <span class="string">&#x27;[&quot;*.example.com&quot;, &quot;example.com&quot;]&#x27;</span></span><br></pre></td></tr></table></figure><p>在 Windows 命令行中输入 JSON 参数有所不同，需要对双引号进行转义：</p><p>Windows PowerShell：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yarn config <span class="built_in">set</span> unsafeHttpWhitelist <span class="literal">--json</span> <span class="string">&#x27;[\&quot;*.example.com\&quot;, \&quot;example.com\&quot;]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果不包含空格，外层的单引号可以省略</span></span><br><span class="line">yarn config <span class="built_in">set</span> unsafeHttpWhitelist <span class="literal">--json</span> [\<span class="string">&quot;*.example.com\&quot;</span>]</span><br><span class="line">yarn config <span class="built_in">set</span> unsafeHttpWhitelist <span class="literal">--json</span> [\<span class="string">&quot;*.example.com\&quot;</span>,\<span class="string">&quot;example.com\&quot;</span>]</span><br></pre></td></tr></table></figure><p>Windows 命令提示符（cmd），字符串只支持双引号不支持单引号：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn config set unsafeHttpWhitelist --json &quot;[\&quot;*.example.com\&quot;, \&quot;example.com\&quot;]&quot;</span><br></pre></td></tr></table></figure><h2 id="git-代理配置">Git 代理配置</h2><p>Git 仓库通常支持多个协议：</p><ul><li><code>http://</code> 对应 <code>http.proxy</code></li><li><code>https://</code> 对应 <code>https.proxy</code></li><li><code>git://</code> 对应 <code>core.gitproxy</code></li></ul><p>如果通过 SSH 的方式访问 Git 仓库，则直接修改 SSH 配置。</p><p>设置全局代理：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.proxy http://proxy.example.com:8080</span><br><span class="line">git config --global https.proxy http://proxy.example.com:8080</span><br><span class="line">git config --global core.gitproxy &lt;自行参考 git 文档&gt;</span><br></pre></td></tr></table></figure><p>取消全局代理：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global --<span class="built_in">unset</span> http.proxy</span><br><span class="line">git config --global --<span class="built_in">unset</span> https.proxy</span><br><span class="line">git config --global --<span class="built_in">unset</span> core.gitproxy</span><br></pre></td></tr></table></figure><p>如果只是希望某个项目设置代理，省略 <code>--global</code> 参数即可。</p><h2 id="gradle-代理配置">Gradle 代理配置</h2><p>在 <code>gradle.properties</code> 中设置代理（可以是项目中的 <code>gradle.properties</code> 或者用户 HOME 目录的 <code>.gradle/gradle.properties</code>）：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">systemProp.http.proxyHost</span>=<span class="string">proxy.example.com</span></span><br><span class="line"><span class="attr">systemProp.http.proxyPort</span>=<span class="string">8080</span></span><br><span class="line"><span class="attr">systemProp.http.nonProxyHosts</span>=<span class="string">localhost|127.0.0.1|10.*|*.example.com</span></span><br><span class="line"></span><br><span class="line"><span class="attr">systemProp.https.proxyHost</span>=<span class="string">proxy.example.com</span></span><br><span class="line"><span class="attr">systemProp.https.proxyPort</span>=<span class="string">8080</span></span><br><span class="line"><span class="attr">systemProp.https.nonProxyHosts</span>=<span class="string">localhost|127.0.0.1|10.*|*.example.com</span></span><br></pre></td></tr></table></figure><p>为了加速依赖下载，可能还需要设置镜像源：</p><p>在用户 HOME 目录的 <code>.gradle</code> 文件夹下创建 <code>init.gradle</code> 文件，即 <code>~/.gradle/init.gradle</code>（Windows 环境下为 <code>%USERPROFILE%\.gradle\init.gradle</code>）。</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven &#123;</span><br><span class="line">            url <span class="string">&#x27;http://maven.example.com/content/groups/public&#x27;</span></span><br><span class="line">            content &#123;</span><br><span class="line">                includeGroup <span class="string">&quot;com.example&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        maven &#123; url <span class="string">&#x27;https://maven.aliyun.com/repository/public&#x27;</span> &#125;</span><br><span class="line">        maven &#123; url <span class="string">&#x27;https://maven.aliyun.com/repository/jcenter&#x27;</span> &#125;</span><br><span class="line">        maven &#123; url <span class="string">&#x27;https://maven.aliyun.com/repository/google&#x27;</span> &#125;</span><br><span class="line">        mavenLocal()</span><br><span class="line">        mavenCentral()</span><br><span class="line">        jcenter()</span><br><span class="line">        google()</span><br><span class="line">        maven &#123; url <span class="string">&#x27;https://www.jitpack.io&#x27;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>建议修改全局的 Gradle 配置，如果修改项目中的配置不一定生效，比如：</p><ul><li><code>&lt;React Native project&gt;/android/build.gradle</code></li><li><code>&lt;React Native project&gt;/node_modules/react-native-screens/android/build.gradle</code></li><li><code>&lt;React Native project&gt;/node_modules/react-native-safe-area-context/android/build.gradle</code></li></ul><h2 id="maven-代理配置">Maven 代理配置</h2><p>在 <code>settings.xml</code> 中设置代理：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">proxies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">proxy</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>http-proxy<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">active</span>&gt;</span>true<span class="tag">&lt;/<span class="name">active</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">protocol</span>&gt;</span>http<span class="tag">&lt;/<span class="name">protocol</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">host</span>&gt;</span>proxy.example.com<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">port</span>&gt;</span>8080<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">nonProxyHosts</span>&gt;</span>localhost|127.0.0.1|10.*|*.example.com<span class="tag">&lt;/<span class="name">nonProxyHosts</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">proxy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">proxy</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>https-proxy<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">active</span>&gt;</span>true<span class="tag">&lt;/<span class="name">active</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">protocol</span>&gt;</span>https<span class="tag">&lt;/<span class="name">protocol</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">host</span>&gt;</span>proxy.example.com<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">port</span>&gt;</span>8080<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">nonProxyHosts</span>&gt;</span>localhost|127.0.0.1|10.*|*.example.com<span class="tag">&lt;/<span class="name">nonProxyHosts</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">proxy</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">proxies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="浏览器代理配置">浏览器代理配置</h2><h3 id="手动代理配置">手动代理配置</h3><ul><li>Windows：在 IE 中取消勾选【自动检测设置】和【使用自动配置脚本】，勾选【为 LAN 使用代理服务器】和【对于本地地址不使用代理服务器】，填入服务器地址和端口。</li><li>手机：打开电脑热点，手机连接以后修改 WiFi 配置，选择【HTTP 代理-配置代理】，勾选【手动】，填入服务器地址和端口。</li></ul><h3 id="自动代理配置">自动代理配置</h3><ul><li>Windows：在 IE 中勾选【使用自动配置脚本】，填入 PAC 文件地址。（不要勾选【自动检测设置】和【为 LAN 使用代理服务器】）</li><li>手机：打开电脑热点，手机连接以后修改 WiFi 配置，选择【HTTP 代理-配置代理】，勾选【自动】，填入 PAC 文件地址。</li></ul><p>自动代理配置依赖 PAC 文件，PAC 文件地址从何而来，见下文。</p><h3 id="pac-文件">PAC 文件</h3><p>PAC 即 Proxy Auto Config，最早由 Netscape Navigator 2.0 引入到 Web 浏览器中，大部分浏览器和操作系统都支持，以下是一段文件示例：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// proxy.pac</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">FindProxyForURL</span>(<span class="params">url, host</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">dnsDomainIs</span>(host, <span class="string">&#x27;.public.example.com&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;PROXY 127.0.0.1:8080&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    <span class="title function_">shExpMatch</span>(host, <span class="string">&#x27;localhost&#x27;</span>) ||</span><br><span class="line">    <span class="title function_">shExpMatch</span>(host, <span class="string">&#x27;127.0.0.1&#x27;</span>) ||</span><br><span class="line">    <span class="title function_">shExpMatch</span>(host, <span class="string">&#x27;10.*&#x27;</span>) ||</span><br><span class="line">    <span class="title function_">shExpMatch</span>(host, <span class="string">&#x27;192.168.*&#x27;</span>) ||</span><br><span class="line">    <span class="title function_">shExpMatch</span>(url, <span class="string">&#x27;https://gitlab.example-inc.com/*&#x27;</span>) ||</span><br><span class="line">    <span class="title function_">shExpMatch</span>(url, <span class="string">&#x27;https://oa.example-inc.com/*&#x27;</span>) ||</span><br><span class="line">    <span class="title function_">shExpMatch</span>(url, <span class="string">&#x27;https://mail.example-inc.com/*&#x27;</span>) ||</span><br><span class="line">    <span class="title function_">dnsDomainIs</span>(host, <span class="string">&#x27;.example.com&#x27;</span>) ||</span><br><span class="line">    <span class="title function_">dnsDomainIs</span>(host, <span class="string">&#x27;.test.com&#x27;</span>)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;DIRECT&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;PROXY 127.0.0.1:8080&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体如何编写可以参考 <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Proxy_servers_and_tunneling/Proxy_Auto-Configuration_(PAC)_file">Proxy Auto-Configuration (PAC) file - MDN</a>。</p><p>PAC 文件编写完成后需要托管到静态文件服务器上，以便通过某个地址访问，比如 <code>http://static.example.com/proxy.pac</code>。</p><h3 id="让-nginx-支持-pac-文件">让 Nginx 支持 PAC 文件</h3><p>Nginx 默认不支持 PAC 文件，直接将 <code>proxy.pac</code> 放到 Nginx 的 <code>html</code> 目录下，访问 <code>http://static.example.com/proxy.pac</code> 返回的媒体类型为 <code>application/octet-stream</code>，浏览器无法将其识别为代理配置文件。</p><p>需要手动修改 Nginx 的 <code>mime.types</code> 配置：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">application/x-ns-proxy-<span class="attribute">autoconfig</span>                pac;</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">application/x-javascript-<span class="attribute">config</span>                  pac;</span><br></pre></td></tr></table></figure><p>至于默认返回的 <code>application/octet-stream</code>，取决于 Nginx 的 <code>default_type</code> 配置：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">default_type</span>  application/octet-stream;</span><br></pre></td></tr></table></figure><h2 id="微信开发者工具代理配置">微信开发者工具代理配置</h2><p>如果系统设置过代理，则直接在【代理设置】中勾选【使用系统代理】；否则，选择【手动设置代理】，填入代理服务器地址和端口。</p><h2 id="相关链接">相关链接</h2><ul><li>npm<ul><li><a href="https://docs.npmjs.com/cli/v7/using-npm/config">config - npm docs</a></li><li><a href="https://docs.npmjs.com/cli/v7/commands/npm-config">npm config - npm docs</a></li></ul></li><li>Yarn<ul><li><a href="https://yarnpkg.com/cli/config/set">yarn config set - Yarn</a></li><li><a href="https://yarnpkg.com/cli/config/unset">yarn config unset - Yarn</a></li></ul></li><li>Java<ul><li><a href="https://docs.oracle.com/en/java/javase/14/docs/api/java.base/java/net/doc-files/net-properties.html">Networking Properties</a></li><li><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/net/proxies.html">Java Networking and Proxies</a></li></ul></li><li>Gradle<ul><li><a href="https://docs.gradle.org/current/userguide/build_environment.html#sec:accessing_the_web_via_a_proxy">Accessing the web through a HTTP proxy - Gradle</a></li><li><a href="https://docs.gradle.org/current/userguide/declaring_repositories.html">Declaring repositories</a></li><li><a href="https://docs.gradle.org/current/userguide/init_scripts.html">Initialization Scripts</a></li></ul></li><li>Maven<ul><li><a href="https://maven.apache.org/guides/mini/guide-proxies.html">Configuring a proxy - Maven</a></li><li><a href="https://maven.apache.org/ref/3.6.3/maven-settings/settings.html">Maven Settings</a></li></ul></li><li>PAC<ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Proxy_servers_and_tunneling">Proxy servers and tunneling - MDN</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Proxy_servers_and_tunneling/Proxy_Auto-Configuration_(PAC)_file">Proxy Auto-Configuration (PAC) file - MDN</a></li><li><a href="https://en.wikipedia.org/wiki/Proxy_auto-config">Proxy auto-config - Wikipedia</a></li></ul></li><li>HTTP_PROXY, HTTPS_PROXY, NO_PROXY<ul><li><a href="https://superuser.com/questions/944958/are-http-proxy-https-proxy-and-no-proxy-environment-variables-standard">Are HTTP_PROXY, HTTPS_PROXY and NO_PROXY environment variables standard?</a></li><li><a href="https://github.com/curl/curl/issues/1208">Please document syntax and semantics of NO_PROXY environment variable. #1208 - curl</a></li><li><a href="https://about.gitlab.com/blog/2021/01/27/we-need-to-talk-no-proxy/">We need to talk: Can we standardize NO_PROXY?</a></li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;日常开发中用到的一些代理配置方式&quot;&gt;日常开发中用到的一些代理配置方式&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;原文：&lt;a href=&quot;https://keqingrong.cn/blog/2021-02-19-proxy-and-pac/&quot;&gt;https://ke</summary>
      
    
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
  </entry>
  
  <entry>
    <title>【阿里cdn】被恶意刷流量!</title>
    <link href="https://blog.lthero.cn/2024/12/31/FUCK-U-CDN-STEALER/"/>
    <id>https://blog.lthero.cn/2024/12/31/FUCK-U-CDN-STEALER/</id>
    <published>2024-12-31T08:42:46.000Z</published>
    <updated>2024-12-31T09:26:48.408Z</updated>
    
    <content type="html"><![CDATA[<h1 id="阿里cdn被恶意刷流量">阿里cdn被恶意刷流量</h1><h2 id="说明">说明</h2><p>本人在 github 部署了静态网页博客，使用阿里云的 cdn 进行加速，最近发现 cdn 流量异常</p><p>异常表现：晚上 20 点到 2 点期间刷了 4GB 流量，访问 10w+次；并不是每天都有，最近是隔一周左右发生一次</p><h2 id="处理">处理</h2><p>好在阿里云提供了查询 ip 的接口（接口还被藏起来了）</p><p><a href="https://next.api.aliyun.com/api/Cdn/2018-05-10/DescribeDomainTopClientIpVisit">https://next.api.aliyun.com/api/Cdn/2018-05-10/DescribeDomainTopClientIpVisit</a></p><p>返回结果如下</p><p><em>仅一天内的访问情况</em></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;ClientIpList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Acc&quot;</span><span class="punctuation">:</span> <span class="number">172871</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;Traffic&quot;</span><span class="punctuation">:</span> <span class="number">1932827800</span><span class="punctuation">,</span> #Byte<span class="punctuation">,</span>大概 <span class="number">2</span>GB</span><br><span class="line">  <span class="attr">&quot;Rank&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;ClientIp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.202.114.36&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><h2 id="坏蛋-ip">坏蛋 ip</h2><p><strong>1.202.114.36</strong></p><p><strong>1.202.114.242</strong></p><p><strong>219.143.174.174</strong></p><p>北京电信的</p><h2 id="后续处理">后续处理</h2><p>1、在阿里云控制台把这个ip段封掉（添加到黑名单）</p><p>2、对整个域名添加限速和限流量设置</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;阿里cdn被恶意刷流量&quot;&gt;阿里cdn被恶意刷流量&lt;/h1&gt;
&lt;h2 id=&quot;说明&quot;&gt;说明&lt;/h2&gt;
&lt;p&gt;本人在 github 部署了静态网页博客，使用阿里云的 cdn 进行加速，最近发现 cdn 流量异常&lt;/p&gt;
&lt;p&gt;异常表现：晚上 20 点到 2 点期间刷了</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="cdn盗用" scheme="https://blog.lthero.cn/tags/cdn%E7%9B%97%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>【VPS面板】哪吒面板安装</title>
    <link href="https://blog.lthero.cn/2024/12/25/Install-VPS-Dashboard/"/>
    <id>https://blog.lthero.cn/2024/12/25/Install-VPS-Dashboard/</id>
    <published>2024-12-25T12:43:21.000Z</published>
    <updated>2025-01-02T13:14:03.641Z</updated>
    
    <content type="html"><![CDATA[<h1 id="哪吒面板安装过程">哪吒面板安装过程</h1><blockquote><p>用到的项目：<a href="https://nezha.wiki/">https://nezha.wiki/</a></p></blockquote><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241225204400503.png" alt="实现效果图"></p><h2 id="写在前面">写在前面</h2><p>安装分两个部分（控制端dashboard，被控端agent）</p><p>其中控制端的软件安装在一台机器A上即可，被控制端的设备(B,C,D)向A定期发送数据</p><h2 id="在控制端中安装dashboard">在控制端中安装Dashboard</h2><p>在面板服务器中，运行以下安装脚本：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://raw.githubusercontent.com/nezhahq/scripts/refs/heads/main/install.sh -o nezha.sh &amp;&amp; <span class="built_in">chmod</span> +x nezha.sh &amp;&amp; sudo ./nezha.sh</span><br></pre></td></tr></table></figure><p>如果你的服务器位于中国大陆，可以使用镜像：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://gitee.com/naibahq/scripts/raw/main/install.sh -o nezha.sh &amp;&amp; <span class="built_in">chmod</span> +x nezha.sh &amp;&amp; sudo CN=<span class="literal">true</span> ./nezha.sh</span><br></pre></td></tr></table></figure><p>以 Docker 安装为例，安装完成后按提示输入以下信息：</p><ul><li><code>请输入站点标题:</code> - 自定义站点标题。</li><li><code>请输入暴露端口:</code> - 公开访问端口（默认 8008，可自定义）</li><li><code>请指定安装命令中预设的 nezha-agent 通信域名地址</code> （例如 <a href="http://example.com:443">example.com:443</a>）<ul><li>这里不要写8008了，使用<code>域名:444</code>即可，如<code>dash.lthero.top:444</code></li></ul></li></ul><p>输入完成后，等待拉取 Docker 镜像</p><p>安装结束后，如果一切正常，你可以通过域名和端口号访问 Dashboard，例如：</p><p><code>http://dash.example.com:8008</code></p><p>如果需要再次运行安装脚本，可输入以下命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nezha.sh</span><br></pre></td></tr></table></figure><p>打开管理脚本</p><h3 id="登录到-dashboard-配置界面">登录到 Dashboard 配置界面</h3><p>后台管理界面的路径为 <code>/dashboard</code>，你只需访问：</p><p><code>http://dash.example.com:8008/dashboard</code></p><p>首次登录的默认用户名和密码均为 <code>admin</code></p><p>建议安装后立即进入管理页面：点击头像 → “个人信息” → “更新个人资料”修改密码。</p><h2 id="https安装">HTTPS安装</h2><h3 id="脚本下载">脚本下载</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/lthero-big/QcHTTPS/refs/heads/main/install_https.sh -O install_https.sh </span><br></pre></td></tr></table></figure><p>脚本将保存在本地 ，install_https.sh ，您可以随时执行</p><h3 id="脚本执行">脚本执行</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash install_https.sh</span><br></pre></td></tr></table></figure><p>随后输入</p><ul><li>域名，如<code>dash.lthero.top</code></li><li>端口，<code>8008</code></li><li>邮箱，自己的</li></ul><p>然后等证书下来后</p><p>修改这个配置文件<code>vim /etc/nginx/sites-available/dash.lthero.top</code></p><h3 id="nginx-配置示例">Nginx 配置示例</h3><blockquote><p>如果你没有使用CloudFlare的服务，下面的代码默认为“你使用nginx作为最外层”，需要按下面的注释，删除（注释掉）一些代码</p></blockquote><p>以下是使用 Nginx 配置反向代理的示例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl http2;</span><br><span class="line">    listen [::]:443 ssl http2;</span><br><span class="line">    <span class="comment"># http2 on; # Nginx &gt; 1.25.1，请注释上面两行，启用此行</span></span><br><span class="line"></span><br><span class="line">    server_name dashboard.example.com; <span class="comment"># 替换为你的域名</span></span><br><span class="line">    ssl_certificate          /data/letsencrypt/fullchain.pem; <span class="comment"># 域名证书路径</span></span><br><span class="line">    ssl_certificate_key      /data/letsencrypt/key.pem;       <span class="comment"># 域名私钥路径</span></span><br><span class="line">    ssl_stapling on;</span><br><span class="line">    ssl_session_timeout 1d;</span><br><span class="line">    ssl_session_cache shared:SSL:10m; <span class="comment"># 如果与其他配置冲突，请注释此项</span></span><br><span class="line">    ssl_protocols TLSv1.2 TLSv1.3;</span><br><span class="line"></span><br><span class="line">    underscores_in_headers on;</span><br><span class="line">    set_real_ip_from 0.0.0.0/0; <span class="comment"># 替换为你的 CDN 回源 IP 地址段</span></span><br><span class="line">    real_ip_header CF-Connecting-IP; <span class="comment"># 替换为你的 CDN 提供的私有 header，此处为 CloudFlare 默认</span></span><br><span class="line">    <span class="comment"># 如果你使用nginx作为最外层，把上面两行注释掉</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># grpc 相关    </span></span><br><span class="line">    location ^~ /proto.NezhaService/ &#123;</span><br><span class="line">        grpc_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        grpc_set_header nz-realip <span class="variable">$http_CF_Connecting_IP</span>; <span class="comment"># 替换为你的 CDN 提供的私有 header，此处为 CloudFlare 默认</span></span><br><span class="line">        <span class="comment"># grpc_set_header nz-realip $remote_addr; # 如果你使用nginx作为最外层，就把上面一行注释掉，启用此行</span></span><br><span class="line">        grpc_read_timeout 600s;</span><br><span class="line">        grpc_send_timeout 600s;</span><br><span class="line">        grpc_socket_keepalive on;</span><br><span class="line">        client_max_body_size 10m;</span><br><span class="line">        grpc_buffer_size 4m;</span><br><span class="line">        grpc_pass grpc://dashboard;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># websocket 相关</span></span><br><span class="line">    location ~* ^/api/v1/ws/(server|terminal|file)(.*)$ &#123;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header nz-realip <span class="variable">$http_cf_connecting_ip</span>; <span class="comment"># 替换为你的 CDN 提供的私有 header，此处为 CloudFlare 默认</span></span><br><span class="line">        <span class="comment"># proxy_set_header nz-realip $remote_addr; # 如果你使用nginx作为最外层，就把上面一行注释掉，启用此行</span></span><br><span class="line">        proxy_set_header Origin https://<span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">        proxy_read_timeout 3600s;</span><br><span class="line">        proxy_send_timeout 3600s;</span><br><span class="line">        proxy_pass http://127.0.0.1:8008;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># web</span></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header nz-realip <span class="variable">$http_cf_connecting_ip</span>; <span class="comment"># 替换为你的 CDN 提供的私有 header，此处为 CloudFlare 默认</span></span><br><span class="line">        <span class="comment"># proxy_set_header nz-realip $remote_addr; # 如果你使用nginx作为最外层，就把上面一行注释掉，启用此行</span></span><br><span class="line">        proxy_read_timeout 3600s;</span><br><span class="line">        proxy_send_timeout 3600s;</span><br><span class="line">        proxy_buffer_size 128k;</span><br><span class="line">        proxy_buffers 4 256k;</span><br><span class="line">        proxy_busy_buffers_size 256k;</span><br><span class="line">        proxy_max_temp_file_size 0;</span><br><span class="line">        proxy_pass http://127.0.0.1:8008;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream dashboard &#123;</span><br><span class="line">    server 127.0.0.1:8008;</span><br><span class="line">    keepalive 512;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name dash.lthero.top;</span><br><span class="line">    <span class="built_in">return</span> 301 https://$server_name<span class="variable">$request_uri</span>;  <span class="comment"># 强制重定向所有 HTTP 请求到 HTTPS</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面是我的设置</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">server_name</span> dash.lthero.top; <span class="comment"># 替换为你的域名</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span>          /etc/letsencrypt/live/dash.lthero.top/fullchain.pem; <span class="comment"># 域名证书路径</span></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span>      /etc/letsencrypt/live/dash.lthero.top/privkey.pem; <span class="comment"># 域名私钥路径</span></span><br><span class="line">    <span class="attribute">ssl_stapling</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">1d</span>;</span><br><span class="line">    <span class="attribute">ssl_session_cache</span> shared:SSL:<span class="number">10m</span>; <span class="comment">#</span></span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">underscores_in_headers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># grpc 相关    </span></span><br><span class="line">    <span class="section">location</span><span class="regexp"> ^~</span> /proto.NezhaService/ &#123;</span><br><span class="line">        <span class="attribute">grpc_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">grpc_set_header</span> nz-realip <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">grpc_read_timeout</span> <span class="number">600s</span>;</span><br><span class="line">        <span class="attribute">grpc_send_timeout</span> <span class="number">600s</span>;</span><br><span class="line">        <span class="attribute">grpc_socket_keepalive</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">client_max_body_size</span> <span class="number">10m</span>;</span><br><span class="line">        <span class="attribute">grpc_buffer_size</span> <span class="number">4m</span>;</span><br><span class="line">        <span class="attribute">grpc_pass</span> grpc://dashboard;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># websocket 相关</span></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~* ^/api/v1/ws/(server|terminal|file)(.*)$</span> &#123;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> nz-realip <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Origin https://<span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">        <span class="attribute">proxy_read_timeout</span> <span class="number">3600s</span>;</span><br><span class="line">        <span class="attribute">proxy_send_timeout</span> <span class="number">3600s</span>;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:8008;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># web</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> nz-realip <span class="variable">$remote_addr</span>; </span><br><span class="line">        <span class="attribute">proxy_read_timeout</span> <span class="number">3600s</span>;</span><br><span class="line">        <span class="attribute">proxy_send_timeout</span> <span class="number">3600s</span>;</span><br><span class="line">        <span class="attribute">proxy_buffer_size</span> <span class="number">128k</span>;</span><br><span class="line">        <span class="attribute">proxy_buffers</span> <span class="number">4</span> <span class="number">256k</span>;</span><br><span class="line">        <span class="attribute">proxy_busy_buffers_size</span> <span class="number">256k</span>;</span><br><span class="line">        <span class="attribute">proxy_max_temp_file_size</span> <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:8008;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">upstream</span> dashboard &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8008</span>; <span class="comment"># 8008服务端口</span></span><br><span class="line">    <span class="attribute">keepalive</span> <span class="number">512</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> dash.lthero.top;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$server_name</span><span class="variable">$request_uri</span>;  <span class="comment"># 强制重定向所有 HTTP 请求到 HTTPS</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后，重启nginx即可</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t  <span class="comment"># 检查配置文件是否有语法错误</span></span><br><span class="line">sudo systemctl reload nginx  <span class="comment"># 重新加载配置</span></span><br><span class="line"><span class="comment"># 如果重新加载配置后无效，可以尝试重启nginx</span></span><br><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure><h2 id="在被控端安装agent">在被控端安装agent</h2><p>哪吒监控支持在 Windows、macOS 和 Linux 上一键安装 Agent</p><h3 id="准备工作">准备工作</h3><p>在安装前，需要提前在管理面板中设置通信域名，该域名不建议接入 CDN。</p><p>本文档以示例<strong>通信域名</strong> “<a href="http://dash.example.com:444">dash.example.com:444</a>” 为例</p><ol><li>在后台管理面板点击头像，进入“系统设置”页。</li><li>在“Agent对接地址【域名/IP:端口】”项中填入通信域名和端口 “<a href="http://dash.example.com:444">dash.example.com:444</a>”<ul><li>不要用8008了，换个端口就行</li></ul></li><li>点击“确认”保存设置</li></ol><h3 id="一键安装步骤">一键安装步骤</h3><ol><li>在 <code>服务器</code> 页面中，点击 <code>安装命令</code> 并选择对应操作系统，安装命令将自动复制到你的剪贴板。</li><li>在被控端服务器中运行安装命令，等待安装完成后返回到 <code>服务器</code> 页面查看是否上线。</li><li>如果安装成功，页面中将自动弹出新的服务器，你可以点击编辑按钮为其设置名称。</li></ol><h2 id="查看-agent-运行日志">查看 Agent 运行日志</h2><p>在配置文件中启用 debug 模式，使用以下命令查看 Agent 的运行状态和日志：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status nezha-agent-*</span><br></pre></td></tr></table></figure><p>如果出现多个运行结果，说明你运行了多次agent</p><blockquote><p><code>/opt/nezha/agent/</code> 下面有多少个config*.json就对应了相应的配置个数</p></blockquote><h2 id="卸载-agent">卸载 Agent</h2><p>卸载 Agent 包括停止服务、卸载服务，以及删除相关文件。以下是 Ubuntu 系统的卸载步骤：</p><ol><li><p>停止并卸载服务：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/nezha/agent/nezha-agent service uninstall</span><br></pre></td></tr></table></figure></li><li><p>删除 Agent 文件夹：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /opt/nezha/agent/</span><br></pre></td></tr></table></figure></li></ol><p>如果安装了多个服务并想要全部卸载，可以使用 Agent 安装脚本的卸载功能：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./agent.sh uninstall</span><br></pre></td></tr></table></figure><h1 id="数据迁移-备份恢复">数据迁移、备份恢复</h1><p>新、旧服务器要使用相同的域名以及端口，保证无缝过渡</p><ol><li><strong>停止面板服务</strong><br>在旧服务器中运行一键脚本，选择 <code>停止面板</code>。</li><li><strong>备份数据</strong><br>打包旧服务器中的 <code>/opt/nezha</code> 文件夹，并将其复制到新服务器相同位置。</li><li><strong>恢复数据</strong><br>在新服务器中解压 <code>/opt/nezha</code> 文件夹至相同路径。</li><li><strong>启动面板服务</strong><br>在新服务器中运行一键脚本，选择 <code>启动面板</code>。</li></ol><h3 id="注意事项">注意事项</h3><ul><li>确保 <code>/opt/nezha</code> 文件夹及其内容的权限和所有权在新服务器上正确设置。</li><li>数据迁移完成后，可以通过访问 Dashboard 界面验证迁移是否成功。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;哪吒面板安装过程&quot;&gt;哪吒面板安装过程&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;用到的项目：&lt;a href=&quot;https://nezha.wiki/&quot;&gt;https://nezha.wiki/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;h</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>超低成本PS5远程串流</title>
    <link href="https://blog.lthero.cn/2024/12/23/PS5RemotePlay/"/>
    <id>https://blog.lthero.cn/2024/12/23/PS5RemotePlay/</id>
    <published>2024-12-23T05:04:53.000Z</published>
    <updated>2025-01-07T11:06:03.132Z</updated>
    
    <content type="html"><![CDATA[<h1 id="超低成本ps5远程串流">超低成本PS5远程串流!</h1><blockquote><p>思路：<strong>网络部分</strong>使用zerotier创建虚拟局域网，让PS5在虚拟局域网内，从而被其它设备访问；<strong>控制部分</strong>使用开源的软件chiaki（pxplay也行，但它收费）注意，chiaki有多版本，目前使用<strong>chiaki-ng</strong></p></blockquote><p>开源项目：<a href="https://github.com/streetpea/chiaki-ng">chiaki-ng</a></p><p><strong>特性：</strong></p><ul><li>支持Windows/MacOS/Android/Linux…</li><li>可以调整码率，支持远程唤醒、Xbox手柄！</li><li>支持DS原生震动和线性板机！</li></ul><p><strong>chiaki</strong>虽好，但需要设备处于同一局域网内</p><blockquote><p>如果只在局域网内使用，请分别下载对应客户端食用即可；后续教程可以跳过~</p></blockquote><hr><p>但，如果想在不同的网连接，要么需要公网，要么可以<strong>创建“虚拟局域网”(VLAN)，<strong>需要软件(zerotier)让设备都处在同一个</strong>虚拟局域网</strong>内，这样就能使用chiaki啦~</p><p>下面的教程分为四大部分：</p><ol><li>注册zerotier与创建虚拟局域网</li><li>路由器安装zerotier与配置虚拟局域网</li><li>客户端加入虚拟局域网</li><li>开玩！</li></ol><hr><h2 id="1-注册zerotier与创建vlan">1.注册zerotier与创建VLAN</h2><p>在zerotier官网 <a href="https://zerotier.com/">https://zerotier.com/</a> 上注册账号</p><p>随后，点击&quot;create a network&quot;</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/PixPin_2025-01-06_22-18-55.png" alt="创建网络"></p><h4 id="none"></h4><p>然后点击创建出来的网络，Name可以随便起，AccessControl<strong>最好使用’Private’</strong></p><blockquote><p>即：所有要加入这个虚拟局域网的设备需要你手动认证审核；</p></blockquote><p><strong>记下这里的Network ID</strong>，它就是你的虚拟局域网ID啦，后面需要用上</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/PixPin_2025-01-06_22-21-33.png" alt="选择Private"></p><h4 id="none"></h4><p>接下来，可以更换虚拟局域网的ip段，当然，使用系统分配的也可以啦</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/PixPin_2025-01-06_22-24-29.png" alt="可以更换虚拟局域网的ip段"></p><p>zerotier官网的所有操作会自动更新，所以不用手动保存</p><h2 id="2-路由器安装zerotier与配置vlan">2.路由器安装zerotier与配置VLAN</h2><p>这一步是比较劝退的，由于ps5无法安装zerotier，所以我们只能曲线救国；</p><blockquote><p>在路由器（刷了openwrt系统或其它系统）上安装zerotier</p></blockquote><ul><li>自动：一般在openwrt系统的应用商店可以搜索并下载到（甚至默认安装）</li><li>半自动：zerotier官方提供了比较方便的安装方式，一条命令即可完成（这里默认您已经会使用ssh工具并连入路由器）</li></ul><blockquote><p>curl -s <a href="https://install.zerotier.com/">https://install.zerotier.com/</a> | sudo bash</p></blockquote><h3 id="加入虚拟局域网">加入虚拟局域网</h3><p>在路由器上加入到创建的虚拟局域网</p><blockquote><p>zerotier-cli join fadxxxxx5eb45a9</p></blockquote><p>随后，在zerotier官网上授权这个设备的接入，将设备前面的Auth同意，此设备就加入虚拟局域网成功了，右侧可以看到这个设备的虚拟ip</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/PixPin_2025-01-06_22-37-03.png" alt="同意设备接入"></p><h4 id="none"></h4><h3 id="配置虚拟局域网">配置虚拟局域网</h3><p>但目前只让路由器加入了这个虚拟局域网，<strong>为了让ps也能入网</strong>，我们需要先<strong>设置NAT</strong></p><ul><li>在zerotier网页，找到**“Manage Routes”**模块，将ps所在的真实局域网段（如我这里写的是192.168.8.0/24）填写在Destination，将路由器的虚拟ip填写在Via</li></ul><blockquote><p>从而让你真实局域网内的所有设备，都能被虚拟局域网访问，而路由器就充当了”中间人“</p></blockquote><p><img src="https://cdn.lthero.cn/post_images/course/ML/PixPin_2025-01-06_22-35-32.png" alt="设置NAT"></p><p>点击Submit提交。</p><p>最后一步，需要在路由器的zerotier管理页面，<strong>自动允许客户端NAT</strong></p><p><img src="https://cdn.lthero.cn/post_images/course/ML/PixPin_2025-01-06_22-44-15.png" alt="自动允许客户端NAT"></p><p>即完成虚拟局域网的配置；</p><hr><h2 id="3-客户端加入虚拟局域网">3.客户端加入虚拟局域网</h2><p>还是在zerotier官网，下载pc对应的客户端，如果是安卓，建议用<a href="https://github.com/kaaass/ZerotierFix">安卓zerotier好用版</a></p><p>在pc下载zerotier后，需要加入虚拟局域网，还是使用上面的NetworkID，并且仍然需要手动确认加入。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/PixPin_2025-01-06_23-15-54.png" alt="pc加入网络"></p><p>电脑上会安装一个虚拟网卡，如果弹出来选项框都点是。</p><p>其它平台也是类似操作，安装好对应的客户端后加入网络即可。</p><hr><h2 id="4-开玩">4.开玩！</h2><blockquote><p>为了体现出虚拟局域网的用处，最好让电脑与ps处于不同的真实局域网中，比如让电脑连接手机热点；</p></blockquote><h3 id="电脑端串流">电脑端串流</h3><p>电脑上下载chiaki-ng，链接-&gt;<a href="https://github.com/streetpea/chiaki-ng">chiaki-ng</a> <a href="https://github.com/streetpea/chiaki-ng">https://github.com/streetpea/chiaki-ng</a> ，找到<a href="https://github.com/streetpea/chiaki-ng/releases/download/v1.9.3/chiaki-ng-windows-installer.exe">chiaki-ng-windows-installer.exe</a>（免费）</p><p>打开chiaki-ng后，点击右上角”+“号，输入ps5的真实局域网ip（比如192.168.8.5）</p><blockquote><p>记得吗，前面把整个192.168.8.0/24网段都加入到虚拟局域网了</p></blockquote><p><img src="https://cdn.lthero.cn/post_images/course/ML/PixPin_2025-01-06_23-21-51.png" alt="img"></p><p>然后需要添加注册用户（其实就是需要登录ps账号），但<strong>不要直接填写你PSN的ID，它需要填写base64格式</strong></p><p><img src="https://cdn.lthero.cn/post_images/course/ML/PixPin_2025-01-06_23-27-15.png" alt="填写转码后的ID和远程PIN"></p><p>使用<a href="https://psn.flipscreen.games/">ID转换工具</a> <a href="https://psn.flipscreen.games">https://psn.flipscreen.games</a> 得到转码后的ID，记得要复制chiaki这一个，psplay是另一个软件的（psplay收费）</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/PixPin_2025-01-06_23-28-14.png" alt="复制chiaki的那一串码子"></p><p>另外，需要在ps的“设置”-&gt;“系统”-&gt;“远程游玩“开启远程游玩，并且找到PIN码（有时效），将PIN填写在软件上。</p><p><strong>随后即添加大成功！！！</strong></p><p><img src="https://cdn.lthero.cn/post_images/course/ML/PixPin_2025-01-06_23-33-12.png" alt="ps设备添加成功"></p><ul><li>如果主机处于开机状态（白色），直接双击就能开始远程串流了</li><li>如果主机处于待机状态（黄色），需要选择”Wakeup“发送唤醒操作，然后再进行远程串流</li><li>主机完全关机的状态下无法被唤醒，更无法串流；（可以试试<strong>手指机器人</strong>？）</li></ul><h3 id="电脑端演示效果">电脑端演示效果</h3><p><img src="https://cdn.lthero.cn/post_images/course/ML/PixPin_2025-01-06_23-44-10.png" alt="电脑端演示效果"></p><p>按ctrl+o可以选择出来串流，其它的设置（包含分辨率、码率请自行调整）</p><p>---------------------------------------------</p><h3 id="安卓">安卓</h3><p>如果是安卓，可以在google商店下载到chiaki-up（免费）</p><p>安卓需要先打开zerotier并加入虚拟网络，并且保持加入网络的状态（会创建一个虚拟网卡）</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/Screenshot_2025-01-06-23-39-18-332-edit_net.kaaass.zerotierfix.jpg" alt="zerotier连接到虚拟局域网"></p><p>再打开chiaki-up，点击右下角添加ps5，方法与电脑端相似；</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/Screenshot_2025-01-06-23-38-41-202-edit_com.gameblabla.chiaki.jpg" alt="chiaki-up添加主机"></p><h3 id="手机端演示效果">手机端演示效果</h3><p>可以用蓝牙连接ds，再<strong>将屏幕上的虚拟控制关闭</strong></p><p><img src="https://cdn.lthero.cn/post_images/course/ML/Screenshot_2025-01-06-23-53-26-538_com.gameblabla.chiaki.jpg" alt="手机演示效果"></p><hr><p>至此，教程应该就结束了；</p><h2 id="延迟问题">延迟问题</h2><p>我与朋友测试过，相隔150公里左右，<strong>延迟稳定10ms~15ms</strong>；并且串流时可以正常使用线性板机、震动等功能；体验还是不错的。</p><p>另外，zerotier默认使用p2p打洞，如果打洞成功，延迟会很低而且稳定；</p><blockquote><p>但如果一直无法的洞成功，其实还可以尝试走中转服务器！</p></blockquote><p>但如何搭建moon中转服务器，可惜这里的空白处太小，写不下~</p><p><strong>最后，提前祝大家新年快乐！</strong></p><h1 id="原文">原文</h1><blockquote><p>这里是最初写的</p></blockquote><h2 id="网络部分">网络部分</h2><p>zerotier的安装与使用具体可以查看另一篇文章</p><ol><li>在zerotier创建一个虚拟局域网fx2811dwx(随便写的)</li><li>在n1盒子上（刷了openwrt系统，并安装了zerotier插件）启动zerotier，并加入到虚拟局域网fx2811dwx，需要在zerotier控制台同意设备加入</li><li>为了让PS5也加入到这个网络，需要在n1盒子上，允许 Zerotier 的拨入客户端访问路由器 LAN 资源<ol><li>需要在 Zerotier 管理页面设定到 LAN 网段的路由表</li><li>比如n1盒子的虚拟ip是10.22.22.15，n1盒子的真实局域网ip是192.168.6.15。需要在zerotier管理页面，将LAN网段192.168.6.0/24 交给10.22.22.15进行转发</li><li>在PS5上，将网络设置的网关（以及主DNS）设置为n1盒子的真实局域网ip</li></ol></li></ol><p>如果没问题，此时同一个虚拟局域网下的设备，可以ping通PS5（假设它的真实局域网ip是192.168.6.5），也就是说，PS5是不需要安装zerotier或设置虚拟ip的，转发的操作已经交给了n1盒子</p><blockquote><p>如果网络不稳定，zerotier无法创建直连p2p，此时需要中转服务器（也叫moon服务器），具体操作在另一篇zerotier文章有写</p></blockquote><h3 id="注意">注意</h3><p>除了使用<strong>zerotier</strong>，也可以使用相似的<strong>tailscale</strong>、<strong>皎月连</strong>等虚拟局域网创建工具；</p><p>网上也有使用dmz转发的方法（需要有公网），但此方法会暴露端口，不太推荐</p><h2 id="操控部分">操控部分</h2><blockquote><p>PC/安卓/苹果 需要安装软件chiaki</p><p>项目：<a href="https://github.com/streetpea/chiaki-ng">https://github.com/streetpea/chiaki-ng</a></p></blockquote><p>假如在PC上下载好chiaki软件，此时假设PC也在n1盒子相同的“真实局域网下”（即PC可以ping通PS5），如果chiaki未发现PS5，可以自选添加</p><p>其中选项如下</p><ol><li>ip要设置为PS5的真实局域网ip（192.168.6.5）</li><li>写真实的PSN的ID，然后点击public lookup，可以自动填写ID对应的base64格式。或者用这个网站可以将PSN的ID转码https://psn.flipscreen.games/</li><li>以及pair对应的码子，在“系统”-&gt;“远程游玩”-&gt;&quot;配对&quot;里找，码子有效5分钟</li></ol><p>如果没问题，即可添加成功，随后即可开始串流</p><h3 id="注意">注意</h3><p>chiaki是支持ds手柄原生震动的，但需要有线连接到电脑，如果发现有线连接后还没震动，可以下载Playstation accessories（官方软件）并将手柄驱动更新，理论上不需要一直后台打开accessories就可以用原生震动（如果软件关闭原生震动就不能用，就一直打开accessories好了）</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;超低成本ps5远程串流&quot;&gt;超低成本PS5远程串流!&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;思路：&lt;strong&gt;网络部分&lt;/strong&gt;使用zerotier创建虚拟局域网，让PS5在虚拟局域网内，从而被其它设备访问；&lt;strong&gt;控制部分&lt;/strong&gt;</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
    <category term="PS5" scheme="https://blog.lthero.cn/tags/PS5/"/>
    
  </entry>
  
  <entry>
    <title>收集论文中的好语句与图表</title>
    <link href="https://blog.lthero.cn/2024/12/03/SomeGreatSentences/"/>
    <id>https://blog.lthero.cn/2024/12/03/SomeGreatSentences/</id>
    <published>2024-12-03T07:05:01.000Z</published>
    <updated>2025-01-09T14:30:10.186Z</updated>
    
    <content type="html"><![CDATA[<p>1</p><h1 id="sok-watermarking-for-ai-generated-content">SoK: Watermarking for AI-Generated Content</h1><h3 id="第一章节-introduction">第一章节（Introduction）</h3><blockquote><p>“Distinguishing between human-created and AI-generated content is becoming increasingly challenging, necessitating the development of effective techniques to maintain transparency,accountability, and the responsible use of GenAI.”</p></blockquote><p>区分人类创造的内容和人工智能生成的内容正变得越来越具有挑战性，需要开发有效的技术来保持透明度、问责制和负责任地使用GenAI。</p><blockquote><p>“While watermarking is not a <strong>silver bullet</strong> for addressing all risks associated with GenAI, it can play a crucial role in enhancing AI safety and trustworthiness by combating misinformation and deception.”</p></blockquote><p>虽然水印并不是解决与人工智能相关的所有风险的<strong>灵丹妙药</strong>，但它可以通过打击错误信息和欺骗，在提高人工智能的安全性和可信度方面发挥关键作用。</p><img src="C:/Users/12904/AppData/Roaming/Typora/typora-user-images/image-20241203151752811.png" alt="image-20241203151752811" style="zoom: 67%;" /><p><strong>首先</strong>，抛出问题：我们需要一个能区分AIGC和人工生成内容的技术</p><p><strong>其次</strong>，说出目前使用的解决方案，并突出它们的缺点；</p><ul><li>可能的方案一：记录所有AIGC的内容；但缺点有三，1、需要大量存储空间与跨组织协调；2、隐私保护问题；3、无法应用于开源模型</li><li>可能的方案二：使用post-hoc的检测方式；通过AIGC的特征来区分；缺点，这类检测方式有时间局限性，随着AIGC技术快速升级，生成内容与真实内容越发难的被划分出来。</li></ul><p><strong>最后</strong>，抛出预期的解决方案：水印。</p><ul><li>与其被动地对生成内容检测，不如“主动出击”</li><li>优点：水印技术不受GenAI模型不断发展的能力的限制，而是提供了一种<strong>深思熟虑的、持久的</strong>识别手段</li><li>优点：水印可以在以后检测到，允许在<strong>不依赖于固有或统计差异的情况下进行验证</strong>，从而提供了一种更有弹性的方法来区分机器生成的内容和人类工作</li><li>上述两个优点，正好解决了方案一与方案二的缺点</li></ul><blockquote><p>“Unlike methods that <strong>passively</strong> attempt to detect incidental differences between human and AI generated content, watermarking involves <strong>actively</strong> embedding an imperceptible signal within GenAI output at the time of its generation”</p></blockquote><p>与<strong>被动地</strong>尝试检测人类和人工生成内容之间偶然差异的方法不同，水印涉及在生成GenAI输出时<strong>主动嵌入</strong>难以察觉的信号。</p><p>随后，写一段本文后面几个章节的工作总览</p><h3 id="第二章节">第二章节</h3><p><strong>首先</strong>，介绍了post-hoc 的分类</p><p>1、zero-shot检测，收集统计特征来判断；</p><p>2、training-based检测，使用“包含人类与AIGC”的数据集进行训练；</p><p>post-hoc检测方法拥有较差的性能，此外对于不在数据集中的新模型，此检测方式即会失败</p><p><strong>其次</strong>，简单介绍了水印的历史与分类（可见，不可见）</p><p><strong>随后</strong>，强调GenAI时代对水印的急需性，从以下五点</p><p>1、Combating Misinformation</p><p>在人工智能生成的内容中添加水印可以帮助<strong>追踪信息来源</strong>，从而有助于识别错误信息和虚假信息。</p><p>2、Enhancing Fraud Detection</p><p>生成模型可以产生定制的诈骗信息，使传统的检测方法不那么有效。水印可以在识别和减轻这种复杂的骗局企图方面发挥关键作用，加强反骗局的努力</p><p>3、Deterring Academic Dishonesty.</p><p>水印可以帮助防止在一些领域作弊，比如学生论文，在这些领域验证文本是人类写的</p><p>4、Avoiding Training Data Contamination</p><p>如果模型不经意地在它们自己生成的输出上进行了训练，就会导致“模型崩溃”，在退化数据上进行迭代训练会降低生成内容的整体质量。水印可以帮助标记人工智能生成的内容</p><p>5、Providing Signatures and Attribution.</p><p>水印可以作为签名，允许用户验证内容是由特定模型生成的。此外，水印可以帮助证明归因于模型的有害内容是否真的由该模型生成。</p><p><strong>最后</strong>，强调了政府与工业届的政策</p><p>1、政府：包含美国、欧盟、中国等国家对AI的法规限制</p><p>2、工业届：C2PA与Google SynthID</p><h3 id="第三章节-what-s-a-watermark">第三章节（What’s a Watermark）</h3><h4 id="3-1质量">3.1质量</h4><p><strong>首先</strong>，介绍水印的构成（嵌入&amp;提取）两大部分</p><p>设想个应用场景（在AIGC时代），使用模型M和提示词<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi></mrow><annotation encoding="application/x-tex">\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">π</span></span></span></span>生成一个内容<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span>（视频、音频、文本、图像），随后使用一个水印模块<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>r</mi><msup><mi>k</mi><mi>M</mi></msup><mo stretchy="false">(</mo><mi>π</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Watermark^M(\pi)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0913309999999998em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">π</span><span class="mclose">)</span></span></span></span>-&gt;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span>表示在水印模块下生成的内容</p><p>并根据水印类型，划分成zero-bit水印与multi-bit 水印($ m \in {0,1} ^k<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">)</mo><mtext>，则更新后的演示公式是</mtext></mrow><annotation encoding="application/x-tex">)，则更新后的演示公式是</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">)</span><span class="mord cjk_fallback">，</span><span class="mord cjk_fallback">则</span><span class="mord cjk_fallback">更</span><span class="mord cjk_fallback">新</span><span class="mord cjk_fallback">后</span><span class="mord cjk_fallback">的</span><span class="mord cjk_fallback">演</span><span class="mord cjk_fallback">示</span><span class="mord cjk_fallback">公</span><span class="mord cjk_fallback">式</span><span class="mord cjk_fallback">是</span></span></span></span>Watermark^M(m,\pi)<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">-&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span>x$</p><p>相应的，还有<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Detect(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span></span>来判断是否存在水印，相应的也分成了</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Detect(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span></span> -&gt; <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi><mo separator="true">,</mo><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{true,  false\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">u</span><span class="mord mathdefault">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mclose">}</span></span></span></span> 进行zero-bit水印判断</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Detect(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span></span> -&gt; <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><msup><mo stretchy="false">}</mo><mi>k</mi></msup></mrow><annotation encoding="application/x-tex">\{0,1\}^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.099108em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">}</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span> 进行水印recover</li></ul><p>另外，还有一种<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>b</mi><mi>u</mi><mi>t</mi><mi>e</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Attribute(X)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault">t</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">b</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mclose">)</span></span></span></span>-&gt; <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi><mo separator="true">,</mo><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{true,  false\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">u</span><span class="mord mathdefault">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mclose">}</span></span></span></span></p><blockquote><p>Detect is used, for instance, to identify misinformation being spread by malicious users of the model,Attribute is used to accuse the model owner of producing problematic content</p></blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Detect</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span></span></span></span>用于识别模型恶意用户传播的错误信息，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>b</mi><mi>u</mi><mi>t</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">Attribute</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault">t</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">b</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span></span></span></span>用于指责模型所有者产生有问题的内容</p><p><strong>其次</strong>，介绍水印对质量的影响</p><p>经验质量验证和可证明性质量验证(heuristic versus provable)</p><ul><li><p>heuristic的更偏向于经验向，水印可能会严重影响实验中未捕获的提示或任务的质量。此外，实验中使用的质量度量可能存在偏差或不可靠。</p></li><li><p>provable可证明质量概念适用于任何可能的提示，并确保水印引入的任何偏差是有限的，甚至不存在。</p></li></ul><p>单反应和多反应(single-response versus multi-response)</p><p>一些保证仅适用于水印模型的单个响应。（例如，一些经验质量验证方法，低失真和无失真）</p><p>例如，图像水印可能会导致模型<strong>只输出狗的图像，但这些图像质量极高</strong>。该水印将<strong>满足单响应质量概念</strong>，因为这种偏差只会出现在多个响应中。</p><p>另一方面，其他概念表明，任何数量的水印响应都是高质量的（例如，更强的经验质量验证方法和不可检测性）</p><p><strong>经验质量验证</strong>(Empirical Quality Validation)</p><p><strong>使用其它模型</strong>来给水印内容的质量进行打分（HPSv2），或者<strong>让用户来比较</strong>水印与无水印内容的质量，但实际上，“经验质量”并没有大规模的使用，除了SynthID</p><p>SynthID在语法、相关性、正确性、有用性和整体质量5个类别中，使用人工评价来评价水印的效果。他们还根据经验评估了他们提出的方法的检出率，并表明它具有低假阳性率</p><p><strong>经验质量验证</strong>通常与下面详细说明的<strong>可证明的质量验证</strong>一起使用。</p><p>Distortion-free schemes ensure that the quality is preserved for any single  response from the model, but do not guarantee anything about the quality across multiple generations</p><p>无失真方案确保模型的任何单个响应都能保持质量，但不能保证多代的质量</p><h4 id="3-2-假阳率">3.2 假阳率</h4><p>在水印方案中，检测器(Detector)的一个重要特性是具有较低的误报率（false positive rate)</p><h4 id="3-3-假阳率与鲁棒性">3.3 假阳率与鲁棒性</h4><h4 id="3-4-不可伪造性-unforgeability">3.4 不可伪造性(Unforgeability)</h4><p>不可伪造性保证了没有嵌入密钥的攻击者无法生成看似带有水印的内容，除非是完全复制水印模型的输出内容。</p><p><strong>特性</strong>：确保只有拥有<strong>生成密钥</strong>或<strong>嵌入密钥</strong>的人才能嵌入有效的水印。</p><p><strong>安全性</strong>：防止攻击者伪造水印内容，误导他人认为<strong>某内容来自特定模型</strong>。</p><p><strong>实际意义</strong>：</p><ul><li>一个健全的水印方案必须确保攻击者在没有嵌入密钥的情况下，难以伪造带水印的输出。</li><li>这一特性为水印系统增加了一层可信度，尤其是在涉及责任追究和法律影响的场景中。</li></ul><blockquote><p>伪造攻击问题：如果攻击着拿着别人生成的图A，进行逆向后得到初始噪声，再生成一张有害图B</p></blockquote><p>解决方案：可以通过C2PA解决，假如图A的水印内容(C2PA凭证)已经记录了图A的提示词，哪怕通过图B提取出了水印（即C2PA凭证），可以通过提示词的比对，简单判断出图B的内容与C2PA中的不匹配，说明图像遭到了攻击。</p><p>在水印的设计中，<strong>Attribute（归因）<strong>与</strong>Detect（检测）<strong>是两个关键的功能模块，分别对应不同的应用需求和安全性目标。以下是对两者区别的详细说明，尤其是</strong>Attribute</strong>的功能和重要性：</p><h5 id="attribute-归因">Attribute（归因）</h5><ol><li><p><strong>核心目标</strong>：<br><strong>归因</strong>的核心目标是确定某个内容是否来自一个特定的水印模型。换句话说，Attribute功能用于对内容的来源进行可靠的追溯和责任划分。</p></li><li><p><strong>属性特点</strong>：</p><ul><li><strong>不可伪造性（Unforgeability）</strong>：<br>归因功能需要确保攻击者在不知道归因密钥（Attribute Key, (ak)）的情况下，<strong>无法生成带有有效水印但不属于模型真实输出的内容</strong>。这种不可伪造性对于追责至关重要，特别是在需要证明某模型生成了有害内容时。</li><li><strong>独立性</strong>：<br>归因算法及其密钥 (ak) 是独立于检测功能的，避免了归因和检测的目标相互干扰。归因的重点在于精确性和不可伪造性，而非鲁棒性。</li><li><strong>公开性选项</strong>：<br>在一些方案中，可以公开归因密钥 (ak) 而不影响不可伪造性。例如，使用数字签名技术，可以允许任何人验证内容是否来自某模型，但无法伪造这种内容。</li></ul></li><li><p><strong>应用场景</strong>：</p><ul><li><strong>责任追溯</strong>：<br>如果需要对模型生成的有害内容追责，例如证明某模型输出了虚假或误导性信息，归因功能是不可或缺的。</li><li><strong>法律和伦理保障</strong>：<br>当水印方案涉及敏感内容时，归因功能可以为模型的使用者或开发者提供明确的责任界定。</li></ul></li></ol><p>对于平台来说，如果有人想诬陷某种有害内容（假设是个图片A）是使用华为的模型生成的，此时我们对图片A进行归因，如果能解出来它的密钥，则确实是华为模型生成的；否则，就断定不是华为模型生成的，所以<strong>归因的重点在于精确性和不可伪造性</strong></p><h5 id="detect-检测">Detect（检测）</h5><ol><li><p><strong>核心目标</strong>：<br><strong>检测</strong>功能的目标是确认某个内容是否包含水印，而不关心内容的具体来源。它通常被设计为<strong>鲁棒</strong>的，也就是说，即使内容经过一定程度的修改（如小幅篡改或噪声添加），检测功能仍然可以识别出水印的存在。</p></li><li><p><strong>属性特点</strong>：</p><ul><li><strong>鲁棒性（Robustness）</strong>：<br>检测功能强调在内容被轻微修改后，仍然能够识别水印的能力。这对防止简单的攻击和篡改很重要。</li><li><strong>低误报率</strong>：<br>检测需要确保尽量减少误报（非水印内容被判定为有水印）和漏报（有水印内容被判定为没有水印）。</li></ul></li><li><p><strong>应用场景</strong>：</p><ul><li><strong>内容筛选</strong>：<br>在大规模内容分发中，可以快速检测内容是否带有水印，从而决定是否进一步处理。</li><li><strong>版权保护</strong>：<br>用于检查内容是否属于某水印模型的输出，但通常不追溯具体的生成责任。</li></ul></li></ol><h5 id="归因与检测的主要区别">归因与检测的主要区别</h5><table><thead><tr><th>特性</th><th><strong>Attribute（归因）</strong></th><th><strong>Detect（检测）</strong></th></tr></thead><tbody><tr><td><strong>核心目标</strong></td><td>确定内容来源，追溯责任</td><td>确认内容是否带有水印</td></tr><tr><td><strong>安全性需求</strong></td><td>强调不可伪造性</td><td>强调鲁棒性</td></tr><tr><td><strong>密钥的使用</strong></td><td>使用归因密钥（Attribute Key, (ak)）</td><td>使用检测密钥（Detect Key, (dtk)）</td></tr><tr><td><strong>是否允许公开密钥</strong></td><td>可以公开 (ak)，前提是保障不可伪造性</td><td>公开 (dtk) 可能影响鲁棒性</td></tr><tr><td><strong>典型应用场景</strong></td><td>内容归因、责任划分、法律证明</td><td>快速检测、筛选内容、版权保护</td></tr></tbody></table><p>归因功能（Attribute）是水印方案中实现<strong>不可伪造性</strong>的关键部分，旨在提供一种可靠的方法来<strong>追溯</strong>内容来源并划分生成责任。它的独特性在于，能够确保即使攻击者有意尝试，也无法伪造有效的归因内容。这种特性使归因功能在敏感场景（如法律诉讼、内容归责）中极为重要。与之相对，检测功能更偏向于应用层面的水印存在性验证，其核心是鲁棒性和效率。</p><p>我们得明确水印的目标，溯源本质是一种归因，要强调不可伪造性</p><p>1、有人用华为模型生成有害内容，需要溯源到用户，需要“归因”，此时不需要有强鲁棒性</p><p>2、有人想用有害内容诬陷华为，需要不可伪造性来证明，该内容不是华为生成的，需要“归因”，此时不需要有强鲁棒性</p><p>3、如果需要判断某个内容是否是AI生成，可以用“检测”，需要有强鲁棒性</p><p>**归因（Attribute）<strong>和</strong>检测（Detect）**看似在功能上有一定重叠，但它们的目标和设计侧重点不同：</p><ol><li><p><strong>归因确实能完成检测</strong>：<br>归因功能本质上包含了“检测是否带有水印”的能力。既然它能判断某个内容是否来自特定模型，那么它自然也能判断内容是否包含水印。然而，归因强调的是<strong>不可伪造性</strong>，因此它可以牺牲一些对鲁棒性的需求。</p></li><li><p><strong>检测专注于鲁棒性</strong>：<br>检测的目标是即便内容被篡改（如添加噪声、调整格式），仍然能够识别出水印存在。这种鲁棒性使得检测功能在版权保护和内容筛选等场景中非常高效。</p></li></ol><hr><h5 id="同时满足归因和检测的需求">同时满足归因和检测的需求</h5><p>是的，可以设计一种混合方案，满足两者的需求。具体方法如下：</p><h6 id="分离密钥和算法">分离密钥和算法</h6><p>可以将归因和检测分开设计，但在水印生成时统一实现。这样在检测和归因时可以根据需求选择不同的算法和密钥：</p><ul><li><strong>归因算法与密钥（Attribute and (ak)</strong>）：<ul><li>强调不可伪造性，确保内容来源可靠。</li><li>可以设计为更严格，但允许牺牲鲁棒性。</li></ul></li><li><strong>检测算法与密钥（Detect and (dtk)</strong>）：<ul><li>强调鲁棒性，确保即使内容被修改也能检测出水印。</li><li>允许更宽松的验证条件。</li></ul></li></ul><p>通过这种设计，归因和检测可以基于同一个水印生成算法，但在实际使用时根据需求分别调用不同的功能。</p><hr><h6 id="统一的水印生成机制-分层次需求满足">统一的水印生成机制，分层次需求满足</h6><p>设计一个同时支持归因和检测的水印方案，允许在不同场景下权衡两者：</p><ol><li><p><strong>水印生成阶段</strong>：</p><ul><li>使用单一算法生成水印，水印中包含既可供检测的鲁棒部分，又包含归因所需的不可伪造部分。</li><li>例如，基于<strong>加密签名</strong>的方法，生成的水印既包含公开检测的信息，也包含只有持有私密密钥才能验证的归因信息。</li></ul></li><li><p><strong>检测阶段</strong>：</p><ul><li>使用检测密钥 (dtk) 快速验证水印是否存在。</li><li>重点在于效率和鲁棒性，适合大规模内容筛选。</li></ul></li><li><p><strong>归因阶段</strong>：</p><ul><li>使用归因密钥 (ak) 进一步验证内容来源。</li><li>重点在于不可伪造性，适合小范围高精度分析。</li></ul></li></ol><hr><h6 id="动态水印切换">动态水印切换</h6><p>现代水印算法可以根据应用场景动态选择功能。例如：</p><ul><li>在常规内容筛选中，使用鲁棒的检测算法。</li><li>当需要追溯责任时，再切换到严格的归因算法。</li></ul><p>这样的动态切换可以通过<strong>密钥分级</strong>和<strong>算法模块化</strong>实现，确保归因和检测在同一个水印系统中共存且高效。</p><hr><h6 id="小结">小结</h6><p>归因和检测虽然目标不同，但它们可以通过统一的水印生成机制、分离的密钥和算法实现共存。具体来说：</p><ul><li>检测满足效率和鲁棒性需求。</li><li>归因满足不可伪造性需求。<br>通过分层设计，可以在一个系统中同时实现归因和检测的需求，适应不同的应用场景。</li></ul><h4 id="3-5-嵌入-消息">3.5 嵌入“消息”</h4><p>指嵌入用户信息，模型信息，提示词，生成时间等这种定制化内容，类似于C2PA</p><h4 id="3-6-高效计算">3.6 高效计算</h4><p>带水印的生成过程应该施加最小的计算开销，确保在计算、内存使用和吞吐量方面，计算效率与未带水印的生成过程相当。显著的计算复杂性会阻碍现实世界的部署，使模型对实际应用不那么有吸引力。</p><p>检测、解码和归因的计算需求也应保持在最低限度。</p><h3 id="第四章节-threat-models">第四章节 （Threat Models）</h3><p>介绍了一些攻击方式</p><p>1、水印去除</p><p>2、伪造水印</p><p>攻击者试图创建被错误地分类为水印的内容，尽管没有被指定的水印方案处理，从而实现一些诬陷（参考第三章节的不可伪造性）</p><p>3、秘密信息提取</p><p>更高级的对抗目标<strong>是提取水印方案中使用的密钥</strong>。这种攻击比移除或锻造攻击要困难得多。在大多数情况下，如果攻击者成功地提取了密钥，他们可以很容易地删除或伪造水印。然而，重要的是要注意，提取密钥并不是执行删除或伪造攻击的先决条件</p><h1 id="phoneme-level-feature-discrepancies-a-key-to-detecting-sophisticated-speech-deepfakes">Phoneme-Level Feature Discrepancies: A Key to Detecting Sophisticated Speech Deepfakes</h1><p>Speech deep fakes are synthetic recordings that closely mimic a person’s speech, making it challenging to verify the authenticity of information (Tan et al. 2024)</p><p>Advancements in deep learning technologies for generating realistic speech have made it increasingly difficult to detect these forgeries with conventional methods (Zhang et al. 2024).</p><p>2024年的论文，讲音频可以模仿人类音频的风险</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;1&lt;/p&gt;
&lt;h1 id=&quot;sok-watermarking-for-ai-generated-content&quot;&gt;SoK: Watermarking for AI-Generated Content&lt;/h1&gt;
&lt;h3 id=&quot;第一章节-introduction&quot;&gt;第一章节（</summary>
      
    
    
    
    <category term="AIGC" scheme="https://blog.lthero.cn/categories/AIGC/"/>
    
    
    <category term="AIGC" scheme="https://blog.lthero.cn/tags/AIGC/"/>
    
  </entry>
  
  <entry>
    <title>【Wallos安装】订阅服务统计</title>
    <link href="https://blog.lthero.cn/2024/12/01/InstallWallo/"/>
    <id>https://blog.lthero.cn/2024/12/01/InstallWallo/</id>
    <published>2024-12-01T13:31:20.000Z</published>
    <updated>2024-12-01T15:02:12.206Z</updated>
    
    <content type="html"><![CDATA[<h1 id="wallos">Wallos</h1><blockquote><p>提供订阅服务的统计</p></blockquote><h1 id="项目安装">项目安装</h1><p>创建目录，为了将数据库长期保存在本地</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> wallos</span><br></pre></td></tr></table></figure><p>docker compose文件</p><p>根据实际需求，修改映射端口等，如映射到宿主机的3001端口</p><p>vim docker-compose.yml</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">services:</span><br><span class="line">  wallos:</span><br><span class="line">    container_name: wallos</span><br><span class="line">    image: bellamy/wallos:latest</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8282:80/tcp&quot;</span><br><span class="line">    environment:</span><br><span class="line">      TZ: &#x27;America/Toronto&#x27;</span><br><span class="line">    # Volumes store your data between container upgrades</span><br><span class="line">    volumes:</span><br><span class="line">      - &#x27;./db:/var/www/html/db&#x27;</span><br><span class="line">      - &#x27;./logos:/var/www/html/images/uploads/logos&#x27;</span><br><span class="line">    restart: unless-stopped</span><br></pre></td></tr></table></figure><p>运行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><h1 id="使用http访问">使用HTTP访问</h1><p>要将运行在Docker容器中的服务通过域名访问，并使用Nginx作为反向代理来转发到宿主机的8282端口，你需要完成几个步骤。这包括设置DNS记录、配置Nginx以及确保网络安全。下面是具体步骤：</p><h2 id="步骤-1-设置dns记录">步骤 1: 设置DNS记录</h2><p>确保你的域名 <code>wo.lthero.top</code> 的DNS记录指向托管Nginx的服务器的IP地址。这通常在你的域名注册商处进行设置：</p><ul><li><strong>A记录</strong>：将域名指向IPv4地址。</li><li><strong>AAAA记录</strong>：将域名指向IPv6地址（如果适用）。</li></ul><h2 id="步骤-2-安装并启动nginx">步骤 2: 安装并启动Nginx</h2><p>步骤 1: 更新软件包列表</p><p>打开终端，首先使用<code>apt</code>命令更新你的包列表，以确保你安装的是最新版本的Nginx。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><p>步骤 2: 安装Nginx</p><p>使用<code>apt</code>安装Nginx。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure><h2 id="步骤-3-配置nginx">步骤 3: 配置Nginx</h2><p>你需要在Nginx中创建一个新的服务器块（server block），或者在已有的默认配置中修改，以设置反向代理。以下是一个基本的Nginx配置示例，将会把所有到 <code>wo.lthero.top</code> 的请求转发到本地的8282端口：</p><ol><li><p>打开或创建一个新的Nginx配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/wo.lthero.top</span><br></pre></td></tr></table></figure></li><li><p>添加以下配置：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> wo.lthero.top;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:3001;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个配置做了以下几点：</p><ul><li><code>listen 80;</code> 告诉Nginx监听80端口（HTTP标准端口）。</li><li><code>server_name wo.lthero.top;</code> 设置这个块应当响应的域名。</li><li><code>proxy_pass http://localhost:8282;</code> 指定所有传入的请求转发到本地的8282端口。</li><li><code>proxy_set_header</code> 指令将重要的HTTP头信息转发给后端应用。</li></ul></li><li><p>启用配置文件通过创建一个符号链接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /etc/nginx/sites-available/wo.lthero.top /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure></li><li><p>检查Nginx配置文件是否有语法错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure></li><li><p>如果没有错误，重启Nginx以应用配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure></li></ol><h2 id="步骤-4-调整防火墙规则">步骤 4: 调整防火墙规则</h2><p>确保你的服务器的防火墙规则允许HTTP（端口80）和HTTPS（端口443，如果你使用SSL）的流量。如果你正在使用<code>ufw</code>，可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow <span class="string">&#x27;Nginx Full&#x27;</span></span><br><span class="line">sudo ufw reload</span><br></pre></td></tr></table></figure><h2 id="步骤-5-测试配置">步骤 5: 测试配置</h2><p>在浏览器中输入 <code>http://wo.lthero.top</code> 或使用命令行工具如 <code>curl</code> 来测试你的配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://wo.lthero.top</span><br></pre></td></tr></table></figure><p>你应该能看到从Docker容器中运行的服务响应的内容。</p><p>这样，你就配置好了Nginx作为反向代理，将域名 <code>wo.lthero.top</code> 的流量转发到宿主机的8282端口上的服务。如果你希望使用HTTPS，你还需要设置SSL证书，可以考虑使用Let’s Encrypt免费证书并配置HTTPS。</p><h1 id="使用https访问">使用HTTPS访问</h1><p>要让你的域名 <code>wo.lthero.top</code> 使用 HTTPS，你需要获取 SSL/TLS 证书，并配置 Nginx 以使用这些证书来加密网页内容。以下是详细的步骤，包括如何使用 Let’s Encrypt 提供的免费证书自动化这个过程。</p><h2 id="步骤-1-安装-certbot">步骤 1: 安装 Certbot</h2><p>Certbot 是一个自动获取并安装 Let’s Encrypt 证书的客户端。在 Ubuntu 上安装 Certbot 及其 Nginx 插件非常简单：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install certbot python3-certbot-nginx -y</span><br></pre></td></tr></table></figure><h2 id="步骤-2-获取和安装证书">步骤 2: 获取和安装证书</h2><p>使用 Certbot 获取并为你的域名安装证书：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx -d wo.lthero.top</span><br></pre></td></tr></table></figure><p>此命令会自动为指定的域名 <code>wo.lthero.top</code> 配置 SSL 证书，并更新 Nginx 配置以使用这些证书。Certbot 会询问你一些问题，比如电子邮件地址（用于紧急联系和证书续订提醒），以及是否重定向所有 HTTP 请求到 HTTPS（强烈建议启用）。</p><p>生成的证书位置<code>/etc/letsencrypt/live/</code></p><h2 id="步骤-3-更新-nginx-配置">步骤 3: 更新 Nginx 配置</h2><p>如果你想手动编辑 Nginx 配置文件，可以按以下方式配置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/wo.lthero.top</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    server_name wo.lthero.top;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://localhost:8282;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection &#x27;upgrade&#x27;;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_cache_bypass $http_upgrade;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    listen 443 ssl; # managed by Certbot</span><br><span class="line">    ssl_certificate /etc/letsencrypt/live/wo.lthero.top/fullchain.pem; # managed by Certbot</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/wo.lthero.top/privkey.pem; # managed by Certbot</span><br><span class="line">    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot</span><br><span class="line">    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    if ($host = wo.lthero.top) &#123;</span><br><span class="line">        return 301 https://$host$request_uri;</span><br><span class="line">    &#125; # managed by Certbot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    listen 80;</span><br><span class="line">    server_name wo.lthero.top;</span><br><span class="line">    return 404; # managed by Certbot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> wo.lthero.top;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$server_name</span><span class="variable">$request_uri</span>;  <span class="comment"># 强制重定向所有 HTTP 请求到 HTTPS</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">server_name</span> wo.lthero.top;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/wo.lthero.top/fullchain.pem;  <span class="comment"># 证书文件路径</span></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/wo.lthero.top/privkey.pem;  <span class="comment"># 私钥文件路径</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">1d</span>;</span><br><span class="line">    <span class="attribute">ssl_session_cache</span> shared:MozSSL:<span class="number">10m</span>;  <span class="comment"># 缓存 SSL 会话以提升性能</span></span><br><span class="line">    <span class="attribute">ssl_session_tickets</span> <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 现代加密套件配置</span></span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> <span class="string">&#x27;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384&#x27;</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 其他 SSL 优化设置</span></span><br><span class="line">    <span class="attribute">ssl_stapling</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_stapling_verify</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 允许最大请求体大小为 1000MB</span></span><br><span class="line">    <span class="attribute">client_max_body_size</span> <span class="number">1000m</span>;  </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:8282;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个配置不仅启用了 HTTPS，还包括了一些现代的安全实践，如启用 HTTP/2，配置加密套件和协议等。</p><blockquote><p>允许最大请求体大小为 1000MB</p><p>client_max_body_size 1000m;</p><p>这行最好与config.js中保持一致，如果<strong>nginx设置小了，会出现“上传失败”的结果！</strong></p></blockquote><h2 id="步骤-4-重新加载-nginx">步骤 4: 重新加载 Nginx</h2><p>启用配置文件通过创建一个符号链接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /etc/nginx/sites-available/wo.lthero.top /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure><p>更改配置后，需要重新加载 Nginx 以应用新的配置：</p><blockquote><p>检查配置文件是否有语法错误，如果有warn!直接看“遇到的问题”部分，重新加载配置是不一定能work的</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t  <span class="comment"># 检查配置文件是否有语法错误</span></span><br><span class="line">sudo systemctl reload nginx  <span class="comment"># 重新加载配置</span></span><br><span class="line"><span class="comment"># 如果重新加载配置后无效，可以尝试重启nginx</span></span><br><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure><h2 id="步骤-5-验证-https">步骤 5: 验证 HTTPS</h2><p>在浏览器中访问 <code>https://wo.lthero.top</code> 来检查是否配置成功。你应该能够看到一个安全锁标志，表明连接是通过 HTTPS 加密的。</p><h2 id="步骤-6-自动续订证书">步骤 6: 自动续订证书</h2><p>Let’s Encrypt 的证书有效期为90天，因此建议设置自动续订：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew</span><br></pre></td></tr></table></figure><p>这个命令会测试证书续订过程。如果这个测试成功，添加定时任务<code>crontab</code>：</p><p><code>crontab -e</code>再填写下面内容，表示每月第一天会自动执行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 * * /usr/local/bin/certbot renew --deploy-hook <span class="string">&quot;nginx -s reload&quot;</span></span><br></pre></td></tr></table></figure><p>通过<code>which certbot</code>查看具体程序位置<code>/usr/local/bin/certbot</code></p><p>续签的证书位置<code>/etc/letsencrypt/renewal</code></p><p>通过以上步骤，你的站点 <code>wo.lthero.top</code> 现在应该能够安全地使用 HTTPS 进行通信了。</p><p>如果要换crontab编辑器，运行下面的命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select-editor</span><br></pre></td></tr></table></figure><h2 id="解析到阿里云dns的申请方法">解析到阿里云DNS的申请方法</h2><blockquote><p>如果域名解析在阿里云，可以安装这个插件从而完成证书申请，<a href="https://github.com/tengattack/certbot-dns-aliyun">https://github.com/tengattack/certbot-dns-aliyun</a></p></blockquote><h3 id="credentials-file">Credentials File</h3><p>在某个熟悉的目录下，把下面的内容写入<code>credentials.ini</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dns_aliyun_access_key = 12345678</span><br><span class="line">dns_aliyun_access_key_secret = 1234567890abcdef1234567890abcdef</span><br></pre></td></tr></table></figure><p>dns_aliyun_access_key是阿里云账号的AccessKey ID</p><p>dns_aliyun_access_key_secret是阿里云账号的AccessKey Secret</p><p>这两个值可以在阿里云控制台-&gt;用户头像-&gt;accesskeys按指引获取AccessKey/SecretKey</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 600 /path/to/credentials.ini</span><br></pre></td></tr></table></figure><h3 id="obtain-certificates">Obtain Certificates</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">certbot certonly \</span><br><span class="line">    --authenticator=dns-aliyun \</span><br><span class="line">    --dns-aliyun-credentials=<span class="string">&#x27;/path/to/credentials.ini&#x27;</span> \</span><br><span class="line">    -d <span class="string">&quot;*.example.com,example.com&quot;</span></span><br></pre></td></tr></table></figure><p>申请下来的证书位置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/letsencrypt/archive/</span><br></pre></td></tr></table></figure><p>适合阿里云的自动命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 * * /usr/local/bin/certbot renew --manual --preferred-challenges dns --manual-auth-hook <span class="string">&quot;alidns&quot;</span> --manual-cleanup-hook <span class="string">&quot;alidns clean&quot;</span> --deploy-hook <span class="string">&quot;nginx -s reload&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;wallos&quot;&gt;Wallos&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;提供订阅服务的统计&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;项目安装&quot;&gt;项目安装&lt;/h1&gt;
&lt;p&gt;创建目录，为了将数据库长期保存在本地&lt;/p&gt;
&lt;figure class=&quot;hig</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
  </entry>
  
  <entry>
    <title>【流媒体一键解锁脚本】</title>
    <link href="https://blog.lthero.cn/2024/12/01/SniproxySmartdnsInstaller/"/>
    <id>https://blog.lthero.cn/2024/12/01/SniproxySmartdnsInstaller/</id>
    <published>2024-12-01T09:54:42.000Z</published>
    <updated>2024-12-01T14:37:10.239Z</updated>
    
    <content type="html"><![CDATA[<h1 id="sniproxy-smartdns-一键配置脚本">sniproxy &amp; smartdns 一键配置脚本</h1><blockquote><p>开源项目：<a href="https://github.com/lthero-big/Smartdns_sniproxy_installer">https://github.com/lthero-big/Smartdns_sniproxy_installer</a></p></blockquote><h2 id="写在前面">写在前面</h2><p>最近黑五，买了一些机器，但机器解锁不太满意啊，于是在论坛四处找教程，最近东拼四凑出了这个脚本；</p><p>现有脚本的痛点：</p><p>1、不能方便的配置流媒体平台，sniproxy和smartdns的配置都需要手动修改，而且添加DNS机器也需要手动配置，有点儿麻烦；<br>2、大多是使用dnsmasq和sniproxy结合的脚本，没有smartdns的。</p><h3 id="知识">知识</h3><p>sniproxy：一个透明代理，反向代理流媒体网站（如Netflix），80和443端口不得被占用，且需要开放</p><p>smartdns：一个DNS服务器，用来分流DNS域名是否走sniproxy代理</p><h3 id="必要准备">必要准备</h3><ol><li>一台或多台能解锁流媒体的vps，<strong>简称“解锁机”</strong></li><li>没有vps的可以使用免费或付费的dns解锁服务，请注册Alice免费的DNS解锁服务<a href="https://app.alice.ws/">Alice</a></li><li>一台或多台不能解锁流媒体的vps，<strong>简称“被解锁机”</strong></li></ol><h3 id="实现效果">实现效果</h3><ol><li>让一台vps同时解锁多个地区的流媒体（美国、新加坡、日本、香港）</li><li>实现使用一个节点，同时解锁香港b站，美国油管，新加坡网飞以及日本HBO等</li></ol><p><img src="https://cdn.lthero.cn/post_images/course/ML/PixPin_2024-12-01_16-55-49.png" alt="PixPin_2024-12-01_16-55-49"></p><ol start="3"><li>快速添加不同地区</li></ol><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241201195650422.png" alt="image-20241201195650422"></p><h3 id="参考项目">参考项目</h3><ol><li><a href="https://github.com/myxuchangbin/dnsmasq_sniproxy_install">https://github.com/myxuchangbin/dnsmasq_sniproxy_install</a></li><li><a href="https://github.com/bingotl/dns_unlock">https://github.com/bingotl/dns_unlock</a></li><li><a href="https://github.com/Jimmyzxk/DNS-Alice-Unlock">https://github.com/Jimmyzxk/DNS-Alice-Unlock</a></li><li><a href="https://www.nodeseek.com/post-180592-1">https://www.nodeseek.com/post-180592-1</a></li></ol><h3 id="优点">优点</h3><ol><li>smartdns 拥有更快查询和更强的广告过滤等功能</li><li>快速添加您想解锁的地区，一键配置，一键修改，不用再使用复杂的编辑功能</li><li>快速配置您想添加的解锁机服务器，方便修改</li><li>解锁机哪怕宕机也不影响被解锁机正常使用</li></ol><hr><h2 id="脚本下载与安装">脚本下载与安装</h2><h3 id="脚本下载">脚本下载</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/lthero-big/Smartdns_sniproxy_installer/refs/heads/main/smtdns_install.sh -O smtdns_install.sh </span><br></pre></td></tr></table></figure><p>脚本将保存在本地 ，命名为smtdns_install.sh ，您可以随时执行</p><h3 id="脚本执行">脚本执行</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash smtdns_install.sh</span><br></pre></td></tr></table></figure><hr><h2 id="阅读顺序">阅读顺序</h2><blockquote><p>如果您不想配置解锁机，请注册Alice免费的DNS解锁服务<a href="https://app.alice.ws/">Alice</a>，申请DNS解锁。随后，请阅读“被解锁机”篇章，使用<code>nameserver</code>添加DNS服务器。</p><p>如果您有自己的解锁机，可以先阅读“解锁机”篇章，配置自己的解锁机，随后使用<code>address</code>添加DNS服务器。</p></blockquote><hr><h2 id="被解锁机">被解锁机</h2><h3 id="功能解释">功能解释</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-----------被解锁机--------------</span><br><span class="line">1.  安装 SmartDNS</span><br><span class="line">2.  重新配置 SmartDNS</span><br><span class="line">3.  添加上游 DNS 并分组</span><br><span class="line">4.  查看已配置的上游 DNS 组</span><br><span class="line">5.  查看流媒体平台列表</span><br><span class="line">6.  添加一家流媒体平台到 SmartDNS</span><br><span class="line">7.  添加一个地区流媒体到 SmartDNS</span><br><span class="line">8.  添加所有流媒体平台到 SmartDNS</span><br><span class="line">9.  查看已经添加的流媒体</span><br></pre></td></tr></table></figure><ol><li>输入1，安装smartdns；随后会询问<strong>是否添加上游DNS并分级</strong><ol><li>如果你已经有Alice的解锁服务，或者您自建了DNS服务器，直接输入<code>y</code>；</li><li>随后，会被邀请输入<strong>上游服务器ip地址</strong>，以及给它<strong>命名</strong>，简短即可方便区分<ol><li>假设输入了<code>12.23.34.45</code>，命令为<code>alice-hk</code></li></ol></li><li>直到输入<code>N</code>，完成smartdns的初始配置</li></ol></li><li>输入2，会删除已有的smartdns配置，并重新创建</li><li>输入3，会继续添加上游 DNS</li><li>输入6/7/8，添加流媒体平台（注意是一家，一地区，还是所有平台）<ol><li>假设输入7，想将香港地区的流媒体，都让<code>alice-hk</code>解锁</li><li>请输入<code>nameserver/address</code>，如果使用Alice解锁服务，选择<code>nameserver</code></li><li>直到输入<code>N</code>，完成地区的添加</li></ol></li><li>输入9，查看已经添加的流媒体及对应的解锁服务器</li></ol><h3 id="关于nameserver与address选择">关于nameserver与address选择</h3><ol><li><p>如果使用Alice解锁服务，选择nameserver</p></li><li><p>如果自建的解锁机运行了smartdns，选择address</p></li><li><p>如果自建的解锁机不运行smartdns，选择address</p></li></ol><h3 id="快速上手">快速上手</h3><p>第一步：输入1，安装smartdns；随后会询问<strong>是否添加上游DNS并分级</strong></p><ol><li>如果你已经有Alice的解锁服务，或者您自建了DNS服务器，直接输入<code>y</code>；</li><li>随后，会被邀请输入<strong>上游服务器ip地址</strong>，以及给它<strong>命名</strong>，简短即可方便区分<ol><li>假设输入了<code>12.23.34.45</code>，命令为<code>alice-hk</code></li></ol></li><li>直到输入<code>N</code>，完成smartdns的初始配置</li></ol><p>第二步：输入6/7/8，添加流媒体平台（注意是一家，一地区，还是所有平台）</p><ol><li>假设输入7，如果使用Alice解锁服务，想将香港地区的流媒体都让<code>alice-hk</code>解锁，选择<code>nameserver</code></li><li>直到输入<code>N</code>，完成地区的添加</li></ol><p><strong>确保smartdns服务启动了即可</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SmartDNS 服务状态：运行中</span><br><span class="line">SmartDNS 开机自启：已启用</span><br><span class="line">system DNS 服务状态：已停止</span><br><span class="line">system DNS 开机自启：未启用</span><br><span class="line">sniproxy 服务状态：已停止</span><br><span class="line">sniproxy 开机自启：未启用</span><br></pre></td></tr></table></figure><hr><h2 id="解锁机">解锁机</h2><h3 id="功能解释">功能解释</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-----------sniproxy相关(解锁机)--------------</span><br><span class="line">11.  安装并启动 sniproxy</span><br><span class="line">12.  添加流媒体平台到 sniproxy</span><br><span class="line">13.  启动/重启 sniproxy 服务并开机自启</span><br><span class="line">14.  停止 sniproxy 并关闭开机自启</span><br><span class="line">15.  一键对被解锁机放开 80/443/53 端口 </span><br><span class="line">16.  一键开启指定 防火墙(ufw) 端口 </span><br></pre></td></tr></table></figure><ol><li>输入11，会安装sniproxy并一键添加一些常用的流媒体平台（不会包含所有的）</li><li>输入12：添加想要的流媒体平台到 sniproxy，与上面一样，可以选择添加一个平台或一个地区的平台</li><li>输入13/14：控制sniproxy服务</li><li>输入15：<strong>必做</strong>，防止被他人利用，需要添加对<strong>被解锁机</strong>的访问权限</li><li>输入16：额外功能，开启某个防火墙端口</li></ol><h3 id="快速上手">快速上手</h3><p>第一步：输入15，添加对<strong>被解锁机</strong>的访问权限，需要输入<strong>被解锁机的ip</strong>即可</p><p>第二步：输入11，会安装sniproxy并一键添加一些常用的流媒体平台</p><p>第三步：输入12：添加想要的流媒体平台到 sniproxy；如果你的机器是美国机，则可以添加美国的流媒体服务到sniproxy中，sniproxy会自动重启；</p><p><strong>确保 sniproxy 服务启动即可</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SmartDNS 服务状态：已停止</span><br><span class="line">SmartDNS 开机自启：未启用</span><br><span class="line">system DNS 服务状态：运行中</span><br><span class="line">system DNS 开机自启：已启用</span><br><span class="line">sniproxy 服务状态：运行中</span><br><span class="line">sniproxy 开机自启：已启用</span><br></pre></td></tr></table></figure><hr><h2 id="高级玩家">高级玩家</h2><p>前面只让smartDNS运行在了被解锁机上，当然，smartdns可以运行在解锁机上，从而实现<strong>嵌套解锁</strong>。</p><p><strong>嵌套解锁</strong>：将上游的DNS服务器指向DNS商家提供的服务器，从而让解锁机下游的服务器都能享受DNS商家提供的解锁权益（可能会违反商家的规则）</p><p>本脚本当然可以使用在解锁机上，下面是解锁机的smartdns配置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">server 13.23.33.43 IP -group sg -exclude-default-group</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果解锁机使用解锁机IP，则下游的被解锁机网飞会定位为解锁机的ip（如美国）</span></span><br><span class="line">address /netflix.com/xx.xx.xx.xx</span><br><span class="line">address /netflix.net/xx.xx.xx.xx</span><br><span class="line">address /nflximg.com/xx.xx.xx.xx</span><br><span class="line">address /nflximg.net/xx.xx.xx.xx</span><br><span class="line">address /nflxvideo.net/xx.xx.xx.xx</span><br><span class="line">address /nflxext.com/xx.xx.xx.xx</span><br><span class="line">address /nflxso.net/xx.xx.xx.xx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt; 如果解锁机使用上游的DNS商家提供的IP，则下游的被解锁机网飞会定位为上游ip（如新加坡）</span></span><br><span class="line">nameserver /netflix.com/sg</span><br><span class="line">nameserver /netflix.net/sg</span><br><span class="line">nameserver /nflximg.com/sg</span><br><span class="line">nameserver /nflximg.net/sg</span><br><span class="line">nameserver /nflxvideo.net/sg</span><br><span class="line">nameserver /nflxext.com/sg</span><br><span class="line">nameserver /nflxso.net/sg</span><br></pre></td></tr></table></figure><h1 id="nginx-smartdns">Nginx+smartDNS</h1><blockquote><p><a href="https://xcel.me/unlock_netflix_with_nginx_and_dnsmasq/">https://xcel.me/unlock_netflix_with_nginx_and_dnsmasq/</a></p></blockquote><p>说到反代，nginx也能拿来做这事儿，而且好处是443和80端口可以被继续使用</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;sniproxy-smartdns-一键配置脚本&quot;&gt;sniproxy &amp;amp; smartdns 一键配置脚本&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;开源项目：&lt;a href=&quot;https://github.com/lthero-big/Smartdns_s</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
    <category term="流媒体解锁" scheme="https://blog.lthero.cn/tags/%E6%B5%81%E5%AA%92%E4%BD%93%E8%A7%A3%E9%94%81/"/>
    
  </entry>
  
  <entry>
    <title>【DNS】流媒体解锁</title>
    <link href="https://blog.lthero.cn/2024/11/29/UnlockNetflixWithDNS/"/>
    <id>https://blog.lthero.cn/2024/11/29/UnlockNetflixWithDNS/</id>
    <published>2024-11-29T13:39:07.000Z</published>
    <updated>2024-12-01T05:04:46.468Z</updated>
    
    <content type="html"><![CDATA[<h1 id="自动-流媒体一键修改解锁dns脚本">自动-流媒体一键修改解锁DNS脚本</h1><p><strong>支持操作系统</strong>: Debian &amp; Ubuntu</p><h2 id="项目简介">项目简介</h2><p>该脚本旨在帮助用户通过 <strong>流媒体解锁 DNS</strong> 实现快速的 DNS 分流与全局 DNS 替换。只需简单的几个步骤，即可轻松配置与解锁 DNS。适用于 VPS 用户，支持一键配置，无需复杂设置。</p><h2 id="使用指南">使用指南</h2><h4 id="步骤-1-注册-alice-账号-适用于没有解锁dns-ip的用户">步骤 1: 注册 Alice 账号(适用于没有解锁DNS IP的用户)</h4><ol><li><p>访问 <a href="https://www.nodeseek.com/jump?to=https%3A%2F%2Fapp.alice.ws">Alice DNS 官网</a> 进行注册（官方的解锁教程：<a href="https://blog.alice.ws/16%EF%BC%89">https://blog.alice.ws/16）</a></p></li><li><p>在注册后，将您的 VPS IP 地址添加至 Alice 白名单。</p><blockquote><p><strong>注意</strong>：此过程可能需要 3-5 分钟生效。</p></blockquote></li></ol><h4 id="步骤-2-运行一键分流脚本">步骤 2: 运行一键分流脚本</h4><ol><li><p>下载并运行以下脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/Jimmyzxk/DNS-Alice-Unlock/refs/heads/main/dns-unlock.sh &amp;&amp; bash dns-unlock.sh</span><br></pre></td></tr></table></figure></li></ol><hr><p>运行之前，要确保53端口没被占用</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看53端口是否被占用</span></span><br><span class="line">sudo netstat -tulnp | grep :53</span><br><span class="line"><span class="comment"># 关掉resolved</span></span><br><span class="line">sudo systemctl stop systemd-resolved</span><br><span class="line"><span class="comment"># 禁止开机自启resolved</span></span><br><span class="line">sudo systemctl <span class="built_in">disable</span> systemd-resolved</span><br></pre></td></tr></table></figure><h4 id="解锁方式-1-1：dns-分流模式-dnsmasq">解锁方式 1-1：DNS 分流模式(dnsmasq)</h4><ol><li>在脚本菜单中选择 <code>1</code>。</li><li>脚本将自动安装并配置 <code>dnsmasq</code>，实现多媒体流量的智能分流。</li><li>安装过程中会提示是否输入个人解锁IP，回车默认Alice,IP，输入y，填写个人解锁IP 。<ul><li><strong>适用场景</strong>：优化流媒体（如 Netflix、Disney等）访问体验，确保内容加载更快，解锁区域内容。</li></ul></li></ol><h4 id="选择分流区域-sg-hk">选择分流区域（SG / HK）</h4><ol><li><p>在脚本菜单中选择 <code>3</code>，进入分流区域选择界面。</p></li><li><p>脚本支持自助选择</p><p>SG（新加坡）或HK（香港）</p><p>区域进行分流优化。</p><ul><li><strong>SG（新加坡）</strong>：适用于连接东南亚地区的用户，提供更优的路由和速度。</li><li><strong>HK（香港）</strong>：适用于连接香港及周边地区的用户，提供稳定且快速的网络连接。</li><li>选择完毕后，脚本将根据选择的区域配置合适的分流策略。</li></ul></li></ol><hr><h4 id="解锁方式-1-2：dns-分流模式-smartdns">解锁方式 1-2：DNS 分流模式（smartdns）</h4><ol><li><p>在脚本菜单中选择 <code>2-1</code>。</p></li><li><p>按照提示是否替换为个人解锁DNSIP，IP1/2可同一个；</p></li><li><p>脚本将自动安装并配置smartdns，实现多媒体流量的智能分流。</p><ul><li><strong>适用场景</strong>：优化流媒体（如 Netflix、Disney等）访问体验，确保内容加载更快，解锁区域内容。</li></ul></li></ol><hr><h4 id="解锁方式-2：全局-dns-替换模式">解锁方式 2：全局 DNS 替换模式</h4><ol><li>在脚本菜单中选择 <code>3-3</code>。</li><li>输入自己的解锁IP，一键替换，并锁定resolv.conf文件。<ul><li><strong>适用场景</strong>：需要整体优化网络解析速度，提升所有已解锁自媒体请求。</li></ul></li></ol><h3 id="配置文件参考">配置文件参考</h3><p>下面是<code>/etc/dnsmasq.conf</code>，里面包含了不同流媒体解锁的配置文件，将1.2.1.2修改成对应的DNS解锁机ip即可</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 禁用读取 /etc/resolv.conf</span></span><br><span class="line">no-resolv</span><br><span class="line"><span class="comment"># 设置默认的上游 DNS</span></span><br><span class="line">server=1.0.0.1 <span class="comment"># 主 DNS，Cloudfare Public DNS</span></span><br><span class="line">server=8.8.8.8 <span class="comment"># 备用 DNS，Google Public DNS</span></span><br><span class="line">cache-size=2048</span><br><span class="line">local-ttl=60</span><br><span class="line">listen-address=127.0.0.1</span><br><span class="line"><span class="comment"># Netflix 专用 DNS</span></span><br><span class="line">server=/netflix.ca/1.2.1.2</span><br><span class="line">server=/netflix.com/1.2.1.2</span><br><span class="line">server=/netflix.net/1.2.1.2</span><br><span class="line">server=/netflixinvestor.com/1.2.1.2</span><br><span class="line">server=/netflixtechblog.com/1.2.1.2</span><br><span class="line">server=/nflxext.com/1.2.1.2</span><br><span class="line">server=/nflximg.com/1.2.1.2</span><br><span class="line">server=/nflximg.net/1.2.1.2</span><br><span class="line">server=/nflxsearch.net/1.2.1.2</span><br><span class="line">server=/nflxso.net/1.2.1.2</span><br><span class="line">server=/nflxvideo.net/1.2.1.2</span><br><span class="line">server=/netflixdnstest0.com/1.2.1.2</span><br><span class="line">server=/netflixdnstest1.com/1.2.1.2</span><br><span class="line">server=/netflixdnstest2.com/1.2.1.2</span><br><span class="line">server=/netflixdnstest3.com/1.2.1.2</span><br><span class="line">server=/netflixdnstest4.com/1.2.1.2</span><br><span class="line">server=/netflixdnstest5.com/1.2.1.2</span><br><span class="line">server=/netflixdnstest6.com/1.2.1.2</span><br><span class="line">server=/netflixdnstest7.com/1.2.1.2</span><br><span class="line">server=/netflixdnstest8.com/1.2.1.2</span><br><span class="line">server=/netflixdnstest9.com/1.2.1.2</span><br><span class="line">server=/cinemax.com/1.2.1.2</span><br><span class="line">server=/forthethrone.com/1.2.1.2</span><br><span class="line"><span class="comment"># HBO DNS解锁</span></span><br><span class="line">server=/hbo.com/1.2.1.2</span><br><span class="line">server=/hboasia.com/1.2.1.2</span><br><span class="line">server=/hbogo.com/1.2.1.2</span><br><span class="line">server=/hbogoasia.com/1.2.1.2</span><br><span class="line">server=/hbogoasia.hk/1.2.1.2</span><br><span class="line">server=/hbomax.com/1.2.1.2</span><br><span class="line">server=/hbonow.com/1.2.1.2</span><br><span class="line">server=/maxgo.com/1.2.1.2</span><br><span class="line">server=/max.com/1.2.1.2</span><br><span class="line">server=/discomax.com/1.2.1.2</span><br><span class="line"><span class="comment"># Hoy DNS解锁</span></span><br><span class="line">server=/hoy.tv/1.2.1.2</span><br><span class="line"><span class="comment"># Bahamut Anime解锁</span></span><br><span class="line">server=/bahamut.com.tw/1.2.1.2</span><br><span class="line">server=/gamer.com.tw/1.2.1.2</span><br><span class="line">server=/gamer-cds.cdn.hinet.net/1.2.1.2</span><br><span class="line">server=/gamer2-cds.cdn.hinet.net/1.2.1.2</span><br><span class="line"><span class="comment"># Disney DNS解锁</span></span><br><span class="line">server=/disney.com/1.2.1.2</span><br><span class="line">server=/disneyjunior.com/1.2.1.2</span><br><span class="line">server=/disneyplus.com/1.2.1.2</span><br><span class="line">server=/bamgrid.com/1.2.1.2</span><br><span class="line"><span class="comment"># ChatGPT DNS解锁</span></span><br><span class="line">server=/openai.com/1.2.1.2</span><br><span class="line">server=/chatgpt.com/1.2.1.2</span><br><span class="line">server=/chat.com/1.2.1.2</span><br><span class="line">server=/oaistatic.com/1.2.1.2</span><br><span class="line">server=/oaiusercontent.com/1.2.1.2</span><br><span class="line">server=/chat.comopenai.com.cdn.cloudflare.net/1.2.1.2</span><br><span class="line">server=/openaiapi-site.azureedge.net/1.2.1.2</span><br><span class="line">server=/openaicom-api-bdcpf8c6d2e9atf6.z01.azurefd.net/1.2.1.2</span><br><span class="line">server=/openaicomproductionae4b.blob.core.windows.net/1.2.1.2</span><br><span class="line">server=/production-openaicom-storage.azureedge.net/1.2.1.2</span><br><span class="line">server=/byteoversea.com/1.2.1.2</span><br><span class="line">server=/ibytedtos.com/1.2.1.2</span><br><span class="line">server=/ipstatp.com/1.2.1.2</span><br><span class="line">server=/muscdn.com/1.2.1.2</span><br><span class="line">server=/musical.ly/1.2.1.2</span><br><span class="line"><span class="comment"># tiktok DNS解锁</span></span><br><span class="line">server=/tik-tokapi.com/1.2.1.2</span><br><span class="line">server=/tiktok.com/1.2.1.2</span><br><span class="line">server=/tiktokcdn.com/1.2.1.2</span><br><span class="line">server=/tiktokv.com/1.2.1.2</span><br><span class="line">server=/ggpht.cn/1.2.1.2</span><br><span class="line">server=/ggpht.com/1.2.1.2</span><br><span class="line">server=/googlevideo.com/1.2.1.2</span><br><span class="line">server=/gvt2.com/1.2.1.2</span><br><span class="line"><span class="comment"># Youtube DNS解锁</span></span><br><span class="line">server=/withyoutube.com/1.2.1.2</span><br><span class="line">server=/youtube-nocookie.com/1.2.1.2</span><br><span class="line">server=/youtube.com/1.2.1.2</span><br><span class="line">server=/youtubeeducation.com/1.2.1.2</span><br><span class="line">server=/youtubefanfest.com/1.2.1.2</span><br><span class="line">server=/youtubegaming.com/1.2.1.2</span><br><span class="line">server=/youtubego.com/1.2.1.2</span><br><span class="line">server=/youtubei.googleapis.com/1.2.1.2</span><br><span class="line">server=/youtubekids.com/1.2.1.2</span><br><span class="line">server=/youtubemobilesupport.com/1.2.1.2</span><br><span class="line">server=/ytimg.com/1.2.1.2</span><br><span class="line"><span class="comment"># Spotify DNS解锁</span></span><br><span class="line">server=/audio4-ak-spotify-com.akamaized.net/1.2.1.2</span><br><span class="line">server=/dn-spotify-experiments.conductrics.com/1.2.1.2</span><br><span class="line">server=/heads-ak-spotify-com.akamaized.net/1.2.1.2</span><br><span class="line">server=/spotify.com.edgesuite.net/1.2.1.2</span><br><span class="line">server=/spotify.map.fastly.net/1.2.1.2</span><br><span class="line">server=/spotify.map.fastlylb.net/1.2.1.2</span><br><span class="line">server=/audio-ak-spotify-com.akamaized.net/1.2.1.2</span><br><span class="line">server=/byspotify.com/1.2.1.2</span><br><span class="line">server=/heads4-ak-spotify-com.akamaized.net/1.2.1.2</span><br><span class="line">server=/pscdn.co/1.2.1.2</span><br><span class="line">server=/scdn.co/1.2.1.2</span><br><span class="line">server=/spoti.fi/1.2.1.2</span><br><span class="line">server=/spotify-com.akamaized.net/1.2.1.2</span><br><span class="line">server=/spotify-everywhere.com/1.2.1.2</span><br><span class="line">server=/spotify.com/1.2.1.2</span><br><span class="line">server=/spotify.design/1.2.1.2</span><br><span class="line">server=/spotifycdn.com/1.2.1.2</span><br><span class="line">server=/spotifycdn.net,Spotify/1.2.1.2</span><br><span class="line">server=/spotifycharts.com/1.2.1.2</span><br><span class="line">server=/spotifycodes.com/1.2.1.2</span><br><span class="line">server=/spotifyforbrands.com/1.2.1.2</span><br><span class="line">server=/spotifyjobs.com/1.2.1.2</span><br><span class="line">server=/spotifynewsroom.jp/1.2.1.2</span><br><span class="line">server=/spotilocal.com/1.2.1.2</span><br><span class="line">server=/tospotify.com/1.2.1.2</span><br><span class="line"><span class="comment"># Hotstar DNS解锁</span></span><br><span class="line">server=/hotstar-cdn.net/1.2.1.2</span><br><span class="line">server=/hotstar-labs.com/1.2.1.2</span><br><span class="line">server=/hotstar.com/1.2.1.2</span><br><span class="line">server=/hotstarext.com/1.2.1.2</span><br><span class="line">server=/hsprepack.akamaized.net/1.2.1.2</span><br><span class="line">server=/js-agent.newrelic.com/1.2.1.2</span><br><span class="line"><span class="comment"># MyTVSuper DNS解锁</span></span><br><span class="line">server=/mytvsuper.com/1.2.1.2</span><br><span class="line">server=/mytvsuperlimited.hb.omtrdc.net/1.2.1.2</span><br><span class="line">server=/mytvsuperlimited.sc.omtrdc.net/1.2.1.2</span><br><span class="line">server=/tvb.com/1.2.1.2</span><br><span class="line"><span class="comment"># Gemini DNS解锁</span></span><br><span class="line">server=/gemini.google.com/1.2.1.2</span><br><span class="line">server=/proactivebackend-pa.googleapis.com/1.2.1.2</span><br><span class="line">server=/alkalimakersuite-pa.clients6.google.com/1.2.1.2</span><br><span class="line">server=/aistudio.google.com/1.2.1.2</span><br><span class="line">server=/generativelanguage.googleapis.com/1.2.1.2</span><br><span class="line"><span class="comment"># bilibili DNS解锁 HK</span></span><br><span class="line">server=/bilibili.tv/1.2.1.2</span><br><span class="line">server=/www.bilibili.com/1.2.1.2</span><br><span class="line">server=/cm.bilibili.com/1.2.1.2</span><br><span class="line">server=/api.bilibili.com/1.2.1.2</span><br><span class="line">server=/api.vc.bilibili.com/1.2.1.2</span><br><span class="line">server=/api.live.bilibili.com/1.2.1.2</span><br><span class="line">server=/passport.bilibili.com/1.2.1.2</span><br><span class="line">server=/data.bilibili.com/1.2.1.2</span><br><span class="line">server=/broadcast.chat.bilibili.com/1.2.1.2</span><br><span class="line">server=/upos-hz-mirrorakam.akamaized.net/1.2.1.2</span><br><span class="line">server=/bangumi.bilibili.com/1.2.1.2</span><br><span class="line">server=/manga.bilibili.com/1.2.1.2</span><br><span class="line"><span class="comment"># VIU.TV DNS解锁 HK</span></span><br><span class="line">server=/viu.now.com/1.2.1.2</span><br><span class="line">server=/viu.tv/1.2.1.2</span><br><span class="line">server=/cognito-identity.us-east-1.amazonaws.com/1.2.1.2</span><br><span class="line">server=/d1k2us671qcoau.cloudfront.net/1.2.1.2</span><br><span class="line">server=/d2anahhhmp1ffz.cloudfront.net/1.2.1.2</span><br><span class="line">server=/dfp6rglgjqszk.cloudfront.net/1.2.1.2</span><br><span class="line">server=/d3o7oi00quuwqu.cloudfront.net/1.2.1.2</span><br><span class="line">server=/mobileanalytics.us-east-1.amazonaws.com/1.2.1.2</span><br><span class="line">server=/viu.com/1.2.1.2</span><br><span class="line"><span class="comment"># DAZN DNS解锁 SG</span></span><br><span class="line">server=/dazn-api.com/1.2.1.2</span><br><span class="line">server=/dazn.com/1.2.1.2</span><br><span class="line">server=/dazndn.com/1.2.1.2</span><br><span class="line">server=/indazn.com/1.2.1.2</span><br><span class="line">server=/d1sgwhnao7452x.cloudfront.net/1.2.1.2</span><br><span class="line">server=/dcalivedazn.akamaized.net/1.2.1.2</span><br><span class="line">server=/dcblivedazn.akamaized.net/1.2.1.2</span><br><span class="line">server=/d151l6v8er5bdm.cloudfront.net/1.2.1.2</span><br><span class="line">server=/control.kochava.com/1.2.1.2</span><br><span class="line">server=/dc2-vodhls-perform.secure.footprint.net/1.2.1.2</span><br><span class="line">server=/dca-ll-livedazn-dznlivejp.s.llnwi.net/1.2.1.2</span><br><span class="line">server=/indaznlab.com/1.2.1.2</span><br><span class="line">server=/intercom.io/1.2.1.2</span><br><span class="line">server=/logx.optimizely.com/1.2.1.2</span><br><span class="line">server=/s.yimg.jp/1.2.1.2</span><br><span class="line">server=/sentry.io/1.2.1.2</span><br><span class="line"><span class="comment"># Now E DNS解锁 HK</span></span><br><span class="line">server=/nowe.com/1.2.1.2</span><br><span class="line">server=/nowestatic.com/1.2.1.2</span><br><span class="line">server=/now.com/1.2.1.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; NBA TV</span></span><br><span class="line">server=/nba.com/1.2.1.2</span><br><span class="line">server=/neulion-a.akamaihd.net/1.2.1.2</span><br><span class="line">server=/nlnbamdnyc-a.akamaihd.net/1.2.1.2</span><br><span class="line">server=/sdk.iad-03.braze.com/1.2.1.2</span><br><span class="line">server=/nbaprop.sc.omtrdc.net/1.2.1.2</span><br><span class="line">server=/nlnbaqos.neulion.com/1.2.1.2</span><br><span class="line">server=/watchnba.cdnfastly.endeavorstreaming.net/1.2.1.2</span><br><span class="line">server=/nbaapi.neulion.com/1.2.1.2</span><br><span class="line">server=/nba-api-cdn.opin.media/1.2.1.2</span><br><span class="line">server=/neulionqos-a.akamaihd.net/1.2.1.2</span><br><span class="line">server=/neulion.com/1.2.1.2</span><br><span class="line">server=/nbaprop.tt.omtrdc.net/1.2.1.2</span><br><span class="line">server=/lion-nba-msl.akamaized.net/1.2.1.2</span><br><span class="line">server=/nbanlds19vod.akamaized.net/1.2.1.2</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="手动-利用sni代理和smartdns自建dns解锁">手动-利用sni代理和smartdns自建DNS解锁</h1><blockquote><p>参考项目：<a href="https://github.com/myxuchangbin/dnsmasq_sniproxy_install">https://github.com/myxuchangbin/dnsmasq_sniproxy_install</a></p><p>视频教程：<a href="https://youtu.be/Vj4TGd9IaQc?t=682">https://youtu.be/Vj4TGd9IaQc?t=682</a></p></blockquote><h2 id="写在前面">写在前面</h2><p>为实现自建DNS解锁可以采取两种办法：</p><p>第一种<strong>建立私人DNS服务器</strong>，适用于<strong>多台服务器</strong>需要解锁的应用场景</p><p>第二种直接在<strong>被解锁服务器</strong>设置解锁，适用于<strong>单个服务器</strong>需要解锁的应用场景</p><table><thead><tr><th></th><th>方案一</th><th>方案二</th></tr></thead><tbody><tr><td>解锁机搭建sni代理</td><td>√</td><td>√</td></tr><tr><td>解锁机搭建DNS服务器</td><td>√</td><td>×</td></tr><tr><td>被解锁机本地设置</td><td>仅需修改系统DNS</td><td>需要在所有被解锁机搭建smartdns</td></tr><tr><td>灵活性</td><td>快捷</td><td>较为复杂</td></tr><tr><td>可靠性</td><td>自建DNS服务器宕机，本地DNS瘫痪</td><td>自建DNS服务器宕机，本地DNS正常</td></tr><tr><td>应用场景</td><td>多台服务器</td><td>单台服务器</td></tr></tbody></table><p><strong>本文之所以选择用smartdns取代Dnsmasq，在于smartdns 无论是在查询速度、查询到的IP访问速度和广告过滤都强于Dnsmasq。</strong></p><h2 id="必备内容">必备内容</h2><p>1台解锁流媒体的服务器（53,443和80端口都不能被占用）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看80端口是否被占用</span></span><br><span class="line">sudo netstat -tulnp | grep :80</span><br><span class="line"><span class="comment"># 关掉nginx</span></span><br><span class="line">sudo systemctl stop nginx</span><br><span class="line"><span class="comment"># 禁止开机自启nginx</span></span><br><span class="line">sudo systemctl <span class="built_in">disable</span> nginx</span><br></pre></td></tr></table></figure><h2 id="sni-proxy搭建">SNI Proxy搭建</h2><p>由于存在两种实现方法，教程除了sni代理为统一步骤外，其余部分因差异性将分开阐述，sni为反向代理工具</p><h3 id="解锁机-安装sni-proxy">解锁机:安装SNI Proxy</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate -O dnsmasq_sniproxy.sh https://raw.githubusercontent.com/myxuchangbin/dnsmasq_sniproxy_install/master/dnsmasq_sniproxy.sh </span><br></pre></td></tr></table></figure><h3 id="解锁机-运行sni-proxy">解锁机:运行SNI Proxy</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">使用方法：bash dnsmasq_sniproxy.sh [-h] [-i] [-f] [-<span class="built_in">id</span>] [-fd] [-is] [-fs] [-u] [-ud] [-us]</span><br><span class="line">  -h , --<span class="built_in">help</span>                显示帮助信息</span><br><span class="line">  -i , --install             安装 Dnsmasq + SNI Proxy</span><br><span class="line">  -f , --fastinstall         快速安装 Dnsmasq + SNI Proxy</span><br><span class="line">  -<span class="built_in">id</span>, --installdnsmasq      仅安装 Dnsmasq</span><br><span class="line">  -<span class="built_in">id</span>, --installdnsmasq      快速安装 Dnsmasq</span><br><span class="line">  -is, --installsniproxy     仅安装 SNI Proxy</span><br><span class="line">  -fs, --fastinstallsniproxy 快速安装 SNI Proxy</span><br><span class="line">  -u , --uninstall           卸载 Dnsmasq + SNI Proxy</span><br><span class="line">  -ud, --undnsmasq           卸载 Dnsmasq</span><br><span class="line">  -us, --unsniproxy          卸载 SNI Proxy</span><br></pre></td></tr></table></figure><p>这里原教程是只使用<code>bash dnsmasq_sniproxy.sh -is</code>，仅安装SNI Proxy，然后再手动修改配置文件。</p><p>这里我们直接用<code>bash dnsmasq_sniproxy.sh -fs</code>让工具自动写好配置文件，我们仍然可以对配置文件依据自己喜好进行修改。</p><h3 id="解锁机-手动设置sni-proxy的配置文件">解锁机:手动设置SNI Proxy的配置文件</h3><p>修改配置文件，将所需dns解锁的网址格式化输入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/sniproxy.conf</span><br></pre></td></tr></table></figure><p>格式示例</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">user daemon</span><br><span class="line">pidfile /var/tmp/sniproxy.pid</span><br><span class="line"></span><br><span class="line">error_log &#123;</span><br><span class="line">    syslog daemon</span><br><span class="line">    priority notice</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resolver &#123;</span><br><span class="line">    nameserver 8.8.8.8</span><br><span class="line">    nameserver 8.8.4.4 <span class="comment"># local dns should be better</span></span><br><span class="line">    mode ipv4_only</span><br><span class="line">&#125;</span><br><span class="line">listener 0.0.0.0:80 &#123;</span><br><span class="line">    proto http</span><br><span class="line">    access_log &#123;</span><br><span class="line">        filename /var/log/sniproxy/http_access.log</span><br><span class="line">        priority notice</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">listener 0.0.0.0:443 &#123;</span><br><span class="line">    proto tls</span><br><span class="line">    access_log &#123;</span><br><span class="line">        filename /var/log/sniproxy/https_access.log</span><br><span class="line">        priority notice</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">table &#123;</span><br><span class="line">    .*ai\.com$ *</span><br><span class="line">    .*openai\.com$ *</span><br><span class="line">    .*chatgpt.com$ *</span><br><span class="line">    .*oaistatic.com$ *</span><br><span class="line">    .*oaiusercontent.com$ *</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改完配置后，重启SNI Proxy</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart sniproxy</span><br></pre></td></tr></table></figure><h3 id="解锁机-设置解锁白名单">解锁机:设置解锁白名单</h3><blockquote><p>如果不做这步，很有可能被别人盗用你的DNS解锁服务 ！</p></blockquote><p>如未安装ufw，请先执行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ufw</span><br><span class="line">ufw <span class="built_in">enable</span></span><br></pre></td></tr></table></figure><p><strong>第一次安装一定要放行当前使用的ssh端口</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow 22/tcp</span><br></pre></td></tr></table></figure><p>修改下面示例的IP（写被解锁机IP），执行即可。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow from 142.171.50.112 to any port 443 proto tcp</span><br><span class="line">sudo ufw allow from 142.171.50.112 to any port 443 proto udp</span><br><span class="line">sudo ufw allow from 142.171.50.112 to any port 80 proto tcp</span><br><span class="line">sudo ufw allow from 142.171.50.112 to any port 80 proto udp</span><br></pre></td></tr></table></figure><h4 id="开启dns白名单">开启DNS白名单</h4><p>强烈建议开启DNS白名单，不开启会被别人白嫖，也可能被D哥用作DNS放大攻击</p><p>修改下面示例的IP(被解锁机的ip)即可。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow from 142.171.50.112 to any port 53 proto udp</span><br></pre></td></tr></table></figure><h4 id="none"></h4><hr><h2 id="smartdns方案">SmartDNS方案</h2><h3 id="安装smartdns">安装smartdns</h3><blockquote><p>这里使用smartdns，上面的dnsmasq_sniproxy.sh脚本只能安装dnsmasq，所以需要手动安装smartdns</p></blockquote><p>此处可以用另一台服务器，也可以就用搭建sni代理那台服务器。</p><p>运行之前，要确保53端口没被占用</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看53端口是否被占用</span></span><br><span class="line">sudo netstat -tulnp | grep :53</span><br><span class="line"><span class="comment"># 关掉resolved</span></span><br><span class="line">sudo systemctl stop systemd-resolved</span><br><span class="line"><span class="comment"># 禁止开机自启resolved</span></span><br><span class="line">sudo systemctl <span class="built_in">disable</span> systemd-resolved</span><br></pre></td></tr></table></figure><p>这里上<code>https://github.com/pymumu/smartdns/releases/</code>查找最新版本</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/pymumu/smartdns/releases/download/Release46/smartdns.1.2024.06.12-2222.x86-linux-all.tar.gz</span><br><span class="line">tar zxf smartdns.1.2024.06.12-2222.x86-linux-all.tar.gz</span><br><span class="line"><span class="built_in">cd</span> smartdns</span><br><span class="line"><span class="built_in">chmod</span> +x ./install</span><br><span class="line">./install -i</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看运行状态</span></span><br><span class="line">systemctl status smartdns</span><br><span class="line"><span class="comment"># 此时本地的53端口应该是运行着smartdns，否则手动运行下</span></span><br><span class="line">systemctl start smartdns</span><br></pre></td></tr></table></figure><h3 id="方案一：搭建dns服务器">方案一：搭建DNS服务器</h3><h4 id="解锁机-设置smardns">解锁机:设置smardns</h4><blockquote><p>注意，这里不要把解锁服务器的IP填写进去！否则会出现查询回环（自己问自己）</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/smartdns/smartdns.conf</span><br></pre></td></tr></table></figure><p>编辑配置，自行添加需要解锁的网址，常见流媒体域名可以参考<a href="https://github.com/1-stream/1stream-public-utils/blob/main/stream.smartdns.list">1stream写好的</a></p><p>下面的配置文件是包含“嵌套解锁”，其中嵌套了Alice的解析服务；</p><p>具体的smartdn用法参考：<a href="https://pymumu.github.io/smartdns/config/domain-address/">https://pymumu.github.io/smartdns/config/domain-address/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># &gt; Netflix</span><br><span class="line"># 如果使用上游DNS服务器，则使用nameserver</span><br><span class="line">nameserver /netflix.com/SGdnsproxy</span><br><span class="line"></span><br><span class="line"># 如果使用解锁机IP，则使用address</span><br><span class="line">address /netflix.com/11.22.33.44</span><br></pre></td></tr></table></figure><p>完整配置如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> [::]:53</span><br><span class="line"><span class="comment">#bind[::]:53@eth0 -no-dualstack-selection -no-speed-check </span></span><br><span class="line">dualstack-ip-selection no</span><br><span class="line">speed-check-mode none</span><br><span class="line">serve-expired-prefetch-time 21600</span><br><span class="line">prefetch-domain <span class="built_in">yes</span></span><br><span class="line">cache-size 32768</span><br><span class="line">cache-persist <span class="built_in">yes</span></span><br><span class="line">cache-file /etc/smartdns/cache</span><br><span class="line">prefetch-domain <span class="built_in">yes</span></span><br><span class="line">serve-expired <span class="built_in">yes</span></span><br><span class="line">serve-expired-ttl 259200</span><br><span class="line">serve-expired-reply-ttl 3</span><br><span class="line">prefetch-domain <span class="built_in">yes</span></span><br><span class="line">serve-expired-prefetch-time 21600</span><br><span class="line">cache-checkpoint-time 86400</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置默认的上游 DNS</span></span><br><span class="line">server 8.8.8.8 <span class="comment">#默认上游DNS</span></span><br><span class="line">server 8.8.4.4 <span class="comment">#默认上游DNS</span></span><br><span class="line"><span class="comment"># 配置上游DNS  alice-dns-hk</span></span><br><span class="line">server 154.12.177.22 IP -group HKdnsproxy -exclude-default-group</span><br><span class="line"><span class="comment"># 配置上游DNS  alice-dns-sg</span></span><br><span class="line">server 157.20.104.47 IP -group SGdnsproxy -exclude-default-group</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; Disney+</span></span><br><span class="line">nameserver /disney.connections.edge.bamgrid.com/us</span><br><span class="line">nameserver /disney.api.edge.bamgrid.com/us</span><br><span class="line">nameserver /disney-plus.net/us</span><br><span class="line">nameserver /disneyplus.com/us</span><br><span class="line">nameserver /dssott.com/us</span><br><span class="line">nameserver /disneynow.com/us</span><br><span class="line">nameserver /disneystreaming.com/us</span><br><span class="line">nameserver /cdn.registerdisney.go.com/us</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; Netflix</span></span><br><span class="line"><span class="comment"># 如果使用上游DNS服务器</span></span><br><span class="line">nameserver /netflix.com/SGdnsproxy</span><br><span class="line">nameserver /netflix.net/SGdnsproxy</span><br><span class="line">nameserver /nflximg.com/SGdnsproxy</span><br><span class="line">nameserver /nflximg.net/SGdnsproxy</span><br><span class="line">nameserver /nflxvideo.net/SGdnsproxy</span><br><span class="line">nameserver /nflxext.com/SGdnsproxy</span><br><span class="line">nameserver /nflxso.net/SGdnsproxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果使用解锁机IP</span></span><br><span class="line"><span class="comment">#address /netflix.com/11.22.33.44</span></span><br><span class="line"><span class="comment">#address /netflix.net/11.22.33.44</span></span><br><span class="line"><span class="comment">#address /nflximg.com/11.22.33.44</span></span><br><span class="line"><span class="comment">#address /nflximg.net/11.22.33.44</span></span><br><span class="line"><span class="comment">#address /nflxvideo.net/11.22.33.44</span></span><br><span class="line"><span class="comment">#address /nflxext.com/11.22.33.44</span></span><br><span class="line"><span class="comment">#address /nflxso.net/11.22.33.44</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; HuluUSA</span></span><br><span class="line">address /assetshuluimcom-a.akamaihd.net/11.22.33.44</span><br><span class="line">address /cws-hulu.conviva.com/11.22.33.44</span><br><span class="line">address /hulu.com/11.22.33.44</span><br><span class="line">address /hulu.hb.omtrdc.net/11.22.33.44</span><br><span class="line">address /hulu.sc.omtrdc.net/11.22.33.44</span><br><span class="line">address /huluad.com/11.22.33.44</span><br><span class="line">address /huluqa.com/11.22.33.44</span><br><span class="line">address /hulustream.com/11.22.33.44</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; HBO / Max</span></span><br><span class="line">address /max.com/11.22.33.44</span><br><span class="line">address /hbo.com/11.22.33.44</span><br><span class="line">address /hbomax.com/11.22.33.44</span><br><span class="line">address /hbomaxcdn.com/11.22.33.44</span><br><span class="line">address /hbonow.com/11.22.33.44</span><br><span class="line">address /discomax.com/11.22.33.44</span><br><span class="line"></span><br><span class="line">nameserver /hbogo.com/SGdnsproxy</span><br><span class="line">nameserver /maxgo.com/SGdnsproxy</span><br><span class="line"><span class="comment"># ---------- &gt; Taiwan Media</span></span><br><span class="line"><span class="comment"># &gt; KKTV</span></span><br><span class="line">nameserver /kfs.io/HKdnsproxy</span><br><span class="line">nameserver /kktv-theater.kk.stream/HKdnsproxy</span><br><span class="line">nameserver /kkbox.com/HKdnsproxy</span><br><span class="line">nameserver /kkbox.com.tw/HKdnsproxy</span><br><span class="line">nameserver /kktv.com.tw/HKdnsproxy</span><br><span class="line">nameserver /kktv.me/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; LiTV</span></span><br><span class="line">nameserver /litv.tv/HKdnsproxy</span><br><span class="line">nameserver /litvfreepc.akamaized.net/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; MyVideo</span></span><br><span class="line">nameserver /cdn.plyr.io/HKdnsproxy</span><br><span class="line">nameserver /myvideo.net.tw/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; 4GTV</span></span><br><span class="line">nameserver /4gtv.tv/HKdnsproxy</span><br><span class="line">nameserver /4gtvfreepc-cds.cdn.hinet.net/HKdnsproxy</span><br><span class="line">nameserver /4gtvfreepcvod-cds.cdn.hinet.net/HKdnsproxy</span><br><span class="line">nameserver /4gtvpc-cds.cdn.hinet.net/HKdnsproxy</span><br><span class="line">nameserver /4gtvpcvod-cds.cdn.hinet.net/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; LineTV.TW</span></span><br><span class="line">nameserver /d3c7rimkq79yfu.cloudfront.net/HKdnsproxy</span><br><span class="line">nameserver /linetv.tw/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; Hami Video</span></span><br><span class="line">nameserver /cdn.hinet.net/HKdnsproxy</span><br><span class="line">nameserver /hamivideo.hinet.net/HKdnsproxy</span><br><span class="line">nameserver /scc.ott.hinet.net/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; CatchPlay+</span></span><br><span class="line">nameserver /catchplay.com/HKdnsproxy</span><br><span class="line">nameserver /d2ivmxp5z2ww0n.cloudfront.net/HKdnsproxy</span><br><span class="line">nameserver /ols-ww100-cp.akamaized.net/HKdnsproxy</span><br><span class="line">nameserver /tra-www000-cp.akamaized.net/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; Bahamut Anime</span></span><br><span class="line">nameserver /bahamut.com.tw/HKdnsproxy</span><br><span class="line">nameserver /gamer.com.tw/HKdnsproxy</span><br><span class="line">nameserver /gamer-cds.cdn.hinet.net/HKdnsproxy</span><br><span class="line">nameserver /gamer2-cds.cdn.hinet.net/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; Friday Video</span></span><br><span class="line">nameserver /video.friday.tw/HKdnsproxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- &gt; Hong Kong Media</span></span><br><span class="line"><span class="comment"># &gt; Now E </span></span><br><span class="line">nameserver /nowe.com/HKdnsproxy</span><br><span class="line">nameserver /nowestatic.com/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; Now TV</span></span><br><span class="line">nameserver /now.com/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; Viu.TV</span></span><br><span class="line"><span class="comment">#include Viu.com</span></span><br><span class="line">nameserver /viu.now.com/HKdnsproxy</span><br><span class="line">nameserver /viu.tv/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; MyTVSuper</span></span><br><span class="line">nameserver /mytvsuper.com/HKdnsproxy</span><br><span class="line">nameserver /mytvsuperlimited.hb.omtrdc.net/HKdnsproxy</span><br><span class="line">nameserver /mytvsuperlimited.sc.omtrdc.net/HKdnsproxy</span><br><span class="line">nameserver /tvb.com/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; HOY TV</span></span><br><span class="line">nameserver /hoy.tv/HKdnsproxy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- &gt; SouthEastAsia media</span></span><br><span class="line"><span class="comment"># &gt; HBO GO Asia</span></span><br><span class="line">nameserver /44wilhpljf.execute-api.ap-southeast-1.amazonaws.com/HKdnsproxy</span><br><span class="line">nameserver /bcbolthboa-a.akamaihd.net/HKdnsproxy</span><br><span class="line">nameserver /dai3fd1oh325y.cloudfront.net/HKdnsproxy</span><br><span class="line">nameserver /hboasia1-i.akamaihd.net/HKdnsproxy</span><br><span class="line">nameserver /hboasia2-i.akamaihd.net/HKdnsproxy</span><br><span class="line">nameserver /hboasia3-i.akamaihd.net/HKdnsproxy</span><br><span class="line">nameserver /hboasia4-i.akamaihd.net/HKdnsproxy</span><br><span class="line">nameserver /hboasia5-i.akamaihd.net/HKdnsproxy</span><br><span class="line">nameserver /hboasialive.akamaized.net/HKdnsproxy</span><br><span class="line">nameserver /hbogoprod-vod.akamaized.net/HKdnsproxy</span><br><span class="line">nameserver /hbolb.onwardsmg.com/HKdnsproxy</span><br><span class="line">nameserver /hbounify-prod.evergent.com/HKdnsproxy</span><br><span class="line">nameserver /hbogo.co.th/HKdnsproxy</span><br><span class="line">nameserver /hbogoasia.com/HKdnsproxy</span><br><span class="line">nameserver /hbogoasia.hk/HKdnsproxy</span><br><span class="line">nameserver /hbogoasia.id/HKdnsproxy</span><br><span class="line">nameserver /hbogoasia.ph/HKdnsproxy</span><br><span class="line">nameserver /hbogoasia.sg/SGdnsproxy</span><br><span class="line">nameserver /hbogoasia.tw/HKdnsproxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- &gt; AI Platform</span></span><br><span class="line"><span class="comment"># &gt; Openai</span></span><br><span class="line">nameserver /openai.com/HKdnsproxy</span><br><span class="line">nameserver /chatgpt.com/HKdnsproxy</span><br><span class="line">nameserver /oaistatic.com/HKdnsproxy</span><br><span class="line">nameserver /oaiusercontent.com/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; ExHantai/E-hentai</span></span><br><span class="line">nameserver /exhentai.org/HKdnsproxy</span><br><span class="line">nameserver /e-hentai.org/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; Claude 2</span></span><br><span class="line">nameserver /anthropic.com/HKdnsproxy</span><br><span class="line">nameserver /claude.ai/HKdnsproxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- &gt; China Media</span></span><br><span class="line"><span class="comment"># &gt; BiliBili</span></span><br><span class="line">nameserver /bilibili.com/HKdnsproxy</span><br><span class="line">nameserver /bilibili.tv/HKdnsproxy</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>保存并启动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#记得关闭本地DNS服务</span></span><br><span class="line">systemctl stop systemd-resolved &amp;&amp; systemctl <span class="built_in">disable</span> systemd-resolved </span><br><span class="line"><span class="comment">#开启smartdns</span></span><br><span class="line">systemctl <span class="built_in">enable</span> smartdns</span><br><span class="line">systemctl start smartdns</span><br></pre></td></tr></table></figure><h4 id="解锁机-开启dns白名单">解锁机:开启DNS白名单</h4><p>强烈建议开启DNS白名单，不开启会被别人白嫖，也可能被D哥用作DNS放大攻击</p><p>修改下面示例的IP(被解锁机的ip)即可。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw allow from 64.23.217.157 to any port 53 proto udp</span><br></pre></td></tr></table></figure><h4 id="被解锁机-全局修改dns">被解锁机:全局修改DNS</h4><p>修改DNS为解锁机或者DNS服务器的IP</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolv.conf</span><br><span class="line"><span class="comment"># 添加下面的</span></span><br><span class="line">nameserver 解锁机或DNS服务器的IP</span><br></pre></td></tr></table></figure><p>这里全局修改DNS到解锁机，如果解锁机宕机，被解锁机的DNS服务会出问题；</p><h3 id="方案二：单机代理">方案二：单机代理</h3><h4 id="被解锁机-搭建smartdns-dnsmasq">被解锁机:搭建smartdns/dnsmasq</h4><p>在被解锁服务器<strong>本地搭建smartdns</strong></p><p>安装步骤和方案一相同，此处不再赘述。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#记得关闭本地DNS服务</span></span><br><span class="line">systemctl stop systemd-resolved &amp;&amp; systemctl <span class="built_in">disable</span> systemd-resolved </span><br><span class="line"></span><br><span class="line"><span class="comment">#非必要！默认优先ipv6，直接禁用ipv6</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1&quot;</span> &gt; /proc/sys/net/ipv6/conf/all/disable_ipv6 </span><br></pre></td></tr></table></figure><p>配置文件有所改变，具体改动为第一行的DNS设置，该设置限制了仅本地可以访问</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/smartdns/smartdns.conf</span><br></pre></td></tr></table></figure><p>格式示例：</p><p><strong>不用全部添加，如果已经解锁了的没必要添加进去</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> [::]:53</span><br><span class="line"><span class="comment">#bind[::]:53@eth0 -no-dualstack-selection -no-speed-check </span></span><br><span class="line">dualstack-ip-selection no</span><br><span class="line">speed-check-mode none</span><br><span class="line">serve-expired-prefetch-time 21600</span><br><span class="line">prefetch-domain <span class="built_in">yes</span></span><br><span class="line">cache-size 32768</span><br><span class="line">cache-persist <span class="built_in">yes</span></span><br><span class="line">cache-file /etc/smartdns/cache</span><br><span class="line">prefetch-domain <span class="built_in">yes</span></span><br><span class="line">serve-expired <span class="built_in">yes</span></span><br><span class="line">serve-expired-ttl 259200</span><br><span class="line">serve-expired-reply-ttl 3</span><br><span class="line">prefetch-domain <span class="built_in">yes</span></span><br><span class="line">serve-expired-prefetch-time 21600</span><br><span class="line">cache-checkpoint-time 86400</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置默认的上游 DNS</span></span><br><span class="line">server 11.22.33.44</span><br><span class="line">server 8.8.8.8 <span class="comment">#默认上游DNS</span></span><br><span class="line">server 8.8.4.4 <span class="comment">#默认上游DNS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置自定义的解锁机上游 DNS</span></span><br><span class="line">server 11.22.33.44 IP -group us -exclude-default-group</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; Disney+</span></span><br><span class="line">nameserver /disney.connections.edge.bamgrid.com/us</span><br><span class="line">nameserver /disney.api.edge.bamgrid.com/us</span><br><span class="line">nameserver /disney-plus.net/us</span><br><span class="line">nameserver /disneyplus.com/us</span><br><span class="line">nameserver /dssott.com/us</span><br><span class="line">nameserver /disneynow.com/us</span><br><span class="line">nameserver /disneystreaming.com/us</span><br><span class="line">nameserver /cdn.registerdisney.go.com/us</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; Netflix</span></span><br><span class="line">nameserver /netflix.com/us</span><br><span class="line">nameserver /netflix.net/us</span><br><span class="line">nameserver /nflximg.com/us</span><br><span class="line">nameserver /nflximg.net/us</span><br><span class="line">nameserver /nflxvideo.net/us</span><br><span class="line">nameserver /nflxext.com/us</span><br><span class="line">nameserver /nflxso.net/us</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; HuluUSA</span></span><br><span class="line">address /assetshuluimcom-a.akamaihd.net/11.22.33.44</span><br><span class="line">address /cws-hulu.conviva.com/11.22.33.44</span><br><span class="line">address /hulu.com/11.22.33.44</span><br><span class="line">address /hulu.hb.omtrdc.net/11.22.33.44</span><br><span class="line">address /hulu.sc.omtrdc.net/11.22.33.44</span><br><span class="line">address /huluad.com/11.22.33.44</span><br><span class="line">address /huluqa.com/11.22.33.44</span><br><span class="line">address /hulustream.com/11.22.33.44</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; Instagram</span></span><br><span class="line">nameserver /instagram.com/us</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; Tiktok</span></span><br><span class="line">nameserver /byteoversea.com/us</span><br><span class="line">nameserver /ibytedtos.com/us</span><br><span class="line">nameserver /ipstatp.com/us</span><br><span class="line">nameserver /muscdn.com/us</span><br><span class="line">nameserver /musical.ly/us</span><br><span class="line">nameserver /tiktok.com/us</span><br><span class="line">nameserver /tik-tokapi.com/us</span><br><span class="line">nameserver /tiktokcdn.com/us</span><br><span class="line">nameserver /tiktokv.com/us</span><br></pre></td></tr></table></figure><h4 id="被解锁-修改dns">被解锁:修改DNS</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改完配置后，重启smartdns</span></span><br><span class="line">systemctl restart smartdns</span><br><span class="line"><span class="comment"># 查看运行状态</span></span><br><span class="line">systemctl status smartdns</span><br><span class="line"><span class="comment"># 此时本地的53端口应该是运行着smartdns</span></span><br></pre></td></tr></table></figure><p>再将修改本地DNS为127.0.0.1，从而定位到smartdns服务</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolv.conf</span><br></pre></td></tr></table></figure><h2 id="dnsmasq方案">Dnsmasq方案</h2><h3 id="解锁机安装dnsmasq">解锁机安装Dnsmasq</h3><blockquote><p>这里在使用dnsmasq，上面的dnsmasq_sniproxy.sh脚本能一键安装dnsmasq并配置好流媒体</p><p>即在被解锁机建立DNS服务，为多台机器提供解锁</p></blockquote><p>确保53、80、443端口不被占用</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 执行</span></span><br><span class="line">bash dnsmasq_sniproxy.sh -<span class="built_in">id</span></span><br></pre></td></tr></table></figure><p>执行后应该即可运行dnsmasq服务了</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启dnsmasq服务</span></span><br><span class="line">systemctl start dnsmasq &amp;&amp; systemctl <span class="built_in">enable</span> dnsmasq</span><br><span class="line"><span class="comment"># 关闭dnsmasq服务</span></span><br><span class="line">systemctl stop dnsmasq &amp;&amp; systemctl <span class="built_in">disable</span> dnsmasq</span><br><span class="line"><span class="comment"># 开启systemd-resolved</span></span><br><span class="line">systemctl start systemd-resolved &amp;&amp; systemctl <span class="built_in">enable</span> systemd-resolved </span><br></pre></td></tr></table></figure><h3 id="被解锁机安装dnsmasq">被解锁机安装Dnsmasq</h3><p>使用前面的脚本，在被解锁机上运行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/Jimmyzxk/DNS-Alice-Unlock/refs/heads/main/dns-unlock.sh &amp;&amp; bash dns-unlock.sh</span><br></pre></td></tr></table></figure><p>同样使用dnsmasq方案，填写上解锁机的ip</p><hr><h2 id="还原设置">还原设置</h2><blockquote><p>还原成原始DNS设置</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭smartdns服务</span></span><br><span class="line">systemctl stop smartdns &amp;&amp; systemctl <span class="built_in">disable</span> smartdns</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭dnsmasq服务</span></span><br><span class="line">systemctl stop dnsmasq &amp;&amp; systemctl <span class="built_in">disable</span> dnsmasq</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启systemd-resolved</span></span><br><span class="line">systemctl start systemd-resolved &amp;&amp; systemctl <span class="built_in">enable</span> systemd-resolved</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启smardns</span></span><br><span class="line">systemctl start smartdns &amp;&amp; systemctl <span class="built_in">enable</span> smartdns</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启dnsmasq服务</span></span><br><span class="line">systemctl start dnsmasq &amp;&amp; systemctl <span class="built_in">enable</span> dnsmasq</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭本地DNS服务</span></span><br><span class="line">systemctl stop systemd-resolved &amp;&amp; systemctl <span class="built_in">disable</span> systemd-resolved </span><br></pre></td></tr></table></figure><p>文件可能被锁定，这里是解锁方法</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsattr /etc/resolv.conf</span><br></pre></td></tr></table></figure><p>如果看到有’i’ (e.g., <code>----i---------</code>)则说明文件被锁定</p><p>解除锁定</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chattr -i /etc/resolv.conf</span><br></pre></td></tr></table></figure><p>随后修改文件权限即可</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> 755 /etc/resolv.conf</span><br></pre></td></tr></table></figure><h1 id="解锁方式对比">解锁方式对比</h1><h2 id="六种情况">六种情况</h2><ol><li>解锁机不运行SmartDNS，被解锁机运行SmartDNS，并用<code>nameserver</code>解析网飞</li></ol><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241130143227303.png" alt="image-20241130143227303"></p><p>失败</p><ol start="2"><li>解锁机不运行SmartDNS，被解锁机运行SmartDNS，并用<code>address</code>解析网飞</li></ol><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241130143412383.png" alt="image-20241130143412383"></p><p>解锁成功，并且网飞定位是US</p><ol start="3"><li>解锁机运行SmartDNS，被解锁机运行SmartDNS，并用<code>nameserver</code>解析网飞</li></ol><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241130143637685.png" alt="image-20241130143637685"></p><p>解锁成功，并且看到网飞定位是SG，因为在解锁机上我们将网飞的解析交给了Alice的SG服务器（上游服务器）</p><ol start="4"><li>解锁机运行SmartDNS，被解锁机运行SmartDNS，并用<code>address</code>解析网飞</li></ol><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241130143848175.png" alt="image-20241130143848175"></p><p>解锁成功，网飞定位是US（即解锁机的地区），说明此时解锁机直接进行了解析，并没有交给上游Alice服务器</p><ol start="5"><li>解锁机运行SmartDNS，被解锁机<code>全局DNS解析</code>到解锁机</li></ol><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241130144503190.png" alt="image-20241130144503190"></p><p>解锁成功，并且看到网飞定位是SG，因为在解锁机上我们将网飞的解析交给了Alice的SG服务器（上游服务器）</p><p>和在被解锁机运行sm，并使用nameserver解析一样</p><ol start="6"><li>解锁机不运行SmartDNS，被解锁机<code>全局DNS</code>解析</li></ol><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241130144630366.png" alt="image-20241130144630366"></p><p>可以看到，直接失败了，无法进行任何DNS解析</p><blockquote><p>注意，这里的解锁机运行smartDNS时，网飞的解锁交给Alice的SG服务器解析</p></blockquote><table><thead><tr><th><strong>序号</strong></th><th><strong>解锁方式</strong></th><th><strong>结果</strong></th><th><strong>优点</strong></th><th><strong>缺点</strong></th></tr></thead><tbody><tr><td><strong>1</strong></td><td>解锁机不运行SmartDNS，被解锁机运行SmartDNS，并用<code>nameserver</code>解析网飞</td><td>无法解析成功</td><td>—</td><td>解析失败</td></tr><tr><td><strong>2</strong></td><td>解锁机不运行SmartDNS，被解锁机运行SmartDNS，并用<code>address</code>解析网飞</td><td>解锁成功，网飞定位为US（由解锁机<strong>直接解析</strong>）</td><td>无需解锁机运行SmartDNS</td><td></td></tr><tr><td><strong>3</strong></td><td>解锁机运行SmartDNS，被解锁机运行SmartDNS，并用<code>nameserver</code>解析网飞</td><td>解锁成功，网飞定位为SG（由解锁机的<strong>上游服务器决定</strong>）</td><td>被解锁机不完全依赖解锁机；可以用解锁机的上游服务器</td><td></td></tr><tr><td><strong>4</strong></td><td>解锁机运行SmartDNS，被解锁机运行SmartDNS，并用<code>address</code>解析网飞</td><td>解锁成功，网飞定位为US（由解锁机<strong>直接解析</strong>）</td><td>被解锁机不完全依赖解锁机</td><td></td></tr><tr><td><strong>5</strong></td><td>解锁机运行SmartDNS，被解锁机<code>全局DNS解析</code>到解锁机</td><td>解锁成功，网飞定位为SG（由解锁机的<strong>上游服务器决定</strong>）</td><td>接入方便;可以用解锁机的上游服务器</td><td>被解锁机完全依赖解锁机的SmartDNS，需保证解锁机稳定运行</td></tr><tr><td><strong>6</strong></td><td>解锁机不运行SmartDNS，被解锁机<code>全局DNS</code>解析</td><td>无法解析成功</td><td>—</td><td>无法解析DNS，直接失败</td></tr></tbody></table><hr><h2 id="推荐解锁方式">推荐解锁方式</h2><p>解锁机运行sniproxy，不运行SmartDNS，被解锁机运行SmartDNS并用<code>address</code>解析</p><p>优点：</p><p>1、DNS解析速度快</p><p>2、被解锁机可以自由选择用不同解锁机</p><p>3、解锁机宕机后也不影响被解锁机使用</p><ol><li><strong>方式 3（解锁机运行SmartDNS，被解锁机运行SmartDNS并用<code>nameserver</code>解析）</strong><ul><li>解锁机如果运营了一个DNS解锁服务器，可以通过嵌套解锁方式，实现不同地区的内容解锁；</li><li>被解锁机设置所有流媒体网站全部用<code>nameserver</code>解析交给解锁机，且不完全依赖解锁机；</li></ul></li><li>**方式 5 解锁机运行SmartDNS，被解锁机<code>全局DNS解析</code>到解锁机 **<ol><li>方便，简单</li></ol></li></ol><h1 id="高级玩法">高级玩法</h1><h2 id="玩法一-嵌套解锁">玩法一 嵌套解锁</h2><p>其实，在某些商家提供DNS解锁的服务器也可以利用本教程给其他服务器提供解锁，就是嵌套解锁（<strong>该行为可能违反TOS</strong>）。<br>借助方案一，使用自建DNS，只需要改一下上游DNS设置和域名对应的DNS设置即可实现。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server 210.0.255.250 <span class="comment">#默认上游DNS</span></span><br><span class="line">server 210.0.255.251 <span class="comment">#默认上游DNS</span></span><br><span class="line">server 此处写商家提供的DNS IP -group dnsproxy -exclude-default-group</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; Netflix</span></span><br><span class="line">nameserver /netflix.com/dnsproxy</span><br><span class="line">nameserver /netflix.net/dnsproxy</span><br><span class="line">nameserver /nflximg.com/dnsproxy </span><br><span class="line">nameserver /nflximg.net/dnsproxy</span><br><span class="line">nameserver /nflxvideo.net/dnsproxy </span><br><span class="line">nameserver /nflxext.com/dnsproxy </span><br><span class="line">nameserver /nflxso.net/dnsproxy </span><br></pre></td></tr></table></figure><h2 id="玩法二-自建doh服务器">玩法二 自建DOH服务器</h2><p>某些厂商强制劫持了53端口的UDP流量，导致无论怎么改DNS都无法摆脱商家的解锁服务，此时DOH就派上了用处。<br>DOH简单说就是DNS over HTTPS，通过DOH 走TCP流量使用TLS可以完美绕过DNS劫持。<br>smartdns可以搭建DOH服务器，但是我没搭建成功，so sad。所以仅介绍adguardhome搭建DOH。<br><a href="https://www.nodeseek.com/jump?to=https%3A%2F%2Faoyouer.com%2Fposts%2Fadguardhome-public-dns%2F">具体adguardhome搭建DOH的教程网络已有很多</a>，此处就省去了。搭建过程中，唯一需要注意的是，上游DNS需要写127.0.0.1。<br>被DNS劫持的服务器只需要在smartdns中将默认DNS设置为自己刚建好的DOH地址即可。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server-https https://cloudflare-dns.com/dns-query</span><br></pre></td></tr></table></figure><p>小建议由于TLS三次握手的特性，查询DNS的延迟肯定会提升，建议开启smartdns的缓存功能。</p><h2 id="玩法三-smartdns开启广告过滤">玩法三 smartdns开启广告过滤</h2><p>下载配置文件到<code>/etc/smartdns</code>目录：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://anti-ad.net/anti-ad-for-smartdns.conf -O /etc/smartdns/anti-ad-smartdns.conf</span><br></pre></td></tr></table></figure><p>修改该<code>/etc/smartdns/smartdns.conf</code>文件以包含上述配置文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 在/etc/smartdns/smartdns.conf 末尾添加下面这行即可</span><br><span class="line">conf-file /etc/smartdns/anti-ad-smartdns.conf</span><br></pre></td></tr></table></figure><p>保存并重启SmartDNS 服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart smartdns</span><br></pre></td></tr></table></figure><h2 id="扩展聊一聊">扩展聊一聊</h2><p>其实直接通过修改系统DNS方式解锁流媒体弊端有很多，常见的弊端比如：DNS服务器宕机导致本地服务无法解析域名、由于厂商分流规则没有细分导致常见CDN 分配的IP在别的地区（常见于akamai的CDN），这时候DNS分流就尤为重要。利用smartdns，可以实现对解锁域名走厂商DNS，对其他域名走公共DNS。举个例子，下面那个配置意思是：DAZN和Hotstar走DNS，其他的全用8.8.8.8解析，这样即使66.66.66.66宕机，本地只要不访问DAZN和Hotstar就不受任何影响。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server 8.8.8.8</span><br><span class="line">server 66.66.66.66（厂商给的dns ip） -group dns -exclude-default-group</span><br><span class="line"></span><br><span class="line"># ---------- &gt; Global Plaform</span><br><span class="line"># &gt; DAZN</span><br><span class="line">nameserver /upos-hz-mirrorakam.akamaized.net/dns</span><br><span class="line"># &gt; Hotstar</span><br><span class="line">nameserver /hotstar.com/dns</span><br></pre></td></tr></table></figure><h2 id="相关项目官网">相关项目官网</h2><p><a href="https://www.nodeseek.com/jump?to=https%3A%2F%2Fgithub.com%2Fxsidc%2Fdnsmasq">sni代理</a><br><a href="https://www.nodeseek.com/jump?to=https%3A%2F%2Fpymumu.github.io%2Fsmartdns">smartdns</a><br><a href="https://www.nodeseek.com/jump?to=https%3A%2F%2Fgithub.com%2FAdguardTeam%2FAdGuardHome">AdGuardHome</a></p><h1 id="流媒体解锁检测">流媒体解锁检测</h1><p>RegionRestrictionCheck 检测脚本检测项目比较全面，且支持Docker运行，杜绝污染VPS服务器，检测流媒体除了主流的Netflix、Disney+、YouTube Premium，还可以支持检测Dazn、Viu TV、4GTV和KKTV等比较冷门的流媒体服务。</p><blockquote><p>支持OS/Platform：CentOS 6+, Ubuntu 14.04+, Debian 8+, MacOS, Android with Termux</p></blockquote><h2 id="使用方法">使用方法</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -L -s check.unlock.media)</span><br></pre></td></tr></table></figure><p>只检测IPv4结果:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -L -s check.unlock.media) -M 4</span><br></pre></td></tr></table></figure><p>只检测IPv6结果：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -L -s check.unlock.media) -M 6</span><br></pre></td></tr></table></figure><h1 id="附件">附件</h1><p>完整的配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br></pre></td><td class="code"><pre><span class="line">bind [::]:53</span><br><span class="line">#bind[::]:53@eth0 -no-dualstack-selection -no-speed-check </span><br><span class="line">dualstack-ip-selection no</span><br><span class="line">speed-check-mode none</span><br><span class="line">serve-expired-prefetch-time 21600</span><br><span class="line">prefetch-domain yes</span><br><span class="line">cache-size 32768</span><br><span class="line">cache-persist yes</span><br><span class="line">cache-file /etc/smartdns/cache</span><br><span class="line">prefetch-domain yes</span><br><span class="line">serve-expired yes</span><br><span class="line">serve-expired-ttl 259200</span><br><span class="line">serve-expired-reply-ttl 3</span><br><span class="line">prefetch-domain yes</span><br><span class="line">serve-expired-prefetch-time 21600</span><br><span class="line">cache-checkpoint-time 86400</span><br><span class="line"></span><br><span class="line"># 设置默认的上游 DNS</span><br><span class="line">server 8.8.8.8 #默认上游DNS</span><br><span class="line">server 8.8.4.4 #默认上游DNS</span><br><span class="line"># 设置自定义的上游 DNS</span><br><span class="line">server 11.22.33.44 IP -group us -exclude-default-group</span><br><span class="line"></span><br><span class="line"># ---------- &gt; Global Plaform</span><br><span class="line"># &gt; Disney+</span><br><span class="line">nameserver /disney.connections.edge.bamgrid.com/us</span><br><span class="line">nameserver /disney.api.edge.bamgrid.com/us</span><br><span class="line">nameserver /disney-plus.net/us</span><br><span class="line">nameserver /disneyplus.com/us</span><br><span class="line">nameserver /dssott.com/us</span><br><span class="line">nameserver /disneynow.com/us</span><br><span class="line">nameserver /disneystreaming.com/us</span><br><span class="line">nameserver /cdn.registerdisney.go.com/us</span><br><span class="line"></span><br><span class="line"># &gt; Netflix</span><br><span class="line">#nameserver /netflix.com/us</span><br><span class="line">#nameserver /netflix.net/us</span><br><span class="line">#nameserver /nflximg.com/us</span><br><span class="line">#nameserver /nflximg.net/us</span><br><span class="line">#nameserver /nflxvideo.net/us</span><br><span class="line">#nameserver /nflxext.com/us</span><br><span class="line">#nameserver /nflxso.net/us</span><br><span class="line"></span><br><span class="line"># 如果使用解锁机IP</span><br><span class="line">address /netflix.com/11.22.33.44</span><br><span class="line">address /netflix.net/11.22.33.44</span><br><span class="line">address /nflximg.com/11.22.33.44</span><br><span class="line">address /nflximg.net/11.22.33.44</span><br><span class="line">address /nflxvideo.net/11.22.33.44</span><br><span class="line">address /nflxext.com/11.22.33.44</span><br><span class="line">address /nflxso.net/11.22.33.44</span><br><span class="line"></span><br><span class="line"># &gt; HuluUSA</span><br><span class="line">address /assetshuluimcom-a.akamaihd.net/11.22.33.44</span><br><span class="line">address /cws-hulu.conviva.com/11.22.33.44</span><br><span class="line">address /hulu.com/11.22.33.44</span><br><span class="line">address /hulu.hb.omtrdc.net/11.22.33.44</span><br><span class="line">address /hulu.sc.omtrdc.net/11.22.33.44</span><br><span class="line">address /huluad.com/11.22.33.44</span><br><span class="line">address /huluqa.com/11.22.33.44</span><br><span class="line">address /hulustream.com/11.22.33.44</span><br><span class="line"></span><br><span class="line"># &gt; HuluUSA</span><br><span class="line">#nameserver /assetshuluimcom-a.akamaihd.net/us</span><br><span class="line">#nameserver /cws-hulu.conviva.com/us</span><br><span class="line">#nameserver /hulu.com/us</span><br><span class="line">#nameserver /hulu.hb.omtrdc.net/us</span><br><span class="line">#nameserver /hulu.sc.omtrdc.net/us</span><br><span class="line">#nameserver /huluad.com/us</span><br><span class="line">#nameserver /huluqa.com/us</span><br><span class="line">#nameserver /hulustream.com/us</span><br><span class="line"></span><br><span class="line"># &gt; Amazon Prime Video:</span><br><span class="line">#nameserver /d1v5ir2lpwr8os.cloudfront.net/us</span><br><span class="line">#nameserver /d22qjgkvxw22r6.cloudfront.net/us</span><br><span class="line">#nameserver /d25xi40x97liuc.cloudfront.net/us</span><br><span class="line">#nameserver /d27xxe7juh1us6.cloudfront.net/us</span><br><span class="line">#nameserver /dmqdd6hw24ucf.cloudfront.net/us</span><br><span class="line">#nameserver /aiv-cdn.net/us</span><br><span class="line">#nameserver /aiv-delivery.net/us</span><br><span class="line">#nameserver /amazonvideo.com/us</span><br><span class="line">#nameserver /atv-ext-eu.amazon.com/us</span><br><span class="line">#nameserver /atv-ext-fe.amazon.com/us</span><br><span class="line">#nameserver /atv-ext.amazon.com/us</span><br><span class="line">#nameserver /atv-ps-eu.amazon.co.uk/us</span><br><span class="line">#nameserver /atv-ps-eu.amazon.com/us</span><br><span class="line">#nameserver /atv-ps-fe.amazon.co.jp/us</span><br><span class="line">#nameserver /atv-ps-fe.amazon.com/us</span><br><span class="line">#nameserver /atv-ps.amazon.com/us</span><br><span class="line">#nameserver /primevideo.com/us</span><br><span class="line">#nameserver /pv-cdn.net/us</span><br><span class="line">#nameserver /video.a2z.com/us</span><br><span class="line"></span><br><span class="line"># &gt; TVBAnywhere+</span><br><span class="line">nameserver /tvbanywhere.com/us</span><br><span class="line">nameserver /tvbanywhere.com.sg/us</span><br><span class="line">nameserver /tvb.com/us</span><br><span class="line">nameserver /tvb.com.au/us</span><br><span class="line">nameserver /tvbc.com.cn/us</span><br><span class="line">nameserver /tvbeventpower.com.hk/us</span><br><span class="line">nameserver /tvbusa.com/us</span><br><span class="line">nameserver /tvbweekly.com/us</span><br><span class="line">nameserver /tvmedia.net.au/us</span><br><span class="line"></span><br><span class="line"># &gt; Viu.com</span><br><span class="line">nameserver /cognito-identity.us-east-1.amazonaws.com/us</span><br><span class="line">nameserver /d1k2us671qcoau.cloudfront.net/us</span><br><span class="line">nameserver /d2anahhhmp1ffz.cloudfront.net/us</span><br><span class="line">nameserver /dfp6rglgjqszk.cloudfront.net/us</span><br><span class="line">nameserver /d3o7oi00quuwqu.cloudfront.net/us</span><br><span class="line">nameserver /mobileanalytics.us-east-1.amazonaws.com/us</span><br><span class="line">nameserver /viu.com/us</span><br><span class="line"></span><br><span class="line"># &gt; Instagram</span><br><span class="line">nameserver /instagram.com/us</span><br><span class="line"># &gt; iQiyi</span><br><span class="line">nameserver /71.am/us</span><br><span class="line">nameserver /iq.com/us</span><br><span class="line">nameserver /iqiyi.com/us</span><br><span class="line">nameserver /iqiyipic.com/us</span><br><span class="line">nameserver /pps.tv/us</span><br><span class="line">nameserver /ppsimg.com/us</span><br><span class="line">nameserver /qiyi.com/us</span><br><span class="line">nameserver /qiyipic.com/us</span><br><span class="line">nameserver /qy.net/us</span><br><span class="line"># &gt; Tiktok</span><br><span class="line">nameserver /byteoversea.com/us</span><br><span class="line">nameserver /ibytedtos.com/us</span><br><span class="line">nameserver /ipstatp.com/us</span><br><span class="line">nameserver /muscdn.com/us</span><br><span class="line">nameserver /musical.ly/us</span><br><span class="line">nameserver /tiktok.com/us</span><br><span class="line">nameserver /tik-tokapi.com/us</span><br><span class="line">nameserver /tiktokcdn.com/us</span><br><span class="line">nameserver /tiktokv.com/us</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ---------- &gt; Taiwan Media</span><br><span class="line"># &gt; KKTV</span><br><span class="line">nameserver /kfs.io/us</span><br><span class="line">nameserver /kktv-theater.kk.stream/us</span><br><span class="line">nameserver /kkbox.com/us</span><br><span class="line">nameserver /kkbox.com.tw/us</span><br><span class="line">nameserver /kktv.com.tw/us</span><br><span class="line">nameserver /kktv.me/us</span><br><span class="line"># &gt; LiTV</span><br><span class="line">nameserver /litv.tv/us</span><br><span class="line">nameserver /litvfreepc.akamaized.net/us</span><br><span class="line"># &gt; MyVideo</span><br><span class="line">nameserver /cdn.plyr.io/us</span><br><span class="line">nameserver /myvideo.net.tw/us</span><br><span class="line"># &gt; 4GTV</span><br><span class="line">nameserver /4gtv.tv/us</span><br><span class="line">nameserver /4gtvfreepc-cds.cdn.hinet.net/us</span><br><span class="line">nameserver /4gtvfreepcvod-cds.cdn.hinet.net/us</span><br><span class="line">nameserver /4gtvpc-cds.cdn.hinet.net/us</span><br><span class="line">nameserver /4gtvpcvod-cds.cdn.hinet.net/us</span><br><span class="line"># &gt; LineTV.TW</span><br><span class="line">nameserver /d3c7rimkq79yfu.cloudfront.net/us</span><br><span class="line">nameserver /linetv.tw/us</span><br><span class="line"># &gt; Hami Video</span><br><span class="line">nameserver /cdn.hinet.net/us</span><br><span class="line">nameserver /hamivideo.hinet.net/us</span><br><span class="line">nameserver /scc.ott.hinet.net/us</span><br><span class="line"># &gt; CatchPlay+</span><br><span class="line">nameserver /catchplay.com/us</span><br><span class="line">nameserver /d2ivmxp5z2ww0n.cloudfront.net/us</span><br><span class="line">nameserver /ols-ww100-cp.akamaized.net/us</span><br><span class="line">nameserver /tra-www000-cp.akamaized.net/us</span><br><span class="line"># &gt; Bahamut Anime</span><br><span class="line">nameserver /bahamut.com.tw/us</span><br><span class="line">nameserver /gamer.com.tw/us</span><br><span class="line">nameserver /gamer-cds.cdn.hinet.net/us</span><br><span class="line">nameserver /gamer2-cds.cdn.hinet.net/us</span><br><span class="line"></span><br><span class="line"># &gt; Friday Video</span><br><span class="line">nameserver /video.friday.tw/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; Canada Media</span><br><span class="line"># &gt; CBC Gem</span><br><span class="line">nameserver /cbc.ca/us</span><br><span class="line">nameserver /cbchd1dynamicads-i.akamaihd.net/us</span><br><span class="line">nameserver /cbclivedai5-i.akamaihd.net/us</span><br><span class="line">nameserver /cbcnewshd-f.akamaihd.net/us</span><br><span class="line">nameserver /cbcrcott-gem-key.akamaized.net/us</span><br><span class="line">nameserver /cbcrcott-gem.akamaized.net/us</span><br><span class="line">nameserver /go-mpulse.net/us</span><br><span class="line">nameserver /theplatform.com/us</span><br><span class="line"># &gt; Crave TV</span><br><span class="line">nameserver /crave.ca/us</span><br><span class="line">nameserver /go-mpulse.net/us</span><br><span class="line">nameserver /9c9media.com/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; Japan Media</span><br><span class="line"># &gt; NHK+</span><br><span class="line">nameserver /nhk.jp/us</span><br><span class="line">nameserver /nhk.or.jp/us</span><br><span class="line"># &gt; DMM</span><br><span class="line">nameserver /dmm-extension.com/us</span><br><span class="line">nameserver /dmm.co.jp/us</span><br><span class="line">nameserver /dmm.com/us</span><br><span class="line">nameserver /videomarket.jp/us</span><br><span class="line">nameserver /p-smith.com/us</span><br><span class="line">nameserver /vmdash-cenc.akamaized.net/us</span><br><span class="line">nameserver /img.vm-movie.jp/us</span><br><span class="line"># &gt; Abema</span><br><span class="line">nameserver /abema.io/us</span><br><span class="line">nameserver /abema.tv/us</span><br><span class="line">nameserver /ds-linear-abematv.akamaized.net/us</span><br><span class="line">nameserver /linear-abematv.akamaized.net/us</span><br><span class="line">nameserver /ds-vod-abematv.akamaized.net/us</span><br><span class="line">nameserver /vod-abematv.akamaized.net/us</span><br><span class="line">nameserver /vod-playout-abematv.akamaized.net/us</span><br><span class="line">nameserver /ameba.jp/us</span><br><span class="line">nameserver /hayabusa.io/us</span><br><span class="line">nameserver /bucketeer.jp/us</span><br><span class="line">nameserver /abema.adx.promo/us</span><br><span class="line">nameserver /hayabusa.media/us</span><br><span class="line">nameserver /abema-tv.com/us</span><br><span class="line"># &gt; NicoNico</span><br><span class="line">nameserver /dmc.nico/us</span><br><span class="line">nameserver /nicovideo.jp/us</span><br><span class="line">nameserver /nimg.jp/us</span><br><span class="line"># &gt; Telasa</span><br><span class="line">nameserver /telasa.jp/us</span><br><span class="line">nameserver /kddi-video.com/us</span><br><span class="line">nameserver /videopass.jp/us</span><br><span class="line">nameserver /d2lmsumy47c8as.cloudfront.net/us</span><br><span class="line"># &gt; Paravi</span><br><span class="line">nameserver /paravi.jp/us</span><br><span class="line"># &gt; U-NEXT</span><br><span class="line">nameserver /unext.jp/us</span><br><span class="line">nameserver /nxtv.jp/us</span><br><span class="line"># &gt; Hulu Japan</span><br><span class="line">nameserver /happyon.jp/us</span><br><span class="line">nameserver /hulu.jp/us</span><br><span class="line">nameserver /prod.hjholdings.tv/us</span><br><span class="line">nameserver /streaks.jp/us</span><br><span class="line">nameserver /yb.uncn.jp/us</span><br><span class="line">nameserver /hjholdings.jp/us</span><br><span class="line"># &gt; TVer</span><br><span class="line">nameserver /tver.jp/us</span><br><span class="line">nameserver /edge.api.brightcove.com/us</span><br><span class="line"># nameserver /players.brightcove.net/us</span><br><span class="line">nameserver /gorin.jp/us</span><br><span class="line">nameserver /screens-lab.jp/us</span><br><span class="line">nameserver /tver.co.jp/us</span><br><span class="line">nameserver /dogatch.jp/us</span><br><span class="line"># &gt; GYAO!</span><br><span class="line">nameserver /gyao.yahoo.co.jp/us</span><br><span class="line"># &gt; WOWOW</span><br><span class="line">nameserver /wowow.co.jp/us</span><br><span class="line"># &gt; Videomarket</span><br><span class="line">nameserver /videomarket.jp/us</span><br><span class="line"># &gt; D Anime Store</span><br><span class="line">nameserver /animestore.docomo.ne.jp/us</span><br><span class="line"># &gt; Fuji TV</span><br><span class="line">nameserver /fujitv.co.jp/us</span><br><span class="line">nameserver /stream.ne.jp/us</span><br><span class="line"># &gt; Radiko</span><br><span class="line">nameserver /radiko.jp/us</span><br><span class="line">nameserver /radionikkei.jp/us</span><br><span class="line">nameserver /smartstream.ne.jp/us</span><br><span class="line"># &gt; Karaoke@DAM</span><br><span class="line">nameserver /clubdam.com/us</span><br><span class="line"># &gt; J:com On Demand</span><br><span class="line">nameserver /id.zaq.ne.jp/us</span><br><span class="line"># &gt; AnimeFesta</span><br><span class="line">nameserver /api-animefesta.iowl.jp/us</span><br><span class="line"># &gt; Lemino</span><br><span class="line">nameserver /if.lemino.docomo.ne.jp/us</span><br><span class="line"># &gt; Rakuten TV JP</span><br><span class="line">nameserver /rakuten.co.jp/us</span><br><span class="line"># &gt; Games</span><br><span class="line">nameserver /cygames.jp/us</span><br><span class="line">nameserver /konosubafd.jp/us</span><br><span class="line">nameserver /colorfulpalette.org/us</span><br><span class="line">nameserver /worldflipper.jp/us</span><br><span class="line">nameserver /jujutsuphanpara.jp/us</span><br><span class="line"># &gt; Mora</span><br><span class="line">nameserver /mora.jp/us</span><br><span class="line"># &gt; Music.jp</span><br><span class="line">nameserver /music.jp/us</span><br><span class="line">nameserver /music-book.jp/us</span><br><span class="line"># &gt; Reads </span><br><span class="line">nameserver /data-cloudauthoring.magazine.rakuten.co.jp/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; Oceania Media</span><br><span class="line"># &gt; NBA TV</span><br><span class="line">nameserver /nba.com/us</span><br><span class="line">nameserver /neulion-a.akamaihd.net/us</span><br><span class="line">nameserver /nlnbamdnyc-a.akamaihd.net/us</span><br><span class="line">nameserver /sdk.iad-03.braze.com/us</span><br><span class="line">nameserver /nbaprop.sc.omtrdc.net/us</span><br><span class="line">nameserver /nlnbaqos.neulion.com/us</span><br><span class="line">nameserver /watchnba.cdnfastly.endeavorstreaming.net/us</span><br><span class="line">nameserver /nbaapi.neulion.com/us</span><br><span class="line">nameserver /nba-api-cdn.opin.media/us</span><br><span class="line">nameserver /neulionqos-a.akamaihd.net/us</span><br><span class="line">nameserver /neulion.com/us</span><br><span class="line">nameserver /nbaprop.tt.omtrdc.net/us</span><br><span class="line">nameserver /lion-nba-msl.akamaized.net/us</span><br><span class="line">nameserver /nbanlds19vod.akamaized.net/us</span><br><span class="line"># &gt; Acorn TV</span><br><span class="line">nameserver /edge.api.brightcove.com/us</span><br><span class="line">nameserver /api.rlje.net/us</span><br><span class="line">nameserver /boltdns.net/us</span><br><span class="line">nameserver /acorn.tv/us</span><br><span class="line"># &gt; SHOWTIME</span><br><span class="line">nameserver /sho.com/us</span><br><span class="line">nameserver /showtime.com/us</span><br><span class="line">nameserver /showtimeanytime.com/us</span><br><span class="line"># &gt; BritBox</span><br><span class="line">nameserver /vod-dash-ntham-comm-live.akamaized.net/us</span><br><span class="line">nameserver /vod-dash-ntham-comm.live.cf.md.bbci.co.uk/us</span><br><span class="line">nameserver /vod-hls-ntham-comm-live.akamaized.net/us</span><br><span class="line">nameserver /vod-hls-ntham-comm.live.cf.md.bbci.co.uk/us</span><br><span class="line">nameserver /britbox.com/us</span><br><span class="line">nameserver /d2z3p34itxwaj7.cloudfront.net/us</span><br><span class="line"># &gt; Funimation</span><br><span class="line">nameserver /funimation.com/us</span><br><span class="line">nameserver /funimationsvc.com/us</span><br><span class="line"># &gt; Paramount+</span><br><span class="line">nameserver /paramountplus.com/us</span><br><span class="line">nameserver /cbsi.live.ott.irdeto.com/us</span><br><span class="line">nameserver /cbsplaylistserver.aws.syncbak.com/us</span><br><span class="line">nameserver /cbsservice.aws.syncbak.com/us</span><br><span class="line">nameserver /link.theplatform.com/us</span><br><span class="line">nameserver /cbsaavideo.com/us</span><br><span class="line">nameserver /cbsi.com/us</span><br><span class="line">nameserver /cbsivideo.com/us</span><br><span class="line">nameserver /pplusstatic.com/us</span><br><span class="line"># &gt; AU:Stan</span><br><span class="line">nameserver /stan.com.au/us</span><br><span class="line">nameserver /stan.video/us</span><br><span class="line">nameserver /streamcoimg-a.akamaihd.net/us</span><br><span class="line">nameserver /live01-stan.akamaized.net/us</span><br><span class="line">nameserver /live02-stan.akamaized.net/us</span><br><span class="line"># &gt; AU:Binge/Kayo Sports</span><br><span class="line">nameserver /kayosports.com.au/us</span><br><span class="line">nameserver /streamotion.com.au/us</span><br><span class="line"># &gt; AU:Docplay</span><br><span class="line">nameserver /docplay.com/us</span><br><span class="line">nameserver /0c86e2d1-madman-com-au.akamaized.net/us</span><br><span class="line">nameserver /ff1be285-madman-com-au.akamaized.net/us</span><br><span class="line">nameserver /5a929471-madman-com-au.akamaized.net/us</span><br><span class="line">nameserver /879ed873-madman-com-au.akamaized.net/us</span><br><span class="line"># &gt; AU:7plus</span><br><span class="line">nameserver /7plus.com.au/us</span><br><span class="line">nameserver /npc-live-sevennetwork.akamaized.net/us</span><br><span class="line">nameserver /7plus-sevennetwork.akamaized.net/us</span><br><span class="line">nameserver /seven.demdex.net/us</span><br><span class="line">nameserver /cdn.7livecloud.io/us</span><br><span class="line"># &gt; AU:9 now</span><br><span class="line">nameserver /nine.com.au/us</span><br><span class="line">nameserver /9now.com.au/us</span><br><span class="line">nameserver /edge.api.brightcove.com/us</span><br><span class="line">nameserver /p-9now.akamaized.net/us</span><br><span class="line">nameserver /9now-livestreams.akamaized.net/us</span><br><span class="line">nameserver /9cdn.net/us</span><br><span class="line">nameserver /9nation.com.au/us</span><br><span class="line">nameserver /9news.com.au/us</span><br><span class="line">nameserver /9now.com.au/us</span><br><span class="line">nameserver /freeviewplus.net.au/us</span><br><span class="line">nameserver /mi9.com.au/us</span><br><span class="line">nameserver /mi9cdn.com/us</span><br><span class="line">nameserver /nine.com.au/us</span><br><span class="line">nameserver /nineentertainment.com.au/us</span><br><span class="line">nameserver /nineentertainmentco.com.au/us</span><br><span class="line">nameserver /ninemediaroom.com.au/us</span><br><span class="line">nameserver /ninemsn.com.au/us</span><br><span class="line">nameserver /static9.net.au/us</span><br><span class="line">nameserver /yourtv.com.au/us</span><br><span class="line"># &gt; AU:10 play</span><br><span class="line">nameserver /10play.com.au/us</span><br><span class="line">nameserver /global.ssl.fastly.net/us</span><br><span class="line">nameserver /airspace-cdn.cbsviedo.com/us</span><br><span class="line">nameserver /net10-livestream-keys.play.cbsi.video/us</span><br><span class="line">nameserver /net10-livestream.play.cbsi.video/us</span><br><span class="line">nameserver /d25m2gzplgnf0.cloudfront.net/us</span><br><span class="line"># &gt; AU:ABC iView</span><br><span class="line">nameserver /iview.abc.net.au/us</span><br><span class="line">nameserver /abc-iview-mediapackagestreams-2.akamaized.net/us</span><br><span class="line"># &gt; AU:Optus</span><br><span class="line">nameserver /optus.com.au/us</span><br><span class="line">nameserver /optusdigital.com/us</span><br><span class="line">nameserver /optusnet.com.au/us</span><br><span class="line">nameserver /optussport.tv/us</span><br><span class="line">nameserver /optusvideo.tv/us</span><br><span class="line">nameserver /tls1.yospace.com/us</span><br><span class="line">nameserver /bln1.yospace.com/us</span><br><span class="line">nameserver /d3rj5p7u4c4icq.cloudfront.net/us</span><br><span class="line">nameserver /mgd0ee5iankkv3gidl14rm7c0.litix.io/us</span><br><span class="line">nameserver /93e30b04-drm-widevine-licensing.axprod.net/us</span><br><span class="line"># &gt; AU:SBS on Demand</span><br><span class="line">nameserver /sbsod.com/us</span><br><span class="line">nameserver /sbs.com.au/us</span><br><span class="line">nameserver /videocdn-sbs.akamaized.net/us</span><br><span class="line">nameserver /sbsvoddai-vh.akamaihd.net/us</span><br><span class="line">nameserver /sbsvodns-vh.akamaihd.net/us</span><br><span class="line">nameserver /sbs-live-dai.akamaized.net/us</span><br><span class="line">nameserver /sbs-live.akamaized.net/us</span><br><span class="line">nameserver /sbs-live-dai.akamaized.net/us</span><br><span class="line"># &gt; NZ:Neon TV</span><br><span class="line">nameserver /neontv.co.nz/us</span><br><span class="line"># &gt; NZ:SkyGO NZ</span><br><span class="line">nameserver /sky.co.nz/us</span><br><span class="line">nameserver /prod-skyonelive.akamaized.net/us</span><br><span class="line">nameserver /skysportnow.co.nz/us</span><br><span class="line">nameserver /imggaming.com/us</span><br><span class="line">nameserver /pndsn.com/us</span><br><span class="line"># &gt; NZ:ThreeNow</span><br><span class="line">nameserver /fullscreen.nz/us</span><br><span class="line"># &gt; NZ:Maori TV</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># ---------- &gt; North America Media</span><br><span class="line"># &gt; FOX</span><br><span class="line">nameserver /x-live-fox-stgec.uplynk.com/us</span><br><span class="line">nameserver /fox.com/us</span><br><span class="line">nameserver /foxdcg.com/us</span><br><span class="line">nameserver /theplatform.com/us</span><br><span class="line">nameserver /cdn-fox-networks-group-green.akamaized.net/us</span><br><span class="line">nameserver /d3cv4a9a9wh0bt.cloudfront.net/us</span><br><span class="line">nameserver /foxsports01-i.akamaihd.net/us</span><br><span class="line">nameserver /foxsports02-i.akamaihd.net/us</span><br><span class="line">nameserver /foxsports03-i.akamaihd.net/us</span><br><span class="line"></span><br><span class="line"># &gt; NFL</span><br><span class="line">nameserver /nfl.com/us</span><br><span class="line"># &gt; ESPN+</span><br><span class="line">nameserver /espn.api.edge.bamgrid.com/us</span><br><span class="line">nameserver /espn.hb.omtrdc.net/us</span><br><span class="line">nameserver /espndotcom.tt.omtrdc.net/us</span><br><span class="line">nameserver /dtci.co/us</span><br><span class="line">nameserver /dtci.technology/us</span><br><span class="line">nameserver /espn.co.uk/us</span><br><span class="line">nameserver /espn.com/us</span><br><span class="line">nameserver /espn.net/us</span><br><span class="line">nameserver /espncdn.com/us</span><br><span class="line">nameserver /espnqa.com/us</span><br><span class="line">nameserver /watchespn.com/us</span><br><span class="line"># &gt; Epix</span><br><span class="line">nameserver /epix.com/us</span><br><span class="line"># &gt; Starz</span><br><span class="line">nameserver /starz.com/us</span><br><span class="line"># &gt; Philo</span><br><span class="line">nameserver /philo.com/us</span><br><span class="line"># &gt; FXNOW</span><br><span class="line">nameserver /fxnow.fxnetworks.com/us</span><br><span class="line"># &gt; TLC GO</span><br><span class="line">nameserver /geolocation.onetrust.com/us</span><br><span class="line"># &gt; HBO / Max</span><br><span class="line">nameserver /max.com/us</span><br><span class="line">nameserver /hbo.com/us</span><br><span class="line">nameserver /hbogo.com/us</span><br><span class="line">nameserver /hbomax.com/us</span><br><span class="line">nameserver /hbomaxcdn.com/us</span><br><span class="line">nameserver /hbonow.com/us</span><br><span class="line">nameserver /maxgo.com/us</span><br><span class="line">nameserver /discomax.com/us</span><br><span class="line"># &gt; Shudder</span><br><span class="line">nameserver /shudder.com/us</span><br><span class="line"># &gt; BritBox</span><br><span class="line">nameserver /vod-dash-ntham-comm-live.akamaized.net/us</span><br><span class="line">nameserver /vod-dash-ntham-comm.live.cf.md.bbci.co.uk/us</span><br><span class="line">nameserver /vod-hls-ntham-comm-live.akamaized.net/us</span><br><span class="line">nameserver /vod-hls-ntham-comm.live.cf.md.bbci.co.uk/us</span><br><span class="line">nameserver /britbox.com/us</span><br><span class="line">nameserver /d2z3p34itxwaj7.cloudfront.net/us</span><br><span class="line"># &gt; Crackle</span><br><span class="line">nameserver /crackle.com/us</span><br><span class="line"># &gt; CW TV</span><br><span class="line">nameserver /cwtv.com/us</span><br><span class="line"># &gt; A&amp;E TV</span><br><span class="line">nameserver /aetv.com/us</span><br><span class="line">nameserver /ccpa-service.sp-prod.net/us</span><br><span class="line"># &gt; NBA TV</span><br><span class="line">nameserver /nba.com/us</span><br><span class="line">nameserver /neulion-a.akamaihd.net/us</span><br><span class="line">nameserver /nlnbamdnyc-a.akamaihd.net/us</span><br><span class="line">nameserver /sdk.iad-03.braze.com/us</span><br><span class="line">nameserver /nbaprop.sc.omtrdc.net/us</span><br><span class="line">nameserver /nlnbaqos.neulion.com/us</span><br><span class="line">nameserver /watchnba.cdnfastly.endeavorstreaming.net/us</span><br><span class="line">nameserver /nbaapi.neulion.com/us</span><br><span class="line">nameserver /nba-api-cdn.opin.media/us</span><br><span class="line">nameserver /neulionqos-a.akamaihd.net/us</span><br><span class="line">nameserver /neulion.com/us</span><br><span class="line">nameserver /nbaprop.tt.omtrdc.net/us</span><br><span class="line">nameserver /lion-nba-msl.akamaized.net/us</span><br><span class="line">nameserver /nbanlds19vod.akamaized.net/us</span><br><span class="line"># &gt; Fubo TV</span><br><span class="line">nameserver /fubo.tv/us</span><br><span class="line"># &gt; Tubi TV</span><br><span class="line">nameserver /tubitv.com/us</span><br><span class="line"># &gt; Sling TV</span><br><span class="line">nameserver /dishworld.com/us</span><br><span class="line">nameserver /slinginternational.com/us</span><br><span class="line">nameserver /sling.com/us</span><br><span class="line">nameserver /movenetworks.com/us</span><br><span class="line">nameserver /movetv.com/us</span><br><span class="line"># &gt; Pluto TV</span><br><span class="line">nameserver /pluto.tv/us</span><br><span class="line"># &gt; Acorn TV</span><br><span class="line">nameserver /edge.api.brightcove.com/us</span><br><span class="line">nameserver /api.rlje.net/us</span><br><span class="line">nameserver /boltdns.net/us</span><br><span class="line">nameserver /acorn.tv/us</span><br><span class="line"># &gt; SHOWTIME</span><br><span class="line">nameserver /sho.com/us</span><br><span class="line">nameserver /showtime.com/us</span><br><span class="line">nameserver /showtimeanytime.com/us</span><br><span class="line"># &gt; encoreTVB</span><br><span class="line">nameserver /encoretvb.com/us</span><br><span class="line">nameserver /bcbolt446c5271-a.akamaihd.net/us</span><br><span class="line">nameserver /videos-f.jwpsrv.com/us</span><br><span class="line">nameserver /content.jwplatform.com/us</span><br><span class="line">nameserver /edge.api.brightcove.com/us</span><br><span class="line"># &gt; Funimation</span><br><span class="line">nameserver /funimation.com/us</span><br><span class="line"># &gt; Discovery+</span><br><span class="line">nameserver /content-ause1-ur-discovery1.uplynk.com/us</span><br><span class="line">nameserver /disco-api.com/us</span><br><span class="line">nameserver /discoveryplus.com/us</span><br><span class="line">nameserver /x-default-stgec.uplynk.com/us</span><br><span class="line">nameserver /discovery.com/us</span><br><span class="line">nameserver /discoveryplus.co.uk/us</span><br><span class="line">nameserver /getblueshift.com/us</span><br><span class="line">nameserver /litix.io/us</span><br><span class="line">nameserver /mobile-collector.newrelic.com/us</span><br><span class="line">nameserver /discovery.uplynk.com/us</span><br><span class="line"># &gt; Paramount+</span><br><span class="line">nameserver /paramountplus.com/us</span><br><span class="line">nameserver /cbsi.live.ott.irdeto.com/us</span><br><span class="line">nameserver /cbsplaylistserver.aws.syncbak.com/us</span><br><span class="line">nameserver /cbsservice.aws.syncbak.com/us</span><br><span class="line">nameserver /link.theplatform.com/us</span><br><span class="line">nameserver /cbsaavideo.com/us</span><br><span class="line">nameserver /cbsi.com/us</span><br><span class="line">nameserver /cbsivideo.com/us</span><br><span class="line">nameserver /pplusstatic.com/us</span><br><span class="line"># &gt; Peacock TV</span><br><span class="line">nameserver /peacocktv.com/us</span><br><span class="line">nameserver /peacock.com/us</span><br><span class="line"># &gt; Popcornflix</span><br><span class="line">nameserver /popcornflix.com/us</span><br><span class="line">nameserver /popcornflix-prod.cloud.seachange.com/us</span><br><span class="line"># &gt; Crunchyroll</span><br><span class="line">nameserver /crunchyroll.com/us</span><br><span class="line">nameserver /vrv.co/us</span><br><span class="line"># &gt; Directv Stream</span><br><span class="line">nameserver /atttvnow.com/us</span><br><span class="line"># &gt; KBS American</span><br><span class="line">nameserver /kbs.co.kr/us</span><br><span class="line"># &gt; KOCOWA</span><br><span class="line">nameserver /kocowa.com/us</span><br><span class="line"># &gt; F1TV</span><br><span class="line">nameserver /f1prodlive.akamaized.net/us</span><br><span class="line">nameserver /formula1.com/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; Europe Media</span><br><span class="line"># &gt; EU:Rakuten TV</span><br><span class="line">nameserver /rakuten.tv/us</span><br><span class="line"># &gt; EU:Funimation</span><br><span class="line">nameserver /funimation.com/us</span><br><span class="line"># &gt; EU:SkyShowTime</span><br><span class="line">nameserver /skyshowtimeuk.data.adobedc.net/us</span><br><span class="line">nameserver /skyshowtime.com/us</span><br><span class="line">nameserver /cssott.com/us</span><br><span class="line">nameserver /4ac1dd56e493354be504f063e4ae3440a13c6776.cws.conviva.com/us</span><br><span class="line"># &gt; EU:HBO Max</span><br><span class="line">nameserver /max.com/us</span><br><span class="line">nameserver /cinemax.com/us</span><br><span class="line">nameserver /forthethrone.com/us</span><br><span class="line">nameserver /hbo.com/us</span><br><span class="line">nameserver /hbomax.com/us</span><br><span class="line">nameserver /hbomaxcdn.com/us</span><br><span class="line">nameserver /maxgo.com/us</span><br><span class="line"># &gt; EuroSport</span><br><span class="line">nameserver /europe-fastly-mediashield-live-prod.cdn.h264.io/us</span><br><span class="line">nameserver /akamai.prod-live.h264.io/us</span><br><span class="line">nameserver /eurosport-dlvr-ott.akamaized.net/us</span><br><span class="line">nameserver /eu3-prod-images.disco-api.com/us</span><br><span class="line">nameserver /eu3-prod.disco-api.com/us</span><br><span class="line">nameserver /eurosportplayer.com/us</span><br><span class="line">nameserver /eurosport.com/us</span><br><span class="line">nameserver /eurosport.fr/us</span><br><span class="line">nameserver /eurosport.es/us</span><br><span class="line">nameserver /eurosport.ro/us</span><br><span class="line">nameserver /eurosport.io/us</span><br><span class="line">nameserver /eurosport.ru/us</span><br><span class="line">nameserver /media-shield.live.eurosport.map.fastly.net/us</span><br><span class="line">nameserver /eurosport-dlvr-ott-vod.akamaized.net/us</span><br><span class="line"># &gt; ViaPlay</span><br><span class="line">nameserver /i-viaplay-com.akamaized.net/us</span><br><span class="line">nameserver /viaplay.com/us</span><br><span class="line">nameserver /viaplay.pl/us</span><br><span class="line">nameserver /mtg-api.com/us</span><br><span class="line"># &gt; GB:Sky GO /usSkyGONZ/us</span><br><span class="line">nameserver /sky.com/us</span><br><span class="line"># &gt; GB:BritBox</span><br><span class="line">nameserver /vod-dash-ntham-comm-live.akamaized.net/us</span><br><span class="line">nameserver /vod-dash-ntham-comm.live.cf.md.bbci.co.uk/us</span><br><span class="line">nameserver /vod-hls-ntham-comm-live.akamaized.net/us</span><br><span class="line">nameserver /vod-hls-ntham-comm.live.cf.md.bbci.co.uk/us</span><br><span class="line">nameserver /britbox.com/us</span><br><span class="line">nameserver /d2z3p34itxwaj7.cloudfront.net/us</span><br><span class="line"># &gt; GB:ITV Hub</span><br><span class="line">nameserver /itvpnpmobile-a.akamaihd.net/us</span><br><span class="line">nameserver /itv.com/us</span><br><span class="line">nameserver /itvstatic.com/us</span><br><span class="line"># &gt; GB:Channel 4 **</span><br><span class="line">nameserver /channel4.com/us</span><br><span class="line"># &gt; GB:Channel 5 **</span><br><span class="line">nameserver /channel5.com/us</span><br><span class="line"># &gt; GB:BBC</span><br><span class="line">nameserver /aod-dash-uk-live.akamaized.net/us</span><br><span class="line">nameserver /aod-hls-uk-live.akamaized.net/us</span><br><span class="line">nameserver /as-dash-uk-live.akamaized.net/us</span><br><span class="line">nameserver /as-hls-uk-live.akamaized.net/us</span><br><span class="line">nameserver /vod-dash-uk-live.akamaized.net/us</span><br><span class="line">nameserver /vod-dash-ww-live.akamaized.net/us</span><br><span class="line">nameserver /vod-hls-uk-live.akamaized.net/us</span><br><span class="line">nameserver /vod-sub-uk-live.akamaized.net/us</span><br><span class="line">nameserver /vod-thumb-uk-live.akamaized.net/us</span><br><span class="line">nameserver /vod-thumb-ww-live.akamaized.net/us</span><br><span class="line">nameserver /vs-cmaf-push-uk-live.akamaized.net/us</span><br><span class="line">nameserver /bbc/us</span><br><span class="line">nameserver /bbc.co/us</span><br><span class="line">nameserver /bbc.co.uk/us</span><br><span class="line">nameserver /bbc.com/us</span><br><span class="line">nameserver /bbc.in/us</span><br><span class="line">nameserver /bbc.net.uk/us</span><br><span class="line">nameserver /bbcchinese.com/us</span><br><span class="line">nameserver /bbcfmt.hs.llnwd.net/us</span><br><span class="line">nameserver /bbcfmt.s.llnwi.net/us</span><br><span class="line">nameserver /bbci.co/us</span><br><span class="line">nameserver /bbci.co.uk/us</span><br><span class="line">nameserver /bbcmedia.co.uk/us</span><br><span class="line">nameserver /bbcpersian.com/us</span><br><span class="line">nameserver /bbcverticals.com/us</span><br><span class="line">nameserver /bidi.net.uk/us</span><br><span class="line"># &gt; GB:Discovery+</span><br><span class="line">nameserver /content-ause1-ur-discovery1.uplynk.com/us</span><br><span class="line">nameserver /disco-api.com/us</span><br><span class="line">nameserver /discoveryplus.com/us</span><br><span class="line">nameserver /x-default-stgec.uplynk.com/us</span><br><span class="line">nameserver /discovery.com/us</span><br><span class="line">nameserver /discoveryplus.co.uk/us</span><br><span class="line">nameserver /getblueshift.com/us</span><br><span class="line">nameserver /litix.io/us</span><br><span class="line">nameserver /mobile-collector.newrelic.com/us</span><br><span class="line">nameserver /discovery.uplynk.com/us</span><br><span class="line"># &gt; FR:Salto</span><br><span class="line">nameserver /salto.fr/us</span><br><span class="line"># &gt; FR:Canal+</span><br><span class="line">nameserver /canalplus.com/us</span><br><span class="line"># &gt; FR:Molotov</span><br><span class="line">nameserver /molotov.tv/us</span><br><span class="line"># &gt; FR:France.tv</span><br><span class="line">nameserver /ftven.fr/us</span><br><span class="line"># &gt; DE:Joyn</span><br><span class="line">nameserver /joyn.de/us</span><br><span class="line"># &gt; DE:Sky</span><br><span class="line">nameserver /sky.de/us</span><br><span class="line">nameserver /edge.api.brightcove.com/us</span><br><span class="line"># &gt; DE:ZDF</span><br><span class="line">nameserver /zdf.de/us</span><br><span class="line"># &gt; NL:videoland</span><br><span class="line">nameserver /videoland.com/us</span><br><span class="line"># &gt; NL:NPO</span><br><span class="line">nameserver /npo.nl/us</span><br><span class="line"># &gt; IT Rai Play</span><br><span class="line">nameserver /mediapolisvod.rai.it/us</span><br><span class="line"># &gt; RU:Amediateka</span><br><span class="line">nameserver /amediateka.ru/us</span><br><span class="line"># &gt; UA:MEGOGO</span><br><span class="line">nameserver /megogo.net/us</span><br><span class="line">nameserver /vcdn.biz/us</span><br><span class="line"># &gt; CH:Sky</span><br><span class="line">nameserver /sky.ch/us</span><br><span class="line">nameserver /zahs.tv/us</span><br><span class="line"># &gt; TR:digiturkplay</span><br><span class="line">nameserver /digiturkplay.com/us</span><br><span class="line">nameserver /dt-int-gurme-hls.mncdn.com/us</span><br><span class="line">nameserver /dt-live-int.akamaized.net/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; Hong Kong Media</span><br><span class="line"># &gt; Now E </span><br><span class="line">nameserver /nowe.com/us</span><br><span class="line">nameserver /nowestatic.com/us</span><br><span class="line"># &gt; Now TV</span><br><span class="line">nameserver /now.com/us</span><br><span class="line"># &gt; Viu.TV</span><br><span class="line">#include Viu.com</span><br><span class="line">nameserver /viu.now.com/us</span><br><span class="line">nameserver /viu.tv/us</span><br><span class="line"># &gt; MyTVSuper</span><br><span class="line">nameserver /mytvsuper.com/us</span><br><span class="line">nameserver /mytvsuperlimited.hb.omtrdc.net/us</span><br><span class="line">nameserver /mytvsuperlimited.sc.omtrdc.net/us</span><br><span class="line">nameserver /tvb.com/us</span><br><span class="line"># &gt; HOY TV</span><br><span class="line">nameserver /hoy.tv/us</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ---------- &gt; South America Media</span><br><span class="line"># &gt; HBO </span><br><span class="line">nameserver /cinemax.com/us</span><br><span class="line">nameserver /forthethrone.com/us</span><br><span class="line">nameserver /hbo.com/us</span><br><span class="line">nameserver /hbogo.com/us</span><br><span class="line">nameserver /hbomax.com/us</span><br><span class="line">nameserver /hbomaxcdn.com/us</span><br><span class="line">nameserver /hbonow.com/us</span><br><span class="line">nameserver /maxgo.com/us</span><br><span class="line"># &gt; DirecTV</span><br><span class="line">nameserver /directvgo.com/us</span><br><span class="line"># &gt; Funimation</span><br><span class="line">nameserver /funimation.com/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; Indian Media</span><br><span class="line">nameserver /discoveryplus.in/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; Korean Media</span><br><span class="line"># &gt; Wavve</span><br><span class="line">nameserver /wavve.com/us</span><br><span class="line">nameserver /pooq.co.kr/us</span><br><span class="line"># &gt; Tving</span><br><span class="line">nameserver /tving.com/us</span><br><span class="line"># &gt; Coupang Play</span><br><span class="line">nameserver /coupangplay.com/us</span><br><span class="line"># &gt; Naver TV</span><br><span class="line">nameserver /naver.com/us</span><br><span class="line">nameserver /navercorp.com/us</span><br><span class="line">nameserver /pstatic.net/us</span><br><span class="line">nameserver /smartmediarep.com/us</span><br><span class="line"># &gt; Afreeca TV</span><br><span class="line">nameserver /afreecatv.com/us</span><br><span class="line"># &gt; KBS Domestic</span><br><span class="line">nameserver /kbs.co.kr/us</span><br><span class="line"># &gt; jtbc</span><br><span class="line">nameserver /jtbc.co.kr/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; ? media</span><br><span class="line"># &gt; Setanta Sports</span><br><span class="line">nameserver /setantasports.com/us</span><br><span class="line">nameserver /imggaming.com/us</span><br><span class="line">nameserver /diceplatform.com/us</span><br><span class="line">nameserver /dicelaboratory.com/us</span><br><span class="line">nameserver /pndsn.com/us</span><br><span class="line">nameserver /imggaming.s3-eu-west-1.amazonaws.com/us</span><br><span class="line">nameserver /ux1kpaebv0.execute-api.eu-west-1.amazonaws.com/us</span><br><span class="line">nameserver /1ok961aaca.execute-api.eu-west-1.amazonaws.com/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; SouthEastAsia media</span><br><span class="line"># &gt; HBO GO Asia</span><br><span class="line">nameserver /44wilhpljf.execute-api.ap-southeast-1.amazonaws.com/us</span><br><span class="line">nameserver /bcbolthboa-a.akamaihd.net/us</span><br><span class="line">nameserver /dai3fd1oh325y.cloudfront.net/us</span><br><span class="line">nameserver /hboasia1-i.akamaihd.net/us</span><br><span class="line">nameserver /hboasia2-i.akamaihd.net/us</span><br><span class="line">nameserver /hboasia3-i.akamaihd.net/us</span><br><span class="line">nameserver /hboasia4-i.akamaihd.net/us</span><br><span class="line">nameserver /hboasia5-i.akamaihd.net/us</span><br><span class="line">nameserver /hboasialive.akamaized.net/us</span><br><span class="line">nameserver /hbogoprod-vod.akamaized.net/us</span><br><span class="line">nameserver /hbolb.onwardsmg.com/us</span><br><span class="line">nameserver /hbounify-prod.evergent.com/us</span><br><span class="line">nameserver /hbogo.co.th/us</span><br><span class="line">nameserver /hbogoasia.com/us</span><br><span class="line">nameserver /hbogoasia.hk/us</span><br><span class="line">nameserver /hbogoasia.id/us</span><br><span class="line">nameserver /hbogoasia.ph/us</span><br><span class="line">nameserver /hbogoasia.sg/us</span><br><span class="line">nameserver /hbogoasia.tw/us</span><br><span class="line"></span><br><span class="line"># &gt; SG:meWATCH</span><br><span class="line">nameserver /mewatch.sg/us</span><br><span class="line"># &gt; SG:StarHub</span><br><span class="line">nameserver /starhubgo.com/us</span><br><span class="line">nameserver /failoverstarhub.akamaized.net/us</span><br><span class="line">nameserver /scvm1sc0-ssm.anycast.nagra.com/us</span><br><span class="line">nameserver /starhubtvplus.com/us</span><br><span class="line"># &gt; CatchPlay+</span><br><span class="line">nameserver /catchplay.com/us</span><br><span class="line">nameserver /d2ivmxp5z2ww0n.cloudfront.net/us</span><br><span class="line">nameserver /ols-ww100-cp.akamaized.net/us</span><br><span class="line">nameserver /tra-www000-cp.akamaized.net/us</span><br><span class="line"># &gt; TH:TrueID </span><br><span class="line">nameserver /trueid.net/us</span><br><span class="line"># &gt; TH:AIS Play</span><br><span class="line">nameserver /aisplay.ais.co.th/us</span><br><span class="line">nameserver /ais-vidnt.com/us</span><br><span class="line"># &gt; ID:Vidio</span><br><span class="line">nameserver /geo-id-media-001-vidio-com.akamaized.net/us</span><br><span class="line"># &gt; VN:MYTV</span><br><span class="line">nameserver /mytv.vn/us</span><br><span class="line"># &gt; VN:Clip TV</span><br><span class="line">nameserver /cliptv.vn/us</span><br><span class="line"># &gt; VN:Galaxy Play</span><br><span class="line">nameserver /glxplay.io/us</span><br><span class="line"># &gt; VN:K+</span><br><span class="line">nameserver /solocoo.tv/us</span><br><span class="line"># &gt; MY:sooka</span><br><span class="line">nameserver /sooka.my/us</span><br><span class="line">nameserver /kaltura.com/us</span><br><span class="line">nameserver /1fad96d91f4f519fc79753650a57dad992c44af2.cws.conviva.com/us</span><br><span class="line"># &gt; IN:MXPlayer</span><br><span class="line">nameserver /mxplayer.in/us</span><br><span class="line"># &gt; IN:Tata Play</span><br><span class="line">nameserver /tataplay.com/us</span><br><span class="line"># &gt; IN:Zee5</span><br><span class="line">nameserver /zee5.com/us</span><br><span class="line"># &gt; IN:Jio Cinema</span><br><span class="line">nameserver /content-jiovoot.voot.com/us</span><br><span class="line"># &gt; UAE:shahid</span><br><span class="line">nameserver /mbc.net/us</span><br><span class="line">nameserver /npaw.com/us</span><br><span class="line">nameserver /shahid.net/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; AI Platform</span><br><span class="line"># &gt; Openai</span><br><span class="line">nameserver /openai.com/us</span><br><span class="line">nameserver /chatgpt.com/us</span><br><span class="line">nameserver /oaistatic.com/us</span><br><span class="line">nameserver /oaiusercontent.com/us</span><br><span class="line"># &gt; ExHantai/E-hentai</span><br><span class="line">nameserver /exhentai.org/us</span><br><span class="line">nameserver /e-hentai.org/us</span><br><span class="line"># &gt; Claude 2</span><br><span class="line">nameserver /anthropic.com/us</span><br><span class="line">nameserver /claude.ai/us</span><br><span class="line"># &gt; Google Gemini</span><br><span class="line">nameserver /gemini.google.com/us</span><br><span class="line">nameserver /proactivebackend-pa.googleapis.com/us</span><br><span class="line"># &gt; Google AiStudio</span><br><span class="line">nameserver /aistudio.google.com/us</span><br><span class="line">nameserver /alkalimakersuite-pa.clients6.google.com/us</span><br><span class="line">nameserver /generativelanguage.googleapis.com/us</span><br><span class="line"># &gt; Microsoft Copilot For Image Generates</span><br><span class="line">nameserver /copilot.microsoft.com/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; China Media</span><br><span class="line"></span><br><span class="line"># &gt; BiliBili</span><br><span class="line">nameserver /bilibili.com/us</span><br><span class="line">nameserver /bilibili.tv/us</span><br><span class="line"></span><br><span class="line"># &gt; iQiyi</span><br><span class="line">nameserver /71.am/us</span><br><span class="line">nameserver /71.am.com/us</span><br><span class="line">nameserver /71edge.com/us</span><br><span class="line">nameserver /71edge.net/us</span><br><span class="line">nameserver /aianno.cn/us</span><br><span class="line">nameserver /aianno.com/us</span><br><span class="line">nameserver /aiqiyicloud-mgmt.com/us</span><br><span class="line">nameserver /aiqiyicloud.com/us</span><br><span class="line">nameserver /aiqiyicloud.net/us</span><br><span class="line">nameserver /baiying.com/us</span><br><span class="line">nameserver /gitv.cn/us</span><br><span class="line">nameserver /gitv.tv/us</span><br><span class="line">nameserver /ibkstore.com/us</span><br><span class="line">nameserver /iq.com/us</span><br><span class="line">nameserver /iqiyi.com/us</span><br><span class="line">nameserver /iqiyi.demo.uwp/us</span><br><span class="line">nameserver /iqiyiedge.com/us</span><br><span class="line">nameserver /iqiyiedge.net/us</span><br><span class="line">nameserver /iqiyipic.com/us</span><br><span class="line">nameserver /jiangbing.cn/us</span><br><span class="line">nameserver /pps.tv/us</span><br><span class="line">nameserver /ppsimg.com/us</span><br><span class="line">nameserver /ppstream.cn/us</span><br><span class="line">nameserver /ppstream.com/us</span><br><span class="line">nameserver /ppstream.com.cn/us</span><br><span class="line">nameserver /ppstream.net/us</span><br><span class="line">nameserver /ppstream.net.cn/us</span><br><span class="line">nameserver /ppsurl.com/us</span><br><span class="line">nameserver /qiyi.cn/us</span><br><span class="line">nameserver /qiyi.com/us</span><br><span class="line">nameserver /qiyipic.com/us</span><br><span class="line">nameserver /qy.com/us</span><br><span class="line">nameserver /qy.net/us</span><br><span class="line">nameserver /suike.cn/us</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;自动-流媒体一键修改解锁dns脚本&quot;&gt;自动-流媒体一键修改解锁DNS脚本&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;支持操作系统&lt;/strong&gt;: Debian &amp;amp; Ubuntu&lt;/p&gt;
&lt;h2 id=&quot;项目简介&quot;&gt;项目简介&lt;/h2&gt;
&lt;p&gt;该脚本旨在帮助用户通过</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
    <category term="流媒体" scheme="https://blog.lthero.cn/tags/%E6%B5%81%E5%AA%92%E4%BD%93/"/>
    
  </entry>
  
  <entry>
    <title>【自建】建立自己的代理机场</title>
    <link href="https://blog.lthero.cn/2024/11/26/BuildYourOwnProxyhub/"/>
    <id>https://blog.lthero.cn/2024/11/26/BuildYourOwnProxyhub/</id>
    <published>2024-11-26T12:58:48.000Z</published>
    <updated>2025-01-22T05:56:35.817Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://blog.lthero.top/2024/11/26/BuildYourOwnProxyhub/">跳转到搭建hysteria2文章</a></p><p><a href="https://blog.lthero.top/2024/07/18/Install-vless-reality/">跳转到搭建vless-realit文章</a></p><h1 id="自建机场">自建机场</h1><p><strong>声明：本方法建立的机场仅限技术交流，无实际交易教程！</strong></p><p><strong>本方法搭建的机场属于代理直连的方式，非中转机场等高级玩法</strong></p><blockquote><p>先用两句话说明自建机场的逻辑</p><p>1、用<code>Xboard</code>创建机场的前端，<strong>在一台服务器A上部署</strong>即可，用户管理、流量管理等功能全在这上面</p><p>2、使用<code>V2bX</code>创建机场的后端（运行了各种代理服务，如ss, v2ray, hysteria2等）。V2bX会获取节点信息、用户鉴权信息与上报用户流量到服务器A，<strong>V2bX部署在服务器A,B,C,D等</strong></p></blockquote><h2 id="xboard部署教程">Xboard部署教程</h2><h3 id="安装">安装</h3><p>下面是使用Docker-Compose进行部署</p><blockquote><p><strong>仅在服务器A上部署</strong></p><p>Xboard更多安装方式参考：<a href="https://github.com/cedar2025/Xboard">https://github.com/cedar2025/Xboard</a></p></blockquote><h4 id="安装docker">安装docker</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.docker.com | bash</span><br></pre></td></tr></table></figure><p>获取Docker compose 文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> -b  docker-compose --depth 1 https://github.com/cedar2025/Xboard</span><br><span class="line"><span class="built_in">cd</span> Xboard</span><br></pre></td></tr></table></figure><h4 id="执行数据库安装命令">执行数据库安装命令</h4><blockquote><p>自动选择 <strong>启用sqlite</strong> 和 <strong>Docker内置的Redis</strong></p><p>修改下面的your_admin_email@example.com 为自己的管理员账号</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose run -it --<span class="built_in">rm</span> -e enable_sqlite=<span class="literal">true</span> -e enable_redis=<span class="literal">true</span> -e admin_account=your_admin_email@example.com xboard php artisan xboard:install</span><br></pre></td></tr></table></figure><p>手动根据自己的需要在运行时选择sqlite和redis，以及手动输入管理员账号</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose run -it --<span class="built_in">rm</span> xboard php artisan xboard:install</span><br></pre></td></tr></table></figure><blockquote><p>执行这条命令之后，会返回你的后台地址(asdfasqeb)和管理员账号密码（<strong>你需要记录下来后台地址</strong>）！<br>你需要执行下面的 <strong>启动xborad</strong> 步骤之后才能访问后台</p></blockquote><h4 id="启动xboard">启动Xboard</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><blockquote><p>安装完成之后即可访问你的站点</p></blockquote><h4 id="访问站点">访问站点</h4><blockquote><p>启动之后网站端口默认为7001, 你可以配置nginx反向代理使用80端口</p></blockquote><p>网站地址: <a href="http://xn--IP-0p3cm89l:7001/">http://你的IP:7001/</a></p><p>后台地址：<a href="http://xn--IP-0p3cm89l:7001/asdfasqeb">http://你的IP:7001/asdfasqeb</a></p><p>在此你已经成功部署了, 你可以访问网址体验Xboard的完整功能，</p><blockquote><p>如果你需要使用mysql，请自行安装Mysql后重新部署</p></blockquote><h3 id="更新"><strong>更新</strong></h3><p>修改版本</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> Xboard</span><br><span class="line">vi docker-compose.yaml</span><br></pre></td></tr></table></figure><blockquote><p>修改docker-compose.yaml 当中image后面的版本号为你需要的版本<br>如果为版本为latest 则可以忽略这一步，直接进行第二步</p></blockquote><p>更新数据库（可以执行多次都是安全的）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker compose pull</span><br><span class="line">docker compose down</span><br><span class="line">docker compose run -it --<span class="built_in">rm</span> xboard php artisan xboard:update</span><br><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><blockquote><p>即可更新成功</p></blockquote><h3 id="回滚"><strong>回滚</strong></h3><blockquote><p>此回滚不回滚数据库，是否回滚数据库请查看相关文档</p></blockquote><p>回退版本</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi docker-compose.yaml</span><br></pre></td></tr></table></figure><blockquote><p>修改docker-compose.yaml 当中image后面的版本号为更新前的版本号</p></blockquote><p>启动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><h3 id="注意">注意</h3><p>启用webman后做的任何代码修改都需要重启生效</p><h2 id="xboard添加节点">Xboard添加节点</h2><blockquote><p>在Xboard的管理页面添加节点，在添加节点前，先添加一个订阅服务（金额流量等信息可以随便填写）</p></blockquote><p>这里以配置hysteria2为例，并且是使用自签证书的形式，<a href="http://xn--bing-494f58bbyus1hf9y35i7i9b1o8e.com">所以下面的域名是bing.com</a></p><p>在Xboard里先一个节点</p><ul><li><p>节点名称 ：任意</p></li><li><p>倍率：任意</p></li><li><p>节点地址：<strong>将运行hysteria的服务器</strong>（可以是服务器A,B,C,D等），写公网<strong>IP地址</strong></p></li><li><p>连接端口：选择服务器A（运行了board）上<strong>空闲的端口</strong></p></li><li><p>服务端口：将运行hysteria2的服务器（如B,C,D）中hysteria2进程的端口</p><ul><li><strong>连接端口和服务端口要写一样的，否则无法正常使用</strong>，理论上应该是可以不同的，但可能是bug</li></ul></li><li><p>允许不安全：是</p></li><li><p>协议版本：v2</p></li><li><p>开启obfs：否</p></li><li><p>sni：<a href="http://bing.com">bing.com</a></p><ul><li>如果使用公认证书，请输入指向这台服务器的域名（A,B,C,D等运行hy协议的服务器）</li></ul></li><li><p>上行带宽：100</p></li><li><p>下行带宽：200</p></li><li><p>父节点：无</p></li></ul><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241125235329948.png" alt="image-20241125235329948"></p><p>至此，已经完成了前端的工作，后面是将添加的节点进行实际运行起来，<strong>节点的部署</strong>可以运行在不同于服务器A(运行了Xboard)的机器B,C,D上</p><blockquote><p>强烈推荐在部署节点之前，<strong>先配置好https访问</strong>，后面两步是配置https的过程</p></blockquote><ol><li>先配置http访问</li><li>再配置https访问，不要跳过</li></ol><h2 id="使用http访问">使用HTTP访问</h2><p>要将运行在Docker容器中的服务通过域名访问，并使用Nginx作为反向代理来转发到宿主机的7001端口，你需要完成几个步骤。这包括设置DNS记录、配置Nginx以及确保网络安全。下面是具体步骤：</p><h3 id="步骤-1-设置dns记录">步骤 1: 设置DNS记录</h3><p>确保你的域名 <code>board.lthero.top</code> 的DNS记录指向托管Nginx的服务器的IP地址。这通常在你的域名注册商处进行设置：</p><ul><li><strong>A记录</strong>：将域名指向IPv4地址。</li><li><strong>AAAA记录</strong>：将域名指向IPv6地址（如果适用）。</li></ul><h3 id="步骤-2-安装并启动nginx">步骤 2: 安装并启动Nginx</h3><p>步骤 1: 更新软件包列表</p><p>打开终端，首先使用<code>apt</code>命令更新你的包列表，以确保你安装的是最新版本的Nginx。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><p>步骤 2: 安装Nginx</p><p>使用<code>apt</code>安装Nginx。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure><h3 id="步骤-3-配置nginx">步骤 3: 配置Nginx</h3><p>你需要在Nginx中创建一个新的服务器块（server block），或者在已有的默认配置中修改，以设置反向代理。以下是一个基本的Nginx配置示例，将会把所有到 <code>board.lthero.top</code> 的请求转发到本地的7001端口：</p><ol><li><p>打开或创建一个新的Nginx配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/board.lthero.top</span><br></pre></td></tr></table></figure></li><li><p>添加以下配置：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> board.lthero.top;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:7001;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个配置做了以下几点：</p><ul><li><code>listen 80;</code> 告诉Nginx监听80端口（HTTP标准端口）。</li><li><code>server_name board.lthero.top;</code> 设置这个块应当响应的域名。</li><li><code>proxy_pass http://localhost:7001;</code> 指定所有传入的请求转发到本地的7001端口。</li><li><code>proxy_set_header</code> 指令将重要的HTTP头信息转发给后端应用。</li></ul></li><li><p>启用配置文件通过创建一个符号链接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /etc/nginx/sites-available/board.lthero.top /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure></li><li><p>检查Nginx配置文件是否有语法错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure></li><li><p>如果没有错误，重启Nginx以应用配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure></li></ol><h3 id="步骤-4-调整防火墙规则">步骤 4: 调整防火墙规则</h3><p>确保你的服务器的防火墙规则允许HTTP（端口80）和HTTPS（端口443，如果你使用SSL）的流量。如果你正在使用<code>ufw</code>，可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow <span class="string">&#x27;Nginx Full&#x27;</span></span><br><span class="line">sudo ufw reload</span><br></pre></td></tr></table></figure><h3 id="步骤-5-测试配置">步骤 5: 测试配置</h3><p>在浏览器中输入 <code>http://board.lthero.top</code> 或使用命令行工具如 <code>curl</code> 来测试你的配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://board.lthero.top</span><br></pre></td></tr></table></figure><p>你应该能看到从Docker容器中运行的服务响应的内容。</p><p>这样，你就配置好了Nginx作为反向代理，将域名 <code>board.lthero.top</code> 的流量转发到宿主机的7001端口上的服务。如果你希望使用HTTPS，你还需要设置SSL证书，可以考虑使用Let’s Encrypt免费证书并配置HTTPS。</p><h2 id="使用https访问">使用HTTPS访问</h2><p>要让你的域名 <code>board.lthero.top</code> 使用 HTTPS，你需要获取 SSL/TLS 证书，并配置 Nginx 以使用这些证书来加密网页内容。以下是详细的步骤，包括如何使用 Let’s Encrypt 提供的免费证书自动化这个过程。</p><h3 id="步骤-1-安装-certbot">步骤 1: 安装 Certbot</h3><p>Certbot 是一个自动获取并安装 Let’s Encrypt 证书的客户端。在 Ubuntu 上安装 Certbot 及其 Nginx 插件非常简单：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install certbot python3-certbot-nginx -y</span><br></pre></td></tr></table></figure><h3 id="步骤-2-获取和安装证书">步骤 2: 获取和安装证书</h3><p>使用 Certbot 获取并为你的域名安装证书：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx -d board.lthero.top</span><br></pre></td></tr></table></figure><p>此命令会自动为指定的域名 <code>board.lthero.top</code> 配置 SSL 证书，并更新 Nginx 配置以使用这些证书。</p><p>Certbot 会询问你一些问题，比如电子邮件地址（用于紧急联系和证书续订提醒）</p><p>以及<strong>是否重定向所有 HTTP 请求到 HTTPS（强烈建议启用）</strong>，如果启用，它用自动修改board.lthero.top的nginx配置文件，</p><p>生成的证书位置<code>/etc/letsencrypt/live/</code></p><h3 id="步骤-3-更新-nginx-配置">步骤 3: 更新 Nginx 配置</h3><p>如果你想手动编辑 Nginx 配置文件，可以按以下方式配置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/board.lthero.top</span><br></pre></td></tr></table></figure><ol><li>如果你的配置文件里已经出现“# managed by Certbot”等内容，说明Certbot已经将配置文件修改好了，直接重启nginx即可</li><li>记得将下面所有的board.lthero.top换成你的域名</li><li>这里的7001端口是Xboard运行端口</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">server_name</span> board.lthero.top;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:7001;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/board.lthero.top/fullchain.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/board.lthero.top/privkey.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">include</span> /etc/letsencrypt/options-ssl-nginx.conf; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">ssl_dhparam</span> /etc/letsencrypt/ssl-dhparams.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$host</span> = board.lthero.top) &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">    &#125; <span class="comment"># managed by Certbot</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> board.lthero.top;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">404</span>; <span class="comment"># managed by Certbot</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="步骤-4-重新加载-nginx">步骤 4: 重新加载 Nginx</h3><p>更改配置后，需要重新加载 Nginx 以应用新的配置：</p><blockquote><p>检查配置文件是否有语法错误，如果有warn!直接看“遇到的问题”部分，重新加载配置是不一定能work的</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t  <span class="comment"># 检查配置文件是否有语法错误</span></span><br><span class="line">sudo systemctl reload nginx  <span class="comment"># 重新加载配置</span></span><br><span class="line"><span class="comment"># 如果重新加载配置后无效，可以尝试重启nginx</span></span><br><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure><h3 id="步骤-5-验证-https">步骤 5: 验证 HTTPS</h3><p>在浏览器中访问 <code>https://board.lthero.top</code> 来检查是否配置成功。你应该能够看到一个安全锁标志，表明连接是通过 HTTPS 加密的。</p><h3 id="步骤-6-自动续订证书">步骤 6: 自动续订证书</h3><p>Let’s Encrypt 的证书有效期为90天，因此建议设置自动续订：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew</span><br></pre></td></tr></table></figure><p>这个命令会测试证书续订过程。如果这个测试成功，添加定时任务<code>crontab</code>：</p><p><code>crontab -e</code>再填写下面内容，表示每月第一天会自动执行</p><p>通过<code>which certbot</code>查看具体程序位置<code>/usr/local/bin/certbot</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 * * /usr/local/bin/certbot renew --deploy-hook <span class="string">&quot;nginx -s reload&quot;</span></span><br></pre></td></tr></table></figure><p>续签的证书位置<code>/etc/letsencrypt/renewal</code></p><p>通过以上步骤，你的站点 <code>board.lthero.top</code> 现在应该能够安全地使用 HTTPS 进行通信了。</p><p>如果要换crontab编辑器，运行下面的命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select-editor</span><br></pre></td></tr></table></figure><p>至此，已经配置好https访问，下面开始<strong>部署代理服务</strong></p><hr><h2 id="v2bx部署代理服务">V2bX部署代理服务</h2><blockquote><p>在需要**运行节点的服务器（A,B,C,D等）**上安装V2bX，从而运行hysteria2, v2ray, vless, ss等协议</p><p>在V2bX上运行的代理协议可对接到Xboard上，会将用户使用情况上传到Xboard上并统计</p><p>视频参考：<a href="https://youtu.be/Fwn0nFbB0zY?t=720">https://youtu.be/Fwn0nFbB0zY?t=720</a></p></blockquote><h3 id="v2bx安装">V2bX安装</h3><p>执行下面的命令，安装V2bX</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -N https://raw.githubusercontent.com/wyx2685/V2bX-script/master/install.sh &amp;&amp; bash install.sh</span><br></pre></td></tr></table></figure><p>配置文件路径：<code>/etc/V2bX</code> 配置文件详见：<a href="https://v2bx.v-50.me/v2bx/v2bx-pei-zhi-wen-jian-shuo-ming/config">配置文件说明</a></p><p>下面是在<strong>服务器B</strong>上运行hysteria2协议的配置过程</p><ul><li><p>输入机场网址与API Key</p><ul><li>机场网址就是域名https://board.lthero.top，而API key在Xboard的管理网页中，找到“系统配置”-&gt;“节点”-&gt;“通讯密钥”</li><li>原理是V2bX拿着密钥，到board.lthero.top上面获取你配置的节点的信息；根据这些节点信息，V2bX在服务器(A,B,C,D)上运行服务（如hysteria2协议，Vless协议等）</li></ul></li><li><p>选择核心：<strong>singbox</strong> 对应的序号</p></li><li><p>选择协议：<strong>hysteria2</strong> 对应的序号</p></li><li><p>证书模式：<strong>self模式</strong> 对应的序号</p><ul><li>如果使用公认证书，请使用<strong>http模式</strong>，你需要解析一个域名到这个<strong>服务器B的节点服务</strong>，如：hy-jp-b.lthero.top</li><li>如果你仍然使用<strong>服务器A</strong>运行节点，请不要使用board.lthero.top，请重新配置一条域名解析到<strong>节点服务</strong>,如：，如：hy-jp-a.lthero.top</li></ul></li><li><p>输入节点证书域名：<strong><a href="http://bing.com">bing.com</a></strong></p><ul><li>如果使用公认证书，请输入指向这台VPS的域名</li></ul></li><li><p>输入n退出（除非想添加其它协议）</p></li></ul><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241125235810854.png" alt="image-20241125235810854"></p><p>随后，输入 <code>V2bX</code> 查看V2bX的配置或修改配置文件，<strong>每次修改配置文件后V2bX会自动重启</strong></p><p>这里吐槽一句啊，它只能初始化的时候使用交互方式进行文件配置，后续只能手动修改配置文件，对新手不友好。</p><p>如果想重新使用交互方式，只能将V2bX卸载后重装。</p><h3 id="hysteria2自签证书的配置文件">hysteria2自签证书的配置文件</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Log&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;Level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;error&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Output&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Cores&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;Type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sing&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Log&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;error&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Timestamp&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;NTP&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Enable&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;time.apple.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ServerPort&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;OriginalPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/V2bX/sing_origin.json&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Nodes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Core&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sing&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ApiHost&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://xxx.lthero.top&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ApiKey&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;NodeID&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;NodeType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hysteria2&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Timeout&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ListenIP&quot;</span><span class="punctuation">:</span> <span class="string">&quot;::&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;SendIP&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;DeviceOnlineMinTraffic&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;TCPFastOpen&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;SniffEnabled&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;CertConfig&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;CertMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;self&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;RejectUnknownSni&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CertDomain&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bing.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CertFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/V2bX/fullchain.cer&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;KeyFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/V2bX/cert.key&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;Email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;v2bx@github.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;Provider&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cloudflare&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;DNSEnv&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;EnvName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;env1&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="hysteria2使用证书">hysteria2使用证书</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;Nodes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Core&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sing&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ApiHost&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://board.lthero.top&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ApiKey&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxxxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;NodeID&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;NodeType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hysteria2&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Timeout&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ListenIP&quot;</span><span class="punctuation">:</span> <span class="string">&quot;::&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;SendIP&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;DeviceOnlineMinTraffic&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;TCPFastOpen&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;SniffEnabled&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;CertConfig&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;CertMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;RejectUnknownSni&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">                <span class="comment">//唯一的区别是，这里写解析到节点服务的域名</span></span><br><span class="line">                <span class="attr">&quot;CertDomain&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ak-jp.lthero.top&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CertFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/V2bX/fullchain.cer&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;KeyFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/V2bX/cert.key&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;Email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;v2bx@github.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;Provider&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cloudflare&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;DNSEnv&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;EnvName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;env1&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><hr><h2 id="其它对接xboard的工具">其它对接Xboard的工具</h2><p>除了V2bX，还有个对接Xboard的工具：</p><p><a href="https://github.com/FireinRainLab/hysteria-v2board">https://github.com/FireinRainLab/hysteria-v2board</a></p><p><a href="https://github.com/cedar2025/hysteria">https://github.com/cedar2025/hysteria</a></p><p>这工具是将hysteria2打包到docker中，并且将用户使用数据对接到Xboard/V2board</p><h1 id="蒸蒸日上的工具">蒸蒸日上的工具</h1><h2 id="一键抢主机脚本">一键抢主机脚本</h2><p><a href="https://chromewebstore.google.com/detail/one-click-checkout-for-wh/">https://chromewebstore.google.com/detail/one-click-checkout-for-wh/</a></p><p>支持 * RackNerd * SpartanHost * GreenCloudVPS</p><h2 id="主机全方面测试">主机全方面测试</h2><blockquote><p>包含主机cpu性能、磁盘测试、流媒体解锁测试、速度及延迟测试等</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://github.com/spiritLHLS/ecs/raw/main/ecs.sh -o ecs.sh &amp;&amp; <span class="built_in">chmod</span> +x ecs.sh &amp;&amp; bash ecs.sh</span><br></pre></td></tr></table></figure><p>工具来源：<a href="https://digvps.com/tools/ecs">https://digvps.com/tools/ecs</a></p><h2 id="流媒体解锁检测">流媒体解锁检测</h2><p>RegionRestrictionCheck 检测脚本检测项目比较全面，且支持Docker运行，杜绝污染VPS服务器，检测流媒体除了主流的Netflix、Disney+、YouTube Premium，还可以支持检测Dazn、Viu TV、4GTV和KKTV等比较冷门的流媒体服务。</p><blockquote><p>支持OS/Platform：CentOS 6+, Ubuntu 14.04+, Debian 8+, MacOS, Android with Termux</p></blockquote><h3 id="使用方法">使用方法</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -L -s check.unlock.media)</span><br></pre></td></tr></table></figure><p>只检测IPv4结果:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -L -s check.unlock.media) -M 4</span><br></pre></td></tr></table></figure><p>只检测IPv6结果：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -L -s check.unlock.media) -M 6</span><br></pre></td></tr></table></figure><h2 id="部分测试结果">部分测试结果</h2><h3 id="do">DO</h3><p>美国SF-1c2g</p><p><a href="https://paste.spiritlhl.net/code/K1XMh0.txt">https://paste.spiritlhl.net/code/K1XMh0.txt</a></p><h3 id="racknerd">RackNerd</h3><p>美国LA-1c2g</p><p><a href="https://paste.spiritlhl.net/code/ECrxxe.txt">https://paste.spiritlhl.net/code/ECrxxe.txt</a></p><p>美国LA-2c2.5g</p><p><a href="https://paste.spiritlhl.net/code/dKstV2.txt">https://paste.spiritlhl.net/code/dKstV2.txt</a></p><p>美国LA-黑五闪够 2c2g</p><p><a href="https://paste.spiritlhl.net/code/t9bdNE.txt">https://paste.spiritlhl.net/code/t9bdNE.txt</a></p><h3 id="akile">Akile</h3><p>美国LA-1c1g</p><p><a href="https://paste.spiritlhl.net/code/GWNS6v.txt">https://paste.spiritlhl.net/code/GWNS6v.txt</a></p><p>香港2c2g(元旦)</p><p><a href="https://paste.spiritlhl.net/code/taeLVN.txt">https://paste.spiritlhl.net/code/taeLVN.txt</a></p><h3 id="vkvm">vkvm</h3><p>美国LA-2c4g</p><p><a href="https://paste.spiritlhl.net/#/show/9taqwb.txt">https://paste.spiritlhl.net/#/show/9taqwb.txt</a></p><h3 id="物语云">物语云</h3><p>宁波2c-2g</p><p><a href="https://paste.spiritlhl.net/#/show/gyE4an.txt">https://paste.spiritlhl.net/#/show/gyE4an.txt</a></p><h3 id="hoho">HoHo</h3><p><a href="https://myprepaid-server.com/index.php">https://myprepaid-server.com/index.php</a></p><p>德国4c4g，无限流量</p><p><a href="http://hpaste.spiritlhl.net/#/show/hNQzX.txt">http://hpaste.spiritlhl.net/#/show/hNQzX.txt</a></p><h3 id="claw">Claw</h3><p>日本（原35刀一年）</p><p><a href="https://paste.spiritlhl.net/#/show/GofO6.txt">https://paste.spiritlhl.net/#/show/GofO6.txt</a></p><p>vkvm家的不大行，超售，导致机器实际性能与纸上数据相差非常大；</p><p>Akile的跑分不错，实际测试性能还行，至少一边运行docker并上传一个500MB文件，另一边使用hy2看4k视频能到9万分；</p><p>Racknerd和DO的，主打个内存大，但cpu性能一般；</p><h1 id="遇到的问题">遇到的问题</h1><h2 id="用户订阅链接无输出">用户订阅链接无输出</h2><p>如果所有节点都是hysteria2协议，会出现订阅链接输出是空白；此时直接在pc端导入到clash是正常的</p><p>尝试添加如vless协议的节点，但在安卓、苹果端仍然无法直接导入hysteria2协议</p><h2 id="数据迁移">数据迁移</h2><p>数据库位置：/root/Xboard/.docker/.data/database.sqlite</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://blog.lthero.top/2024/11/26/BuildYourOwnProxyhub/&quot;&gt;跳转到搭建hysteria2文章&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.lthero.top/2024/07/1</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
    <category term="vps" scheme="https://blog.lthero.cn/tags/vps/"/>
    
    <category term="代理" scheme="https://blog.lthero.cn/tags/%E4%BB%A3%E7%90%86/"/>
    
    <category term="机场" scheme="https://blog.lthero.cn/tags/%E6%9C%BA%E5%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>在线文件共享平台</title>
    <link href="https://blog.lthero.cn/2024/11/24/OnlineFileSharing/"/>
    <id>https://blog.lthero.cn/2024/11/24/OnlineFileSharing/</id>
    <published>2024-11-24T09:34:49.000Z</published>
    <updated>2024-12-25T06:01:58.721Z</updated>
    
    <content type="html"><![CDATA[<h1 id="在线文件共享平台">在线文件共享平台</h1><blockquote><p>提供短时/长期（类似蓝奏云）的文件分享，无文件类型限制</p></blockquote><h1 id="项目安装">项目安装</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/stonith404/pingvin-share.git</span><br><span class="line"><span class="built_in">cd</span> pingvin-share</span><br></pre></td></tr></table></figure><p>根据实际需求，修改映射端口等，如映射到宿主机的3001端口</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure><p>配置文件参考，如果需要禁止通过ip:端口访问，需要将ports下面添加<code>- &quot;127.0.0.1:3001:3000&quot;</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">services<span class="punctuation">:</span></span><br><span class="line">  pingvin-share<span class="punctuation">:</span></span><br><span class="line">    image<span class="punctuation">:</span> stonith404/pingvin-share</span><br><span class="line">    restart<span class="punctuation">:</span> unless-stopped</span><br><span class="line">    ports<span class="punctuation">:</span></span><br><span class="line">  # 开放<span class="number">3001</span>（宿主机），并且监听<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>所有访问（权限高于ufw!)</span><br><span class="line">      #- <span class="number">3001</span><span class="punctuation">:</span><span class="number">3000</span></span><br><span class="line"></span><br><span class="line">  # 设置为仅监听本地的访问，需要搭配后面的nginx使用，从而禁止通过ip<span class="punctuation">:</span>端口访问</span><br><span class="line">      - <span class="string">&quot;127.0.0.1:3001:3000&quot;</span></span><br><span class="line">    environment<span class="punctuation">:</span></span><br><span class="line">      - TRUST_PROXY=<span class="keyword">false</span> # Set to <span class="keyword">true</span> if a reverse proxy is in front of the container</span><br><span class="line">    volumes<span class="punctuation">:</span></span><br><span class="line">      - <span class="string">&quot;./data:/opt/app/backend/data&quot;</span></span><br><span class="line">      - <span class="string">&quot;./data/images:/opt/app/frontend/public/img&quot;</span></span><br></pre></td></tr></table></figure><p>运行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><hr><h1 id="使用http访问">使用HTTP访问</h1><p>要将运行在Docker容器中的服务通过域名访问，并使用Nginx作为反向代理来转发到宿主机的3001端口，你需要完成几个步骤。这包括设置DNS记录、配置Nginx以及确保网络安全。下面是具体步骤：</p><h2 id="步骤-1-设置dns记录">步骤 1: 设置DNS记录</h2><p>确保你的域名 <code>fs.lthero.cn</code> 的DNS记录指向托管Nginx的服务器的IP地址。这通常在你的域名注册商处进行设置：</p><ul><li><strong>A记录</strong>：将域名指向IPv4地址</li><li><strong>AAAA记录</strong>：将域名指向IPv6地址（如果适用）</li></ul><h2 id="步骤-2-安装并启动nginx">步骤 2: 安装并启动Nginx</h2><p>步骤 1: 更新软件包列表</p><p>打开终端，首先使用<code>apt</code>命令更新你的包列表，以确保你安装的是最新版本的Nginx。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><p>步骤 2: 安装Nginx</p><p>使用<code>apt</code>安装Nginx。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure><h2 id="步骤-3-配置nginx">步骤 3: 配置Nginx</h2><p>你需要在Nginx中创建一个新的服务器块（server block），或者在已有的默认配置中修改，以设置反向代理。以下是一个基本的Nginx配置示例，将会把所有到 <code>fs.lthero.cn</code> 的请求转发到本地的3001端口：</p><ol><li><p>打开或创建一个新的Nginx配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/fs.lthero.cn</span><br></pre></td></tr></table></figure></li><li><p>添加以下配置：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> fs.lthero.cn;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:3001;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个配置做了以下几点：</p><ul><li><code>listen 80;</code> 告诉Nginx监听80端口（HTTP标准端口）。</li><li><code>server_name fs.lthero.cn;</code> 设置这个块应当响应的域名。</li><li><code>proxy_pass http://localhost:3001;</code> 指定所有传入的请求转发到本地的3001端口。</li><li><code>proxy_set_header</code> 指令将重要的HTTP头信息转发给后端应用。</li></ul></li><li><p>启用配置文件通过创建一个符号链接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /etc/nginx/sites-available/fs.lthero.cn /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure></li><li><p>检查Nginx配置文件是否有语法错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure></li><li><p>如果没有错误，重启Nginx以应用配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure></li></ol><h2 id="步骤-4-调整防火墙规则">步骤 4: 调整防火墙规则</h2><p>确保你的服务器的防火墙规则允许HTTP（端口80）和HTTPS（端口443，如果你使用SSL）的流量。如果你正在使用<code>ufw</code>，可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow <span class="string">&#x27;Nginx Full&#x27;</span></span><br><span class="line">sudo ufw reload</span><br></pre></td></tr></table></figure><h2 id="步骤-5-测试配置">步骤 5: 测试配置</h2><p>在浏览器中输入 <code>http://fs.lthero.cn</code> 或使用命令行工具如 <code>curl</code> 来测试你的配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://fs.lthero.cn</span><br></pre></td></tr></table></figure><p>你应该能看到从Docker容器中运行的服务响应的内容。</p><p>这样，你就配置好了Nginx作为反向代理，将域名 <code>fs.lthero.cn</code> 的流量转发到宿主机的3001端口上的服务。如果你希望使用HTTPS，你还需要设置SSL证书，可以考虑使用Let’s Encrypt免费证书并配置HTTPS。</p><h1 id="使用https访问">使用HTTPS访问</h1><p>要让你的域名 <code>fs.lthero.cn</code> 使用 HTTPS，你需要获取 SSL/TLS 证书，并配置 Nginx 以使用这些证书来加密网页内容。以下是详细的步骤，包括如何使用 Let’s Encrypt 提供的免费证书自动化这个过程。</p><h2 id="步骤-1-安装-certbot">步骤 1: 安装 Certbot</h2><p>Certbot 是一个自动获取并安装 Let’s Encrypt 证书的客户端。在 Ubuntu 上安装 Certbot 及其 Nginx 插件非常简单：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install certbot python3-certbot-nginx -y</span><br></pre></td></tr></table></figure><h2 id="步骤-2-获取和安装证书">步骤 2: 获取和安装证书</h2><p>使用 Certbot 获取并为你的域名安装证书：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx -d fs.lthero.cn</span><br></pre></td></tr></table></figure><p>此命令会自动为指定的域名 <code>fs.lthero.cn</code> 配置 SSL 证书，并更新 Nginx 配置以使用这些证书。Certbot 会询问你一些问题，比如电子邮件地址（用于紧急联系和证书续订提醒），以及是否重定向所有 HTTP 请求到 HTTPS（强烈建议启用）。</p><p>生成的证书位置<code>/etc/letsencrypt/live/</code></p><h2 id="步骤-3-更新-nginx-配置">步骤 3: 更新 Nginx 配置</h2><p>如果你想手动编辑 Nginx 配置文件，可以按以下方式配置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/fs.lthero.cn</span><br></pre></td></tr></table></figure><p>下面是certbot自动配置的文件，最新版本的certbot会自动配置好</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">server_name</span> fs.lthero.cn;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:3001;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/fs.lthero.cn/fullchain.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/fs.lthero.cn/privkey.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">include</span> /etc/letsencrypt/options-ssl-nginx.conf; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">ssl_dhparam</span> /etc/letsencrypt/ssl-dhparams.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$host</span> = fs.lthero.cn) &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">    &#125; <span class="comment"># managed by Certbot</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> fs.lthero.cn;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">404</span>; <span class="comment"># managed by Certbot</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面是手动修改</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> fs.lthero.cn;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$server_name</span><span class="variable">$request_uri</span>;  <span class="comment"># 强制重定向所有 HTTP 请求到 HTTPS</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">server_name</span> fs.lthero.cn;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/fs.lthero.cn/fullchain.pem;  <span class="comment"># 证书文件路径</span></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/fs.lthero.cn/privkey.pem;  <span class="comment"># 私钥文件路径</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">1d</span>;</span><br><span class="line">    <span class="attribute">ssl_session_cache</span> shared:MozSSL:<span class="number">10m</span>;  <span class="comment"># 缓存 SSL 会话以提升性能</span></span><br><span class="line">    <span class="attribute">ssl_session_tickets</span> <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 现代加密套件配置</span></span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> <span class="string">&#x27;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384&#x27;</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 其他 SSL 优化设置</span></span><br><span class="line">    <span class="attribute">ssl_stapling</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_stapling_verify</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 允许最大请求体大小为 1000MB</span></span><br><span class="line">    <span class="attribute">client_max_body_size</span> <span class="number">1000m</span>;  </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:3001;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个配置不仅启用了 HTTPS，还包括了一些现代的安全实践，如启用 HTTP/2，配置加密套件和协议等。</p><blockquote><p>允许最大请求体大小为 1000MB</p><p>client_max_body_size 1000m;</p><p>这行最好与config.js中保持一致，如果<strong>nginx设置小了，会出现“上传失败”的结果！</strong></p></blockquote><h2 id="步骤-4-重新加载-nginx">步骤 4: 重新加载 Nginx</h2><p>更改配置后，需要重新加载 Nginx 以应用新的配置：</p><blockquote><p>检查配置文件是否有语法错误，如果有warn!直接看“遇到的问题”部分，重新加载配置是不一定能work的</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t  <span class="comment"># 检查配置文件是否有语法错误</span></span><br><span class="line">sudo systemctl reload nginx  <span class="comment"># 重新加载配置</span></span><br><span class="line"><span class="comment"># 如果重新加载配置后无效，可以尝试重启nginx</span></span><br><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure><h2 id="步骤-5-验证-https">步骤 5: 验证 HTTPS</h2><p>在浏览器中访问 <code>https://fs.lthero.cn</code> 来检查是否配置成功。你应该能够看到一个安全锁标志，表明连接是通过 HTTPS 加密的。</p><h2 id="步骤-6-自动续订证书">步骤 6: 自动续订证书</h2><p>Let’s Encrypt 的证书有效期为90天，因此建议设置自动续订：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew</span><br></pre></td></tr></table></figure><p>这个命令会测试证书续订过程。如果这个测试成功，添加定时任务<code>crontab</code>：</p><p><code>crontab -e</code>再填写下面内容，表示每月第一天会自动执行</p><p>通过<code>which certbot</code>查看具体程序位置<code>/usr/local/bin/certbot</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 * * /usr/local/bin/certbot renew --deploy-hook <span class="string">&quot;nginx -s reload&quot;</span></span><br></pre></td></tr></table></figure><p>续签的证书位置<code>/etc/letsencrypt/renewal</code></p><p>通过以上步骤，你的站点 <code>fs.lthero.cn</code> 现在应该能够安全地使用 HTTPS 进行通信了。</p><p>如果要换crontab编辑器，运行下面的命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select-editor</span><br></pre></td></tr></table></figure><h2 id="使用防火墙限制ip-端口访问">使用防火墙限制IP:端口访问</h2><blockquote><p>这是从防火墙级别禁用ip:端口访问，但要注意如果docker在映射时使用了0.0.0.0:3001:3000这种形式，docker的规则高于防火墙；</p><p>方式有三种</p><p>1、直接在vps对应的云平台添加安全组，权限应该是最高的</p><p>2、在docker启动时设置-p 127.0.0.1:3001:3000，仅本地访问，权限次高</p><p>3、设置vps上的防火墙规则，权限会被docker覆盖</p></blockquote><h4 id="1-禁止外部直接访问应用端口">1. 禁止外部直接访问应用端口</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw deny 3001</span><br></pre></td></tr></table></figure><h4 id="2-允许本地访问">2. 允许本地访问</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow from 127.0.0.1 to any port 3001</span><br><span class="line"><span class="comment"># 记得做reload</span></span><br><span class="line">sudo ufw reload</span><br></pre></td></tr></table></figure><p>这会禁止外部直接访问 <code>3001</code> 端口，但允许 Nginx 在本地访问它。</p><h4 id="3-验证">3. 验证</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo netstat -tuln | grep 3001</span><br><span class="line"><span class="comment"># 应该输出</span></span><br><span class="line">tcp        0      0 127.0.0.1:3001          0.0.0.0:*               LISTEN</span><br><span class="line"><span class="comment"># 如果输出下面的则不对，需要调整docker的映射</span></span><br><span class="line">tcp        0      0 0.0.0.0:3001          0.0.0.0:*               LISTEN</span><br></pre></td></tr></table></figure><p>其它操作</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ufw查看规则</span></span><br><span class="line">sudo ufw status numbered</span><br><span class="line"><span class="comment"># ufw删除规则</span></span><br><span class="line">sudo ufw delete 22</span><br></pre></td></tr></table></figure><h2 id="解析到阿里云dns的申请方法">解析到阿里云DNS的申请方法</h2><blockquote><p>如果域名解析在阿里云，可以安装这个插件从而完成证书申请，<a href="https://github.com/tengattack/certbot-dns-aliyun">https://github.com/tengattack/certbot-dns-aliyun</a></p></blockquote><h3 id="credentials-file">Credentials File</h3><p>在某个熟悉的目录下，把下面的内容写入<code>credentials.ini</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dns_aliyun_access_key = 12345678</span><br><span class="line">dns_aliyun_access_key_secret = 1234567890abcdef1234567890abcdef</span><br></pre></td></tr></table></figure><p>dns_aliyun_access_key是阿里云账号的AccessKey ID</p><p>dns_aliyun_access_key_secret是阿里云账号的AccessKey Secret</p><p>这两个值可以在阿里云控制台-&gt;用户头像-&gt;accesskeys按指引获取AccessKey/SecretKey</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 600 /path/to/credentials.ini</span><br></pre></td></tr></table></figure><h3 id="obtain-certificates">Obtain Certificates</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">certbot certonly \</span><br><span class="line">    --authenticator=dns-aliyun \</span><br><span class="line">    --dns-aliyun-credentials=<span class="string">&#x27;/path/to/credentials.ini&#x27;</span> \</span><br><span class="line">    -d <span class="string">&quot;*.example.com,example.com&quot;</span></span><br></pre></td></tr></table></figure><p>申请下来的证书位置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/letsencrypt/archive/</span><br></pre></td></tr></table></figure><p>适合阿里云的自动命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 * * /usr/local/bin/certbot renew --manual --preferred-challenges dns --manual-auth-hook <span class="string">&quot;alidns&quot;</span> --manual-cleanup-hook <span class="string">&quot;alidns clean&quot;</span> --deploy-hook <span class="string">&quot;nginx -s reload&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;在线文件共享平台&quot;&gt;在线文件共享平台&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;提供短时/长期（类似蓝奏云）的文件分享，无文件类型限制&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;项目安装&quot;&gt;项目安装&lt;/h1&gt;
&lt;figure class=&quot;highlig</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
  </entry>
  
  <entry>
    <title>【PPT】生成高清的PDF格式矢量图片</title>
    <link href="https://blog.lthero.cn/2024/11/22/CreateHighResolutionPic/"/>
    <id>https://blog.lthero.cn/2024/11/22/CreateHighResolutionPic/</id>
    <published>2024-11-22T05:46:43.000Z</published>
    <updated>2024-11-26T13:04:38.968Z</updated>
    
    <content type="html"><![CDATA[<h2 id="步骤">步骤</h2><p>1、新建个PPT（如：export.pptx），在PPT的“设计”-&gt;“幻灯片大小”改成“自定义”，宽度,高度：100cm</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241122134900256.png" alt="image-20241122134900256"></p><p>2、将原来的PPT（包含构架图）一整页直接复制到export.pptx中</p><p>3、选择“文件”-&gt;“导出”-&gt;“导出为pdf”（这里有个“选项”，可以选择导出到具体的某页）</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241122140000983.png" alt="image-20241122140000983"></p><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241122140030833.png" alt="image-20241122140030833"></p><p>4、导出为pdf后，使用“编辑”功能中的“裁剪”，对图像进行裁剪并保存。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;步骤&quot;&gt;步骤&lt;/h2&gt;
&lt;p&gt;1、新建个PPT（如：export.pptx），在PPT的“设计”-&amp;gt;“幻灯片大小”改成“自定义”，宽度,高度：100cm&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn.lthero.cn/post_images/c</summary>
      
    
    
    
    <category term="技巧" scheme="https://blog.lthero.cn/categories/%E6%8A%80%E5%B7%A7/"/>
    
    
    <category term="技巧" scheme="https://blog.lthero.cn/tags/%E6%8A%80%E5%B7%A7/"/>
    
    <category term="PPT" scheme="https://blog.lthero.cn/tags/PPT/"/>
    
  </entry>
  
  <entry>
    <title>GetSSLforWebsite</title>
    <link href="https://blog.lthero.cn/2024/08/19/GetSSLforWebsite/"/>
    <id>https://blog.lthero.cn/2024/08/19/GetSSLforWebsite/</id>
    <published>2024-08-19T10:40:40.000Z</published>
    <updated>2024-08-19T10:46:50.651Z</updated>
    
    <content type="html"><![CDATA[<h2 id="宝塔">宝塔</h2><p>在宝塔网络管理，选择<strong>DNS验证</strong>，手动解析<strong>阿里云DNS</strong>，设置密钥后自动申请即可</p><h2 id="阿里云平台">阿里云平台</h2><p>搜索：数字证书管理服务</p><p>在SSL证书管理中，可以申请免费的DigiCert证书，时效三个月，好处是对于部署在阿里云的cdn服务，在申请证书后，平台会自动更新cdn相关服务。</p><h2 id="certbot自动">certbot自动</h2><h3 id="安装certbot和阿里云dns插件">安装certbot和阿里云DNS插件</h3><p>安装步骤在<a href="https://certbot.eff.org/">certbot (opens new window)</a>的官网上有，而且很详细。但最大的问题是，官网上的安装方法要求使用snapd，而七牛云服务器（实际上是阿里云服务器）并不支持snapd，所以需要使用yum安装。</p><h4 id="安装手动申请证书所需工具">安装手动申请证书所需工具</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install certbot</span><br></pre></td></tr></table></figure><h4 id="安装自动续期证书所需工具">安装自动续期证书所需工具</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt install certbot python3-certbot-nginx</span><br><span class="line">pip3 install certbot-dns-aliyun</span><br><span class="line">pip3 install certbot-nginx</span><br></pre></td></tr></table></figure><h3 id="申请证书">申请证书</h3><h4 id="手动申请证书">手动申请证书</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certbot -d *.sunxiaolong.net -d sunxiaolong.net --manual certonly</span><br></pre></td></tr></table></figure><p>这个<code>--manual</code>参数很重要，如果没有这个参数，就必须得用dns插件了~<br>随后会有提示，给域名添加一个TXT解析，按照提示去域名解析控制台添加对应记录。这里一定要注意这个解析记录不要区分大陆还是海外线路，否则可能会失败。<br>解析记录添加完成后，回到命令行按下回车键。<br>证书和私钥文件会保存到<code>/etc/letsenctypt/live</code>下，命令行上有回显。</p><h4 id="自动申请证书">自动申请证书</h4><p>将阿里云DNS的key写到本地，格式如下：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dns_aliyun_access_key</span>=<span class="string">*******</span></span><br><span class="line"><span class="attr">dns_aliyun_access_key_secret</span>=<span class="string">******</span></span><br></pre></td></tr></table></figure><p>随后保存到服务器上，如<code>/opt/cert/aliyun-dns.conf</code>。access_key和access_key_secret是阿里云的多用户访问控制中相应用户的key和secret。</p><ol start="2"><li>签发证书</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certbot certonly --authenticator=dns-aliyun --dns-aliyun-credentials=&#x27;/opt/cert/aliyun-dns.conf&#x27; -d &quot;*.sunxiaolong.net,sunxiaolong.net&quot;</span><br></pre></td></tr></table></figure><p>然后就签发成功了～证书位置可以看回显，确认配置没错之后，reload一下nginx就可以了。</p><h3 id="修改nginx配置">修改nginx配置</h3><p>将nginx配置中对应域名的证书和私钥文件路径指定到certbot回显的路径上。</p><h3 id="reload-nginx">reload nginx</h3><p>重新加载nginx即可生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">NGINX_HOME/sbin/nginx -s reload</span></span><br></pre></td></tr></table></figure><h3 id="验证是否生效">验证是否生效</h3><p>重新打开对应的HTTPS站点，不再提示证书不安全，且证书过期时间和certbot命令行回显能对应上即为成功。</p><h3 id="配置自动续期">配置自动续期</h3><h4 id="手动续期">手动续期</h4><p>待证书要过期，执行<code>certbot renew</code>，再reload nginx即可。</p><h4 id="自动续期">自动续期</h4><p>编辑crontab</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure><p>添加记录，<code>0 0 1 * * /root/renew-cert.sh</code>，表示每月1日0点执行续期脚本。</p><p>编写续期脚本 <code>/root/renew-cert.sh</code>的内容如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">certbot certonly -n --authenticator=dns-aliyun --dns-aliyun-credentials=&#x27;/opt/cert/aliyun-dns.conf&#x27; -d &quot;*.sunxiaolong.net,sunxiaolong.net&quot;</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><p>重新加载crond服务。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service crond reload</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;宝塔&quot;&gt;宝塔&lt;/h2&gt;
&lt;p&gt;在宝塔网络管理，选择&lt;strong&gt;DNS验证&lt;/strong&gt;，手动解析&lt;strong&gt;阿里云DNS&lt;/strong&gt;，设置密钥后自动申请即可&lt;/p&gt;
&lt;h2 id=&quot;阿里云平台&quot;&gt;阿里云平台&lt;/h2&gt;
&lt;p&gt;搜索：数字证书管理服务</summary>
      
    
    
    
    
  </entry>
  
</feed>
