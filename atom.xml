<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>lthero</title>
  
  <subtitle>个人博客</subtitle>
  <link href="https://blog.lthero.cn/atom.xml" rel="self"/>
  
  <link href="https://blog.lthero.cn/"/>
  <updated>2024-12-23T12:14:44.973Z</updated>
  <id>https://blog.lthero.cn/</id>
  
  <author>
    <name>lthero</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>PS5串流</title>
    <link href="https://blog.lthero.cn/2024/12/23/PS5RemotePlay/"/>
    <id>https://blog.lthero.cn/2024/12/23/PS5RemotePlay/</id>
    <published>2024-12-23T05:04:53.000Z</published>
    <updated>2024-12-23T12:14:44.973Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>思路：<strong>网络部分</strong>使用zerotier创建虚拟局域网，让PS5在虚拟局域网内，从而被其它设备访问；<strong>控制部分</strong>使用开源的软件chiaki（pxplay也行，但它收费）</p></blockquote><h2 id="网络部分">网络部分</h2><p>zerotier的安装与使用具体可以查看另一篇文章</p><ol><li>在zerotier创建一个虚拟局域网fx2811dwx(随便写的)</li><li>在n1盒子上（刷了openwrt系统，并安装了zerotier插件）启动zerotier，并加入到虚拟局域网fx2811dwx，需要在zerotier控制台同意设备加入</li><li>为了让PS5也加入到这个网络，需要在n1盒子上，允许 Zerotier 的拨入客户端访问路由器 LAN 资源<ol><li>需要在 Zerotier 管理页面设定到 LAN 网段的路由表</li><li>比如n1盒子的虚拟ip是10.22.22.15，n1盒子的真实局域网ip是192.168.6.15。需要在zerotier管理页面，将LAN网段192.168.6.0/24 交给10.22.22.15进行转发</li><li>在PS5上，将网络设置的网关（以及主DNS）设置为n1盒子的真实局域网ip</li></ol></li></ol><p>如果没问题，此时同一个虚拟局域网下的设备，可以ping通PS5（假设它的真实局域网ip是192.168.6.5），也就是说，PS5是不需要安装zerotier或设置虚拟ip的，转发的操作已经交给了n1盒子</p><blockquote><p>如果网络不稳定，zerotier无法创建直连p2p，此时需要中转服务器（也叫moon服务器），具体操作在另一篇zerotier文章有写</p></blockquote><h3 id="注意">注意</h3><p>除了使用<strong>zerotier</strong>，也可以使用相似的<strong>tailscale</strong>、<strong>皎月连</strong>等虚拟局域网创建工具；</p><p>网上也有使用dmz转发的方法（需要有公网），但此方法会暴露端口，不太推荐</p><h2 id="操控部分">操控部分</h2><blockquote><p>PC/安卓/苹果 需要安装软件chiaki</p><p>项目：<a href="https://github.com/streetpea/chiaki-ng">https://github.com/streetpea/chiaki-ng</a></p></blockquote><p>假如在PC上下载好chiaki软件，此时假设PC也在n1盒子相同的“真实局域网下”（即PC可以ping通PS5），如果chiaki未发现PS5，可以自选添加</p><p>其中选项如下</p><ol><li>ip要设置为PS5的真实局域网ip（192.168.6.5）</li><li>写真实的PSN的ID，然后点击public lookup，可以自动填写ID对应的base64格式。或者用这个网站可以将PSN的ID转码https://psn.flipscreen.games/</li><li>以及pair对应的码子，在“系统”-&gt;“远程游玩”-&gt;&quot;配对&quot;里找，码子有效5分钟</li></ol><p>如果没问题，即可添加成功，随后即可开始串流</p><h3 id="注意">注意</h3><p>chiaki是支持ds手柄原生震动的，但需要有线连接到电脑，如果发现有线连接后还没震动，可以下载Playstation accessories（官方软件）并将手柄驱动更新，理论上不需要一直后台打开accessories就可以用原生震动（如果软件关闭原生震动就不能用，就一直打开accessories好了）</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;思路：&lt;strong&gt;网络部分&lt;/strong&gt;使用zerotier创建虚拟局域网，让PS5在虚拟局域网内，从而被其它设备访问；&lt;strong&gt;控制部分&lt;/strong&gt;使用开源的软件chiaki（pxplay也行，但它收费）&lt;/p&gt;
&lt;/bloc</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
    <category term="PS5" scheme="https://blog.lthero.cn/tags/PS5/"/>
    
  </entry>
  
  <entry>
    <title>收集论文中的好语句与图表</title>
    <link href="https://blog.lthero.cn/2024/12/03/SomeGreatSentences/"/>
    <id>https://blog.lthero.cn/2024/12/03/SomeGreatSentences/</id>
    <published>2024-12-03T07:05:01.000Z</published>
    <updated>2024-12-04T02:21:17.349Z</updated>
    
    <content type="html"><![CDATA[<p>1</p><p>SoK: Watermarking for AI-Generated Content</p><h3 id="第一章节-introduction">第一章节（Introduction）</h3><blockquote><p>“Distinguishing between human-created and AI-generated content is becoming increasingly challenging, necessitating the development of effective techniques to maintain transparency,accountability, and the responsible use of GenAI.”</p></blockquote><p>区分人类创造的内容和人工智能生成的内容正变得越来越具有挑战性，需要开发有效的技术来保持透明度、问责制和负责任地使用GenAI。</p><blockquote><p>“While watermarking is not a <strong>silver bullet</strong> for addressing all risks associated with GenAI, it can play a crucial role in enhancing AI safety and trustworthiness by combating misinformation and deception.”</p></blockquote><p>虽然水印并不是解决与人工智能相关的所有风险的<strong>灵丹妙药</strong>，但它可以通过打击错误信息和欺骗，在提高人工智能的安全性和可信度方面发挥关键作用。</p><img src="C:/Users/12904/AppData/Roaming/Typora/typora-user-images/image-20241203151752811.png" alt="image-20241203151752811" style="zoom: 67%;" /><p><strong>首先</strong>，抛出问题：我们需要一个能区分AIGC和人工生成内容的技术</p><p><strong>其次</strong>，说出目前使用的解决方案，并突出它们的缺点；</p><ul><li>可能的方案一：记录所有AIGC的内容；但缺点有三，1、需要大量存储空间与跨组织协调；2、隐私保护问题；3、无法应用于开源模型</li><li>可能的方案二：使用post-hoc的检测方式；通过AIGC的特征来区分；缺点，这类检测方式有时间局限性，随着AIGC技术快速升级，生成内容与真实内容越发难的被划分出来。</li></ul><p><strong>最后</strong>，抛出预期的解决方案：水印。</p><ul><li>与其被动地对生成内容检测，不如“主动出击”</li><li>优点：水印技术不受GenAI模型不断发展的能力的限制，而是提供了一种<strong>深思熟虑的、持久的</strong>识别手段</li><li>优点：水印可以在以后检测到，允许在<strong>不依赖于固有或统计差异的情况下进行验证</strong>，从而提供了一种更有弹性的方法来区分机器生成的内容和人类工作</li><li>上述两个优点，正好解决了方案一与方案二的缺点</li></ul><blockquote><p>“Unlike methods that <strong>passively</strong> attempt to detect incidental differences between human and AI generated content, watermarking involves <strong>actively</strong> embedding an imperceptible signal within GenAI output at the time of its generation”</p></blockquote><p>与<strong>被动地</strong>尝试检测人类和人工生成内容之间偶然差异的方法不同，水印涉及在生成GenAI输出时<strong>主动嵌入</strong>难以察觉的信号。</p><p>随后，写一段本文后面几个章节的工作总览</p><h3 id="第二章节">第二章节</h3><p><strong>首先</strong>，介绍了post-hoc 的分类</p><p>1、zero-shot检测，收集统计特征来判断；</p><p>2、training-based检测，使用“包含人类与AIGC”的数据集进行训练；</p><p>post-hoc检测方法拥有较差的性能，此外对于不在数据集中的新模型，此检测方式即会失败</p><p><strong>其次</strong>，简单介绍了水印的历史与分类（可见，不可见）</p><p><strong>随后</strong>，强调GenAI时代对水印的急需性，从以下五点</p><p>1、Combating Misinformation</p><p>在人工智能生成的内容中添加水印可以帮助<strong>追踪信息来源</strong>，从而有助于识别错误信息和虚假信息。</p><p>2、Enhancing Fraud Detection</p><p>生成模型可以产生定制的诈骗信息，使传统的检测方法不那么有效。水印可以在识别和减轻这种复杂的骗局企图方面发挥关键作用，加强反骗局的努力</p><p>3、Deterring Academic Dishonesty.</p><p>水印可以帮助防止在一些领域作弊，比如学生论文，在这些领域验证文本是人类写的</p><p>4、Avoiding Training Data Contamination</p><p>如果模型不经意地在它们自己生成的输出上进行了训练，就会导致“模型崩溃”，在退化数据上进行迭代训练会降低生成内容的整体质量。水印可以帮助标记人工智能生成的内容</p><p>5、Providing Signatures and Attribution.</p><p>水印可以作为签名，允许用户验证内容是由特定模型生成的。此外，水印可以帮助证明归因于模型的有害内容是否真的由该模型生成。</p><p><strong>最后</strong>，强调了政府与工业届的政策</p><p>1、政府：包含美国、欧盟、中国等国家对AI的法规限制</p><p>2、工业届：C2PA与Google SynthID</p><h3 id="第三章节-what-s-a-watermark">第三章节（What’s a Watermark）</h3><h4 id="3-1质量">3.1质量</h4><p><strong>首先</strong>，介绍水印的构成（嵌入&amp;提取）两大部分</p><p>设想个应用场景（在AIGC时代），使用模型M和提示词<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi></mrow><annotation encoding="application/x-tex">\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">π</span></span></span></span>生成一个内容<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span>（视频、音频、文本、图像），随后使用一个水印模块<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>r</mi><msup><mi>k</mi><mi>M</mi></msup><mo stretchy="false">(</mo><mi>π</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Watermark^M(\pi)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0913309999999998em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">π</span><span class="mclose">)</span></span></span></span>-&gt;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span>表示在水印模块下生成的内容</p><p>并根据水印类型，划分成zero-bit水印与multi-bit 水印($ m \in {0,1} ^k<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">)</mo><mtext>，则更新后的演示公式是</mtext></mrow><annotation encoding="application/x-tex">)，则更新后的演示公式是</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mclose">)</span><span class="mord cjk_fallback">，</span><span class="mord cjk_fallback">则</span><span class="mord cjk_fallback">更</span><span class="mord cjk_fallback">新</span><span class="mord cjk_fallback">后</span><span class="mord cjk_fallback">的</span><span class="mord cjk_fallback">演</span><span class="mord cjk_fallback">示</span><span class="mord cjk_fallback">公</span><span class="mord cjk_fallback">式</span><span class="mord cjk_fallback">是</span></span></span></span>Watermark^M(m,\pi)<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">-&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span>x$</p><p>相应的，还有<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Detect(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span></span>来判断是否存在水印，相应的也分成了</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Detect(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span></span> -&gt; <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi><mo separator="true">,</mo><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{true,  false\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">u</span><span class="mord mathdefault">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mclose">}</span></span></span></span> 进行zero-bit水印判断</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Detect(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span></span> -&gt; <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><msup><mo stretchy="false">}</mo><mi>k</mi></msup></mrow><annotation encoding="application/x-tex">\{0,1\}^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.099108em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">}</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span> 进行水印recover</li></ul><p>另外，还有一种<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>b</mi><mi>u</mi><mi>t</mi><mi>e</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Attribute(X)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault">t</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">b</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mclose">)</span></span></span></span>-&gt; <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mi>t</mi><mi>r</mi><mi>u</mi><mi>e</mi><mo separator="true">,</mo><mi>f</mi><mi>a</mi><mi>l</mi><mi>s</mi><mi>e</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{true,  false\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">u</span><span class="mord mathdefault">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mclose">}</span></span></span></span></p><blockquote><p>Detect is used, for instance, to identify misinformation being spread by malicious users of the model,Attribute is used to accuse the model owner of producing problematic content</p></blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Detect</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span></span></span></span>用于识别模型恶意用户传播的错误信息，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>b</mi><mi>u</mi><mi>t</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">Attribute</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault">t</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">b</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span></span></span></span>用于指责模型所有者产生有问题的内容</p><p><strong>其次</strong>，介绍水印对质量的影响</p><p>经验质量验证和可证明性质量验证(heuristic versus provable)</p><ul><li><p>heuristic的更偏向于经验向，水印可能会严重影响实验中未捕获的提示或任务的质量。此外，实验中使用的质量度量可能存在偏差或不可靠。</p></li><li><p>provable可证明质量概念适用于任何可能的提示，并确保水印引入的任何偏差是有限的，甚至不存在。</p></li></ul><p>单反应和多反应(single-response versus multi-response)</p><p>一些保证仅适用于水印模型的单个响应。（例如，一些经验质量验证方法，低失真和无失真）</p><p>例如，图像水印可能会导致模型<strong>只输出狗的图像，但这些图像质量极高</strong>。该水印将<strong>满足单响应质量概念</strong>，因为这种偏差只会出现在多个响应中。</p><p>另一方面，其他概念表明，任何数量的水印响应都是高质量的（例如，更强的经验质量验证方法和不可检测性）</p><p><strong>经验质量验证</strong>(Empirical Quality Validation)</p><p><strong>使用其它模型</strong>来给水印内容的质量进行打分（HPSv2），或者<strong>让用户来比较</strong>水印与无水印内容的质量，但实际上，“经验质量”并没有大规模的使用，除了SynthID</p><p>SynthID在语法、相关性、正确性、有用性和整体质量5个类别中，使用人工评价来评价水印的效果。他们还根据经验评估了他们提出的方法的检出率，并表明它具有低假阳性率</p><p><strong>经验质量验证</strong>通常与下面详细说明的<strong>可证明的质量验证</strong>一起使用。</p><p>Distortion-free schemes ensure that the quality is preserved for any single  response from the model, but do not guarantee anything about the quality across multiple generations</p><p>无失真方案确保模型的任何单个响应都能保持质量，但不能保证多代的质量</p><h4 id="3-2-假阳率">3.2 假阳率</h4><p>在水印方案中，检测器(Detector)的一个重要特性是具有较低的误报率（false positive rate)</p><h4 id="3-3-假阳率与鲁棒性">3.3 假阳率与鲁棒性</h4><h4 id="3-4-不可伪造性-unforgeability">3.4 不可伪造性(Unforgeability)</h4><p>不可伪造性保证了没有嵌入密钥的攻击者无法生成看似带有水印的内容，除非是完全复制水印模型的输出内容。</p><p><strong>特性</strong>：确保只有拥有<strong>生成密钥</strong>或<strong>嵌入密钥</strong>的人才能嵌入有效的水印。</p><p><strong>安全性</strong>：防止攻击者伪造水印内容，误导他人认为<strong>某内容来自特定模型</strong>。</p><p><strong>实际意义</strong>：</p><ul><li>一个健全的水印方案必须确保攻击者在没有嵌入密钥的情况下，难以伪造带水印的输出。</li><li>这一特性为水印系统增加了一层可信度，尤其是在涉及责任追究和法律影响的场景中。</li></ul><blockquote><p>伪造攻击问题：如果攻击着拿着别人生成的图A，进行逆向后得到初始噪声，再生成一张有害图B</p></blockquote><p>解决方案：可以通过C2PA解决，假如图A的水印内容(C2PA凭证)已经记录了图A的提示词，哪怕通过图B提取出了水印（即C2PA凭证），可以通过提示词的比对，简单判断出图B的内容与C2PA中的不匹配，说明图像遭到了攻击。</p><p>在水印的设计中，<strong>Attribute（归因）<strong>与</strong>Detect（检测）<strong>是两个关键的功能模块，分别对应不同的应用需求和安全性目标。以下是对两者区别的详细说明，尤其是</strong>Attribute</strong>的功能和重要性：</p><h5 id="attribute-归因">Attribute（归因）</h5><ol><li><p><strong>核心目标</strong>：<br><strong>归因</strong>的核心目标是确定某个内容是否来自一个特定的水印模型。换句话说，Attribute功能用于对内容的来源进行可靠的追溯和责任划分。</p></li><li><p><strong>属性特点</strong>：</p><ul><li><strong>不可伪造性（Unforgeability）</strong>：<br>归因功能需要确保攻击者在不知道归因密钥（Attribute Key, (ak)）的情况下，<strong>无法生成带有有效水印但不属于模型真实输出的内容</strong>。这种不可伪造性对于追责至关重要，特别是在需要证明某模型生成了有害内容时。</li><li><strong>独立性</strong>：<br>归因算法及其密钥 (ak) 是独立于检测功能的，避免了归因和检测的目标相互干扰。归因的重点在于精确性和不可伪造性，而非鲁棒性。</li><li><strong>公开性选项</strong>：<br>在一些方案中，可以公开归因密钥 (ak) 而不影响不可伪造性。例如，使用数字签名技术，可以允许任何人验证内容是否来自某模型，但无法伪造这种内容。</li></ul></li><li><p><strong>应用场景</strong>：</p><ul><li><strong>责任追溯</strong>：<br>如果需要对模型生成的有害内容追责，例如证明某模型输出了虚假或误导性信息，归因功能是不可或缺的。</li><li><strong>法律和伦理保障</strong>：<br>当水印方案涉及敏感内容时，归因功能可以为模型的使用者或开发者提供明确的责任界定。</li></ul></li></ol><p>对于平台来说，如果有人想诬陷某种有害内容（假设是个图片A）是使用华为的模型生成的，此时我们对图片A进行归因，如果能解出来它的密钥，则确实是华为模型生成的；否则，就断定不是华为模型生成的，所以<strong>归因的重点在于精确性和不可伪造性</strong></p><h5 id="detect-检测">Detect（检测）</h5><ol><li><p><strong>核心目标</strong>：<br><strong>检测</strong>功能的目标是确认某个内容是否包含水印，而不关心内容的具体来源。它通常被设计为<strong>鲁棒</strong>的，也就是说，即使内容经过一定程度的修改（如小幅篡改或噪声添加），检测功能仍然可以识别出水印的存在。</p></li><li><p><strong>属性特点</strong>：</p><ul><li><strong>鲁棒性（Robustness）</strong>：<br>检测功能强调在内容被轻微修改后，仍然能够识别水印的能力。这对防止简单的攻击和篡改很重要。</li><li><strong>低误报率</strong>：<br>检测需要确保尽量减少误报（非水印内容被判定为有水印）和漏报（有水印内容被判定为没有水印）。</li></ul></li><li><p><strong>应用场景</strong>：</p><ul><li><strong>内容筛选</strong>：<br>在大规模内容分发中，可以快速检测内容是否带有水印，从而决定是否进一步处理。</li><li><strong>版权保护</strong>：<br>用于检查内容是否属于某水印模型的输出，但通常不追溯具体的生成责任。</li></ul></li></ol><h5 id="归因与检测的主要区别">归因与检测的主要区别</h5><table><thead><tr><th>特性</th><th><strong>Attribute（归因）</strong></th><th><strong>Detect（检测）</strong></th></tr></thead><tbody><tr><td><strong>核心目标</strong></td><td>确定内容来源，追溯责任</td><td>确认内容是否带有水印</td></tr><tr><td><strong>安全性需求</strong></td><td>强调不可伪造性</td><td>强调鲁棒性</td></tr><tr><td><strong>密钥的使用</strong></td><td>使用归因密钥（Attribute Key, (ak)）</td><td>使用检测密钥（Detect Key, (dtk)）</td></tr><tr><td><strong>是否允许公开密钥</strong></td><td>可以公开 (ak)，前提是保障不可伪造性</td><td>公开 (dtk) 可能影响鲁棒性</td></tr><tr><td><strong>典型应用场景</strong></td><td>内容归因、责任划分、法律证明</td><td>快速检测、筛选内容、版权保护</td></tr></tbody></table><p>归因功能（Attribute）是水印方案中实现<strong>不可伪造性</strong>的关键部分，旨在提供一种可靠的方法来<strong>追溯</strong>内容来源并划分生成责任。它的独特性在于，能够确保即使攻击者有意尝试，也无法伪造有效的归因内容。这种特性使归因功能在敏感场景（如法律诉讼、内容归责）中极为重要。与之相对，检测功能更偏向于应用层面的水印存在性验证，其核心是鲁棒性和效率。</p><p>我们得明确水印的目标，溯源本质是一种归因，要强调不可伪造性</p><p>1、有人用华为模型生成有害内容，需要溯源到用户，需要“归因”，此时不需要有强鲁棒性</p><p>2、有人想用有害内容诬陷华为，需要不可伪造性来证明，该内容不是华为生成的，需要“归因”，此时不需要有强鲁棒性</p><p>3、如果需要判断某个内容是否是AI生成，可以用“检测”，需要有强鲁棒性</p><p>**归因（Attribute）<strong>和</strong>检测（Detect）**看似在功能上有一定重叠，但它们的目标和设计侧重点不同：</p><ol><li><p><strong>归因确实能完成检测</strong>：<br>归因功能本质上包含了“检测是否带有水印”的能力。既然它能判断某个内容是否来自特定模型，那么它自然也能判断内容是否包含水印。然而，归因强调的是<strong>不可伪造性</strong>，因此它可以牺牲一些对鲁棒性的需求。</p></li><li><p><strong>检测专注于鲁棒性</strong>：<br>检测的目标是即便内容被篡改（如添加噪声、调整格式），仍然能够识别出水印存在。这种鲁棒性使得检测功能在版权保护和内容筛选等场景中非常高效。</p></li></ol><hr><h5 id="同时满足归因和检测的需求">同时满足归因和检测的需求</h5><p>是的，可以设计一种混合方案，满足两者的需求。具体方法如下：</p><h6 id="分离密钥和算法">分离密钥和算法</h6><p>可以将归因和检测分开设计，但在水印生成时统一实现。这样在检测和归因时可以根据需求选择不同的算法和密钥：</p><ul><li><strong>归因算法与密钥（Attribute and (ak)</strong>）：<ul><li>强调不可伪造性，确保内容来源可靠。</li><li>可以设计为更严格，但允许牺牲鲁棒性。</li></ul></li><li><strong>检测算法与密钥（Detect and (dtk)</strong>）：<ul><li>强调鲁棒性，确保即使内容被修改也能检测出水印。</li><li>允许更宽松的验证条件。</li></ul></li></ul><p>通过这种设计，归因和检测可以基于同一个水印生成算法，但在实际使用时根据需求分别调用不同的功能。</p><hr><h6 id="统一的水印生成机制-分层次需求满足">统一的水印生成机制，分层次需求满足</h6><p>设计一个同时支持归因和检测的水印方案，允许在不同场景下权衡两者：</p><ol><li><p><strong>水印生成阶段</strong>：</p><ul><li>使用单一算法生成水印，水印中包含既可供检测的鲁棒部分，又包含归因所需的不可伪造部分。</li><li>例如，基于<strong>加密签名</strong>的方法，生成的水印既包含公开检测的信息，也包含只有持有私密密钥才能验证的归因信息。</li></ul></li><li><p><strong>检测阶段</strong>：</p><ul><li>使用检测密钥 (dtk) 快速验证水印是否存在。</li><li>重点在于效率和鲁棒性，适合大规模内容筛选。</li></ul></li><li><p><strong>归因阶段</strong>：</p><ul><li>使用归因密钥 (ak) 进一步验证内容来源。</li><li>重点在于不可伪造性，适合小范围高精度分析。</li></ul></li></ol><hr><h6 id="动态水印切换">动态水印切换</h6><p>现代水印算法可以根据应用场景动态选择功能。例如：</p><ul><li>在常规内容筛选中，使用鲁棒的检测算法。</li><li>当需要追溯责任时，再切换到严格的归因算法。</li></ul><p>这样的动态切换可以通过<strong>密钥分级</strong>和<strong>算法模块化</strong>实现，确保归因和检测在同一个水印系统中共存且高效。</p><hr><h6 id="小结">小结</h6><p>归因和检测虽然目标不同，但它们可以通过统一的水印生成机制、分离的密钥和算法实现共存。具体来说：</p><ul><li>检测满足效率和鲁棒性需求。</li><li>归因满足不可伪造性需求。<br>通过分层设计，可以在一个系统中同时实现归因和检测的需求，适应不同的应用场景。</li></ul><h4 id="3-5-嵌入-消息">3.5 嵌入“消息”</h4><p>指嵌入用户信息，模型信息，提示词，生成时间等这种定制化内容，类似于C2PA</p><h4 id="3-6-高效计算">3.6 高效计算</h4><p>带水印的生成过程应该施加最小的计算开销，确保在计算、内存使用和吞吐量方面，计算效率与未带水印的生成过程相当。显著的计算复杂性会阻碍现实世界的部署，使模型对实际应用不那么有吸引力。</p><p>检测、解码和归因的计算需求也应保持在最低限度。</p><h3 id="第四章节-threat-models">第四章节 （Threat Models）</h3><p>介绍了一些攻击方式</p><p>1、水印去除</p><p>2、伪造水印</p><p>攻击者试图创建被错误地分类为水印的内容，尽管没有被指定的水印方案处理，从而实现一些诬陷（参考第三章节的不可伪造性）</p><p>3、秘密信息提取</p><p>更高级的对抗目标<strong>是提取水印方案中使用的密钥</strong>。这种攻击比移除或锻造攻击要困难得多。在大多数情况下，如果攻击者成功地提取了密钥，他们可以很容易地删除或伪造水印。然而，重要的是要注意，提取密钥并不是执行删除或伪造攻击的先决条件</p><blockquote><p>问题，我的rlc方法中，原噪声被修改后就没用了？真的没用了嘛</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;1&lt;/p&gt;
&lt;p&gt;SoK: Watermarking for AI-Generated Content&lt;/p&gt;
&lt;h3 id=&quot;第一章节-introduction&quot;&gt;第一章节（Introduction）&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;“Distinguishin</summary>
      
    
    
    
    <category term="AIGC" scheme="https://blog.lthero.cn/categories/AIGC/"/>
    
    
    <category term="AIGC" scheme="https://blog.lthero.cn/tags/AIGC/"/>
    
  </entry>
  
  <entry>
    <title>【Wallos安装】订阅服务统计</title>
    <link href="https://blog.lthero.cn/2024/12/01/InstallWallo/"/>
    <id>https://blog.lthero.cn/2024/12/01/InstallWallo/</id>
    <published>2024-12-01T13:31:20.000Z</published>
    <updated>2024-12-01T15:02:12.206Z</updated>
    
    <content type="html"><![CDATA[<h1 id="wallos">Wallos</h1><blockquote><p>提供订阅服务的统计</p></blockquote><h1 id="项目安装">项目安装</h1><p>创建目录，为了将数据库长期保存在本地</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> wallos</span><br></pre></td></tr></table></figure><p>docker compose文件</p><p>根据实际需求，修改映射端口等，如映射到宿主机的3001端口</p><p>vim docker-compose.yml</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">services:</span><br><span class="line">  wallos:</span><br><span class="line">    container_name: wallos</span><br><span class="line">    image: bellamy/wallos:latest</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8282:80/tcp&quot;</span><br><span class="line">    environment:</span><br><span class="line">      TZ: &#x27;America/Toronto&#x27;</span><br><span class="line">    # Volumes store your data between container upgrades</span><br><span class="line">    volumes:</span><br><span class="line">      - &#x27;./db:/var/www/html/db&#x27;</span><br><span class="line">      - &#x27;./logos:/var/www/html/images/uploads/logos&#x27;</span><br><span class="line">    restart: unless-stopped</span><br></pre></td></tr></table></figure><p>运行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><h1 id="使用http访问">使用HTTP访问</h1><p>要将运行在Docker容器中的服务通过域名访问，并使用Nginx作为反向代理来转发到宿主机的8282端口，你需要完成几个步骤。这包括设置DNS记录、配置Nginx以及确保网络安全。下面是具体步骤：</p><h2 id="步骤-1-设置dns记录">步骤 1: 设置DNS记录</h2><p>确保你的域名 <code>wo.lthero.top</code> 的DNS记录指向托管Nginx的服务器的IP地址。这通常在你的域名注册商处进行设置：</p><ul><li><strong>A记录</strong>：将域名指向IPv4地址。</li><li><strong>AAAA记录</strong>：将域名指向IPv6地址（如果适用）。</li></ul><h2 id="步骤-2-安装并启动nginx">步骤 2: 安装并启动Nginx</h2><p>步骤 1: 更新软件包列表</p><p>打开终端，首先使用<code>apt</code>命令更新你的包列表，以确保你安装的是最新版本的Nginx。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><p>步骤 2: 安装Nginx</p><p>使用<code>apt</code>安装Nginx。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure><h2 id="步骤-3-配置nginx">步骤 3: 配置Nginx</h2><p>你需要在Nginx中创建一个新的服务器块（server block），或者在已有的默认配置中修改，以设置反向代理。以下是一个基本的Nginx配置示例，将会把所有到 <code>wo.lthero.top</code> 的请求转发到本地的8282端口：</p><ol><li><p>打开或创建一个新的Nginx配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/wo.lthero.top</span><br></pre></td></tr></table></figure></li><li><p>添加以下配置：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> wo.lthero.top;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:3001;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个配置做了以下几点：</p><ul><li><code>listen 80;</code> 告诉Nginx监听80端口（HTTP标准端口）。</li><li><code>server_name wo.lthero.top;</code> 设置这个块应当响应的域名。</li><li><code>proxy_pass http://localhost:8282;</code> 指定所有传入的请求转发到本地的8282端口。</li><li><code>proxy_set_header</code> 指令将重要的HTTP头信息转发给后端应用。</li></ul></li><li><p>启用配置文件通过创建一个符号链接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /etc/nginx/sites-available/wo.lthero.top /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure></li><li><p>检查Nginx配置文件是否有语法错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure></li><li><p>如果没有错误，重启Nginx以应用配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure></li></ol><h2 id="步骤-4-调整防火墙规则">步骤 4: 调整防火墙规则</h2><p>确保你的服务器的防火墙规则允许HTTP（端口80）和HTTPS（端口443，如果你使用SSL）的流量。如果你正在使用<code>ufw</code>，可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow <span class="string">&#x27;Nginx Full&#x27;</span></span><br><span class="line">sudo ufw reload</span><br></pre></td></tr></table></figure><h2 id="步骤-5-测试配置">步骤 5: 测试配置</h2><p>在浏览器中输入 <code>http://wo.lthero.top</code> 或使用命令行工具如 <code>curl</code> 来测试你的配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://wo.lthero.top</span><br></pre></td></tr></table></figure><p>你应该能看到从Docker容器中运行的服务响应的内容。</p><p>这样，你就配置好了Nginx作为反向代理，将域名 <code>wo.lthero.top</code> 的流量转发到宿主机的8282端口上的服务。如果你希望使用HTTPS，你还需要设置SSL证书，可以考虑使用Let’s Encrypt免费证书并配置HTTPS。</p><h1 id="使用https访问">使用HTTPS访问</h1><p>要让你的域名 <code>wo.lthero.top</code> 使用 HTTPS，你需要获取 SSL/TLS 证书，并配置 Nginx 以使用这些证书来加密网页内容。以下是详细的步骤，包括如何使用 Let’s Encrypt 提供的免费证书自动化这个过程。</p><h2 id="步骤-1-安装-certbot">步骤 1: 安装 Certbot</h2><p>Certbot 是一个自动获取并安装 Let’s Encrypt 证书的客户端。在 Ubuntu 上安装 Certbot 及其 Nginx 插件非常简单：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install certbot python3-certbot-nginx -y</span><br></pre></td></tr></table></figure><h2 id="步骤-2-获取和安装证书">步骤 2: 获取和安装证书</h2><p>使用 Certbot 获取并为你的域名安装证书：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx -d wo.lthero.top</span><br></pre></td></tr></table></figure><p>此命令会自动为指定的域名 <code>wo.lthero.top</code> 配置 SSL 证书，并更新 Nginx 配置以使用这些证书。Certbot 会询问你一些问题，比如电子邮件地址（用于紧急联系和证书续订提醒），以及是否重定向所有 HTTP 请求到 HTTPS（强烈建议启用）。</p><p>生成的证书位置<code>/etc/letsencrypt/live/</code></p><h2 id="步骤-3-更新-nginx-配置">步骤 3: 更新 Nginx 配置</h2><p>如果你想手动编辑 Nginx 配置文件，可以按以下方式配置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/wo.lthero.top</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    server_name wo.lthero.top;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://localhost:8282;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection &#x27;upgrade&#x27;;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_cache_bypass $http_upgrade;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    listen 443 ssl; # managed by Certbot</span><br><span class="line">    ssl_certificate /etc/letsencrypt/live/wo.lthero.top/fullchain.pem; # managed by Certbot</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/wo.lthero.top/privkey.pem; # managed by Certbot</span><br><span class="line">    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot</span><br><span class="line">    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    if ($host = wo.lthero.top) &#123;</span><br><span class="line">        return 301 https://$host$request_uri;</span><br><span class="line">    &#125; # managed by Certbot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    listen 80;</span><br><span class="line">    server_name wo.lthero.top;</span><br><span class="line">    return 404; # managed by Certbot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> wo.lthero.top;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$server_name</span><span class="variable">$request_uri</span>;  <span class="comment"># 强制重定向所有 HTTP 请求到 HTTPS</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">server_name</span> wo.lthero.top;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/wo.lthero.top/fullchain.pem;  <span class="comment"># 证书文件路径</span></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/wo.lthero.top/privkey.pem;  <span class="comment"># 私钥文件路径</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">1d</span>;</span><br><span class="line">    <span class="attribute">ssl_session_cache</span> shared:MozSSL:<span class="number">10m</span>;  <span class="comment"># 缓存 SSL 会话以提升性能</span></span><br><span class="line">    <span class="attribute">ssl_session_tickets</span> <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 现代加密套件配置</span></span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> <span class="string">&#x27;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384&#x27;</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 其他 SSL 优化设置</span></span><br><span class="line">    <span class="attribute">ssl_stapling</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_stapling_verify</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 允许最大请求体大小为 1000MB</span></span><br><span class="line">    <span class="attribute">client_max_body_size</span> <span class="number">1000m</span>;  </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:8282;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个配置不仅启用了 HTTPS，还包括了一些现代的安全实践，如启用 HTTP/2，配置加密套件和协议等。</p><blockquote><p>允许最大请求体大小为 1000MB</p><p>client_max_body_size 1000m;</p><p>这行最好与config.js中保持一致，如果<strong>nginx设置小了，会出现“上传失败”的结果！</strong></p></blockquote><h2 id="步骤-4-重新加载-nginx">步骤 4: 重新加载 Nginx</h2><p>启用配置文件通过创建一个符号链接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /etc/nginx/sites-available/wo.lthero.top /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure><p>更改配置后，需要重新加载 Nginx 以应用新的配置：</p><blockquote><p>检查配置文件是否有语法错误，如果有warn!直接看“遇到的问题”部分，重新加载配置是不一定能work的</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t  <span class="comment"># 检查配置文件是否有语法错误</span></span><br><span class="line">sudo systemctl reload nginx  <span class="comment"># 重新加载配置</span></span><br><span class="line"><span class="comment"># 如果重新加载配置后无效，可以尝试重启nginx</span></span><br><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure><h2 id="步骤-5-验证-https">步骤 5: 验证 HTTPS</h2><p>在浏览器中访问 <code>https://wo.lthero.top</code> 来检查是否配置成功。你应该能够看到一个安全锁标志，表明连接是通过 HTTPS 加密的。</p><h2 id="步骤-6-自动续订证书">步骤 6: 自动续订证书</h2><p>Let’s Encrypt 的证书有效期为90天，因此建议设置自动续订：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew</span><br></pre></td></tr></table></figure><p>这个命令会测试证书续订过程。如果这个测试成功，添加定时任务<code>crontab</code>：</p><p><code>crontab -e</code>再填写下面内容，表示每月第一天会自动执行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 * * /usr/local/bin/certbot renew --deploy-hook <span class="string">&quot;nginx -s reload&quot;</span></span><br></pre></td></tr></table></figure><p>通过<code>which certbot</code>查看具体程序位置<code>/usr/local/bin/certbot</code></p><p>续签的证书位置<code>/etc/letsencrypt/renewal</code></p><p>通过以上步骤，你的站点 <code>wo.lthero.top</code> 现在应该能够安全地使用 HTTPS 进行通信了。</p><p>如果要换crontab编辑器，运行下面的命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select-editor</span><br></pre></td></tr></table></figure><h2 id="解析到阿里云dns的申请方法">解析到阿里云DNS的申请方法</h2><blockquote><p>如果域名解析在阿里云，可以安装这个插件从而完成证书申请，<a href="https://github.com/tengattack/certbot-dns-aliyun">https://github.com/tengattack/certbot-dns-aliyun</a></p></blockquote><h3 id="credentials-file">Credentials File</h3><p>在某个熟悉的目录下，把下面的内容写入<code>credentials.ini</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dns_aliyun_access_key = 12345678</span><br><span class="line">dns_aliyun_access_key_secret = 1234567890abcdef1234567890abcdef</span><br></pre></td></tr></table></figure><p>dns_aliyun_access_key是阿里云账号的AccessKey ID</p><p>dns_aliyun_access_key_secret是阿里云账号的AccessKey Secret</p><p>这两个值可以在阿里云控制台-&gt;用户头像-&gt;accesskeys按指引获取AccessKey/SecretKey</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 600 /path/to/credentials.ini</span><br></pre></td></tr></table></figure><h3 id="obtain-certificates">Obtain Certificates</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">certbot certonly \</span><br><span class="line">    --authenticator=dns-aliyun \</span><br><span class="line">    --dns-aliyun-credentials=<span class="string">&#x27;/path/to/credentials.ini&#x27;</span> \</span><br><span class="line">    -d <span class="string">&quot;*.example.com,example.com&quot;</span></span><br></pre></td></tr></table></figure><p>申请下来的证书位置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/letsencrypt/archive/</span><br></pre></td></tr></table></figure><p>适合阿里云的自动命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 * * /usr/local/bin/certbot renew --manual --preferred-challenges dns --manual-auth-hook <span class="string">&quot;alidns&quot;</span> --manual-cleanup-hook <span class="string">&quot;alidns clean&quot;</span> --deploy-hook <span class="string">&quot;nginx -s reload&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;wallos&quot;&gt;Wallos&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;提供订阅服务的统计&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;项目安装&quot;&gt;项目安装&lt;/h1&gt;
&lt;p&gt;创建目录，为了将数据库长期保存在本地&lt;/p&gt;
&lt;figure class=&quot;hig</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
  </entry>
  
  <entry>
    <title>【流媒体一键解锁脚本】</title>
    <link href="https://blog.lthero.cn/2024/12/01/SniproxySmartdnsInstaller/"/>
    <id>https://blog.lthero.cn/2024/12/01/SniproxySmartdnsInstaller/</id>
    <published>2024-12-01T09:54:42.000Z</published>
    <updated>2024-12-01T14:37:10.239Z</updated>
    
    <content type="html"><![CDATA[<h1 id="sniproxy-smartdns-一键配置脚本">sniproxy &amp; smartdns 一键配置脚本</h1><blockquote><p>开源项目：<a href="https://github.com/lthero-big/Smartdns_sniproxy_installer">https://github.com/lthero-big/Smartdns_sniproxy_installer</a></p></blockquote><h2 id="写在前面">写在前面</h2><p>最近黑五，买了一些机器，但机器解锁不太满意啊，于是在论坛四处找教程，最近东拼四凑出了这个脚本；</p><p>现有脚本的痛点：</p><p>1、不能方便的配置流媒体平台，sniproxy和smartdns的配置都需要手动修改，而且添加DNS机器也需要手动配置，有点儿麻烦；<br>2、大多是使用dnsmasq和sniproxy结合的脚本，没有smartdns的。</p><h3 id="知识">知识</h3><p>sniproxy：一个透明代理，反向代理流媒体网站（如Netflix），80和443端口不得被占用，且需要开放</p><p>smartdns：一个DNS服务器，用来分流DNS域名是否走sniproxy代理</p><h3 id="必要准备">必要准备</h3><ol><li>一台或多台能解锁流媒体的vps，<strong>简称“解锁机”</strong></li><li>没有vps的可以使用免费或付费的dns解锁服务，请注册Alice免费的DNS解锁服务<a href="https://app.alice.ws/">Alice</a></li><li>一台或多台不能解锁流媒体的vps，<strong>简称“被解锁机”</strong></li></ol><h3 id="实现效果">实现效果</h3><ol><li>让一台vps同时解锁多个地区的流媒体（美国、新加坡、日本、香港）</li><li>实现使用一个节点，同时解锁香港b站，美国油管，新加坡网飞以及日本HBO等</li></ol><p><img src="https://cdn.lthero.cn/post_images/course/ML/PixPin_2024-12-01_16-55-49.png" alt="PixPin_2024-12-01_16-55-49"></p><ol start="3"><li>快速添加不同地区</li></ol><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241201195650422.png" alt="image-20241201195650422"></p><h3 id="参考项目">参考项目</h3><ol><li><a href="https://github.com/myxuchangbin/dnsmasq_sniproxy_install">https://github.com/myxuchangbin/dnsmasq_sniproxy_install</a></li><li><a href="https://github.com/bingotl/dns_unlock">https://github.com/bingotl/dns_unlock</a></li><li><a href="https://github.com/Jimmyzxk/DNS-Alice-Unlock">https://github.com/Jimmyzxk/DNS-Alice-Unlock</a></li><li><a href="https://www.nodeseek.com/post-180592-1">https://www.nodeseek.com/post-180592-1</a></li></ol><h3 id="优点">优点</h3><ol><li>smartdns 拥有更快查询和更强的广告过滤等功能</li><li>快速添加您想解锁的地区，一键配置，一键修改，不用再使用复杂的编辑功能</li><li>快速配置您想添加的解锁机服务器，方便修改</li><li>解锁机哪怕宕机也不影响被解锁机正常使用</li></ol><hr><h2 id="脚本下载与安装">脚本下载与安装</h2><h3 id="脚本下载">脚本下载</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/lthero-big/Smartdns_sniproxy_installer/refs/heads/main/smtdns_install.sh -O smtdns_install.sh </span><br></pre></td></tr></table></figure><p>脚本将保存在本地 ，命名为smtdns_install.sh ，您可以随时执行</p><h3 id="脚本执行">脚本执行</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash smtdns_install.sh</span><br></pre></td></tr></table></figure><hr><h2 id="阅读顺序">阅读顺序</h2><blockquote><p>如果您不想配置解锁机，请注册Alice免费的DNS解锁服务<a href="https://app.alice.ws/">Alice</a>，申请DNS解锁。随后，请阅读“被解锁机”篇章，使用<code>nameserver</code>添加DNS服务器。</p><p>如果您有自己的解锁机，可以先阅读“解锁机”篇章，配置自己的解锁机，随后使用<code>address</code>添加DNS服务器。</p></blockquote><hr><h2 id="被解锁机">被解锁机</h2><h3 id="功能解释">功能解释</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-----------被解锁机--------------</span><br><span class="line">1.  安装 SmartDNS</span><br><span class="line">2.  重新配置 SmartDNS</span><br><span class="line">3.  添加上游 DNS 并分组</span><br><span class="line">4.  查看已配置的上游 DNS 组</span><br><span class="line">5.  查看流媒体平台列表</span><br><span class="line">6.  添加一家流媒体平台到 SmartDNS</span><br><span class="line">7.  添加一个地区流媒体到 SmartDNS</span><br><span class="line">8.  添加所有流媒体平台到 SmartDNS</span><br><span class="line">9.  查看已经添加的流媒体</span><br></pre></td></tr></table></figure><ol><li>输入1，安装smartdns；随后会询问<strong>是否添加上游DNS并分级</strong><ol><li>如果你已经有Alice的解锁服务，或者您自建了DNS服务器，直接输入<code>y</code>；</li><li>随后，会被邀请输入<strong>上游服务器ip地址</strong>，以及给它<strong>命名</strong>，简短即可方便区分<ol><li>假设输入了<code>12.23.34.45</code>，命令为<code>alice-hk</code></li></ol></li><li>直到输入<code>N</code>，完成smartdns的初始配置</li></ol></li><li>输入2，会删除已有的smartdns配置，并重新创建</li><li>输入3，会继续添加上游 DNS</li><li>输入6/7/8，添加流媒体平台（注意是一家，一地区，还是所有平台）<ol><li>假设输入7，想将香港地区的流媒体，都让<code>alice-hk</code>解锁</li><li>请输入<code>nameserver/address</code>，如果使用Alice解锁服务，选择<code>nameserver</code></li><li>直到输入<code>N</code>，完成地区的添加</li></ol></li><li>输入9，查看已经添加的流媒体及对应的解锁服务器</li></ol><h3 id="关于nameserver与address选择">关于nameserver与address选择</h3><ol><li><p>如果使用Alice解锁服务，选择nameserver</p></li><li><p>如果自建的解锁机运行了smartdns，选择address</p></li><li><p>如果自建的解锁机不运行smartdns，选择address</p></li></ol><h3 id="快速上手">快速上手</h3><p>第一步：输入1，安装smartdns；随后会询问<strong>是否添加上游DNS并分级</strong></p><ol><li>如果你已经有Alice的解锁服务，或者您自建了DNS服务器，直接输入<code>y</code>；</li><li>随后，会被邀请输入<strong>上游服务器ip地址</strong>，以及给它<strong>命名</strong>，简短即可方便区分<ol><li>假设输入了<code>12.23.34.45</code>，命令为<code>alice-hk</code></li></ol></li><li>直到输入<code>N</code>，完成smartdns的初始配置</li></ol><p>第二步：输入6/7/8，添加流媒体平台（注意是一家，一地区，还是所有平台）</p><ol><li>假设输入7，如果使用Alice解锁服务，想将香港地区的流媒体都让<code>alice-hk</code>解锁，选择<code>nameserver</code></li><li>直到输入<code>N</code>，完成地区的添加</li></ol><p><strong>确保smartdns服务启动了即可</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SmartDNS 服务状态：运行中</span><br><span class="line">SmartDNS 开机自启：已启用</span><br><span class="line">system DNS 服务状态：已停止</span><br><span class="line">system DNS 开机自启：未启用</span><br><span class="line">sniproxy 服务状态：已停止</span><br><span class="line">sniproxy 开机自启：未启用</span><br></pre></td></tr></table></figure><hr><h2 id="解锁机">解锁机</h2><h3 id="功能解释">功能解释</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-----------sniproxy相关(解锁机)--------------</span><br><span class="line">11.  安装并启动 sniproxy</span><br><span class="line">12.  添加流媒体平台到 sniproxy</span><br><span class="line">13.  启动/重启 sniproxy 服务并开机自启</span><br><span class="line">14.  停止 sniproxy 并关闭开机自启</span><br><span class="line">15.  一键对被解锁机放开 80/443/53 端口 </span><br><span class="line">16.  一键开启指定 防火墙(ufw) 端口 </span><br></pre></td></tr></table></figure><ol><li>输入11，会安装sniproxy并一键添加一些常用的流媒体平台（不会包含所有的）</li><li>输入12：添加想要的流媒体平台到 sniproxy，与上面一样，可以选择添加一个平台或一个地区的平台</li><li>输入13/14：控制sniproxy服务</li><li>输入15：<strong>必做</strong>，防止被他人利用，需要添加对<strong>被解锁机</strong>的访问权限</li><li>输入16：额外功能，开启某个防火墙端口</li></ol><h3 id="快速上手">快速上手</h3><p>第一步：输入15，添加对<strong>被解锁机</strong>的访问权限，需要输入<strong>被解锁机的ip</strong>即可</p><p>第二步：输入11，会安装sniproxy并一键添加一些常用的流媒体平台</p><p>第三步：输入12：添加想要的流媒体平台到 sniproxy；如果你的机器是美国机，则可以添加美国的流媒体服务到sniproxy中，sniproxy会自动重启；</p><p><strong>确保 sniproxy 服务启动即可</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SmartDNS 服务状态：已停止</span><br><span class="line">SmartDNS 开机自启：未启用</span><br><span class="line">system DNS 服务状态：运行中</span><br><span class="line">system DNS 开机自启：已启用</span><br><span class="line">sniproxy 服务状态：运行中</span><br><span class="line">sniproxy 开机自启：已启用</span><br></pre></td></tr></table></figure><hr><h2 id="高级玩家">高级玩家</h2><p>前面只让smartDNS运行在了被解锁机上，当然，smartdns可以运行在解锁机上，从而实现<strong>嵌套解锁</strong>。</p><p><strong>嵌套解锁</strong>：将上游的DNS服务器指向DNS商家提供的服务器，从而让解锁机下游的服务器都能享受DNS商家提供的解锁权益（可能会违反商家的规则）</p><p>本脚本当然可以使用在解锁机上，下面是解锁机的smartdns配置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">server 13.23.33.43 IP -group sg -exclude-default-group</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果解锁机使用解锁机IP，则下游的被解锁机网飞会定位为解锁机的ip（如美国）</span></span><br><span class="line">address /netflix.com/xx.xx.xx.xx</span><br><span class="line">address /netflix.net/xx.xx.xx.xx</span><br><span class="line">address /nflximg.com/xx.xx.xx.xx</span><br><span class="line">address /nflximg.net/xx.xx.xx.xx</span><br><span class="line">address /nflxvideo.net/xx.xx.xx.xx</span><br><span class="line">address /nflxext.com/xx.xx.xx.xx</span><br><span class="line">address /nflxso.net/xx.xx.xx.xx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#&gt; 如果解锁机使用上游的DNS商家提供的IP，则下游的被解锁机网飞会定位为上游ip（如新加坡）</span></span><br><span class="line">nameserver /netflix.com/sg</span><br><span class="line">nameserver /netflix.net/sg</span><br><span class="line">nameserver /nflximg.com/sg</span><br><span class="line">nameserver /nflximg.net/sg</span><br><span class="line">nameserver /nflxvideo.net/sg</span><br><span class="line">nameserver /nflxext.com/sg</span><br><span class="line">nameserver /nflxso.net/sg</span><br></pre></td></tr></table></figure><h1 id="nginx-smartdns">Nginx+smartDNS</h1><blockquote><p><a href="https://xcel.me/unlock_netflix_with_nginx_and_dnsmasq/">https://xcel.me/unlock_netflix_with_nginx_and_dnsmasq/</a></p></blockquote><p>说到反代，nginx也能拿来做这事儿，而且好处是443和80端口可以被继续使用</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;sniproxy-smartdns-一键配置脚本&quot;&gt;sniproxy &amp;amp; smartdns 一键配置脚本&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;开源项目：&lt;a href=&quot;https://github.com/lthero-big/Smartdns_s</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
    <category term="流媒体解锁" scheme="https://blog.lthero.cn/tags/%E6%B5%81%E5%AA%92%E4%BD%93%E8%A7%A3%E9%94%81/"/>
    
  </entry>
  
  <entry>
    <title>【DNS】流媒体解锁</title>
    <link href="https://blog.lthero.cn/2024/11/29/UnlockNetflixWithDNS/"/>
    <id>https://blog.lthero.cn/2024/11/29/UnlockNetflixWithDNS/</id>
    <published>2024-11-29T13:39:07.000Z</published>
    <updated>2024-12-01T05:04:46.468Z</updated>
    
    <content type="html"><![CDATA[<h1 id="自动-流媒体一键修改解锁dns脚本">自动-流媒体一键修改解锁DNS脚本</h1><p><strong>支持操作系统</strong>: Debian &amp; Ubuntu</p><h2 id="项目简介">项目简介</h2><p>该脚本旨在帮助用户通过 <strong>流媒体解锁 DNS</strong> 实现快速的 DNS 分流与全局 DNS 替换。只需简单的几个步骤，即可轻松配置与解锁 DNS。适用于 VPS 用户，支持一键配置，无需复杂设置。</p><h2 id="使用指南">使用指南</h2><h4 id="步骤-1-注册-alice-账号-适用于没有解锁dns-ip的用户">步骤 1: 注册 Alice 账号(适用于没有解锁DNS IP的用户)</h4><ol><li><p>访问 <a href="https://www.nodeseek.com/jump?to=https%3A%2F%2Fapp.alice.ws">Alice DNS 官网</a> 进行注册（官方的解锁教程：<a href="https://blog.alice.ws/16%EF%BC%89">https://blog.alice.ws/16）</a></p></li><li><p>在注册后，将您的 VPS IP 地址添加至 Alice 白名单。</p><blockquote><p><strong>注意</strong>：此过程可能需要 3-5 分钟生效。</p></blockquote></li></ol><h4 id="步骤-2-运行一键分流脚本">步骤 2: 运行一键分流脚本</h4><ol><li><p>下载并运行以下脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/Jimmyzxk/DNS-Alice-Unlock/refs/heads/main/dns-unlock.sh &amp;&amp; bash dns-unlock.sh</span><br></pre></td></tr></table></figure></li></ol><hr><p>运行之前，要确保53端口没被占用</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看53端口是否被占用</span></span><br><span class="line">sudo netstat -tulnp | grep :53</span><br><span class="line"><span class="comment"># 关掉resolved</span></span><br><span class="line">sudo systemctl stop systemd-resolved</span><br><span class="line"><span class="comment"># 禁止开机自启resolved</span></span><br><span class="line">sudo systemctl <span class="built_in">disable</span> systemd-resolved</span><br></pre></td></tr></table></figure><h4 id="解锁方式-1-1：dns-分流模式-dnsmasq">解锁方式 1-1：DNS 分流模式(dnsmasq)</h4><ol><li>在脚本菜单中选择 <code>1</code>。</li><li>脚本将自动安装并配置 <code>dnsmasq</code>，实现多媒体流量的智能分流。</li><li>安装过程中会提示是否输入个人解锁IP，回车默认Alice,IP，输入y，填写个人解锁IP 。<ul><li><strong>适用场景</strong>：优化流媒体（如 Netflix、Disney等）访问体验，确保内容加载更快，解锁区域内容。</li></ul></li></ol><h4 id="选择分流区域-sg-hk">选择分流区域（SG / HK）</h4><ol><li><p>在脚本菜单中选择 <code>3</code>，进入分流区域选择界面。</p></li><li><p>脚本支持自助选择</p><p>SG（新加坡）或HK（香港）</p><p>区域进行分流优化。</p><ul><li><strong>SG（新加坡）</strong>：适用于连接东南亚地区的用户，提供更优的路由和速度。</li><li><strong>HK（香港）</strong>：适用于连接香港及周边地区的用户，提供稳定且快速的网络连接。</li><li>选择完毕后，脚本将根据选择的区域配置合适的分流策略。</li></ul></li></ol><hr><h4 id="解锁方式-1-2：dns-分流模式-smartdns">解锁方式 1-2：DNS 分流模式（smartdns）</h4><ol><li><p>在脚本菜单中选择 <code>2-1</code>。</p></li><li><p>按照提示是否替换为个人解锁DNSIP，IP1/2可同一个；</p></li><li><p>脚本将自动安装并配置smartdns，实现多媒体流量的智能分流。</p><ul><li><strong>适用场景</strong>：优化流媒体（如 Netflix、Disney等）访问体验，确保内容加载更快，解锁区域内容。</li></ul></li></ol><hr><h4 id="解锁方式-2：全局-dns-替换模式">解锁方式 2：全局 DNS 替换模式</h4><ol><li>在脚本菜单中选择 <code>3-3</code>。</li><li>输入自己的解锁IP，一键替换，并锁定resolv.conf文件。<ul><li><strong>适用场景</strong>：需要整体优化网络解析速度，提升所有已解锁自媒体请求。</li></ul></li></ol><h3 id="配置文件参考">配置文件参考</h3><p>下面是<code>/etc/dnsmasq.conf</code>，里面包含了不同流媒体解锁的配置文件，将1.2.1.2修改成对应的DNS解锁机ip即可</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 禁用读取 /etc/resolv.conf</span></span><br><span class="line">no-resolv</span><br><span class="line"><span class="comment"># 设置默认的上游 DNS</span></span><br><span class="line">server=1.0.0.1 <span class="comment"># 主 DNS，Cloudfare Public DNS</span></span><br><span class="line">server=8.8.8.8 <span class="comment"># 备用 DNS，Google Public DNS</span></span><br><span class="line">cache-size=2048</span><br><span class="line">local-ttl=60</span><br><span class="line">listen-address=127.0.0.1</span><br><span class="line"><span class="comment"># Netflix 专用 DNS</span></span><br><span class="line">server=/netflix.ca/1.2.1.2</span><br><span class="line">server=/netflix.com/1.2.1.2</span><br><span class="line">server=/netflix.net/1.2.1.2</span><br><span class="line">server=/netflixinvestor.com/1.2.1.2</span><br><span class="line">server=/netflixtechblog.com/1.2.1.2</span><br><span class="line">server=/nflxext.com/1.2.1.2</span><br><span class="line">server=/nflximg.com/1.2.1.2</span><br><span class="line">server=/nflximg.net/1.2.1.2</span><br><span class="line">server=/nflxsearch.net/1.2.1.2</span><br><span class="line">server=/nflxso.net/1.2.1.2</span><br><span class="line">server=/nflxvideo.net/1.2.1.2</span><br><span class="line">server=/netflixdnstest0.com/1.2.1.2</span><br><span class="line">server=/netflixdnstest1.com/1.2.1.2</span><br><span class="line">server=/netflixdnstest2.com/1.2.1.2</span><br><span class="line">server=/netflixdnstest3.com/1.2.1.2</span><br><span class="line">server=/netflixdnstest4.com/1.2.1.2</span><br><span class="line">server=/netflixdnstest5.com/1.2.1.2</span><br><span class="line">server=/netflixdnstest6.com/1.2.1.2</span><br><span class="line">server=/netflixdnstest7.com/1.2.1.2</span><br><span class="line">server=/netflixdnstest8.com/1.2.1.2</span><br><span class="line">server=/netflixdnstest9.com/1.2.1.2</span><br><span class="line">server=/cinemax.com/1.2.1.2</span><br><span class="line">server=/forthethrone.com/1.2.1.2</span><br><span class="line"><span class="comment"># HBO DNS解锁</span></span><br><span class="line">server=/hbo.com/1.2.1.2</span><br><span class="line">server=/hboasia.com/1.2.1.2</span><br><span class="line">server=/hbogo.com/1.2.1.2</span><br><span class="line">server=/hbogoasia.com/1.2.1.2</span><br><span class="line">server=/hbogoasia.hk/1.2.1.2</span><br><span class="line">server=/hbomax.com/1.2.1.2</span><br><span class="line">server=/hbonow.com/1.2.1.2</span><br><span class="line">server=/maxgo.com/1.2.1.2</span><br><span class="line">server=/max.com/1.2.1.2</span><br><span class="line">server=/discomax.com/1.2.1.2</span><br><span class="line"><span class="comment"># Hoy DNS解锁</span></span><br><span class="line">server=/hoy.tv/1.2.1.2</span><br><span class="line"><span class="comment"># Bahamut Anime解锁</span></span><br><span class="line">server=/bahamut.com.tw/1.2.1.2</span><br><span class="line">server=/gamer.com.tw/1.2.1.2</span><br><span class="line">server=/gamer-cds.cdn.hinet.net/1.2.1.2</span><br><span class="line">server=/gamer2-cds.cdn.hinet.net/1.2.1.2</span><br><span class="line"><span class="comment"># Disney DNS解锁</span></span><br><span class="line">server=/disney.com/1.2.1.2</span><br><span class="line">server=/disneyjunior.com/1.2.1.2</span><br><span class="line">server=/disneyplus.com/1.2.1.2</span><br><span class="line">server=/bamgrid.com/1.2.1.2</span><br><span class="line"><span class="comment"># ChatGPT DNS解锁</span></span><br><span class="line">server=/openai.com/1.2.1.2</span><br><span class="line">server=/chatgpt.com/1.2.1.2</span><br><span class="line">server=/chat.com/1.2.1.2</span><br><span class="line">server=/oaistatic.com/1.2.1.2</span><br><span class="line">server=/oaiusercontent.com/1.2.1.2</span><br><span class="line">server=/chat.comopenai.com.cdn.cloudflare.net/1.2.1.2</span><br><span class="line">server=/openaiapi-site.azureedge.net/1.2.1.2</span><br><span class="line">server=/openaicom-api-bdcpf8c6d2e9atf6.z01.azurefd.net/1.2.1.2</span><br><span class="line">server=/openaicomproductionae4b.blob.core.windows.net/1.2.1.2</span><br><span class="line">server=/production-openaicom-storage.azureedge.net/1.2.1.2</span><br><span class="line">server=/byteoversea.com/1.2.1.2</span><br><span class="line">server=/ibytedtos.com/1.2.1.2</span><br><span class="line">server=/ipstatp.com/1.2.1.2</span><br><span class="line">server=/muscdn.com/1.2.1.2</span><br><span class="line">server=/musical.ly/1.2.1.2</span><br><span class="line"><span class="comment"># tiktok DNS解锁</span></span><br><span class="line">server=/tik-tokapi.com/1.2.1.2</span><br><span class="line">server=/tiktok.com/1.2.1.2</span><br><span class="line">server=/tiktokcdn.com/1.2.1.2</span><br><span class="line">server=/tiktokv.com/1.2.1.2</span><br><span class="line">server=/ggpht.cn/1.2.1.2</span><br><span class="line">server=/ggpht.com/1.2.1.2</span><br><span class="line">server=/googlevideo.com/1.2.1.2</span><br><span class="line">server=/gvt2.com/1.2.1.2</span><br><span class="line"><span class="comment"># Youtube DNS解锁</span></span><br><span class="line">server=/withyoutube.com/1.2.1.2</span><br><span class="line">server=/youtube-nocookie.com/1.2.1.2</span><br><span class="line">server=/youtube.com/1.2.1.2</span><br><span class="line">server=/youtubeeducation.com/1.2.1.2</span><br><span class="line">server=/youtubefanfest.com/1.2.1.2</span><br><span class="line">server=/youtubegaming.com/1.2.1.2</span><br><span class="line">server=/youtubego.com/1.2.1.2</span><br><span class="line">server=/youtubei.googleapis.com/1.2.1.2</span><br><span class="line">server=/youtubekids.com/1.2.1.2</span><br><span class="line">server=/youtubemobilesupport.com/1.2.1.2</span><br><span class="line">server=/ytimg.com/1.2.1.2</span><br><span class="line"><span class="comment"># Spotify DNS解锁</span></span><br><span class="line">server=/audio4-ak-spotify-com.akamaized.net/1.2.1.2</span><br><span class="line">server=/dn-spotify-experiments.conductrics.com/1.2.1.2</span><br><span class="line">server=/heads-ak-spotify-com.akamaized.net/1.2.1.2</span><br><span class="line">server=/spotify.com.edgesuite.net/1.2.1.2</span><br><span class="line">server=/spotify.map.fastly.net/1.2.1.2</span><br><span class="line">server=/spotify.map.fastlylb.net/1.2.1.2</span><br><span class="line">server=/audio-ak-spotify-com.akamaized.net/1.2.1.2</span><br><span class="line">server=/byspotify.com/1.2.1.2</span><br><span class="line">server=/heads4-ak-spotify-com.akamaized.net/1.2.1.2</span><br><span class="line">server=/pscdn.co/1.2.1.2</span><br><span class="line">server=/scdn.co/1.2.1.2</span><br><span class="line">server=/spoti.fi/1.2.1.2</span><br><span class="line">server=/spotify-com.akamaized.net/1.2.1.2</span><br><span class="line">server=/spotify-everywhere.com/1.2.1.2</span><br><span class="line">server=/spotify.com/1.2.1.2</span><br><span class="line">server=/spotify.design/1.2.1.2</span><br><span class="line">server=/spotifycdn.com/1.2.1.2</span><br><span class="line">server=/spotifycdn.net,Spotify/1.2.1.2</span><br><span class="line">server=/spotifycharts.com/1.2.1.2</span><br><span class="line">server=/spotifycodes.com/1.2.1.2</span><br><span class="line">server=/spotifyforbrands.com/1.2.1.2</span><br><span class="line">server=/spotifyjobs.com/1.2.1.2</span><br><span class="line">server=/spotifynewsroom.jp/1.2.1.2</span><br><span class="line">server=/spotilocal.com/1.2.1.2</span><br><span class="line">server=/tospotify.com/1.2.1.2</span><br><span class="line"><span class="comment"># Hotstar DNS解锁</span></span><br><span class="line">server=/hotstar-cdn.net/1.2.1.2</span><br><span class="line">server=/hotstar-labs.com/1.2.1.2</span><br><span class="line">server=/hotstar.com/1.2.1.2</span><br><span class="line">server=/hotstarext.com/1.2.1.2</span><br><span class="line">server=/hsprepack.akamaized.net/1.2.1.2</span><br><span class="line">server=/js-agent.newrelic.com/1.2.1.2</span><br><span class="line"><span class="comment"># MyTVSuper DNS解锁</span></span><br><span class="line">server=/mytvsuper.com/1.2.1.2</span><br><span class="line">server=/mytvsuperlimited.hb.omtrdc.net/1.2.1.2</span><br><span class="line">server=/mytvsuperlimited.sc.omtrdc.net/1.2.1.2</span><br><span class="line">server=/tvb.com/1.2.1.2</span><br><span class="line"><span class="comment"># Gemini DNS解锁</span></span><br><span class="line">server=/gemini.google.com/1.2.1.2</span><br><span class="line">server=/proactivebackend-pa.googleapis.com/1.2.1.2</span><br><span class="line">server=/alkalimakersuite-pa.clients6.google.com/1.2.1.2</span><br><span class="line">server=/aistudio.google.com/1.2.1.2</span><br><span class="line">server=/generativelanguage.googleapis.com/1.2.1.2</span><br><span class="line"><span class="comment"># bilibili DNS解锁 HK</span></span><br><span class="line">server=/bilibili.tv/1.2.1.2</span><br><span class="line">server=/www.bilibili.com/1.2.1.2</span><br><span class="line">server=/cm.bilibili.com/1.2.1.2</span><br><span class="line">server=/api.bilibili.com/1.2.1.2</span><br><span class="line">server=/api.vc.bilibili.com/1.2.1.2</span><br><span class="line">server=/api.live.bilibili.com/1.2.1.2</span><br><span class="line">server=/passport.bilibili.com/1.2.1.2</span><br><span class="line">server=/data.bilibili.com/1.2.1.2</span><br><span class="line">server=/broadcast.chat.bilibili.com/1.2.1.2</span><br><span class="line">server=/upos-hz-mirrorakam.akamaized.net/1.2.1.2</span><br><span class="line">server=/bangumi.bilibili.com/1.2.1.2</span><br><span class="line">server=/manga.bilibili.com/1.2.1.2</span><br><span class="line"><span class="comment"># VIU.TV DNS解锁 HK</span></span><br><span class="line">server=/viu.now.com/1.2.1.2</span><br><span class="line">server=/viu.tv/1.2.1.2</span><br><span class="line">server=/cognito-identity.us-east-1.amazonaws.com/1.2.1.2</span><br><span class="line">server=/d1k2us671qcoau.cloudfront.net/1.2.1.2</span><br><span class="line">server=/d2anahhhmp1ffz.cloudfront.net/1.2.1.2</span><br><span class="line">server=/dfp6rglgjqszk.cloudfront.net/1.2.1.2</span><br><span class="line">server=/d3o7oi00quuwqu.cloudfront.net/1.2.1.2</span><br><span class="line">server=/mobileanalytics.us-east-1.amazonaws.com/1.2.1.2</span><br><span class="line">server=/viu.com/1.2.1.2</span><br><span class="line"><span class="comment"># DAZN DNS解锁 SG</span></span><br><span class="line">server=/dazn-api.com/1.2.1.2</span><br><span class="line">server=/dazn.com/1.2.1.2</span><br><span class="line">server=/dazndn.com/1.2.1.2</span><br><span class="line">server=/indazn.com/1.2.1.2</span><br><span class="line">server=/d1sgwhnao7452x.cloudfront.net/1.2.1.2</span><br><span class="line">server=/dcalivedazn.akamaized.net/1.2.1.2</span><br><span class="line">server=/dcblivedazn.akamaized.net/1.2.1.2</span><br><span class="line">server=/d151l6v8er5bdm.cloudfront.net/1.2.1.2</span><br><span class="line">server=/control.kochava.com/1.2.1.2</span><br><span class="line">server=/dc2-vodhls-perform.secure.footprint.net/1.2.1.2</span><br><span class="line">server=/dca-ll-livedazn-dznlivejp.s.llnwi.net/1.2.1.2</span><br><span class="line">server=/indaznlab.com/1.2.1.2</span><br><span class="line">server=/intercom.io/1.2.1.2</span><br><span class="line">server=/logx.optimizely.com/1.2.1.2</span><br><span class="line">server=/s.yimg.jp/1.2.1.2</span><br><span class="line">server=/sentry.io/1.2.1.2</span><br><span class="line"><span class="comment"># Now E DNS解锁 HK</span></span><br><span class="line">server=/nowe.com/1.2.1.2</span><br><span class="line">server=/nowestatic.com/1.2.1.2</span><br><span class="line">server=/now.com/1.2.1.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; NBA TV</span></span><br><span class="line">server=/nba.com/1.2.1.2</span><br><span class="line">server=/neulion-a.akamaihd.net/1.2.1.2</span><br><span class="line">server=/nlnbamdnyc-a.akamaihd.net/1.2.1.2</span><br><span class="line">server=/sdk.iad-03.braze.com/1.2.1.2</span><br><span class="line">server=/nbaprop.sc.omtrdc.net/1.2.1.2</span><br><span class="line">server=/nlnbaqos.neulion.com/1.2.1.2</span><br><span class="line">server=/watchnba.cdnfastly.endeavorstreaming.net/1.2.1.2</span><br><span class="line">server=/nbaapi.neulion.com/1.2.1.2</span><br><span class="line">server=/nba-api-cdn.opin.media/1.2.1.2</span><br><span class="line">server=/neulionqos-a.akamaihd.net/1.2.1.2</span><br><span class="line">server=/neulion.com/1.2.1.2</span><br><span class="line">server=/nbaprop.tt.omtrdc.net/1.2.1.2</span><br><span class="line">server=/lion-nba-msl.akamaized.net/1.2.1.2</span><br><span class="line">server=/nbanlds19vod.akamaized.net/1.2.1.2</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="手动-利用sni代理和smartdns自建dns解锁">手动-利用sni代理和smartdns自建DNS解锁</h1><blockquote><p>参考项目：<a href="https://github.com/myxuchangbin/dnsmasq_sniproxy_install">https://github.com/myxuchangbin/dnsmasq_sniproxy_install</a></p><p>视频教程：<a href="https://youtu.be/Vj4TGd9IaQc?t=682">https://youtu.be/Vj4TGd9IaQc?t=682</a></p></blockquote><h2 id="写在前面">写在前面</h2><p>为实现自建DNS解锁可以采取两种办法：</p><p>第一种<strong>建立私人DNS服务器</strong>，适用于<strong>多台服务器</strong>需要解锁的应用场景</p><p>第二种直接在<strong>被解锁服务器</strong>设置解锁，适用于<strong>单个服务器</strong>需要解锁的应用场景</p><table><thead><tr><th></th><th>方案一</th><th>方案二</th></tr></thead><tbody><tr><td>解锁机搭建sni代理</td><td>√</td><td>√</td></tr><tr><td>解锁机搭建DNS服务器</td><td>√</td><td>×</td></tr><tr><td>被解锁机本地设置</td><td>仅需修改系统DNS</td><td>需要在所有被解锁机搭建smartdns</td></tr><tr><td>灵活性</td><td>快捷</td><td>较为复杂</td></tr><tr><td>可靠性</td><td>自建DNS服务器宕机，本地DNS瘫痪</td><td>自建DNS服务器宕机，本地DNS正常</td></tr><tr><td>应用场景</td><td>多台服务器</td><td>单台服务器</td></tr></tbody></table><p><strong>本文之所以选择用smartdns取代Dnsmasq，在于smartdns 无论是在查询速度、查询到的IP访问速度和广告过滤都强于Dnsmasq。</strong></p><h2 id="必备内容">必备内容</h2><p>1台解锁流媒体的服务器（53,443和80端口都不能被占用）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看80端口是否被占用</span></span><br><span class="line">sudo netstat -tulnp | grep :80</span><br><span class="line"><span class="comment"># 关掉nginx</span></span><br><span class="line">sudo systemctl stop nginx</span><br><span class="line"><span class="comment"># 禁止开机自启nginx</span></span><br><span class="line">sudo systemctl <span class="built_in">disable</span> nginx</span><br></pre></td></tr></table></figure><h2 id="sni-proxy搭建">SNI Proxy搭建</h2><p>由于存在两种实现方法，教程除了sni代理为统一步骤外，其余部分因差异性将分开阐述，sni为反向代理工具</p><h3 id="解锁机-安装sni-proxy">解锁机:安装SNI Proxy</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate -O dnsmasq_sniproxy.sh https://raw.githubusercontent.com/myxuchangbin/dnsmasq_sniproxy_install/master/dnsmasq_sniproxy.sh </span><br></pre></td></tr></table></figure><h3 id="解锁机-运行sni-proxy">解锁机:运行SNI Proxy</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">使用方法：bash dnsmasq_sniproxy.sh [-h] [-i] [-f] [-<span class="built_in">id</span>] [-fd] [-is] [-fs] [-u] [-ud] [-us]</span><br><span class="line">  -h , --<span class="built_in">help</span>                显示帮助信息</span><br><span class="line">  -i , --install             安装 Dnsmasq + SNI Proxy</span><br><span class="line">  -f , --fastinstall         快速安装 Dnsmasq + SNI Proxy</span><br><span class="line">  -<span class="built_in">id</span>, --installdnsmasq      仅安装 Dnsmasq</span><br><span class="line">  -<span class="built_in">id</span>, --installdnsmasq      快速安装 Dnsmasq</span><br><span class="line">  -is, --installsniproxy     仅安装 SNI Proxy</span><br><span class="line">  -fs, --fastinstallsniproxy 快速安装 SNI Proxy</span><br><span class="line">  -u , --uninstall           卸载 Dnsmasq + SNI Proxy</span><br><span class="line">  -ud, --undnsmasq           卸载 Dnsmasq</span><br><span class="line">  -us, --unsniproxy          卸载 SNI Proxy</span><br></pre></td></tr></table></figure><p>这里原教程是只使用<code>bash dnsmasq_sniproxy.sh -is</code>，仅安装SNI Proxy，然后再手动修改配置文件。</p><p>这里我们直接用<code>bash dnsmasq_sniproxy.sh -fs</code>让工具自动写好配置文件，我们仍然可以对配置文件依据自己喜好进行修改。</p><h3 id="解锁机-手动设置sni-proxy的配置文件">解锁机:手动设置SNI Proxy的配置文件</h3><p>修改配置文件，将所需dns解锁的网址格式化输入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/sniproxy.conf</span><br></pre></td></tr></table></figure><p>格式示例</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">user daemon</span><br><span class="line">pidfile /var/tmp/sniproxy.pid</span><br><span class="line"></span><br><span class="line">error_log &#123;</span><br><span class="line">    syslog daemon</span><br><span class="line">    priority notice</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resolver &#123;</span><br><span class="line">    nameserver 8.8.8.8</span><br><span class="line">    nameserver 8.8.4.4 <span class="comment"># local dns should be better</span></span><br><span class="line">    mode ipv4_only</span><br><span class="line">&#125;</span><br><span class="line">listener 0.0.0.0:80 &#123;</span><br><span class="line">    proto http</span><br><span class="line">    access_log &#123;</span><br><span class="line">        filename /var/log/sniproxy/http_access.log</span><br><span class="line">        priority notice</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">listener 0.0.0.0:443 &#123;</span><br><span class="line">    proto tls</span><br><span class="line">    access_log &#123;</span><br><span class="line">        filename /var/log/sniproxy/https_access.log</span><br><span class="line">        priority notice</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">table &#123;</span><br><span class="line">    .*ai\.com$ *</span><br><span class="line">    .*openai\.com$ *</span><br><span class="line">    .*chatgpt.com$ *</span><br><span class="line">    .*oaistatic.com$ *</span><br><span class="line">    .*oaiusercontent.com$ *</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改完配置后，重启SNI Proxy</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart sniproxy</span><br></pre></td></tr></table></figure><h3 id="解锁机-设置解锁白名单">解锁机:设置解锁白名单</h3><blockquote><p>如果不做这步，很有可能被别人盗用你的DNS解锁服务 ！</p></blockquote><p>如未安装ufw，请先执行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ufw</span><br><span class="line">ufw <span class="built_in">enable</span></span><br></pre></td></tr></table></figure><p><strong>第一次安装一定要放行当前使用的ssh端口</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow 22/tcp</span><br></pre></td></tr></table></figure><p>修改下面示例的IP（写被解锁机IP），执行即可。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow from 142.171.50.112 to any port 443 proto tcp</span><br><span class="line">sudo ufw allow from 142.171.50.112 to any port 443 proto udp</span><br><span class="line">sudo ufw allow from 142.171.50.112 to any port 80 proto tcp</span><br><span class="line">sudo ufw allow from 142.171.50.112 to any port 80 proto udp</span><br></pre></td></tr></table></figure><h4 id="开启dns白名单">开启DNS白名单</h4><p>强烈建议开启DNS白名单，不开启会被别人白嫖，也可能被D哥用作DNS放大攻击</p><p>修改下面示例的IP(被解锁机的ip)即可。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow from 142.171.50.112 to any port 53 proto udp</span><br></pre></td></tr></table></figure><h4 id="none"></h4><hr><h2 id="smartdns方案">SmartDNS方案</h2><h3 id="安装smartdns">安装smartdns</h3><blockquote><p>这里使用smartdns，上面的dnsmasq_sniproxy.sh脚本只能安装dnsmasq，所以需要手动安装smartdns</p></blockquote><p>此处可以用另一台服务器，也可以就用搭建sni代理那台服务器。</p><p>运行之前，要确保53端口没被占用</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看53端口是否被占用</span></span><br><span class="line">sudo netstat -tulnp | grep :53</span><br><span class="line"><span class="comment"># 关掉resolved</span></span><br><span class="line">sudo systemctl stop systemd-resolved</span><br><span class="line"><span class="comment"># 禁止开机自启resolved</span></span><br><span class="line">sudo systemctl <span class="built_in">disable</span> systemd-resolved</span><br></pre></td></tr></table></figure><p>这里上<code>https://github.com/pymumu/smartdns/releases/</code>查找最新版本</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/pymumu/smartdns/releases/download/Release46/smartdns.1.2024.06.12-2222.x86-linux-all.tar.gz</span><br><span class="line">tar zxf smartdns.1.2024.06.12-2222.x86-linux-all.tar.gz</span><br><span class="line"><span class="built_in">cd</span> smartdns</span><br><span class="line"><span class="built_in">chmod</span> +x ./install</span><br><span class="line">./install -i</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看运行状态</span></span><br><span class="line">systemctl status smartdns</span><br><span class="line"><span class="comment"># 此时本地的53端口应该是运行着smartdns，否则手动运行下</span></span><br><span class="line">systemctl start smartdns</span><br></pre></td></tr></table></figure><h3 id="方案一：搭建dns服务器">方案一：搭建DNS服务器</h3><h4 id="解锁机-设置smardns">解锁机:设置smardns</h4><blockquote><p>注意，这里不要把解锁服务器的IP填写进去！否则会出现查询回环（自己问自己）</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/smartdns/smartdns.conf</span><br></pre></td></tr></table></figure><p>编辑配置，自行添加需要解锁的网址，常见流媒体域名可以参考<a href="https://github.com/1-stream/1stream-public-utils/blob/main/stream.smartdns.list">1stream写好的</a></p><p>下面的配置文件是包含“嵌套解锁”，其中嵌套了Alice的解析服务；</p><p>具体的smartdn用法参考：<a href="https://pymumu.github.io/smartdns/config/domain-address/">https://pymumu.github.io/smartdns/config/domain-address/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># &gt; Netflix</span><br><span class="line"># 如果使用上游DNS服务器，则使用nameserver</span><br><span class="line">nameserver /netflix.com/SGdnsproxy</span><br><span class="line"></span><br><span class="line"># 如果使用解锁机IP，则使用address</span><br><span class="line">address /netflix.com/11.22.33.44</span><br></pre></td></tr></table></figure><p>完整配置如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> [::]:53</span><br><span class="line"><span class="comment">#bind[::]:53@eth0 -no-dualstack-selection -no-speed-check </span></span><br><span class="line">dualstack-ip-selection no</span><br><span class="line">speed-check-mode none</span><br><span class="line">serve-expired-prefetch-time 21600</span><br><span class="line">prefetch-domain <span class="built_in">yes</span></span><br><span class="line">cache-size 32768</span><br><span class="line">cache-persist <span class="built_in">yes</span></span><br><span class="line">cache-file /etc/smartdns/cache</span><br><span class="line">prefetch-domain <span class="built_in">yes</span></span><br><span class="line">serve-expired <span class="built_in">yes</span></span><br><span class="line">serve-expired-ttl 259200</span><br><span class="line">serve-expired-reply-ttl 3</span><br><span class="line">prefetch-domain <span class="built_in">yes</span></span><br><span class="line">serve-expired-prefetch-time 21600</span><br><span class="line">cache-checkpoint-time 86400</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置默认的上游 DNS</span></span><br><span class="line">server 8.8.8.8 <span class="comment">#默认上游DNS</span></span><br><span class="line">server 8.8.4.4 <span class="comment">#默认上游DNS</span></span><br><span class="line"><span class="comment"># 配置上游DNS  alice-dns-hk</span></span><br><span class="line">server 154.12.177.22 IP -group HKdnsproxy -exclude-default-group</span><br><span class="line"><span class="comment"># 配置上游DNS  alice-dns-sg</span></span><br><span class="line">server 157.20.104.47 IP -group SGdnsproxy -exclude-default-group</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; Disney+</span></span><br><span class="line">nameserver /disney.connections.edge.bamgrid.com/us</span><br><span class="line">nameserver /disney.api.edge.bamgrid.com/us</span><br><span class="line">nameserver /disney-plus.net/us</span><br><span class="line">nameserver /disneyplus.com/us</span><br><span class="line">nameserver /dssott.com/us</span><br><span class="line">nameserver /disneynow.com/us</span><br><span class="line">nameserver /disneystreaming.com/us</span><br><span class="line">nameserver /cdn.registerdisney.go.com/us</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; Netflix</span></span><br><span class="line"><span class="comment"># 如果使用上游DNS服务器</span></span><br><span class="line">nameserver /netflix.com/SGdnsproxy</span><br><span class="line">nameserver /netflix.net/SGdnsproxy</span><br><span class="line">nameserver /nflximg.com/SGdnsproxy</span><br><span class="line">nameserver /nflximg.net/SGdnsproxy</span><br><span class="line">nameserver /nflxvideo.net/SGdnsproxy</span><br><span class="line">nameserver /nflxext.com/SGdnsproxy</span><br><span class="line">nameserver /nflxso.net/SGdnsproxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果使用解锁机IP</span></span><br><span class="line"><span class="comment">#address /netflix.com/11.22.33.44</span></span><br><span class="line"><span class="comment">#address /netflix.net/11.22.33.44</span></span><br><span class="line"><span class="comment">#address /nflximg.com/11.22.33.44</span></span><br><span class="line"><span class="comment">#address /nflximg.net/11.22.33.44</span></span><br><span class="line"><span class="comment">#address /nflxvideo.net/11.22.33.44</span></span><br><span class="line"><span class="comment">#address /nflxext.com/11.22.33.44</span></span><br><span class="line"><span class="comment">#address /nflxso.net/11.22.33.44</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; HuluUSA</span></span><br><span class="line">address /assetshuluimcom-a.akamaihd.net/11.22.33.44</span><br><span class="line">address /cws-hulu.conviva.com/11.22.33.44</span><br><span class="line">address /hulu.com/11.22.33.44</span><br><span class="line">address /hulu.hb.omtrdc.net/11.22.33.44</span><br><span class="line">address /hulu.sc.omtrdc.net/11.22.33.44</span><br><span class="line">address /huluad.com/11.22.33.44</span><br><span class="line">address /huluqa.com/11.22.33.44</span><br><span class="line">address /hulustream.com/11.22.33.44</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; HBO / Max</span></span><br><span class="line">address /max.com/11.22.33.44</span><br><span class="line">address /hbo.com/11.22.33.44</span><br><span class="line">address /hbomax.com/11.22.33.44</span><br><span class="line">address /hbomaxcdn.com/11.22.33.44</span><br><span class="line">address /hbonow.com/11.22.33.44</span><br><span class="line">address /discomax.com/11.22.33.44</span><br><span class="line"></span><br><span class="line">nameserver /hbogo.com/SGdnsproxy</span><br><span class="line">nameserver /maxgo.com/SGdnsproxy</span><br><span class="line"><span class="comment"># ---------- &gt; Taiwan Media</span></span><br><span class="line"><span class="comment"># &gt; KKTV</span></span><br><span class="line">nameserver /kfs.io/HKdnsproxy</span><br><span class="line">nameserver /kktv-theater.kk.stream/HKdnsproxy</span><br><span class="line">nameserver /kkbox.com/HKdnsproxy</span><br><span class="line">nameserver /kkbox.com.tw/HKdnsproxy</span><br><span class="line">nameserver /kktv.com.tw/HKdnsproxy</span><br><span class="line">nameserver /kktv.me/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; LiTV</span></span><br><span class="line">nameserver /litv.tv/HKdnsproxy</span><br><span class="line">nameserver /litvfreepc.akamaized.net/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; MyVideo</span></span><br><span class="line">nameserver /cdn.plyr.io/HKdnsproxy</span><br><span class="line">nameserver /myvideo.net.tw/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; 4GTV</span></span><br><span class="line">nameserver /4gtv.tv/HKdnsproxy</span><br><span class="line">nameserver /4gtvfreepc-cds.cdn.hinet.net/HKdnsproxy</span><br><span class="line">nameserver /4gtvfreepcvod-cds.cdn.hinet.net/HKdnsproxy</span><br><span class="line">nameserver /4gtvpc-cds.cdn.hinet.net/HKdnsproxy</span><br><span class="line">nameserver /4gtvpcvod-cds.cdn.hinet.net/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; LineTV.TW</span></span><br><span class="line">nameserver /d3c7rimkq79yfu.cloudfront.net/HKdnsproxy</span><br><span class="line">nameserver /linetv.tw/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; Hami Video</span></span><br><span class="line">nameserver /cdn.hinet.net/HKdnsproxy</span><br><span class="line">nameserver /hamivideo.hinet.net/HKdnsproxy</span><br><span class="line">nameserver /scc.ott.hinet.net/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; CatchPlay+</span></span><br><span class="line">nameserver /catchplay.com/HKdnsproxy</span><br><span class="line">nameserver /d2ivmxp5z2ww0n.cloudfront.net/HKdnsproxy</span><br><span class="line">nameserver /ols-ww100-cp.akamaized.net/HKdnsproxy</span><br><span class="line">nameserver /tra-www000-cp.akamaized.net/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; Bahamut Anime</span></span><br><span class="line">nameserver /bahamut.com.tw/HKdnsproxy</span><br><span class="line">nameserver /gamer.com.tw/HKdnsproxy</span><br><span class="line">nameserver /gamer-cds.cdn.hinet.net/HKdnsproxy</span><br><span class="line">nameserver /gamer2-cds.cdn.hinet.net/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; Friday Video</span></span><br><span class="line">nameserver /video.friday.tw/HKdnsproxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- &gt; Hong Kong Media</span></span><br><span class="line"><span class="comment"># &gt; Now E </span></span><br><span class="line">nameserver /nowe.com/HKdnsproxy</span><br><span class="line">nameserver /nowestatic.com/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; Now TV</span></span><br><span class="line">nameserver /now.com/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; Viu.TV</span></span><br><span class="line"><span class="comment">#include Viu.com</span></span><br><span class="line">nameserver /viu.now.com/HKdnsproxy</span><br><span class="line">nameserver /viu.tv/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; MyTVSuper</span></span><br><span class="line">nameserver /mytvsuper.com/HKdnsproxy</span><br><span class="line">nameserver /mytvsuperlimited.hb.omtrdc.net/HKdnsproxy</span><br><span class="line">nameserver /mytvsuperlimited.sc.omtrdc.net/HKdnsproxy</span><br><span class="line">nameserver /tvb.com/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; HOY TV</span></span><br><span class="line">nameserver /hoy.tv/HKdnsproxy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- &gt; SouthEastAsia media</span></span><br><span class="line"><span class="comment"># &gt; HBO GO Asia</span></span><br><span class="line">nameserver /44wilhpljf.execute-api.ap-southeast-1.amazonaws.com/HKdnsproxy</span><br><span class="line">nameserver /bcbolthboa-a.akamaihd.net/HKdnsproxy</span><br><span class="line">nameserver /dai3fd1oh325y.cloudfront.net/HKdnsproxy</span><br><span class="line">nameserver /hboasia1-i.akamaihd.net/HKdnsproxy</span><br><span class="line">nameserver /hboasia2-i.akamaihd.net/HKdnsproxy</span><br><span class="line">nameserver /hboasia3-i.akamaihd.net/HKdnsproxy</span><br><span class="line">nameserver /hboasia4-i.akamaihd.net/HKdnsproxy</span><br><span class="line">nameserver /hboasia5-i.akamaihd.net/HKdnsproxy</span><br><span class="line">nameserver /hboasialive.akamaized.net/HKdnsproxy</span><br><span class="line">nameserver /hbogoprod-vod.akamaized.net/HKdnsproxy</span><br><span class="line">nameserver /hbolb.onwardsmg.com/HKdnsproxy</span><br><span class="line">nameserver /hbounify-prod.evergent.com/HKdnsproxy</span><br><span class="line">nameserver /hbogo.co.th/HKdnsproxy</span><br><span class="line">nameserver /hbogoasia.com/HKdnsproxy</span><br><span class="line">nameserver /hbogoasia.hk/HKdnsproxy</span><br><span class="line">nameserver /hbogoasia.id/HKdnsproxy</span><br><span class="line">nameserver /hbogoasia.ph/HKdnsproxy</span><br><span class="line">nameserver /hbogoasia.sg/SGdnsproxy</span><br><span class="line">nameserver /hbogoasia.tw/HKdnsproxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- &gt; AI Platform</span></span><br><span class="line"><span class="comment"># &gt; Openai</span></span><br><span class="line">nameserver /openai.com/HKdnsproxy</span><br><span class="line">nameserver /chatgpt.com/HKdnsproxy</span><br><span class="line">nameserver /oaistatic.com/HKdnsproxy</span><br><span class="line">nameserver /oaiusercontent.com/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; ExHantai/E-hentai</span></span><br><span class="line">nameserver /exhentai.org/HKdnsproxy</span><br><span class="line">nameserver /e-hentai.org/HKdnsproxy</span><br><span class="line"><span class="comment"># &gt; Claude 2</span></span><br><span class="line">nameserver /anthropic.com/HKdnsproxy</span><br><span class="line">nameserver /claude.ai/HKdnsproxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- &gt; China Media</span></span><br><span class="line"><span class="comment"># &gt; BiliBili</span></span><br><span class="line">nameserver /bilibili.com/HKdnsproxy</span><br><span class="line">nameserver /bilibili.tv/HKdnsproxy</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>保存并启动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#记得关闭本地DNS服务</span></span><br><span class="line">systemctl stop systemd-resolved &amp;&amp; systemctl <span class="built_in">disable</span> systemd-resolved </span><br><span class="line"><span class="comment">#开启smartdns</span></span><br><span class="line">systemctl <span class="built_in">enable</span> smartdns</span><br><span class="line">systemctl start smartdns</span><br></pre></td></tr></table></figure><h4 id="解锁机-开启dns白名单">解锁机:开启DNS白名单</h4><p>强烈建议开启DNS白名单，不开启会被别人白嫖，也可能被D哥用作DNS放大攻击</p><p>修改下面示例的IP(被解锁机的ip)即可。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw allow from 64.23.217.157 to any port 53 proto udp</span><br></pre></td></tr></table></figure><h4 id="被解锁机-全局修改dns">被解锁机:全局修改DNS</h4><p>修改DNS为解锁机或者DNS服务器的IP</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolv.conf</span><br><span class="line"><span class="comment"># 添加下面的</span></span><br><span class="line">nameserver 解锁机或DNS服务器的IP</span><br></pre></td></tr></table></figure><p>这里全局修改DNS到解锁机，如果解锁机宕机，被解锁机的DNS服务会出问题；</p><h3 id="方案二：单机代理">方案二：单机代理</h3><h4 id="被解锁机-搭建smartdns-dnsmasq">被解锁机:搭建smartdns/dnsmasq</h4><p>在被解锁服务器<strong>本地搭建smartdns</strong></p><p>安装步骤和方案一相同，此处不再赘述。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#记得关闭本地DNS服务</span></span><br><span class="line">systemctl stop systemd-resolved &amp;&amp; systemctl <span class="built_in">disable</span> systemd-resolved </span><br><span class="line"></span><br><span class="line"><span class="comment">#非必要！默认优先ipv6，直接禁用ipv6</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1&quot;</span> &gt; /proc/sys/net/ipv6/conf/all/disable_ipv6 </span><br></pre></td></tr></table></figure><p>配置文件有所改变，具体改动为第一行的DNS设置，该设置限制了仅本地可以访问</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/smartdns/smartdns.conf</span><br></pre></td></tr></table></figure><p>格式示例：</p><p><strong>不用全部添加，如果已经解锁了的没必要添加进去</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> [::]:53</span><br><span class="line"><span class="comment">#bind[::]:53@eth0 -no-dualstack-selection -no-speed-check </span></span><br><span class="line">dualstack-ip-selection no</span><br><span class="line">speed-check-mode none</span><br><span class="line">serve-expired-prefetch-time 21600</span><br><span class="line">prefetch-domain <span class="built_in">yes</span></span><br><span class="line">cache-size 32768</span><br><span class="line">cache-persist <span class="built_in">yes</span></span><br><span class="line">cache-file /etc/smartdns/cache</span><br><span class="line">prefetch-domain <span class="built_in">yes</span></span><br><span class="line">serve-expired <span class="built_in">yes</span></span><br><span class="line">serve-expired-ttl 259200</span><br><span class="line">serve-expired-reply-ttl 3</span><br><span class="line">prefetch-domain <span class="built_in">yes</span></span><br><span class="line">serve-expired-prefetch-time 21600</span><br><span class="line">cache-checkpoint-time 86400</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置默认的上游 DNS</span></span><br><span class="line">server 11.22.33.44</span><br><span class="line">server 8.8.8.8 <span class="comment">#默认上游DNS</span></span><br><span class="line">server 8.8.4.4 <span class="comment">#默认上游DNS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置自定义的解锁机上游 DNS</span></span><br><span class="line">server 11.22.33.44 IP -group us -exclude-default-group</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; Disney+</span></span><br><span class="line">nameserver /disney.connections.edge.bamgrid.com/us</span><br><span class="line">nameserver /disney.api.edge.bamgrid.com/us</span><br><span class="line">nameserver /disney-plus.net/us</span><br><span class="line">nameserver /disneyplus.com/us</span><br><span class="line">nameserver /dssott.com/us</span><br><span class="line">nameserver /disneynow.com/us</span><br><span class="line">nameserver /disneystreaming.com/us</span><br><span class="line">nameserver /cdn.registerdisney.go.com/us</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; Netflix</span></span><br><span class="line">nameserver /netflix.com/us</span><br><span class="line">nameserver /netflix.net/us</span><br><span class="line">nameserver /nflximg.com/us</span><br><span class="line">nameserver /nflximg.net/us</span><br><span class="line">nameserver /nflxvideo.net/us</span><br><span class="line">nameserver /nflxext.com/us</span><br><span class="line">nameserver /nflxso.net/us</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; HuluUSA</span></span><br><span class="line">address /assetshuluimcom-a.akamaihd.net/11.22.33.44</span><br><span class="line">address /cws-hulu.conviva.com/11.22.33.44</span><br><span class="line">address /hulu.com/11.22.33.44</span><br><span class="line">address /hulu.hb.omtrdc.net/11.22.33.44</span><br><span class="line">address /hulu.sc.omtrdc.net/11.22.33.44</span><br><span class="line">address /huluad.com/11.22.33.44</span><br><span class="line">address /huluqa.com/11.22.33.44</span><br><span class="line">address /hulustream.com/11.22.33.44</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; Instagram</span></span><br><span class="line">nameserver /instagram.com/us</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; Tiktok</span></span><br><span class="line">nameserver /byteoversea.com/us</span><br><span class="line">nameserver /ibytedtos.com/us</span><br><span class="line">nameserver /ipstatp.com/us</span><br><span class="line">nameserver /muscdn.com/us</span><br><span class="line">nameserver /musical.ly/us</span><br><span class="line">nameserver /tiktok.com/us</span><br><span class="line">nameserver /tik-tokapi.com/us</span><br><span class="line">nameserver /tiktokcdn.com/us</span><br><span class="line">nameserver /tiktokv.com/us</span><br></pre></td></tr></table></figure><h4 id="被解锁-修改dns">被解锁:修改DNS</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改完配置后，重启smartdns</span></span><br><span class="line">systemctl restart smartdns</span><br><span class="line"><span class="comment"># 查看运行状态</span></span><br><span class="line">systemctl status smartdns</span><br><span class="line"><span class="comment"># 此时本地的53端口应该是运行着smartdns</span></span><br></pre></td></tr></table></figure><p>再将修改本地DNS为127.0.0.1，从而定位到smartdns服务</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolv.conf</span><br></pre></td></tr></table></figure><h2 id="dnsmasq方案">Dnsmasq方案</h2><h3 id="解锁机安装dnsmasq">解锁机安装Dnsmasq</h3><blockquote><p>这里在使用dnsmasq，上面的dnsmasq_sniproxy.sh脚本能一键安装dnsmasq并配置好流媒体</p><p>即在被解锁机建立DNS服务，为多台机器提供解锁</p></blockquote><p>确保53、80、443端口不被占用</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 执行</span></span><br><span class="line">bash dnsmasq_sniproxy.sh -<span class="built_in">id</span></span><br></pre></td></tr></table></figure><p>执行后应该即可运行dnsmasq服务了</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启dnsmasq服务</span></span><br><span class="line">systemctl start dnsmasq &amp;&amp; systemctl <span class="built_in">enable</span> dnsmasq</span><br><span class="line"><span class="comment"># 关闭dnsmasq服务</span></span><br><span class="line">systemctl stop dnsmasq &amp;&amp; systemctl <span class="built_in">disable</span> dnsmasq</span><br><span class="line"><span class="comment"># 开启systemd-resolved</span></span><br><span class="line">systemctl start systemd-resolved &amp;&amp; systemctl <span class="built_in">enable</span> systemd-resolved </span><br></pre></td></tr></table></figure><h3 id="被解锁机安装dnsmasq">被解锁机安装Dnsmasq</h3><p>使用前面的脚本，在被解锁机上运行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/Jimmyzxk/DNS-Alice-Unlock/refs/heads/main/dns-unlock.sh &amp;&amp; bash dns-unlock.sh</span><br></pre></td></tr></table></figure><p>同样使用dnsmasq方案，填写上解锁机的ip</p><hr><h2 id="还原设置">还原设置</h2><blockquote><p>还原成原始DNS设置</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭smartdns服务</span></span><br><span class="line">systemctl stop smartdns &amp;&amp; systemctl <span class="built_in">disable</span> smartdns</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭dnsmasq服务</span></span><br><span class="line">systemctl stop dnsmasq &amp;&amp; systemctl <span class="built_in">disable</span> dnsmasq</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启systemd-resolved</span></span><br><span class="line">systemctl start systemd-resolved &amp;&amp; systemctl <span class="built_in">enable</span> systemd-resolved</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启smardns</span></span><br><span class="line">systemctl start smartdns &amp;&amp; systemctl <span class="built_in">enable</span> smartdns</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启dnsmasq服务</span></span><br><span class="line">systemctl start dnsmasq &amp;&amp; systemctl <span class="built_in">enable</span> dnsmasq</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭本地DNS服务</span></span><br><span class="line">systemctl stop systemd-resolved &amp;&amp; systemctl <span class="built_in">disable</span> systemd-resolved </span><br></pre></td></tr></table></figure><p>文件可能被锁定，这里是解锁方法</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsattr /etc/resolv.conf</span><br></pre></td></tr></table></figure><p>如果看到有’i’ (e.g., <code>----i---------</code>)则说明文件被锁定</p><p>解除锁定</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chattr -i /etc/resolv.conf</span><br></pre></td></tr></table></figure><p>随后修改文件权限即可</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> 755 /etc/resolv.conf</span><br></pre></td></tr></table></figure><h1 id="解锁方式对比">解锁方式对比</h1><h2 id="六种情况">六种情况</h2><ol><li>解锁机不运行SmartDNS，被解锁机运行SmartDNS，并用<code>nameserver</code>解析网飞</li></ol><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241130143227303.png" alt="image-20241130143227303"></p><p>失败</p><ol start="2"><li>解锁机不运行SmartDNS，被解锁机运行SmartDNS，并用<code>address</code>解析网飞</li></ol><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241130143412383.png" alt="image-20241130143412383"></p><p>解锁成功，并且网飞定位是US</p><ol start="3"><li>解锁机运行SmartDNS，被解锁机运行SmartDNS，并用<code>nameserver</code>解析网飞</li></ol><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241130143637685.png" alt="image-20241130143637685"></p><p>解锁成功，并且看到网飞定位是SG，因为在解锁机上我们将网飞的解析交给了Alice的SG服务器（上游服务器）</p><ol start="4"><li>解锁机运行SmartDNS，被解锁机运行SmartDNS，并用<code>address</code>解析网飞</li></ol><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241130143848175.png" alt="image-20241130143848175"></p><p>解锁成功，网飞定位是US（即解锁机的地区），说明此时解锁机直接进行了解析，并没有交给上游Alice服务器</p><ol start="5"><li>解锁机运行SmartDNS，被解锁机<code>全局DNS解析</code>到解锁机</li></ol><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241130144503190.png" alt="image-20241130144503190"></p><p>解锁成功，并且看到网飞定位是SG，因为在解锁机上我们将网飞的解析交给了Alice的SG服务器（上游服务器）</p><p>和在被解锁机运行sm，并使用nameserver解析一样</p><ol start="6"><li>解锁机不运行SmartDNS，被解锁机<code>全局DNS</code>解析</li></ol><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241130144630366.png" alt="image-20241130144630366"></p><p>可以看到，直接失败了，无法进行任何DNS解析</p><blockquote><p>注意，这里的解锁机运行smartDNS时，网飞的解锁交给Alice的SG服务器解析</p></blockquote><table><thead><tr><th><strong>序号</strong></th><th><strong>解锁方式</strong></th><th><strong>结果</strong></th><th><strong>优点</strong></th><th><strong>缺点</strong></th></tr></thead><tbody><tr><td><strong>1</strong></td><td>解锁机不运行SmartDNS，被解锁机运行SmartDNS，并用<code>nameserver</code>解析网飞</td><td>无法解析成功</td><td>—</td><td>解析失败</td></tr><tr><td><strong>2</strong></td><td>解锁机不运行SmartDNS，被解锁机运行SmartDNS，并用<code>address</code>解析网飞</td><td>解锁成功，网飞定位为US（由解锁机<strong>直接解析</strong>）</td><td>无需解锁机运行SmartDNS</td><td></td></tr><tr><td><strong>3</strong></td><td>解锁机运行SmartDNS，被解锁机运行SmartDNS，并用<code>nameserver</code>解析网飞</td><td>解锁成功，网飞定位为SG（由解锁机的<strong>上游服务器决定</strong>）</td><td>被解锁机不完全依赖解锁机；可以用解锁机的上游服务器</td><td></td></tr><tr><td><strong>4</strong></td><td>解锁机运行SmartDNS，被解锁机运行SmartDNS，并用<code>address</code>解析网飞</td><td>解锁成功，网飞定位为US（由解锁机<strong>直接解析</strong>）</td><td>被解锁机不完全依赖解锁机</td><td></td></tr><tr><td><strong>5</strong></td><td>解锁机运行SmartDNS，被解锁机<code>全局DNS解析</code>到解锁机</td><td>解锁成功，网飞定位为SG（由解锁机的<strong>上游服务器决定</strong>）</td><td>接入方便;可以用解锁机的上游服务器</td><td>被解锁机完全依赖解锁机的SmartDNS，需保证解锁机稳定运行</td></tr><tr><td><strong>6</strong></td><td>解锁机不运行SmartDNS，被解锁机<code>全局DNS</code>解析</td><td>无法解析成功</td><td>—</td><td>无法解析DNS，直接失败</td></tr></tbody></table><hr><h2 id="推荐解锁方式">推荐解锁方式</h2><p>解锁机运行sniproxy，不运行SmartDNS，被解锁机运行SmartDNS并用<code>address</code>解析</p><p>优点：</p><p>1、DNS解析速度快</p><p>2、被解锁机可以自由选择用不同解锁机</p><p>3、解锁机宕机后也不影响被解锁机使用</p><ol><li><strong>方式 3（解锁机运行SmartDNS，被解锁机运行SmartDNS并用<code>nameserver</code>解析）</strong><ul><li>解锁机如果运营了一个DNS解锁服务器，可以通过嵌套解锁方式，实现不同地区的内容解锁；</li><li>被解锁机设置所有流媒体网站全部用<code>nameserver</code>解析交给解锁机，且不完全依赖解锁机；</li></ul></li><li>**方式 5 解锁机运行SmartDNS，被解锁机<code>全局DNS解析</code>到解锁机 **<ol><li>方便，简单</li></ol></li></ol><h1 id="高级玩法">高级玩法</h1><h2 id="玩法一-嵌套解锁">玩法一 嵌套解锁</h2><p>其实，在某些商家提供DNS解锁的服务器也可以利用本教程给其他服务器提供解锁，就是嵌套解锁（<strong>该行为可能违反TOS</strong>）。<br>借助方案一，使用自建DNS，只需要改一下上游DNS设置和域名对应的DNS设置即可实现。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server 210.0.255.250 <span class="comment">#默认上游DNS</span></span><br><span class="line">server 210.0.255.251 <span class="comment">#默认上游DNS</span></span><br><span class="line">server 此处写商家提供的DNS IP -group dnsproxy -exclude-default-group</span><br><span class="line"></span><br><span class="line"><span class="comment"># &gt; Netflix</span></span><br><span class="line">nameserver /netflix.com/dnsproxy</span><br><span class="line">nameserver /netflix.net/dnsproxy</span><br><span class="line">nameserver /nflximg.com/dnsproxy </span><br><span class="line">nameserver /nflximg.net/dnsproxy</span><br><span class="line">nameserver /nflxvideo.net/dnsproxy </span><br><span class="line">nameserver /nflxext.com/dnsproxy </span><br><span class="line">nameserver /nflxso.net/dnsproxy </span><br></pre></td></tr></table></figure><h2 id="玩法二-自建doh服务器">玩法二 自建DOH服务器</h2><p>某些厂商强制劫持了53端口的UDP流量，导致无论怎么改DNS都无法摆脱商家的解锁服务，此时DOH就派上了用处。<br>DOH简单说就是DNS over HTTPS，通过DOH 走TCP流量使用TLS可以完美绕过DNS劫持。<br>smartdns可以搭建DOH服务器，但是我没搭建成功，so sad。所以仅介绍adguardhome搭建DOH。<br><a href="https://www.nodeseek.com/jump?to=https%3A%2F%2Faoyouer.com%2Fposts%2Fadguardhome-public-dns%2F">具体adguardhome搭建DOH的教程网络已有很多</a>，此处就省去了。搭建过程中，唯一需要注意的是，上游DNS需要写127.0.0.1。<br>被DNS劫持的服务器只需要在smartdns中将默认DNS设置为自己刚建好的DOH地址即可。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server-https https://cloudflare-dns.com/dns-query</span><br></pre></td></tr></table></figure><p>小建议由于TLS三次握手的特性，查询DNS的延迟肯定会提升，建议开启smartdns的缓存功能。</p><h2 id="玩法三-smartdns开启广告过滤">玩法三 smartdns开启广告过滤</h2><p>下载配置文件到<code>/etc/smartdns</code>目录：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://anti-ad.net/anti-ad-for-smartdns.conf -O /etc/smartdns/anti-ad-smartdns.conf</span><br></pre></td></tr></table></figure><p>修改该<code>/etc/smartdns/smartdns.conf</code>文件以包含上述配置文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 在/etc/smartdns/smartdns.conf 末尾添加下面这行即可</span><br><span class="line">conf-file /etc/smartdns/anti-ad-smartdns.conf</span><br></pre></td></tr></table></figure><p>保存并重启SmartDNS 服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart smartdns</span><br></pre></td></tr></table></figure><h2 id="扩展聊一聊">扩展聊一聊</h2><p>其实直接通过修改系统DNS方式解锁流媒体弊端有很多，常见的弊端比如：DNS服务器宕机导致本地服务无法解析域名、由于厂商分流规则没有细分导致常见CDN 分配的IP在别的地区（常见于akamai的CDN），这时候DNS分流就尤为重要。利用smartdns，可以实现对解锁域名走厂商DNS，对其他域名走公共DNS。举个例子，下面那个配置意思是：DAZN和Hotstar走DNS，其他的全用8.8.8.8解析，这样即使66.66.66.66宕机，本地只要不访问DAZN和Hotstar就不受任何影响。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server 8.8.8.8</span><br><span class="line">server 66.66.66.66（厂商给的dns ip） -group dns -exclude-default-group</span><br><span class="line"></span><br><span class="line"># ---------- &gt; Global Plaform</span><br><span class="line"># &gt; DAZN</span><br><span class="line">nameserver /upos-hz-mirrorakam.akamaized.net/dns</span><br><span class="line"># &gt; Hotstar</span><br><span class="line">nameserver /hotstar.com/dns</span><br></pre></td></tr></table></figure><h2 id="相关项目官网">相关项目官网</h2><p><a href="https://www.nodeseek.com/jump?to=https%3A%2F%2Fgithub.com%2Fxsidc%2Fdnsmasq">sni代理</a><br><a href="https://www.nodeseek.com/jump?to=https%3A%2F%2Fpymumu.github.io%2Fsmartdns">smartdns</a><br><a href="https://www.nodeseek.com/jump?to=https%3A%2F%2Fgithub.com%2FAdguardTeam%2FAdGuardHome">AdGuardHome</a></p><h1 id="流媒体解锁检测">流媒体解锁检测</h1><p>RegionRestrictionCheck 检测脚本检测项目比较全面，且支持Docker运行，杜绝污染VPS服务器，检测流媒体除了主流的Netflix、Disney+、YouTube Premium，还可以支持检测Dazn、Viu TV、4GTV和KKTV等比较冷门的流媒体服务。</p><blockquote><p>支持OS/Platform：CentOS 6+, Ubuntu 14.04+, Debian 8+, MacOS, Android with Termux</p></blockquote><h2 id="使用方法">使用方法</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -L -s check.unlock.media)</span><br></pre></td></tr></table></figure><p>只检测IPv4结果:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -L -s check.unlock.media) -M 4</span><br></pre></td></tr></table></figure><p>只检测IPv6结果：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -L -s check.unlock.media) -M 6</span><br></pre></td></tr></table></figure><h1 id="附件">附件</h1><p>完整的配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br></pre></td><td class="code"><pre><span class="line">bind [::]:53</span><br><span class="line">#bind[::]:53@eth0 -no-dualstack-selection -no-speed-check </span><br><span class="line">dualstack-ip-selection no</span><br><span class="line">speed-check-mode none</span><br><span class="line">serve-expired-prefetch-time 21600</span><br><span class="line">prefetch-domain yes</span><br><span class="line">cache-size 32768</span><br><span class="line">cache-persist yes</span><br><span class="line">cache-file /etc/smartdns/cache</span><br><span class="line">prefetch-domain yes</span><br><span class="line">serve-expired yes</span><br><span class="line">serve-expired-ttl 259200</span><br><span class="line">serve-expired-reply-ttl 3</span><br><span class="line">prefetch-domain yes</span><br><span class="line">serve-expired-prefetch-time 21600</span><br><span class="line">cache-checkpoint-time 86400</span><br><span class="line"></span><br><span class="line"># 设置默认的上游 DNS</span><br><span class="line">server 8.8.8.8 #默认上游DNS</span><br><span class="line">server 8.8.4.4 #默认上游DNS</span><br><span class="line"># 设置自定义的上游 DNS</span><br><span class="line">server 11.22.33.44 IP -group us -exclude-default-group</span><br><span class="line"></span><br><span class="line"># ---------- &gt; Global Plaform</span><br><span class="line"># &gt; Disney+</span><br><span class="line">nameserver /disney.connections.edge.bamgrid.com/us</span><br><span class="line">nameserver /disney.api.edge.bamgrid.com/us</span><br><span class="line">nameserver /disney-plus.net/us</span><br><span class="line">nameserver /disneyplus.com/us</span><br><span class="line">nameserver /dssott.com/us</span><br><span class="line">nameserver /disneynow.com/us</span><br><span class="line">nameserver /disneystreaming.com/us</span><br><span class="line">nameserver /cdn.registerdisney.go.com/us</span><br><span class="line"></span><br><span class="line"># &gt; Netflix</span><br><span class="line">#nameserver /netflix.com/us</span><br><span class="line">#nameserver /netflix.net/us</span><br><span class="line">#nameserver /nflximg.com/us</span><br><span class="line">#nameserver /nflximg.net/us</span><br><span class="line">#nameserver /nflxvideo.net/us</span><br><span class="line">#nameserver /nflxext.com/us</span><br><span class="line">#nameserver /nflxso.net/us</span><br><span class="line"></span><br><span class="line"># 如果使用解锁机IP</span><br><span class="line">address /netflix.com/11.22.33.44</span><br><span class="line">address /netflix.net/11.22.33.44</span><br><span class="line">address /nflximg.com/11.22.33.44</span><br><span class="line">address /nflximg.net/11.22.33.44</span><br><span class="line">address /nflxvideo.net/11.22.33.44</span><br><span class="line">address /nflxext.com/11.22.33.44</span><br><span class="line">address /nflxso.net/11.22.33.44</span><br><span class="line"></span><br><span class="line"># &gt; HuluUSA</span><br><span class="line">address /assetshuluimcom-a.akamaihd.net/11.22.33.44</span><br><span class="line">address /cws-hulu.conviva.com/11.22.33.44</span><br><span class="line">address /hulu.com/11.22.33.44</span><br><span class="line">address /hulu.hb.omtrdc.net/11.22.33.44</span><br><span class="line">address /hulu.sc.omtrdc.net/11.22.33.44</span><br><span class="line">address /huluad.com/11.22.33.44</span><br><span class="line">address /huluqa.com/11.22.33.44</span><br><span class="line">address /hulustream.com/11.22.33.44</span><br><span class="line"></span><br><span class="line"># &gt; HuluUSA</span><br><span class="line">#nameserver /assetshuluimcom-a.akamaihd.net/us</span><br><span class="line">#nameserver /cws-hulu.conviva.com/us</span><br><span class="line">#nameserver /hulu.com/us</span><br><span class="line">#nameserver /hulu.hb.omtrdc.net/us</span><br><span class="line">#nameserver /hulu.sc.omtrdc.net/us</span><br><span class="line">#nameserver /huluad.com/us</span><br><span class="line">#nameserver /huluqa.com/us</span><br><span class="line">#nameserver /hulustream.com/us</span><br><span class="line"></span><br><span class="line"># &gt; Amazon Prime Video:</span><br><span class="line">#nameserver /d1v5ir2lpwr8os.cloudfront.net/us</span><br><span class="line">#nameserver /d22qjgkvxw22r6.cloudfront.net/us</span><br><span class="line">#nameserver /d25xi40x97liuc.cloudfront.net/us</span><br><span class="line">#nameserver /d27xxe7juh1us6.cloudfront.net/us</span><br><span class="line">#nameserver /dmqdd6hw24ucf.cloudfront.net/us</span><br><span class="line">#nameserver /aiv-cdn.net/us</span><br><span class="line">#nameserver /aiv-delivery.net/us</span><br><span class="line">#nameserver /amazonvideo.com/us</span><br><span class="line">#nameserver /atv-ext-eu.amazon.com/us</span><br><span class="line">#nameserver /atv-ext-fe.amazon.com/us</span><br><span class="line">#nameserver /atv-ext.amazon.com/us</span><br><span class="line">#nameserver /atv-ps-eu.amazon.co.uk/us</span><br><span class="line">#nameserver /atv-ps-eu.amazon.com/us</span><br><span class="line">#nameserver /atv-ps-fe.amazon.co.jp/us</span><br><span class="line">#nameserver /atv-ps-fe.amazon.com/us</span><br><span class="line">#nameserver /atv-ps.amazon.com/us</span><br><span class="line">#nameserver /primevideo.com/us</span><br><span class="line">#nameserver /pv-cdn.net/us</span><br><span class="line">#nameserver /video.a2z.com/us</span><br><span class="line"></span><br><span class="line"># &gt; TVBAnywhere+</span><br><span class="line">nameserver /tvbanywhere.com/us</span><br><span class="line">nameserver /tvbanywhere.com.sg/us</span><br><span class="line">nameserver /tvb.com/us</span><br><span class="line">nameserver /tvb.com.au/us</span><br><span class="line">nameserver /tvbc.com.cn/us</span><br><span class="line">nameserver /tvbeventpower.com.hk/us</span><br><span class="line">nameserver /tvbusa.com/us</span><br><span class="line">nameserver /tvbweekly.com/us</span><br><span class="line">nameserver /tvmedia.net.au/us</span><br><span class="line"></span><br><span class="line"># &gt; Viu.com</span><br><span class="line">nameserver /cognito-identity.us-east-1.amazonaws.com/us</span><br><span class="line">nameserver /d1k2us671qcoau.cloudfront.net/us</span><br><span class="line">nameserver /d2anahhhmp1ffz.cloudfront.net/us</span><br><span class="line">nameserver /dfp6rglgjqszk.cloudfront.net/us</span><br><span class="line">nameserver /d3o7oi00quuwqu.cloudfront.net/us</span><br><span class="line">nameserver /mobileanalytics.us-east-1.amazonaws.com/us</span><br><span class="line">nameserver /viu.com/us</span><br><span class="line"></span><br><span class="line"># &gt; Instagram</span><br><span class="line">nameserver /instagram.com/us</span><br><span class="line"># &gt; iQiyi</span><br><span class="line">nameserver /71.am/us</span><br><span class="line">nameserver /iq.com/us</span><br><span class="line">nameserver /iqiyi.com/us</span><br><span class="line">nameserver /iqiyipic.com/us</span><br><span class="line">nameserver /pps.tv/us</span><br><span class="line">nameserver /ppsimg.com/us</span><br><span class="line">nameserver /qiyi.com/us</span><br><span class="line">nameserver /qiyipic.com/us</span><br><span class="line">nameserver /qy.net/us</span><br><span class="line"># &gt; Tiktok</span><br><span class="line">nameserver /byteoversea.com/us</span><br><span class="line">nameserver /ibytedtos.com/us</span><br><span class="line">nameserver /ipstatp.com/us</span><br><span class="line">nameserver /muscdn.com/us</span><br><span class="line">nameserver /musical.ly/us</span><br><span class="line">nameserver /tiktok.com/us</span><br><span class="line">nameserver /tik-tokapi.com/us</span><br><span class="line">nameserver /tiktokcdn.com/us</span><br><span class="line">nameserver /tiktokv.com/us</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ---------- &gt; Taiwan Media</span><br><span class="line"># &gt; KKTV</span><br><span class="line">nameserver /kfs.io/us</span><br><span class="line">nameserver /kktv-theater.kk.stream/us</span><br><span class="line">nameserver /kkbox.com/us</span><br><span class="line">nameserver /kkbox.com.tw/us</span><br><span class="line">nameserver /kktv.com.tw/us</span><br><span class="line">nameserver /kktv.me/us</span><br><span class="line"># &gt; LiTV</span><br><span class="line">nameserver /litv.tv/us</span><br><span class="line">nameserver /litvfreepc.akamaized.net/us</span><br><span class="line"># &gt; MyVideo</span><br><span class="line">nameserver /cdn.plyr.io/us</span><br><span class="line">nameserver /myvideo.net.tw/us</span><br><span class="line"># &gt; 4GTV</span><br><span class="line">nameserver /4gtv.tv/us</span><br><span class="line">nameserver /4gtvfreepc-cds.cdn.hinet.net/us</span><br><span class="line">nameserver /4gtvfreepcvod-cds.cdn.hinet.net/us</span><br><span class="line">nameserver /4gtvpc-cds.cdn.hinet.net/us</span><br><span class="line">nameserver /4gtvpcvod-cds.cdn.hinet.net/us</span><br><span class="line"># &gt; LineTV.TW</span><br><span class="line">nameserver /d3c7rimkq79yfu.cloudfront.net/us</span><br><span class="line">nameserver /linetv.tw/us</span><br><span class="line"># &gt; Hami Video</span><br><span class="line">nameserver /cdn.hinet.net/us</span><br><span class="line">nameserver /hamivideo.hinet.net/us</span><br><span class="line">nameserver /scc.ott.hinet.net/us</span><br><span class="line"># &gt; CatchPlay+</span><br><span class="line">nameserver /catchplay.com/us</span><br><span class="line">nameserver /d2ivmxp5z2ww0n.cloudfront.net/us</span><br><span class="line">nameserver /ols-ww100-cp.akamaized.net/us</span><br><span class="line">nameserver /tra-www000-cp.akamaized.net/us</span><br><span class="line"># &gt; Bahamut Anime</span><br><span class="line">nameserver /bahamut.com.tw/us</span><br><span class="line">nameserver /gamer.com.tw/us</span><br><span class="line">nameserver /gamer-cds.cdn.hinet.net/us</span><br><span class="line">nameserver /gamer2-cds.cdn.hinet.net/us</span><br><span class="line"></span><br><span class="line"># &gt; Friday Video</span><br><span class="line">nameserver /video.friday.tw/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; Canada Media</span><br><span class="line"># &gt; CBC Gem</span><br><span class="line">nameserver /cbc.ca/us</span><br><span class="line">nameserver /cbchd1dynamicads-i.akamaihd.net/us</span><br><span class="line">nameserver /cbclivedai5-i.akamaihd.net/us</span><br><span class="line">nameserver /cbcnewshd-f.akamaihd.net/us</span><br><span class="line">nameserver /cbcrcott-gem-key.akamaized.net/us</span><br><span class="line">nameserver /cbcrcott-gem.akamaized.net/us</span><br><span class="line">nameserver /go-mpulse.net/us</span><br><span class="line">nameserver /theplatform.com/us</span><br><span class="line"># &gt; Crave TV</span><br><span class="line">nameserver /crave.ca/us</span><br><span class="line">nameserver /go-mpulse.net/us</span><br><span class="line">nameserver /9c9media.com/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; Japan Media</span><br><span class="line"># &gt; NHK+</span><br><span class="line">nameserver /nhk.jp/us</span><br><span class="line">nameserver /nhk.or.jp/us</span><br><span class="line"># &gt; DMM</span><br><span class="line">nameserver /dmm-extension.com/us</span><br><span class="line">nameserver /dmm.co.jp/us</span><br><span class="line">nameserver /dmm.com/us</span><br><span class="line">nameserver /videomarket.jp/us</span><br><span class="line">nameserver /p-smith.com/us</span><br><span class="line">nameserver /vmdash-cenc.akamaized.net/us</span><br><span class="line">nameserver /img.vm-movie.jp/us</span><br><span class="line"># &gt; Abema</span><br><span class="line">nameserver /abema.io/us</span><br><span class="line">nameserver /abema.tv/us</span><br><span class="line">nameserver /ds-linear-abematv.akamaized.net/us</span><br><span class="line">nameserver /linear-abematv.akamaized.net/us</span><br><span class="line">nameserver /ds-vod-abematv.akamaized.net/us</span><br><span class="line">nameserver /vod-abematv.akamaized.net/us</span><br><span class="line">nameserver /vod-playout-abematv.akamaized.net/us</span><br><span class="line">nameserver /ameba.jp/us</span><br><span class="line">nameserver /hayabusa.io/us</span><br><span class="line">nameserver /bucketeer.jp/us</span><br><span class="line">nameserver /abema.adx.promo/us</span><br><span class="line">nameserver /hayabusa.media/us</span><br><span class="line">nameserver /abema-tv.com/us</span><br><span class="line"># &gt; NicoNico</span><br><span class="line">nameserver /dmc.nico/us</span><br><span class="line">nameserver /nicovideo.jp/us</span><br><span class="line">nameserver /nimg.jp/us</span><br><span class="line"># &gt; Telasa</span><br><span class="line">nameserver /telasa.jp/us</span><br><span class="line">nameserver /kddi-video.com/us</span><br><span class="line">nameserver /videopass.jp/us</span><br><span class="line">nameserver /d2lmsumy47c8as.cloudfront.net/us</span><br><span class="line"># &gt; Paravi</span><br><span class="line">nameserver /paravi.jp/us</span><br><span class="line"># &gt; U-NEXT</span><br><span class="line">nameserver /unext.jp/us</span><br><span class="line">nameserver /nxtv.jp/us</span><br><span class="line"># &gt; Hulu Japan</span><br><span class="line">nameserver /happyon.jp/us</span><br><span class="line">nameserver /hulu.jp/us</span><br><span class="line">nameserver /prod.hjholdings.tv/us</span><br><span class="line">nameserver /streaks.jp/us</span><br><span class="line">nameserver /yb.uncn.jp/us</span><br><span class="line">nameserver /hjholdings.jp/us</span><br><span class="line"># &gt; TVer</span><br><span class="line">nameserver /tver.jp/us</span><br><span class="line">nameserver /edge.api.brightcove.com/us</span><br><span class="line"># nameserver /players.brightcove.net/us</span><br><span class="line">nameserver /gorin.jp/us</span><br><span class="line">nameserver /screens-lab.jp/us</span><br><span class="line">nameserver /tver.co.jp/us</span><br><span class="line">nameserver /dogatch.jp/us</span><br><span class="line"># &gt; GYAO!</span><br><span class="line">nameserver /gyao.yahoo.co.jp/us</span><br><span class="line"># &gt; WOWOW</span><br><span class="line">nameserver /wowow.co.jp/us</span><br><span class="line"># &gt; Videomarket</span><br><span class="line">nameserver /videomarket.jp/us</span><br><span class="line"># &gt; D Anime Store</span><br><span class="line">nameserver /animestore.docomo.ne.jp/us</span><br><span class="line"># &gt; Fuji TV</span><br><span class="line">nameserver /fujitv.co.jp/us</span><br><span class="line">nameserver /stream.ne.jp/us</span><br><span class="line"># &gt; Radiko</span><br><span class="line">nameserver /radiko.jp/us</span><br><span class="line">nameserver /radionikkei.jp/us</span><br><span class="line">nameserver /smartstream.ne.jp/us</span><br><span class="line"># &gt; Karaoke@DAM</span><br><span class="line">nameserver /clubdam.com/us</span><br><span class="line"># &gt; J:com On Demand</span><br><span class="line">nameserver /id.zaq.ne.jp/us</span><br><span class="line"># &gt; AnimeFesta</span><br><span class="line">nameserver /api-animefesta.iowl.jp/us</span><br><span class="line"># &gt; Lemino</span><br><span class="line">nameserver /if.lemino.docomo.ne.jp/us</span><br><span class="line"># &gt; Rakuten TV JP</span><br><span class="line">nameserver /rakuten.co.jp/us</span><br><span class="line"># &gt; Games</span><br><span class="line">nameserver /cygames.jp/us</span><br><span class="line">nameserver /konosubafd.jp/us</span><br><span class="line">nameserver /colorfulpalette.org/us</span><br><span class="line">nameserver /worldflipper.jp/us</span><br><span class="line">nameserver /jujutsuphanpara.jp/us</span><br><span class="line"># &gt; Mora</span><br><span class="line">nameserver /mora.jp/us</span><br><span class="line"># &gt; Music.jp</span><br><span class="line">nameserver /music.jp/us</span><br><span class="line">nameserver /music-book.jp/us</span><br><span class="line"># &gt; Reads </span><br><span class="line">nameserver /data-cloudauthoring.magazine.rakuten.co.jp/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; Oceania Media</span><br><span class="line"># &gt; NBA TV</span><br><span class="line">nameserver /nba.com/us</span><br><span class="line">nameserver /neulion-a.akamaihd.net/us</span><br><span class="line">nameserver /nlnbamdnyc-a.akamaihd.net/us</span><br><span class="line">nameserver /sdk.iad-03.braze.com/us</span><br><span class="line">nameserver /nbaprop.sc.omtrdc.net/us</span><br><span class="line">nameserver /nlnbaqos.neulion.com/us</span><br><span class="line">nameserver /watchnba.cdnfastly.endeavorstreaming.net/us</span><br><span class="line">nameserver /nbaapi.neulion.com/us</span><br><span class="line">nameserver /nba-api-cdn.opin.media/us</span><br><span class="line">nameserver /neulionqos-a.akamaihd.net/us</span><br><span class="line">nameserver /neulion.com/us</span><br><span class="line">nameserver /nbaprop.tt.omtrdc.net/us</span><br><span class="line">nameserver /lion-nba-msl.akamaized.net/us</span><br><span class="line">nameserver /nbanlds19vod.akamaized.net/us</span><br><span class="line"># &gt; Acorn TV</span><br><span class="line">nameserver /edge.api.brightcove.com/us</span><br><span class="line">nameserver /api.rlje.net/us</span><br><span class="line">nameserver /boltdns.net/us</span><br><span class="line">nameserver /acorn.tv/us</span><br><span class="line"># &gt; SHOWTIME</span><br><span class="line">nameserver /sho.com/us</span><br><span class="line">nameserver /showtime.com/us</span><br><span class="line">nameserver /showtimeanytime.com/us</span><br><span class="line"># &gt; BritBox</span><br><span class="line">nameserver /vod-dash-ntham-comm-live.akamaized.net/us</span><br><span class="line">nameserver /vod-dash-ntham-comm.live.cf.md.bbci.co.uk/us</span><br><span class="line">nameserver /vod-hls-ntham-comm-live.akamaized.net/us</span><br><span class="line">nameserver /vod-hls-ntham-comm.live.cf.md.bbci.co.uk/us</span><br><span class="line">nameserver /britbox.com/us</span><br><span class="line">nameserver /d2z3p34itxwaj7.cloudfront.net/us</span><br><span class="line"># &gt; Funimation</span><br><span class="line">nameserver /funimation.com/us</span><br><span class="line">nameserver /funimationsvc.com/us</span><br><span class="line"># &gt; Paramount+</span><br><span class="line">nameserver /paramountplus.com/us</span><br><span class="line">nameserver /cbsi.live.ott.irdeto.com/us</span><br><span class="line">nameserver /cbsplaylistserver.aws.syncbak.com/us</span><br><span class="line">nameserver /cbsservice.aws.syncbak.com/us</span><br><span class="line">nameserver /link.theplatform.com/us</span><br><span class="line">nameserver /cbsaavideo.com/us</span><br><span class="line">nameserver /cbsi.com/us</span><br><span class="line">nameserver /cbsivideo.com/us</span><br><span class="line">nameserver /pplusstatic.com/us</span><br><span class="line"># &gt; AU:Stan</span><br><span class="line">nameserver /stan.com.au/us</span><br><span class="line">nameserver /stan.video/us</span><br><span class="line">nameserver /streamcoimg-a.akamaihd.net/us</span><br><span class="line">nameserver /live01-stan.akamaized.net/us</span><br><span class="line">nameserver /live02-stan.akamaized.net/us</span><br><span class="line"># &gt; AU:Binge/Kayo Sports</span><br><span class="line">nameserver /kayosports.com.au/us</span><br><span class="line">nameserver /streamotion.com.au/us</span><br><span class="line"># &gt; AU:Docplay</span><br><span class="line">nameserver /docplay.com/us</span><br><span class="line">nameserver /0c86e2d1-madman-com-au.akamaized.net/us</span><br><span class="line">nameserver /ff1be285-madman-com-au.akamaized.net/us</span><br><span class="line">nameserver /5a929471-madman-com-au.akamaized.net/us</span><br><span class="line">nameserver /879ed873-madman-com-au.akamaized.net/us</span><br><span class="line"># &gt; AU:7plus</span><br><span class="line">nameserver /7plus.com.au/us</span><br><span class="line">nameserver /npc-live-sevennetwork.akamaized.net/us</span><br><span class="line">nameserver /7plus-sevennetwork.akamaized.net/us</span><br><span class="line">nameserver /seven.demdex.net/us</span><br><span class="line">nameserver /cdn.7livecloud.io/us</span><br><span class="line"># &gt; AU:9 now</span><br><span class="line">nameserver /nine.com.au/us</span><br><span class="line">nameserver /9now.com.au/us</span><br><span class="line">nameserver /edge.api.brightcove.com/us</span><br><span class="line">nameserver /p-9now.akamaized.net/us</span><br><span class="line">nameserver /9now-livestreams.akamaized.net/us</span><br><span class="line">nameserver /9cdn.net/us</span><br><span class="line">nameserver /9nation.com.au/us</span><br><span class="line">nameserver /9news.com.au/us</span><br><span class="line">nameserver /9now.com.au/us</span><br><span class="line">nameserver /freeviewplus.net.au/us</span><br><span class="line">nameserver /mi9.com.au/us</span><br><span class="line">nameserver /mi9cdn.com/us</span><br><span class="line">nameserver /nine.com.au/us</span><br><span class="line">nameserver /nineentertainment.com.au/us</span><br><span class="line">nameserver /nineentertainmentco.com.au/us</span><br><span class="line">nameserver /ninemediaroom.com.au/us</span><br><span class="line">nameserver /ninemsn.com.au/us</span><br><span class="line">nameserver /static9.net.au/us</span><br><span class="line">nameserver /yourtv.com.au/us</span><br><span class="line"># &gt; AU:10 play</span><br><span class="line">nameserver /10play.com.au/us</span><br><span class="line">nameserver /global.ssl.fastly.net/us</span><br><span class="line">nameserver /airspace-cdn.cbsviedo.com/us</span><br><span class="line">nameserver /net10-livestream-keys.play.cbsi.video/us</span><br><span class="line">nameserver /net10-livestream.play.cbsi.video/us</span><br><span class="line">nameserver /d25m2gzplgnf0.cloudfront.net/us</span><br><span class="line"># &gt; AU:ABC iView</span><br><span class="line">nameserver /iview.abc.net.au/us</span><br><span class="line">nameserver /abc-iview-mediapackagestreams-2.akamaized.net/us</span><br><span class="line"># &gt; AU:Optus</span><br><span class="line">nameserver /optus.com.au/us</span><br><span class="line">nameserver /optusdigital.com/us</span><br><span class="line">nameserver /optusnet.com.au/us</span><br><span class="line">nameserver /optussport.tv/us</span><br><span class="line">nameserver /optusvideo.tv/us</span><br><span class="line">nameserver /tls1.yospace.com/us</span><br><span class="line">nameserver /bln1.yospace.com/us</span><br><span class="line">nameserver /d3rj5p7u4c4icq.cloudfront.net/us</span><br><span class="line">nameserver /mgd0ee5iankkv3gidl14rm7c0.litix.io/us</span><br><span class="line">nameserver /93e30b04-drm-widevine-licensing.axprod.net/us</span><br><span class="line"># &gt; AU:SBS on Demand</span><br><span class="line">nameserver /sbsod.com/us</span><br><span class="line">nameserver /sbs.com.au/us</span><br><span class="line">nameserver /videocdn-sbs.akamaized.net/us</span><br><span class="line">nameserver /sbsvoddai-vh.akamaihd.net/us</span><br><span class="line">nameserver /sbsvodns-vh.akamaihd.net/us</span><br><span class="line">nameserver /sbs-live-dai.akamaized.net/us</span><br><span class="line">nameserver /sbs-live.akamaized.net/us</span><br><span class="line">nameserver /sbs-live-dai.akamaized.net/us</span><br><span class="line"># &gt; NZ:Neon TV</span><br><span class="line">nameserver /neontv.co.nz/us</span><br><span class="line"># &gt; NZ:SkyGO NZ</span><br><span class="line">nameserver /sky.co.nz/us</span><br><span class="line">nameserver /prod-skyonelive.akamaized.net/us</span><br><span class="line">nameserver /skysportnow.co.nz/us</span><br><span class="line">nameserver /imggaming.com/us</span><br><span class="line">nameserver /pndsn.com/us</span><br><span class="line"># &gt; NZ:ThreeNow</span><br><span class="line">nameserver /fullscreen.nz/us</span><br><span class="line"># &gt; NZ:Maori TV</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># ---------- &gt; North America Media</span><br><span class="line"># &gt; FOX</span><br><span class="line">nameserver /x-live-fox-stgec.uplynk.com/us</span><br><span class="line">nameserver /fox.com/us</span><br><span class="line">nameserver /foxdcg.com/us</span><br><span class="line">nameserver /theplatform.com/us</span><br><span class="line">nameserver /cdn-fox-networks-group-green.akamaized.net/us</span><br><span class="line">nameserver /d3cv4a9a9wh0bt.cloudfront.net/us</span><br><span class="line">nameserver /foxsports01-i.akamaihd.net/us</span><br><span class="line">nameserver /foxsports02-i.akamaihd.net/us</span><br><span class="line">nameserver /foxsports03-i.akamaihd.net/us</span><br><span class="line"></span><br><span class="line"># &gt; NFL</span><br><span class="line">nameserver /nfl.com/us</span><br><span class="line"># &gt; ESPN+</span><br><span class="line">nameserver /espn.api.edge.bamgrid.com/us</span><br><span class="line">nameserver /espn.hb.omtrdc.net/us</span><br><span class="line">nameserver /espndotcom.tt.omtrdc.net/us</span><br><span class="line">nameserver /dtci.co/us</span><br><span class="line">nameserver /dtci.technology/us</span><br><span class="line">nameserver /espn.co.uk/us</span><br><span class="line">nameserver /espn.com/us</span><br><span class="line">nameserver /espn.net/us</span><br><span class="line">nameserver /espncdn.com/us</span><br><span class="line">nameserver /espnqa.com/us</span><br><span class="line">nameserver /watchespn.com/us</span><br><span class="line"># &gt; Epix</span><br><span class="line">nameserver /epix.com/us</span><br><span class="line"># &gt; Starz</span><br><span class="line">nameserver /starz.com/us</span><br><span class="line"># &gt; Philo</span><br><span class="line">nameserver /philo.com/us</span><br><span class="line"># &gt; FXNOW</span><br><span class="line">nameserver /fxnow.fxnetworks.com/us</span><br><span class="line"># &gt; TLC GO</span><br><span class="line">nameserver /geolocation.onetrust.com/us</span><br><span class="line"># &gt; HBO / Max</span><br><span class="line">nameserver /max.com/us</span><br><span class="line">nameserver /hbo.com/us</span><br><span class="line">nameserver /hbogo.com/us</span><br><span class="line">nameserver /hbomax.com/us</span><br><span class="line">nameserver /hbomaxcdn.com/us</span><br><span class="line">nameserver /hbonow.com/us</span><br><span class="line">nameserver /maxgo.com/us</span><br><span class="line">nameserver /discomax.com/us</span><br><span class="line"># &gt; Shudder</span><br><span class="line">nameserver /shudder.com/us</span><br><span class="line"># &gt; BritBox</span><br><span class="line">nameserver /vod-dash-ntham-comm-live.akamaized.net/us</span><br><span class="line">nameserver /vod-dash-ntham-comm.live.cf.md.bbci.co.uk/us</span><br><span class="line">nameserver /vod-hls-ntham-comm-live.akamaized.net/us</span><br><span class="line">nameserver /vod-hls-ntham-comm.live.cf.md.bbci.co.uk/us</span><br><span class="line">nameserver /britbox.com/us</span><br><span class="line">nameserver /d2z3p34itxwaj7.cloudfront.net/us</span><br><span class="line"># &gt; Crackle</span><br><span class="line">nameserver /crackle.com/us</span><br><span class="line"># &gt; CW TV</span><br><span class="line">nameserver /cwtv.com/us</span><br><span class="line"># &gt; A&amp;E TV</span><br><span class="line">nameserver /aetv.com/us</span><br><span class="line">nameserver /ccpa-service.sp-prod.net/us</span><br><span class="line"># &gt; NBA TV</span><br><span class="line">nameserver /nba.com/us</span><br><span class="line">nameserver /neulion-a.akamaihd.net/us</span><br><span class="line">nameserver /nlnbamdnyc-a.akamaihd.net/us</span><br><span class="line">nameserver /sdk.iad-03.braze.com/us</span><br><span class="line">nameserver /nbaprop.sc.omtrdc.net/us</span><br><span class="line">nameserver /nlnbaqos.neulion.com/us</span><br><span class="line">nameserver /watchnba.cdnfastly.endeavorstreaming.net/us</span><br><span class="line">nameserver /nbaapi.neulion.com/us</span><br><span class="line">nameserver /nba-api-cdn.opin.media/us</span><br><span class="line">nameserver /neulionqos-a.akamaihd.net/us</span><br><span class="line">nameserver /neulion.com/us</span><br><span class="line">nameserver /nbaprop.tt.omtrdc.net/us</span><br><span class="line">nameserver /lion-nba-msl.akamaized.net/us</span><br><span class="line">nameserver /nbanlds19vod.akamaized.net/us</span><br><span class="line"># &gt; Fubo TV</span><br><span class="line">nameserver /fubo.tv/us</span><br><span class="line"># &gt; Tubi TV</span><br><span class="line">nameserver /tubitv.com/us</span><br><span class="line"># &gt; Sling TV</span><br><span class="line">nameserver /dishworld.com/us</span><br><span class="line">nameserver /slinginternational.com/us</span><br><span class="line">nameserver /sling.com/us</span><br><span class="line">nameserver /movenetworks.com/us</span><br><span class="line">nameserver /movetv.com/us</span><br><span class="line"># &gt; Pluto TV</span><br><span class="line">nameserver /pluto.tv/us</span><br><span class="line"># &gt; Acorn TV</span><br><span class="line">nameserver /edge.api.brightcove.com/us</span><br><span class="line">nameserver /api.rlje.net/us</span><br><span class="line">nameserver /boltdns.net/us</span><br><span class="line">nameserver /acorn.tv/us</span><br><span class="line"># &gt; SHOWTIME</span><br><span class="line">nameserver /sho.com/us</span><br><span class="line">nameserver /showtime.com/us</span><br><span class="line">nameserver /showtimeanytime.com/us</span><br><span class="line"># &gt; encoreTVB</span><br><span class="line">nameserver /encoretvb.com/us</span><br><span class="line">nameserver /bcbolt446c5271-a.akamaihd.net/us</span><br><span class="line">nameserver /videos-f.jwpsrv.com/us</span><br><span class="line">nameserver /content.jwplatform.com/us</span><br><span class="line">nameserver /edge.api.brightcove.com/us</span><br><span class="line"># &gt; Funimation</span><br><span class="line">nameserver /funimation.com/us</span><br><span class="line"># &gt; Discovery+</span><br><span class="line">nameserver /content-ause1-ur-discovery1.uplynk.com/us</span><br><span class="line">nameserver /disco-api.com/us</span><br><span class="line">nameserver /discoveryplus.com/us</span><br><span class="line">nameserver /x-default-stgec.uplynk.com/us</span><br><span class="line">nameserver /discovery.com/us</span><br><span class="line">nameserver /discoveryplus.co.uk/us</span><br><span class="line">nameserver /getblueshift.com/us</span><br><span class="line">nameserver /litix.io/us</span><br><span class="line">nameserver /mobile-collector.newrelic.com/us</span><br><span class="line">nameserver /discovery.uplynk.com/us</span><br><span class="line"># &gt; Paramount+</span><br><span class="line">nameserver /paramountplus.com/us</span><br><span class="line">nameserver /cbsi.live.ott.irdeto.com/us</span><br><span class="line">nameserver /cbsplaylistserver.aws.syncbak.com/us</span><br><span class="line">nameserver /cbsservice.aws.syncbak.com/us</span><br><span class="line">nameserver /link.theplatform.com/us</span><br><span class="line">nameserver /cbsaavideo.com/us</span><br><span class="line">nameserver /cbsi.com/us</span><br><span class="line">nameserver /cbsivideo.com/us</span><br><span class="line">nameserver /pplusstatic.com/us</span><br><span class="line"># &gt; Peacock TV</span><br><span class="line">nameserver /peacocktv.com/us</span><br><span class="line">nameserver /peacock.com/us</span><br><span class="line"># &gt; Popcornflix</span><br><span class="line">nameserver /popcornflix.com/us</span><br><span class="line">nameserver /popcornflix-prod.cloud.seachange.com/us</span><br><span class="line"># &gt; Crunchyroll</span><br><span class="line">nameserver /crunchyroll.com/us</span><br><span class="line">nameserver /vrv.co/us</span><br><span class="line"># &gt; Directv Stream</span><br><span class="line">nameserver /atttvnow.com/us</span><br><span class="line"># &gt; KBS American</span><br><span class="line">nameserver /kbs.co.kr/us</span><br><span class="line"># &gt; KOCOWA</span><br><span class="line">nameserver /kocowa.com/us</span><br><span class="line"># &gt; F1TV</span><br><span class="line">nameserver /f1prodlive.akamaized.net/us</span><br><span class="line">nameserver /formula1.com/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; Europe Media</span><br><span class="line"># &gt; EU:Rakuten TV</span><br><span class="line">nameserver /rakuten.tv/us</span><br><span class="line"># &gt; EU:Funimation</span><br><span class="line">nameserver /funimation.com/us</span><br><span class="line"># &gt; EU:SkyShowTime</span><br><span class="line">nameserver /skyshowtimeuk.data.adobedc.net/us</span><br><span class="line">nameserver /skyshowtime.com/us</span><br><span class="line">nameserver /cssott.com/us</span><br><span class="line">nameserver /4ac1dd56e493354be504f063e4ae3440a13c6776.cws.conviva.com/us</span><br><span class="line"># &gt; EU:HBO Max</span><br><span class="line">nameserver /max.com/us</span><br><span class="line">nameserver /cinemax.com/us</span><br><span class="line">nameserver /forthethrone.com/us</span><br><span class="line">nameserver /hbo.com/us</span><br><span class="line">nameserver /hbomax.com/us</span><br><span class="line">nameserver /hbomaxcdn.com/us</span><br><span class="line">nameserver /maxgo.com/us</span><br><span class="line"># &gt; EuroSport</span><br><span class="line">nameserver /europe-fastly-mediashield-live-prod.cdn.h264.io/us</span><br><span class="line">nameserver /akamai.prod-live.h264.io/us</span><br><span class="line">nameserver /eurosport-dlvr-ott.akamaized.net/us</span><br><span class="line">nameserver /eu3-prod-images.disco-api.com/us</span><br><span class="line">nameserver /eu3-prod.disco-api.com/us</span><br><span class="line">nameserver /eurosportplayer.com/us</span><br><span class="line">nameserver /eurosport.com/us</span><br><span class="line">nameserver /eurosport.fr/us</span><br><span class="line">nameserver /eurosport.es/us</span><br><span class="line">nameserver /eurosport.ro/us</span><br><span class="line">nameserver /eurosport.io/us</span><br><span class="line">nameserver /eurosport.ru/us</span><br><span class="line">nameserver /media-shield.live.eurosport.map.fastly.net/us</span><br><span class="line">nameserver /eurosport-dlvr-ott-vod.akamaized.net/us</span><br><span class="line"># &gt; ViaPlay</span><br><span class="line">nameserver /i-viaplay-com.akamaized.net/us</span><br><span class="line">nameserver /viaplay.com/us</span><br><span class="line">nameserver /viaplay.pl/us</span><br><span class="line">nameserver /mtg-api.com/us</span><br><span class="line"># &gt; GB:Sky GO /usSkyGONZ/us</span><br><span class="line">nameserver /sky.com/us</span><br><span class="line"># &gt; GB:BritBox</span><br><span class="line">nameserver /vod-dash-ntham-comm-live.akamaized.net/us</span><br><span class="line">nameserver /vod-dash-ntham-comm.live.cf.md.bbci.co.uk/us</span><br><span class="line">nameserver /vod-hls-ntham-comm-live.akamaized.net/us</span><br><span class="line">nameserver /vod-hls-ntham-comm.live.cf.md.bbci.co.uk/us</span><br><span class="line">nameserver /britbox.com/us</span><br><span class="line">nameserver /d2z3p34itxwaj7.cloudfront.net/us</span><br><span class="line"># &gt; GB:ITV Hub</span><br><span class="line">nameserver /itvpnpmobile-a.akamaihd.net/us</span><br><span class="line">nameserver /itv.com/us</span><br><span class="line">nameserver /itvstatic.com/us</span><br><span class="line"># &gt; GB:Channel 4 **</span><br><span class="line">nameserver /channel4.com/us</span><br><span class="line"># &gt; GB:Channel 5 **</span><br><span class="line">nameserver /channel5.com/us</span><br><span class="line"># &gt; GB:BBC</span><br><span class="line">nameserver /aod-dash-uk-live.akamaized.net/us</span><br><span class="line">nameserver /aod-hls-uk-live.akamaized.net/us</span><br><span class="line">nameserver /as-dash-uk-live.akamaized.net/us</span><br><span class="line">nameserver /as-hls-uk-live.akamaized.net/us</span><br><span class="line">nameserver /vod-dash-uk-live.akamaized.net/us</span><br><span class="line">nameserver /vod-dash-ww-live.akamaized.net/us</span><br><span class="line">nameserver /vod-hls-uk-live.akamaized.net/us</span><br><span class="line">nameserver /vod-sub-uk-live.akamaized.net/us</span><br><span class="line">nameserver /vod-thumb-uk-live.akamaized.net/us</span><br><span class="line">nameserver /vod-thumb-ww-live.akamaized.net/us</span><br><span class="line">nameserver /vs-cmaf-push-uk-live.akamaized.net/us</span><br><span class="line">nameserver /bbc/us</span><br><span class="line">nameserver /bbc.co/us</span><br><span class="line">nameserver /bbc.co.uk/us</span><br><span class="line">nameserver /bbc.com/us</span><br><span class="line">nameserver /bbc.in/us</span><br><span class="line">nameserver /bbc.net.uk/us</span><br><span class="line">nameserver /bbcchinese.com/us</span><br><span class="line">nameserver /bbcfmt.hs.llnwd.net/us</span><br><span class="line">nameserver /bbcfmt.s.llnwi.net/us</span><br><span class="line">nameserver /bbci.co/us</span><br><span class="line">nameserver /bbci.co.uk/us</span><br><span class="line">nameserver /bbcmedia.co.uk/us</span><br><span class="line">nameserver /bbcpersian.com/us</span><br><span class="line">nameserver /bbcverticals.com/us</span><br><span class="line">nameserver /bidi.net.uk/us</span><br><span class="line"># &gt; GB:Discovery+</span><br><span class="line">nameserver /content-ause1-ur-discovery1.uplynk.com/us</span><br><span class="line">nameserver /disco-api.com/us</span><br><span class="line">nameserver /discoveryplus.com/us</span><br><span class="line">nameserver /x-default-stgec.uplynk.com/us</span><br><span class="line">nameserver /discovery.com/us</span><br><span class="line">nameserver /discoveryplus.co.uk/us</span><br><span class="line">nameserver /getblueshift.com/us</span><br><span class="line">nameserver /litix.io/us</span><br><span class="line">nameserver /mobile-collector.newrelic.com/us</span><br><span class="line">nameserver /discovery.uplynk.com/us</span><br><span class="line"># &gt; FR:Salto</span><br><span class="line">nameserver /salto.fr/us</span><br><span class="line"># &gt; FR:Canal+</span><br><span class="line">nameserver /canalplus.com/us</span><br><span class="line"># &gt; FR:Molotov</span><br><span class="line">nameserver /molotov.tv/us</span><br><span class="line"># &gt; FR:France.tv</span><br><span class="line">nameserver /ftven.fr/us</span><br><span class="line"># &gt; DE:Joyn</span><br><span class="line">nameserver /joyn.de/us</span><br><span class="line"># &gt; DE:Sky</span><br><span class="line">nameserver /sky.de/us</span><br><span class="line">nameserver /edge.api.brightcove.com/us</span><br><span class="line"># &gt; DE:ZDF</span><br><span class="line">nameserver /zdf.de/us</span><br><span class="line"># &gt; NL:videoland</span><br><span class="line">nameserver /videoland.com/us</span><br><span class="line"># &gt; NL:NPO</span><br><span class="line">nameserver /npo.nl/us</span><br><span class="line"># &gt; IT Rai Play</span><br><span class="line">nameserver /mediapolisvod.rai.it/us</span><br><span class="line"># &gt; RU:Amediateka</span><br><span class="line">nameserver /amediateka.ru/us</span><br><span class="line"># &gt; UA:MEGOGO</span><br><span class="line">nameserver /megogo.net/us</span><br><span class="line">nameserver /vcdn.biz/us</span><br><span class="line"># &gt; CH:Sky</span><br><span class="line">nameserver /sky.ch/us</span><br><span class="line">nameserver /zahs.tv/us</span><br><span class="line"># &gt; TR:digiturkplay</span><br><span class="line">nameserver /digiturkplay.com/us</span><br><span class="line">nameserver /dt-int-gurme-hls.mncdn.com/us</span><br><span class="line">nameserver /dt-live-int.akamaized.net/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; Hong Kong Media</span><br><span class="line"># &gt; Now E </span><br><span class="line">nameserver /nowe.com/us</span><br><span class="line">nameserver /nowestatic.com/us</span><br><span class="line"># &gt; Now TV</span><br><span class="line">nameserver /now.com/us</span><br><span class="line"># &gt; Viu.TV</span><br><span class="line">#include Viu.com</span><br><span class="line">nameserver /viu.now.com/us</span><br><span class="line">nameserver /viu.tv/us</span><br><span class="line"># &gt; MyTVSuper</span><br><span class="line">nameserver /mytvsuper.com/us</span><br><span class="line">nameserver /mytvsuperlimited.hb.omtrdc.net/us</span><br><span class="line">nameserver /mytvsuperlimited.sc.omtrdc.net/us</span><br><span class="line">nameserver /tvb.com/us</span><br><span class="line"># &gt; HOY TV</span><br><span class="line">nameserver /hoy.tv/us</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ---------- &gt; South America Media</span><br><span class="line"># &gt; HBO </span><br><span class="line">nameserver /cinemax.com/us</span><br><span class="line">nameserver /forthethrone.com/us</span><br><span class="line">nameserver /hbo.com/us</span><br><span class="line">nameserver /hbogo.com/us</span><br><span class="line">nameserver /hbomax.com/us</span><br><span class="line">nameserver /hbomaxcdn.com/us</span><br><span class="line">nameserver /hbonow.com/us</span><br><span class="line">nameserver /maxgo.com/us</span><br><span class="line"># &gt; DirecTV</span><br><span class="line">nameserver /directvgo.com/us</span><br><span class="line"># &gt; Funimation</span><br><span class="line">nameserver /funimation.com/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; Indian Media</span><br><span class="line">nameserver /discoveryplus.in/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; Korean Media</span><br><span class="line"># &gt; Wavve</span><br><span class="line">nameserver /wavve.com/us</span><br><span class="line">nameserver /pooq.co.kr/us</span><br><span class="line"># &gt; Tving</span><br><span class="line">nameserver /tving.com/us</span><br><span class="line"># &gt; Coupang Play</span><br><span class="line">nameserver /coupangplay.com/us</span><br><span class="line"># &gt; Naver TV</span><br><span class="line">nameserver /naver.com/us</span><br><span class="line">nameserver /navercorp.com/us</span><br><span class="line">nameserver /pstatic.net/us</span><br><span class="line">nameserver /smartmediarep.com/us</span><br><span class="line"># &gt; Afreeca TV</span><br><span class="line">nameserver /afreecatv.com/us</span><br><span class="line"># &gt; KBS Domestic</span><br><span class="line">nameserver /kbs.co.kr/us</span><br><span class="line"># &gt; jtbc</span><br><span class="line">nameserver /jtbc.co.kr/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; ? media</span><br><span class="line"># &gt; Setanta Sports</span><br><span class="line">nameserver /setantasports.com/us</span><br><span class="line">nameserver /imggaming.com/us</span><br><span class="line">nameserver /diceplatform.com/us</span><br><span class="line">nameserver /dicelaboratory.com/us</span><br><span class="line">nameserver /pndsn.com/us</span><br><span class="line">nameserver /imggaming.s3-eu-west-1.amazonaws.com/us</span><br><span class="line">nameserver /ux1kpaebv0.execute-api.eu-west-1.amazonaws.com/us</span><br><span class="line">nameserver /1ok961aaca.execute-api.eu-west-1.amazonaws.com/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; SouthEastAsia media</span><br><span class="line"># &gt; HBO GO Asia</span><br><span class="line">nameserver /44wilhpljf.execute-api.ap-southeast-1.amazonaws.com/us</span><br><span class="line">nameserver /bcbolthboa-a.akamaihd.net/us</span><br><span class="line">nameserver /dai3fd1oh325y.cloudfront.net/us</span><br><span class="line">nameserver /hboasia1-i.akamaihd.net/us</span><br><span class="line">nameserver /hboasia2-i.akamaihd.net/us</span><br><span class="line">nameserver /hboasia3-i.akamaihd.net/us</span><br><span class="line">nameserver /hboasia4-i.akamaihd.net/us</span><br><span class="line">nameserver /hboasia5-i.akamaihd.net/us</span><br><span class="line">nameserver /hboasialive.akamaized.net/us</span><br><span class="line">nameserver /hbogoprod-vod.akamaized.net/us</span><br><span class="line">nameserver /hbolb.onwardsmg.com/us</span><br><span class="line">nameserver /hbounify-prod.evergent.com/us</span><br><span class="line">nameserver /hbogo.co.th/us</span><br><span class="line">nameserver /hbogoasia.com/us</span><br><span class="line">nameserver /hbogoasia.hk/us</span><br><span class="line">nameserver /hbogoasia.id/us</span><br><span class="line">nameserver /hbogoasia.ph/us</span><br><span class="line">nameserver /hbogoasia.sg/us</span><br><span class="line">nameserver /hbogoasia.tw/us</span><br><span class="line"></span><br><span class="line"># &gt; SG:meWATCH</span><br><span class="line">nameserver /mewatch.sg/us</span><br><span class="line"># &gt; SG:StarHub</span><br><span class="line">nameserver /starhubgo.com/us</span><br><span class="line">nameserver /failoverstarhub.akamaized.net/us</span><br><span class="line">nameserver /scvm1sc0-ssm.anycast.nagra.com/us</span><br><span class="line">nameserver /starhubtvplus.com/us</span><br><span class="line"># &gt; CatchPlay+</span><br><span class="line">nameserver /catchplay.com/us</span><br><span class="line">nameserver /d2ivmxp5z2ww0n.cloudfront.net/us</span><br><span class="line">nameserver /ols-ww100-cp.akamaized.net/us</span><br><span class="line">nameserver /tra-www000-cp.akamaized.net/us</span><br><span class="line"># &gt; TH:TrueID </span><br><span class="line">nameserver /trueid.net/us</span><br><span class="line"># &gt; TH:AIS Play</span><br><span class="line">nameserver /aisplay.ais.co.th/us</span><br><span class="line">nameserver /ais-vidnt.com/us</span><br><span class="line"># &gt; ID:Vidio</span><br><span class="line">nameserver /geo-id-media-001-vidio-com.akamaized.net/us</span><br><span class="line"># &gt; VN:MYTV</span><br><span class="line">nameserver /mytv.vn/us</span><br><span class="line"># &gt; VN:Clip TV</span><br><span class="line">nameserver /cliptv.vn/us</span><br><span class="line"># &gt; VN:Galaxy Play</span><br><span class="line">nameserver /glxplay.io/us</span><br><span class="line"># &gt; VN:K+</span><br><span class="line">nameserver /solocoo.tv/us</span><br><span class="line"># &gt; MY:sooka</span><br><span class="line">nameserver /sooka.my/us</span><br><span class="line">nameserver /kaltura.com/us</span><br><span class="line">nameserver /1fad96d91f4f519fc79753650a57dad992c44af2.cws.conviva.com/us</span><br><span class="line"># &gt; IN:MXPlayer</span><br><span class="line">nameserver /mxplayer.in/us</span><br><span class="line"># &gt; IN:Tata Play</span><br><span class="line">nameserver /tataplay.com/us</span><br><span class="line"># &gt; IN:Zee5</span><br><span class="line">nameserver /zee5.com/us</span><br><span class="line"># &gt; IN:Jio Cinema</span><br><span class="line">nameserver /content-jiovoot.voot.com/us</span><br><span class="line"># &gt; UAE:shahid</span><br><span class="line">nameserver /mbc.net/us</span><br><span class="line">nameserver /npaw.com/us</span><br><span class="line">nameserver /shahid.net/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; AI Platform</span><br><span class="line"># &gt; Openai</span><br><span class="line">nameserver /openai.com/us</span><br><span class="line">nameserver /chatgpt.com/us</span><br><span class="line">nameserver /oaistatic.com/us</span><br><span class="line">nameserver /oaiusercontent.com/us</span><br><span class="line"># &gt; ExHantai/E-hentai</span><br><span class="line">nameserver /exhentai.org/us</span><br><span class="line">nameserver /e-hentai.org/us</span><br><span class="line"># &gt; Claude 2</span><br><span class="line">nameserver /anthropic.com/us</span><br><span class="line">nameserver /claude.ai/us</span><br><span class="line"># &gt; Google Gemini</span><br><span class="line">nameserver /gemini.google.com/us</span><br><span class="line">nameserver /proactivebackend-pa.googleapis.com/us</span><br><span class="line"># &gt; Google AiStudio</span><br><span class="line">nameserver /aistudio.google.com/us</span><br><span class="line">nameserver /alkalimakersuite-pa.clients6.google.com/us</span><br><span class="line">nameserver /generativelanguage.googleapis.com/us</span><br><span class="line"># &gt; Microsoft Copilot For Image Generates</span><br><span class="line">nameserver /copilot.microsoft.com/us</span><br><span class="line"></span><br><span class="line"># ---------- &gt; China Media</span><br><span class="line"></span><br><span class="line"># &gt; BiliBili</span><br><span class="line">nameserver /bilibili.com/us</span><br><span class="line">nameserver /bilibili.tv/us</span><br><span class="line"></span><br><span class="line"># &gt; iQiyi</span><br><span class="line">nameserver /71.am/us</span><br><span class="line">nameserver /71.am.com/us</span><br><span class="line">nameserver /71edge.com/us</span><br><span class="line">nameserver /71edge.net/us</span><br><span class="line">nameserver /aianno.cn/us</span><br><span class="line">nameserver /aianno.com/us</span><br><span class="line">nameserver /aiqiyicloud-mgmt.com/us</span><br><span class="line">nameserver /aiqiyicloud.com/us</span><br><span class="line">nameserver /aiqiyicloud.net/us</span><br><span class="line">nameserver /baiying.com/us</span><br><span class="line">nameserver /gitv.cn/us</span><br><span class="line">nameserver /gitv.tv/us</span><br><span class="line">nameserver /ibkstore.com/us</span><br><span class="line">nameserver /iq.com/us</span><br><span class="line">nameserver /iqiyi.com/us</span><br><span class="line">nameserver /iqiyi.demo.uwp/us</span><br><span class="line">nameserver /iqiyiedge.com/us</span><br><span class="line">nameserver /iqiyiedge.net/us</span><br><span class="line">nameserver /iqiyipic.com/us</span><br><span class="line">nameserver /jiangbing.cn/us</span><br><span class="line">nameserver /pps.tv/us</span><br><span class="line">nameserver /ppsimg.com/us</span><br><span class="line">nameserver /ppstream.cn/us</span><br><span class="line">nameserver /ppstream.com/us</span><br><span class="line">nameserver /ppstream.com.cn/us</span><br><span class="line">nameserver /ppstream.net/us</span><br><span class="line">nameserver /ppstream.net.cn/us</span><br><span class="line">nameserver /ppsurl.com/us</span><br><span class="line">nameserver /qiyi.cn/us</span><br><span class="line">nameserver /qiyi.com/us</span><br><span class="line">nameserver /qiyipic.com/us</span><br><span class="line">nameserver /qy.com/us</span><br><span class="line">nameserver /qy.net/us</span><br><span class="line">nameserver /suike.cn/us</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;自动-流媒体一键修改解锁dns脚本&quot;&gt;自动-流媒体一键修改解锁DNS脚本&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;支持操作系统&lt;/strong&gt;: Debian &amp;amp; Ubuntu&lt;/p&gt;
&lt;h2 id=&quot;项目简介&quot;&gt;项目简介&lt;/h2&gt;
&lt;p&gt;该脚本旨在帮助用户通过</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
    <category term="流媒体" scheme="https://blog.lthero.cn/tags/%E6%B5%81%E5%AA%92%E4%BD%93/"/>
    
  </entry>
  
  <entry>
    <title>【自建】建立自己的代理机场</title>
    <link href="https://blog.lthero.cn/2024/11/26/BuildYourOwnProxyhub/"/>
    <id>https://blog.lthero.cn/2024/11/26/BuildYourOwnProxyhub/</id>
    <published>2024-11-26T12:58:48.000Z</published>
    <updated>2024-12-23T02:41:32.198Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://blog.lthero.top/2024/11/26/BuildYourOwnProxyhub/">跳转到搭建hysteria2文章</a></p><p><a href="https://blog.lthero.top/2024/07/18/Install-vless-reality/">跳转到搭建vless-realit文章</a></p><h1 id="自建机场">自建机场</h1><p><strong>声明：本方法建立的机场仅限技术交流，无实际交易教程！</strong></p><p><strong>本方法搭建的机场属于代理直连的方式，非中转机场等高级玩法</strong></p><blockquote><p>先用两句话说明自建机场的逻辑</p><p>1、用<code>Xboard</code>创建机场的前端，<strong>在一台服务器A上部署</strong>即可，用户管理、流量管理等功能全在这上面</p><p>2、使用<code>V2bX</code>创建机场的后端（运行了各种代理服务，如ss, v2ray, hysteria2等）。V2bX会获取节点信息、用户鉴权信息与上报用户流量到服务器A，<strong>V2bX部署在服务器A,B,C,D等</strong></p></blockquote><h2 id="xboard部署教程">Xboard部署教程</h2><h3 id="安装">安装</h3><p>下面是使用Docker-Compose进行部署</p><blockquote><p><strong>仅在服务器A上部署</strong></p><p>Xboard更多安装方式参考：<a href="https://github.com/cedar2025/Xboard">https://github.com/cedar2025/Xboard</a></p></blockquote><p>安装docker</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.docker.com | bash</span><br></pre></td></tr></table></figure><p>获取Docker compose 文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone -b  docker-compose --depth 1 https://github.com/cedar2025/Xboard</span><br><span class="line">cd Xboard</span><br></pre></td></tr></table></figure><p>执行数据库安装命令</p><blockquote><p>自动选择 <strong>启用sqlite</strong> 和 <strong>Docker内置的Redis</strong></p><p>修改下面的your_admin_email@example.com 为自己的管理员账号</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose run -it --rm -e enable_sqlite=true -e enable_redis=true -e admin_account=your_admin_email@example.com xboard php artisan xboard:install</span><br></pre></td></tr></table></figure><blockquote><p>手动根据自己的需要在运行时选择sqlite和redis，以及手动输入管理员账号</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose run -it --rm xboard php artisan xboard:install</span><br></pre></td></tr></table></figure><blockquote><p>执行这条命令之后，会返回你的后台地址(asdfasqeb)和管理员账号密码（<strong>你需要记录下来后台地址</strong>）！<br>你需要执行下面的 <strong>启动xborad</strong> 步骤之后才能访问后台</p></blockquote><p>启动Xboard</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><blockquote><p>安装完成之后即可访问你的站点</p></blockquote><p>访问站点</p><blockquote><p>启动之后网站端口默认为7001, 你可以配置nginx反向代理使用80端口</p></blockquote><p>网站地址: <a href="http://xn--IP-0p3cm89l:7001/">http://你的IP:7001/</a></p><p>后台地址：<a href="http://xn--IP-0p3cm89l:7001/asdfasqeb">http://你的IP:7001/asdfasqeb</a></p><p>在此你已经成功部署了, 你可以访问网址体验Xboard的完整功能，</p><blockquote><p>如果你需要使用mysql，请自行安装Mysql后重新部署</p></blockquote><h3 id="更新"><strong>更新</strong></h3><p>修改版本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd Xboard</span><br><span class="line">vi docker-compose.yaml</span><br></pre></td></tr></table></figure><blockquote><p>修改docker-compose.yaml 当中image后面的版本号为你需要的版本<br>如果为版本为latest 则可以忽略这一步，直接进行第二步</p></blockquote><p>更新数据库（可以执行多次都是安全的）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker compose pull</span><br><span class="line">docker compose down</span><br><span class="line">docker compose run -it --rm xboard php artisan xboard:update</span><br><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><blockquote><p>即可更新成功</p></blockquote><h3 id="回滚"><strong>回滚</strong></h3><blockquote><p>此回滚不回滚数据库，是否回滚数据库请查看相关文档</p></blockquote><p>回退版本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi docker-compose.yaml</span><br></pre></td></tr></table></figure><blockquote><p>修改docker-compose.yaml 当中image后面的版本号为更新前的版本号</p></blockquote><p>启动</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><h3 id="注意">注意</h3><p>启用webman后做的任何代码修改都需要重启生效</p><h2 id="xboard添加节点">Xboard添加节点</h2><blockquote><p>在Xboard的管理页面添加节点，在添加节点前，先添加一个订阅服务（金额流量等信息可以随便填写）</p></blockquote><p>这里以配置hysteria2为例，并且是使用自签证书的形式，<a href="http://xn--bing-494f58bbyus1hf9y35i7i9b1o8e.com">所以下面的域名是bing.com</a></p><p>在Xboard里先一个节点</p><ul><li><p>节点名称 ：任意</p></li><li><p>倍率：任意</p></li><li><p>节点地址：<strong>将运行hysteria的服务器</strong>（可以是服务器A,B,C,D等），写公网<strong>IP地址</strong></p></li><li><p>连接端口：选择服务器A（运行了board）上<strong>空闲的端口</strong></p></li><li><p>服务端口：将运行hysteria2的服务器（如B,C,D）中hysteria2进程的端口</p><ul><li><strong>连接端口和服务端口要写一样的，否则无法正常使用</strong>，理论上应该是可以不同的，但可能是bug</li></ul></li><li><p>允许不安全：是</p></li><li><p>协议版本：v2</p></li><li><p>开启obfs：否</p></li><li><p>sni：<a href="http://bing.com">bing.com</a></p><ul><li>如果使用公认证书，请输入指向这台服务器的域名（A,B,C,D等运行hy协议的服务器）</li></ul></li><li><p>上行带宽：100</p></li><li><p>下行带宽：200</p></li><li><p>父节点：无</p></li></ul><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241125235329948.png" alt="image-20241125235329948"></p><p>至此，已经完成了前端的工作，后面是将添加的节点进行实际运行起来，<strong>节点的部署</strong>可以运行在不同于服务器A(运行了Xboard)的机器B,C,D上</p><blockquote><p>强烈推荐在部署节点之前，<strong>先配置好https访问</strong>，后面两步是配置https的过程</p></blockquote><ol><li>先配置http访问</li><li>再配置https访问，不要跳过</li></ol><h2 id="使用http访问">使用HTTP访问</h2><p>要将运行在Docker容器中的服务通过域名访问，并使用Nginx作为反向代理来转发到宿主机的7001端口，你需要完成几个步骤。这包括设置DNS记录、配置Nginx以及确保网络安全。下面是具体步骤：</p><h3 id="步骤-1-设置dns记录">步骤 1: 设置DNS记录</h3><p>确保你的域名 <code>board.lthero.top</code> 的DNS记录指向托管Nginx的服务器的IP地址。这通常在你的域名注册商处进行设置：</p><ul><li><strong>A记录</strong>：将域名指向IPv4地址。</li><li><strong>AAAA记录</strong>：将域名指向IPv6地址（如果适用）。</li></ul><h3 id="步骤-2-安装并启动nginx">步骤 2: 安装并启动Nginx</h3><p>步骤 1: 更新软件包列表</p><p>打开终端，首先使用<code>apt</code>命令更新你的包列表，以确保你安装的是最新版本的Nginx。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><p>步骤 2: 安装Nginx</p><p>使用<code>apt</code>安装Nginx。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure><h3 id="步骤-3-配置nginx">步骤 3: 配置Nginx</h3><p>你需要在Nginx中创建一个新的服务器块（server block），或者在已有的默认配置中修改，以设置反向代理。以下是一个基本的Nginx配置示例，将会把所有到 <code>board.lthero.top</code> 的请求转发到本地的7001端口：</p><ol><li><p>打开或创建一个新的Nginx配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/board.lthero.top</span><br></pre></td></tr></table></figure></li><li><p>添加以下配置：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> board.lthero.top;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:7001;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个配置做了以下几点：</p><ul><li><code>listen 80;</code> 告诉Nginx监听80端口（HTTP标准端口）。</li><li><code>server_name board.lthero.top;</code> 设置这个块应当响应的域名。</li><li><code>proxy_pass http://localhost:7001;</code> 指定所有传入的请求转发到本地的7001端口。</li><li><code>proxy_set_header</code> 指令将重要的HTTP头信息转发给后端应用。</li></ul></li><li><p>启用配置文件通过创建一个符号链接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /etc/nginx/sites-available/board.lthero.top /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure></li><li><p>检查Nginx配置文件是否有语法错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure></li><li><p>如果没有错误，重启Nginx以应用配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure></li></ol><h3 id="步骤-4-调整防火墙规则">步骤 4: 调整防火墙规则</h3><p>确保你的服务器的防火墙规则允许HTTP（端口80）和HTTPS（端口443，如果你使用SSL）的流量。如果你正在使用<code>ufw</code>，可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow <span class="string">&#x27;Nginx Full&#x27;</span></span><br><span class="line">sudo ufw reload</span><br></pre></td></tr></table></figure><h3 id="步骤-5-测试配置">步骤 5: 测试配置</h3><p>在浏览器中输入 <code>http://board.lthero.top</code> 或使用命令行工具如 <code>curl</code> 来测试你的配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://board.lthero.top</span><br></pre></td></tr></table></figure><p>你应该能看到从Docker容器中运行的服务响应的内容。</p><p>这样，你就配置好了Nginx作为反向代理，将域名 <code>board.lthero.top</code> 的流量转发到宿主机的7001端口上的服务。如果你希望使用HTTPS，你还需要设置SSL证书，可以考虑使用Let’s Encrypt免费证书并配置HTTPS。</p><h2 id="使用https访问">使用HTTPS访问</h2><p>要让你的域名 <code>board.lthero.top</code> 使用 HTTPS，你需要获取 SSL/TLS 证书，并配置 Nginx 以使用这些证书来加密网页内容。以下是详细的步骤，包括如何使用 Let’s Encrypt 提供的免费证书自动化这个过程。</p><h3 id="步骤-1-安装-certbot">步骤 1: 安装 Certbot</h3><p>Certbot 是一个自动获取并安装 Let’s Encrypt 证书的客户端。在 Ubuntu 上安装 Certbot 及其 Nginx 插件非常简单：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install certbot python3-certbot-nginx -y</span><br></pre></td></tr></table></figure><h3 id="步骤-2-获取和安装证书">步骤 2: 获取和安装证书</h3><p>使用 Certbot 获取并为你的域名安装证书：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx -d board.lthero.top</span><br></pre></td></tr></table></figure><p>此命令会自动为指定的域名 <code>board.lthero.top</code> 配置 SSL 证书，并更新 Nginx 配置以使用这些证书。</p><p>Certbot 会询问你一些问题，比如电子邮件地址（用于紧急联系和证书续订提醒）</p><p>以及<strong>是否重定向所有 HTTP 请求到 HTTPS（强烈建议启用）</strong>，如果启用，它用自动修改board.lthero.top的nginx配置文件，</p><p>生成的证书位置<code>/etc/letsencrypt/live/</code></p><h3 id="步骤-3-更新-nginx-配置">步骤 3: 更新 Nginx 配置</h3><p>如果你想手动编辑 Nginx 配置文件，可以按以下方式配置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/board.lthero.top</span><br></pre></td></tr></table></figure><ol><li>如果你的配置文件里已经出现“# managed by Certbot”等内容，说明Certbot已经将配置文件修改好了，直接重启nginx即可</li><li>记得将下面所有的board.lthero.top换成你的域名</li><li>这里的7001端口是Xboard运行端口</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">server_name</span> board.lthero.top;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:7001;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/board.lthero.top/fullchain.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/board.lthero.top/privkey.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">include</span> /etc/letsencrypt/options-ssl-nginx.conf; <span class="comment"># managed by Certbot</span></span><br><span class="line">    <span class="attribute">ssl_dhparam</span> /etc/letsencrypt/ssl-dhparams.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$host</span> = board.lthero.top) &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">    &#125; <span class="comment"># managed by Certbot</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> board.lthero.top;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">404</span>; <span class="comment"># managed by Certbot</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="步骤-4-重新加载-nginx">步骤 4: 重新加载 Nginx</h3><p>更改配置后，需要重新加载 Nginx 以应用新的配置：</p><blockquote><p>检查配置文件是否有语法错误，如果有warn!直接看“遇到的问题”部分，重新加载配置是不一定能work的</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t  <span class="comment"># 检查配置文件是否有语法错误</span></span><br><span class="line">sudo systemctl reload nginx  <span class="comment"># 重新加载配置</span></span><br><span class="line"><span class="comment"># 如果重新加载配置后无效，可以尝试重启nginx</span></span><br><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure><h3 id="步骤-5-验证-https">步骤 5: 验证 HTTPS</h3><p>在浏览器中访问 <code>https://board.lthero.top</code> 来检查是否配置成功。你应该能够看到一个安全锁标志，表明连接是通过 HTTPS 加密的。</p><h3 id="步骤-6-自动续订证书">步骤 6: 自动续订证书</h3><p>Let’s Encrypt 的证书有效期为90天，因此建议设置自动续订：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew</span><br></pre></td></tr></table></figure><p>这个命令会测试证书续订过程。如果这个测试成功，添加定时任务<code>crontab</code>：</p><p><code>crontab -e</code>再填写下面内容，表示每月第一天会自动执行</p><p>通过<code>which certbot</code>查看具体程序位置<code>/usr/local/bin/certbot</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 * * /usr/local/bin/certbot renew --deploy-hook <span class="string">&quot;nginx -s reload&quot;</span></span><br></pre></td></tr></table></figure><p>续签的证书位置<code>/etc/letsencrypt/renewal</code></p><p>通过以上步骤，你的站点 <code>board.lthero.top</code> 现在应该能够安全地使用 HTTPS 进行通信了。</p><p>如果要换crontab编辑器，运行下面的命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select-editor</span><br></pre></td></tr></table></figure><p>至此，已经配置好https访问，下面开始<strong>部署代理服务</strong></p><hr><h2 id="v2bx部署代理服务">V2bX部署代理服务</h2><blockquote><p>在需要**运行节点的服务器（A,B,C,D等）**上安装V2bX，从而运行hysteria2, v2ray, vless, ss等协议</p><p>在V2bX上运行的代理协议可对接到Xboard上，会将用户使用情况上传到Xboard上并统计</p><p>视频参考：<a href="https://youtu.be/Fwn0nFbB0zY?t=720">https://youtu.be/Fwn0nFbB0zY?t=720</a></p></blockquote><h3 id="v2bx安装">V2bX安装</h3><p>执行下面的命令，安装V2bX</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -N https://raw.githubusercontent.com/wyx2685/V2bX-script/master/install.sh &amp;&amp; bash install.sh</span><br></pre></td></tr></table></figure><p>配置文件路径：<code>/etc/V2bX</code> 配置文件详见：<a href="https://v2bx.v-50.me/v2bx/v2bx-pei-zhi-wen-jian-shuo-ming/config">配置文件说明</a></p><p>下面是在<strong>服务器B</strong>上运行hysteria2协议的配置过程</p><ul><li><p>输入机场网址与API Key</p><ul><li>机场网址就是域名https://board.lthero.top，而API key在Xboard的管理网页中，找到“系统配置”-&gt;“节点”-&gt;“通讯密钥”</li><li>原理是V2bX拿着密钥，到board.lthero.top上面获取你配置的节点的信息；根据这些节点信息，V2bX在服务器(A,B,C,D)上运行服务（如hysteria2协议，Vless协议等）</li></ul></li><li><p>选择核心：<strong>singbox</strong> 对应的序号</p></li><li><p>选择协议：<strong>hysteria2</strong> 对应的序号</p></li><li><p>证书模式：<strong>self模式</strong> 对应的序号</p><ul><li>如果使用公认证书，请使用<strong>http模式</strong>，你需要解析一个域名到这个<strong>服务器B的节点服务</strong>，如：hy-jp-b.lthero.top</li><li>如果你仍然使用<strong>服务器A</strong>运行节点，请不要使用board.lthero.top，请重新配置一条域名解析到<strong>节点服务</strong>,如：，如：hy-jp-a.lthero.top</li></ul></li><li><p>输入节点证书域名：<strong><a href="http://bing.com">bing.com</a></strong></p><ul><li>如果使用公认证书，请输入指向这台VPS的域名</li></ul></li><li><p>输入n退出（除非想添加其它协议）</p></li></ul><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241125235810854.png" alt="image-20241125235810854"></p><p>随后，输入 <code>V2bX</code> 查看V2bX的配置或修改配置文件，<strong>每次修改配置文件后V2bX会自动重启</strong></p><p>这里吐槽一句啊，它只能初始化的时候使用交互方式进行文件配置，后续只能手动修改配置文件，对新手不友好。</p><p>如果想重新使用交互方式，只能将V2bX卸载后重装。</p><h3 id="hysteria2自签证书的配置文件">hysteria2自签证书的配置文件</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Log&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;Level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;error&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Output&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Cores&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;Type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sing&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Log&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;error&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Timestamp&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;NTP&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Enable&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;time.apple.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ServerPort&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;OriginalPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/V2bX/sing_origin.json&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Nodes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Core&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sing&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ApiHost&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://xxx.lthero.top&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ApiKey&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;NodeID&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;NodeType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hysteria2&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Timeout&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ListenIP&quot;</span><span class="punctuation">:</span> <span class="string">&quot;::&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;SendIP&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;DeviceOnlineMinTraffic&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;TCPFastOpen&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;SniffEnabled&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;CertConfig&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;CertMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;self&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;RejectUnknownSni&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CertDomain&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bing.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CertFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/V2bX/fullchain.cer&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;KeyFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/V2bX/cert.key&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;Email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;v2bx@github.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;Provider&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cloudflare&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;DNSEnv&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;EnvName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;env1&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="hysteria2使用证书">hysteria2使用证书</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;Nodes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Core&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sing&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ApiHost&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://board.lthero.top&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ApiKey&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxxxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;NodeID&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;NodeType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hysteria2&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Timeout&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ListenIP&quot;</span><span class="punctuation">:</span> <span class="string">&quot;::&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;SendIP&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;DeviceOnlineMinTraffic&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;TCPFastOpen&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;SniffEnabled&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;CertConfig&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;CertMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;RejectUnknownSni&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">                <span class="comment">//唯一的区别是，这里写解析到节点服务的域名</span></span><br><span class="line">                <span class="attr">&quot;CertDomain&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ak-jp.lthero.top&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;CertFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/V2bX/fullchain.cer&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;KeyFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/V2bX/cert.key&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;Email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;v2bx@github.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;Provider&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cloudflare&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;DNSEnv&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;EnvName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;env1&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><hr><h2 id="其它对接xboard的工具">其它对接Xboard的工具</h2><p>除了V2bX，还有个对接Xboard的工具：</p><p><a href="https://github.com/FireinRainLab/hysteria-v2board">https://github.com/FireinRainLab/hysteria-v2board</a></p><p><a href="https://github.com/cedar2025/hysteria">https://github.com/cedar2025/hysteria</a></p><p>这工具是将hysteria2打包到docker中，并且将用户使用数据对接到Xboard/V2board</p><h1 id="蒸蒸日上的工具">蒸蒸日上的工具</h1><h2 id="一键抢主机脚本">一键抢主机脚本</h2><p><a href="https://chromewebstore.google.com/detail/one-click-checkout-for-wh/">https://chromewebstore.google.com/detail/one-click-checkout-for-wh/</a></p><p>支持 * RackNerd * SpartanHost * GreenCloudVPS</p><h2 id="主机全方面测试">主机全方面测试</h2><blockquote><p>包含主机cpu性能、磁盘测试、流媒体解锁测试、速度及延迟测试等</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://github.com/spiritLHLS/ecs/raw/main/ecs.sh -o ecs.sh &amp;&amp; <span class="built_in">chmod</span> +x ecs.sh &amp;&amp; bash ecs.sh</span><br></pre></td></tr></table></figure><p>工具来源：<a href="https://digvps.com/tools/ecs">https://digvps.com/tools/ecs</a></p><h2 id="流媒体解锁检测">流媒体解锁检测</h2><p>RegionRestrictionCheck 检测脚本检测项目比较全面，且支持Docker运行，杜绝污染VPS服务器，检测流媒体除了主流的Netflix、Disney+、YouTube Premium，还可以支持检测Dazn、Viu TV、4GTV和KKTV等比较冷门的流媒体服务。</p><blockquote><p>支持OS/Platform：CentOS 6+, Ubuntu 14.04+, Debian 8+, MacOS, Android with Termux</p></blockquote><h3 id="使用方法">使用方法</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -L -s check.unlock.media)</span><br></pre></td></tr></table></figure><p>只检测IPv4结果:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -L -s check.unlock.media) -M 4</span><br></pre></td></tr></table></figure><p>只检测IPv6结果：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -L -s check.unlock.media) -M 6</span><br></pre></td></tr></table></figure><h2 id="部分测试结果">部分测试结果</h2><h3 id="do">DO</h3><p>美国SF-1c2g</p><p><a href="https://paste.spiritlhl.net/code/K1XMh0.txt">https://paste.spiritlhl.net/code/K1XMh0.txt</a></p><h3 id="racknerd">RackNerd</h3><p>美国LA-1c2g</p><p><a href="https://paste.spiritlhl.net/code/ECrxxe.txt">https://paste.spiritlhl.net/code/ECrxxe.txt</a></p><p>美国LA-2c2.5g</p><p><a href="https://paste.spiritlhl.net/code/dKstV2.txt">https://paste.spiritlhl.net/code/dKstV2.txt</a></p><p>美国LA-黑五闪够 2c2g</p><p><a href="https://paste.spiritlhl.net/code/t9bdNE.txt">https://paste.spiritlhl.net/code/t9bdNE.txt</a></p><h3 id="akile">Akile</h3><p>美国LA-1c1g</p><p><a href="https://paste.spiritlhl.net/code/GWNS6v.txt">https://paste.spiritlhl.net/code/GWNS6v.txt</a></p><h3 id="vkvm">vkvm</h3><p>美国LA-2c4g</p><p><a href="https://paste.spiritlhl.net/u/9taqwb.txt">https://paste.spiritlhl.net/u/9taqwb.txt</a></p><h3 id="物语云">物语云</h3><p><a href="https://paste.spiritlhl.net/u/gyE4an.txt">https://paste.spiritlhl.net/u/gyE4an.txt</a></p><p>vkvm家的不大行，超售，导致机器实际性能与纸上数据相差非常大；</p><p>Akile的跑分不错，实际测试性能还行，至少一边运行docker并上传一个500MB文件，另一边使用hy2看4k视频能到9万分；</p><p>Racknerd和DO的，主打个内存大，但cpu性能一般；</p><h1 id="遇到的问题">遇到的问题</h1><h2 id="用户订阅链接无输出">用户订阅链接无输出</h2><p>如果所有节点都是hysteria2协议，会出现订阅链接输出是空白；此时直接在pc端导入到clash是正常的</p><p>尝试添加如vless协议的节点，但在安卓、苹果端仍然无法直接导入hysteria2协议</p><h2 id="数据迁移">数据迁移</h2><p>数据库位置：/root/Xboard/.docker/.data/database.sqlite</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://blog.lthero.top/2024/11/26/BuildYourOwnProxyhub/&quot;&gt;跳转到搭建hysteria2文章&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.lthero.top/2024/07/1</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
    <category term="代理" scheme="https://blog.lthero.cn/tags/%E4%BB%A3%E7%90%86/"/>
    
    <category term="vps" scheme="https://blog.lthero.cn/tags/vps/"/>
    
    <category term="机场" scheme="https://blog.lthero.cn/tags/%E6%9C%BA%E5%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>在线文件共享平台</title>
    <link href="https://blog.lthero.cn/2024/11/24/OnlineFileSharing/"/>
    <id>https://blog.lthero.cn/2024/11/24/OnlineFileSharing/</id>
    <published>2024-11-24T09:34:49.000Z</published>
    <updated>2024-11-27T08:23:57.073Z</updated>
    
    <content type="html"><![CDATA[<h1 id="在线文件共享平台">在线文件共享平台</h1><blockquote><p>提供短时/长期（类似蓝奏云）的文件分享，无文件类型限制</p></blockquote><h1 id="项目安装">项目安装</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/stonith404/pingvin-share.git</span><br><span class="line"><span class="built_in">cd</span> pingvin-share</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据实际需求，修改映射端口等，如映射到宿主机的3001端口</span></span><br><span class="line"><span class="comment"># vim docker-compose.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行</span></span><br><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><h1 id="使用http访问">使用HTTP访问</h1><p>要将运行在Docker容器中的服务通过域名访问，并使用Nginx作为反向代理来转发到宿主机的3001端口，你需要完成几个步骤。这包括设置DNS记录、配置Nginx以及确保网络安全。下面是具体步骤：</p><h2 id="步骤-1-设置dns记录">步骤 1: 设置DNS记录</h2><p>确保你的域名 <code>fs.lthero.top</code> 的DNS记录指向托管Nginx的服务器的IP地址。这通常在你的域名注册商处进行设置：</p><ul><li><strong>A记录</strong>：将域名指向IPv4地址。</li><li><strong>AAAA记录</strong>：将域名指向IPv6地址（如果适用）。</li></ul><h2 id="步骤-2-安装并启动nginx">步骤 2: 安装并启动Nginx</h2><p>步骤 1: 更新软件包列表</p><p>打开终端，首先使用<code>apt</code>命令更新你的包列表，以确保你安装的是最新版本的Nginx。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><p>步骤 2: 安装Nginx</p><p>使用<code>apt</code>安装Nginx。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure><h2 id="步骤-3-配置nginx">步骤 3: 配置Nginx</h2><p>你需要在Nginx中创建一个新的服务器块（server block），或者在已有的默认配置中修改，以设置反向代理。以下是一个基本的Nginx配置示例，将会把所有到 <code>fs.lthero.top</code> 的请求转发到本地的3001端口：</p><ol><li><p>打开或创建一个新的Nginx配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/fs.lthero.top</span><br></pre></td></tr></table></figure></li><li><p>添加以下配置：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> fs.lthero.top;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:3001;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个配置做了以下几点：</p><ul><li><code>listen 80;</code> 告诉Nginx监听80端口（HTTP标准端口）。</li><li><code>server_name fs.lthero.top;</code> 设置这个块应当响应的域名。</li><li><code>proxy_pass http://localhost:3001;</code> 指定所有传入的请求转发到本地的3001端口。</li><li><code>proxy_set_header</code> 指令将重要的HTTP头信息转发给后端应用。</li></ul></li><li><p>启用配置文件通过创建一个符号链接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /etc/nginx/sites-available/fs.lthero.top /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure></li><li><p>检查Nginx配置文件是否有语法错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure></li><li><p>如果没有错误，重启Nginx以应用配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure></li></ol><h2 id="步骤-4-调整防火墙规则">步骤 4: 调整防火墙规则</h2><p>确保你的服务器的防火墙规则允许HTTP（端口80）和HTTPS（端口443，如果你使用SSL）的流量。如果你正在使用<code>ufw</code>，可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow <span class="string">&#x27;Nginx Full&#x27;</span></span><br><span class="line">sudo ufw reload</span><br></pre></td></tr></table></figure><h2 id="步骤-5-测试配置">步骤 5: 测试配置</h2><p>在浏览器中输入 <code>http://fs.lthero.top</code> 或使用命令行工具如 <code>curl</code> 来测试你的配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://fs.lthero.top</span><br></pre></td></tr></table></figure><p>你应该能看到从Docker容器中运行的服务响应的内容。</p><p>这样，你就配置好了Nginx作为反向代理，将域名 <code>fs.lthero.top</code> 的流量转发到宿主机的3001端口上的服务。如果你希望使用HTTPS，你还需要设置SSL证书，可以考虑使用Let’s Encrypt免费证书并配置HTTPS。</p><h1 id="使用https访问">使用HTTPS访问</h1><p>要让你的域名 <code>fs.lthero.top</code> 使用 HTTPS，你需要获取 SSL/TLS 证书，并配置 Nginx 以使用这些证书来加密网页内容。以下是详细的步骤，包括如何使用 Let’s Encrypt 提供的免费证书自动化这个过程。</p><h2 id="步骤-1-安装-certbot">步骤 1: 安装 Certbot</h2><p>Certbot 是一个自动获取并安装 Let’s Encrypt 证书的客户端。在 Ubuntu 上安装 Certbot 及其 Nginx 插件非常简单：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install certbot python3-certbot-nginx -y</span><br></pre></td></tr></table></figure><h2 id="步骤-2-获取和安装证书">步骤 2: 获取和安装证书</h2><p>使用 Certbot 获取并为你的域名安装证书：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx -d fs.lthero.top</span><br></pre></td></tr></table></figure><p>此命令会自动为指定的域名 <code>fs.lthero.top</code> 配置 SSL 证书，并更新 Nginx 配置以使用这些证书。Certbot 会询问你一些问题，比如电子邮件地址（用于紧急联系和证书续订提醒），以及是否重定向所有 HTTP 请求到 HTTPS（强烈建议启用）。</p><p>生成的证书位置<code>/etc/letsencrypt/live/</code></p><h2 id="步骤-3-更新-nginx-配置">步骤 3: 更新 Nginx 配置</h2><p>如果你想手动编辑 Nginx 配置文件，可以按以下方式配置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/fs.lthero.top</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    server_name fs.lthero.top;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://localhost:3001;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection &#x27;upgrade&#x27;;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_cache_bypass $http_upgrade;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    listen 443 ssl; # managed by Certbot</span><br><span class="line">    ssl_certificate /etc/letsencrypt/live/fs.lthero.top/fullchain.pem; # managed by Certbot</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/fs.lthero.top/privkey.pem; # managed by Certbot</span><br><span class="line">    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot</span><br><span class="line">    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    if ($host = fs.lthero.top) &#123;</span><br><span class="line">        return 301 https://$host$request_uri;</span><br><span class="line">    &#125; # managed by Certbot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    listen 80;</span><br><span class="line">    server_name fs.lthero.top;</span><br><span class="line">    return 404; # managed by Certbot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> fs.lthero.top;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$server_name</span><span class="variable">$request_uri</span>;  <span class="comment"># 强制重定向所有 HTTP 请求到 HTTPS</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">server_name</span> fs.lthero.top;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/fs.lthero.top/fullchain.pem;  <span class="comment"># 证书文件路径</span></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/fs.lthero.top/privkey.pem;  <span class="comment"># 私钥文件路径</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">1d</span>;</span><br><span class="line">    <span class="attribute">ssl_session_cache</span> shared:MozSSL:<span class="number">10m</span>;  <span class="comment"># 缓存 SSL 会话以提升性能</span></span><br><span class="line">    <span class="attribute">ssl_session_tickets</span> <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 现代加密套件配置</span></span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> <span class="string">&#x27;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384&#x27;</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 其他 SSL 优化设置</span></span><br><span class="line">    <span class="attribute">ssl_stapling</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_stapling_verify</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 允许最大请求体大小为 1000MB</span></span><br><span class="line">    <span class="attribute">client_max_body_size</span> <span class="number">1000m</span>;  </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:3001;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个配置不仅启用了 HTTPS，还包括了一些现代的安全实践，如启用 HTTP/2，配置加密套件和协议等。</p><blockquote><p>允许最大请求体大小为 1000MB</p><p>client_max_body_size 1000m;</p><p>这行最好与config.js中保持一致，如果<strong>nginx设置小了，会出现“上传失败”的结果！</strong></p></blockquote><h2 id="步骤-4-重新加载-nginx">步骤 4: 重新加载 Nginx</h2><p>启用配置文件通过创建一个符号链接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /etc/nginx/sites-available/fs.lthero.top /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure><p>更改配置后，需要重新加载 Nginx 以应用新的配置：</p><blockquote><p>检查配置文件是否有语法错误，如果有warn!直接看“遇到的问题”部分，重新加载配置是不一定能work的</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t  <span class="comment"># 检查配置文件是否有语法错误</span></span><br><span class="line">sudo systemctl reload nginx  <span class="comment"># 重新加载配置</span></span><br><span class="line"><span class="comment"># 如果重新加载配置后无效，可以尝试重启nginx</span></span><br><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure><h2 id="步骤-5-验证-https">步骤 5: 验证 HTTPS</h2><p>在浏览器中访问 <code>https://fs.lthero.top</code> 来检查是否配置成功。你应该能够看到一个安全锁标志，表明连接是通过 HTTPS 加密的。</p><h2 id="步骤-6-自动续订证书">步骤 6: 自动续订证书</h2><p>Let’s Encrypt 的证书有效期为90天，因此建议设置自动续订：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew</span><br></pre></td></tr></table></figure><p>这个命令会测试证书续订过程。如果这个测试成功，添加定时任务<code>crontab</code>：</p><p><code>crontab -e</code>再填写下面内容，表示每月第一天会自动执行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 * * /usr/local/bin/certbot renew --deploy-hook <span class="string">&quot;nginx -s reload&quot;</span></span><br></pre></td></tr></table></figure><p>通过<code>which certbot</code>查看具体程序位置<code>/usr/local/bin/certbot</code></p><p>续签的证书位置<code>/etc/letsencrypt/renewal</code></p><p>通过以上步骤，你的站点 <code>fs.lthero.top</code> 现在应该能够安全地使用 HTTPS 进行通信了。</p><p>如果要换crontab编辑器，运行下面的命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select-editor</span><br></pre></td></tr></table></figure><h2 id="解析到阿里云dns的申请方法">解析到阿里云DNS的申请方法</h2><blockquote><p>如果域名解析在阿里云，可以安装这个插件从而完成证书申请，<a href="https://github.com/tengattack/certbot-dns-aliyun">https://github.com/tengattack/certbot-dns-aliyun</a></p></blockquote><h3 id="credentials-file">Credentials File</h3><p>在某个熟悉的目录下，把下面的内容写入<code>credentials.ini</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dns_aliyun_access_key = 12345678</span><br><span class="line">dns_aliyun_access_key_secret = 1234567890abcdef1234567890abcdef</span><br></pre></td></tr></table></figure><p>dns_aliyun_access_key是阿里云账号的AccessKey ID</p><p>dns_aliyun_access_key_secret是阿里云账号的AccessKey Secret</p><p>这两个值可以在阿里云控制台-&gt;用户头像-&gt;accesskeys按指引获取AccessKey/SecretKey</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 600 /path/to/credentials.ini</span><br></pre></td></tr></table></figure><h3 id="obtain-certificates">Obtain Certificates</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">certbot certonly \</span><br><span class="line">    --authenticator=dns-aliyun \</span><br><span class="line">    --dns-aliyun-credentials=<span class="string">&#x27;/path/to/credentials.ini&#x27;</span> \</span><br><span class="line">    -d <span class="string">&quot;*.example.com,example.com&quot;</span></span><br></pre></td></tr></table></figure><p>申请下来的证书位置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/letsencrypt/archive/</span><br></pre></td></tr></table></figure><p>适合阿里云的自动命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 * * /usr/local/bin/certbot renew --manual --preferred-challenges dns --manual-auth-hook <span class="string">&quot;alidns&quot;</span> --manual-cleanup-hook <span class="string">&quot;alidns clean&quot;</span> --deploy-hook <span class="string">&quot;nginx -s reload&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;在线文件共享平台&quot;&gt;在线文件共享平台&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;提供短时/长期（类似蓝奏云）的文件分享，无文件类型限制&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;项目安装&quot;&gt;项目安装&lt;/h1&gt;
&lt;figure class=&quot;highlig</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
  </entry>
  
  <entry>
    <title>【PPT】生成高清的PDF格式矢量图片</title>
    <link href="https://blog.lthero.cn/2024/11/22/CreateHighResolutionPic/"/>
    <id>https://blog.lthero.cn/2024/11/22/CreateHighResolutionPic/</id>
    <published>2024-11-22T05:46:43.000Z</published>
    <updated>2024-11-26T13:04:38.968Z</updated>
    
    <content type="html"><![CDATA[<h2 id="步骤">步骤</h2><p>1、新建个PPT（如：export.pptx），在PPT的“设计”-&gt;“幻灯片大小”改成“自定义”，宽度,高度：100cm</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241122134900256.png" alt="image-20241122134900256"></p><p>2、将原来的PPT（包含构架图）一整页直接复制到export.pptx中</p><p>3、选择“文件”-&gt;“导出”-&gt;“导出为pdf”（这里有个“选项”，可以选择导出到具体的某页）</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241122140000983.png" alt="image-20241122140000983"></p><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20241122140030833.png" alt="image-20241122140030833"></p><p>4、导出为pdf后，使用“编辑”功能中的“裁剪”，对图像进行裁剪并保存。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;步骤&quot;&gt;步骤&lt;/h2&gt;
&lt;p&gt;1、新建个PPT（如：export.pptx），在PPT的“设计”-&amp;gt;“幻灯片大小”改成“自定义”，宽度,高度：100cm&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn.lthero.cn/post_images/c</summary>
      
    
    
    
    <category term="技巧" scheme="https://blog.lthero.cn/categories/%E6%8A%80%E5%B7%A7/"/>
    
    
    <category term="技巧" scheme="https://blog.lthero.cn/tags/%E6%8A%80%E5%B7%A7/"/>
    
    <category term="PPT" scheme="https://blog.lthero.cn/tags/PPT/"/>
    
  </entry>
  
  <entry>
    <title>GetSSLforWebsite</title>
    <link href="https://blog.lthero.cn/2024/08/19/GetSSLforWebsite/"/>
    <id>https://blog.lthero.cn/2024/08/19/GetSSLforWebsite/</id>
    <published>2024-08-19T10:40:40.000Z</published>
    <updated>2024-08-19T10:46:50.651Z</updated>
    
    <content type="html"><![CDATA[<h2 id="宝塔">宝塔</h2><p>在宝塔网络管理，选择<strong>DNS验证</strong>，手动解析<strong>阿里云DNS</strong>，设置密钥后自动申请即可</p><h2 id="阿里云平台">阿里云平台</h2><p>搜索：数字证书管理服务</p><p>在SSL证书管理中，可以申请免费的DigiCert证书，时效三个月，好处是对于部署在阿里云的cdn服务，在申请证书后，平台会自动更新cdn相关服务。</p><h2 id="certbot自动">certbot自动</h2><h3 id="安装certbot和阿里云dns插件">安装certbot和阿里云DNS插件</h3><p>安装步骤在<a href="https://certbot.eff.org/">certbot (opens new window)</a>的官网上有，而且很详细。但最大的问题是，官网上的安装方法要求使用snapd，而七牛云服务器（实际上是阿里云服务器）并不支持snapd，所以需要使用yum安装。</p><h4 id="安装手动申请证书所需工具">安装手动申请证书所需工具</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install certbot</span><br></pre></td></tr></table></figure><h4 id="安装自动续期证书所需工具">安装自动续期证书所需工具</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt install certbot python3-certbot-nginx</span><br><span class="line">pip3 install certbot-dns-aliyun</span><br><span class="line">pip3 install certbot-nginx</span><br></pre></td></tr></table></figure><h3 id="申请证书">申请证书</h3><h4 id="手动申请证书">手动申请证书</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certbot -d *.sunxiaolong.net -d sunxiaolong.net --manual certonly</span><br></pre></td></tr></table></figure><p>这个<code>--manual</code>参数很重要，如果没有这个参数，就必须得用dns插件了~<br>随后会有提示，给域名添加一个TXT解析，按照提示去域名解析控制台添加对应记录。这里一定要注意这个解析记录不要区分大陆还是海外线路，否则可能会失败。<br>解析记录添加完成后，回到命令行按下回车键。<br>证书和私钥文件会保存到<code>/etc/letsenctypt/live</code>下，命令行上有回显。</p><h4 id="自动申请证书">自动申请证书</h4><p>将阿里云DNS的key写到本地，格式如下：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dns_aliyun_access_key</span>=<span class="string">*******</span></span><br><span class="line"><span class="attr">dns_aliyun_access_key_secret</span>=<span class="string">******</span></span><br></pre></td></tr></table></figure><p>随后保存到服务器上，如<code>/opt/cert/aliyun-dns.conf</code>。access_key和access_key_secret是阿里云的多用户访问控制中相应用户的key和secret。</p><ol start="2"><li>签发证书</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certbot certonly --authenticator=dns-aliyun --dns-aliyun-credentials=&#x27;/opt/cert/aliyun-dns.conf&#x27; -d &quot;*.sunxiaolong.net,sunxiaolong.net&quot;</span><br></pre></td></tr></table></figure><p>然后就签发成功了～证书位置可以看回显，确认配置没错之后，reload一下nginx就可以了。</p><h3 id="修改nginx配置">修改nginx配置</h3><p>将nginx配置中对应域名的证书和私钥文件路径指定到certbot回显的路径上。</p><h3 id="reload-nginx">reload nginx</h3><p>重新加载nginx即可生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">NGINX_HOME/sbin/nginx -s reload</span></span><br></pre></td></tr></table></figure><h3 id="验证是否生效">验证是否生效</h3><p>重新打开对应的HTTPS站点，不再提示证书不安全，且证书过期时间和certbot命令行回显能对应上即为成功。</p><h3 id="配置自动续期">配置自动续期</h3><h4 id="手动续期">手动续期</h4><p>待证书要过期，执行<code>certbot renew</code>，再reload nginx即可。</p><h4 id="自动续期">自动续期</h4><p>编辑crontab</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure><p>添加记录，<code>0 0 1 * * /root/renew-cert.sh</code>，表示每月1日0点执行续期脚本。</p><p>编写续期脚本 <code>/root/renew-cert.sh</code>的内容如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">certbot certonly -n --authenticator=dns-aliyun --dns-aliyun-credentials=&#x27;/opt/cert/aliyun-dns.conf&#x27; -d &quot;*.sunxiaolong.net,sunxiaolong.net&quot;</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><p>重新加载crond服务。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service crond reload</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;宝塔&quot;&gt;宝塔&lt;/h2&gt;
&lt;p&gt;在宝塔网络管理，选择&lt;strong&gt;DNS验证&lt;/strong&gt;，手动解析&lt;strong&gt;阿里云DNS&lt;/strong&gt;，设置密钥后自动申请即可&lt;/p&gt;
&lt;h2 id=&quot;阿里云平台&quot;&gt;阿里云平台&lt;/h2&gt;
&lt;p&gt;搜索：数字证书管理服务</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>【vless-reality】安装</title>
    <link href="https://blog.lthero.cn/2024/07/18/Install-vless-reality/"/>
    <id>https://blog.lthero.cn/2024/07/18/Install-vless-reality/</id>
    <published>2024-07-18T07:26:50.000Z</published>
    <updated>2024-07-18T08:20:50.823Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>官方说法是 REALITY 可以<strong>消除服务端 TLS 指纹特征</strong>，同时保留前向保密性等功能，证书链攻击也无效，安全性超越了常规的 TLS。还有个优点是 REALITY <strong>可以指向别人的网站，无需自己购买域名和配置 TLS 服务端</strong>，通俗来说就是伪装性和便捷性都得到了提升。</p></blockquote><h1 id="一键安装脚本">一键安装脚本</h1><blockquote><p>本文参考：<a href="https://oooutman.github.io/reality-v2ray/">https://oooutman.github.io/reality-v2ray/</a></p><p>下面这个安装脚本，默认使用“无需域名”的方法</p><p>如果需要设置自己的域名，可以使用另一个脚本：<a href="https://www.v2ray-agent.com/archives/1680104902581">https://www.v2ray-agent.com/archives/1680104902581</a></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate -O $&#123;HOME&#125;/Xray-script.sh https://raw.githubusercontent.com/zxcvos/Xray-script/main/reality.sh &amp;&amp; bash $&#123;HOME&#125;/Xray-script.sh</span><br></pre></td></tr></table></figure><p>复制上面👆一整行命令运行后会出现如下👇安装向导，有各种选项设置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">--------------- Xray-script ---------------</span><br><span class="line"> Version      : v2023-03-15(beta)</span><br><span class="line"> Description  : Xray 管理脚本</span><br><span class="line">----------------- 装载管理 ----------------</span><br><span class="line">1. 安装</span><br><span class="line">2. 更新</span><br><span class="line">3. 卸载</span><br><span class="line">----------------- 操作管理 ----------------</span><br><span class="line">4. 启动</span><br><span class="line">5. 停止</span><br><span class="line">6. 重启</span><br><span class="line">----------------- 配置管理 ----------------</span><br><span class="line">101. 查看配置</span><br><span class="line">102. 信息统计</span><br><span class="line">103. 修改 <span class="built_in">id</span></span><br><span class="line">104. 修改 dest</span><br><span class="line">105. 修改 x25519 key</span><br><span class="line">106. 修改 shortIds</span><br><span class="line">107. 修改 xray 监听端口</span><br><span class="line">108. 刷新已有的 shortIds</span><br><span class="line">109. 追加自定义的 shortIds</span><br><span class="line">110. 使用 WARP 分流，开启 OpenAI</span><br><span class="line">----------------- 其他选项 ----------------</span><br><span class="line">201. 更新至最新稳定版内核</span><br><span class="line">202. 卸载多余内核</span><br><span class="line">203. 修改 ssh 端口</span><br><span class="line">204. 网络连接优化</span><br><span class="line">-------------------------------------------</span><br><span class="line">0. 退出</span><br><span class="line">Choose:</span><br></pre></td></tr></table></figure><p>先选 1 安装， 输入 <code>1</code> 回车即可安装。</p><p>以后如果要进入这个管理脚本界面可以输入 <code>bash Xray-script.sh</code> 命令回车即可</p><p>安装过程进行一会儿会提示你输入自定义端口，这里直接回车不填就会使用默认 <code>443</code> 端口了。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请输入自定义的端口(1-65535), 默认不修改:</span><br></pre></td></tr></table></figure><p>接着提示输入 UUID，也可以直接回车让它自动生成</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请输入自定义 UUID, 默认则自动生成:</span><br></pre></td></tr></table></figure><p>出现让你设置目标网站的选项，也可以看情况输入 <code>0</code> 来自填网址。</p><blockquote><p>填写的网站建议跟你 VPS 所在地差不多，比如我的 IP 是大版的，我可以找家日本动画公司官网填写。不过这里选项里已经有几个 .jp 域名后缀的日本网站，我就直接填 <code>5</code> 回车。</p></blockquote><p>选项 1 和 2 的微软和苹果因为是全球化的公司，到处都有服务器，通用性很好不用太在意地址。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">---------------- dest 列表 -----------------</span><br><span class="line">1) learn.microsoft.com</span><br><span class="line">2) www.apple.com</span><br><span class="line">3) music.apple.com</span><br><span class="line">4) www.fandom.com</span><br><span class="line">5) www.lovelive-anime.jp</span><br><span class="line">6) tidal.com</span><br><span class="line">7) zoro.to</span><br><span class="line">8) www.pixiv.co.jp</span><br><span class="line">9) mxj.myanimelist.net</span><br><span class="line">10) mora.jp</span><br><span class="line">11) www.j-wave.co.jp</span><br><span class="line">12) www.dmm.com</span><br><span class="line">13) booth.pm</span><br><span class="line">14) www.ivi.tv</span><br><span class="line">15) fmovies.to/home</span><br><span class="line">16) www.leercapitulo.com</span><br><span class="line">17) www.sky.it</span><br><span class="line">18) www.sky.com</span><br><span class="line">19) www.smdyy.cc</span><br><span class="line">20) www.telecinco.es</span><br><span class="line">请选择你的 dest, 当前默认使用 <span class="string">&quot;learn.microsoft.com&quot;</span>, 自填选 0:</span><br></pre></td></tr></table></figure><p>这里问你要选哪个 UUID 的配置，只有一个选项自然填 <code>1</code> ，也可以不填，使用“默认全选”直接回车。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1) 422939fd-f699-4a26-a6d7-61e17ee3dd88</span><br><span class="line">请选择生成分享链接的 UUID ，用英文逗号分隔， 默认全选:</span><br></pre></td></tr></table></figure><p>让你选网址，虽然之前只设置了一个网址，不过这里拆分成带和不带 <code>www</code> 两种，也不填直接回车默认全选。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1) lovelive-anime.jp</span><br><span class="line">2) www.lovelive-anime.jp</span><br><span class="line">请选择生成分享链接的 serverName ，用英文逗号分隔， 默认全选:</span><br></pre></td></tr></table></figure><p>让选 shortId，这个脚本默认生成了 5 个 shortId，还是不填直接回车。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1) <span class="string">&quot;&quot;</span></span><br><span class="line">2) <span class="string">&quot;6d&quot;</span></span><br><span class="line">3) <span class="string">&quot;85dd&quot;</span></span><br><span class="line">4) <span class="string">&quot;e04cccd5&quot;</span></span><br><span class="line">5) <span class="string">&quot;5042dcec226b1621&quot;</span></span><br><span class="line">请选择生成分享链接的 shortId ，用英文逗号分隔， 默认全选:</span><br></pre></td></tr></table></figure><p>如果想自己设定 shortId 要遵循规则，可以使用十六进制：也就是这些数字和字母 <code>0123456789abcdef</code>，长度要求是 2 的倍数，不能写 3 位、5 位这种数字字母组合，长度最长到 16 位。</p><blockquote><p>🎉大功告成！出现如下共 10 个分享链接。随便复制一个到本地 v2rayN 客户端上粘贴就可以用了，注意分享链接开头是 <code>Vless://</code>，结尾是 <code>VLESS-XTLS-uTLS-REALITY</code>。</p></blockquote><h1 id="客户端配置">客户端配置</h1><p><strong>REALITY 这个新协议对客户端和内核是有要求的</strong></p><ul><li>Windows 端 v2rayN 至少要 v6.21 以上版本</li><li>安卓端 v2rayNG要 1.8.0 及以上版本</li><li>iPhone 端不清楚，自行查阅。</li></ul><h2 id="pc-端-v2rayn-配置">PC 端 v2rayN 配置</h2><p><a href="https://github.com/2dust/v2rayN/releases">点我进入 v2rayN 下载页面</a> ，当下最新正式版是 6.43 ，这里以此为例。</p><ol><li>下载下方的 <code>v2rayN-With-Core.zip</code>，解压即用无需安装，建议先将解压后的文件夹找个地方放好，然后将里面的 <code>v2rayN.exe</code> 程序创建个快捷方式。</li></ol><p><img src="https://oooutman.github.io/img/post/Reality/reality_02.jpg" alt="reality_02"></p><ol start="2"><li>打开文件夹，双击里面的 <code>v2rayN.exe</code> 即可运行，运行后可能窗口闪一下就消失了，去右下角托盘图标里找到它。也可能先弹出提示要求下载 <code>Microsoft .NET 8.0 Desktop Runtime</code> ，按提示下载安装即可。</li><li>运行后先右键图标在菜单 <code>自动配置系统代理</code> 打上勾，并确保路由是 <code>绕过大陆</code>。</li></ol><p><img src="https://oooutman.github.io/img/post/Reality/reality_03.jpg" alt="reality_03"></p><ol start="4"><li>再双击图标打开界面，开始里面是空白没有配置的，<strong>将你上面生成的分享链接复制</strong>，然后直接在这个界面 <code>Cltr+V</code> 粘贴就可以添加配置</li><li>打开浏览器访问被墙网站看能不能上，也可以在配置文件上右键使用 <code>测试服务器速度</code> 看看能不能跑起来。</li></ol><p><img src="https://oooutman.github.io/img/post/Reality/reality_04.jpg" alt="reality_04"></p><h2 id="安卓端-v2rayng-配置">安卓端 v2rayNG 配置</h2><p><a href="https://github.com/2dust/v2rayNG/releases">点我进入 v2rayNG 下载页面</a>，当前最新 Latest 版本为 1.8.19，下载下方的 <code>v2rayNG_1.8.19.apk</code>。</p><p><img src="https://oooutman.github.io/img/post/Reality/reality_05.jpg" alt="reality_05"></p><p>手机上安装后打开应用，点击右上角 <code>+</code> 图标， 选择 <code>扫描二维码</code>或<code>从剪贴板导入</code> 选项，不过手机上想获得电脑端的分享链接可能有点麻烦，用扫描二维码会方便点，可以先在PC端 v2rayN 配置上右键点击 <code>分享服务器(Ctrl+F)</code>这个选项（安卓端配置上面那张测试速度的图片里能看到），然后扫描出现的二维码窗口 。</p><p><img src="https://oooutman.github.io/img/post/Reality/reality_06.gif" alt="reality_06"></p><h2 id="sing-box配置">sing-box配置</h2><blockquote><p>经测试使用sing-box需要能连接通，但速度不快，延迟也高，体验上不如v2rayNG</p><p>配置文件来源：<a href="https://www.youtube.com/watch?v=e8EU29_YlOo">https://www.youtube.com/watch?v=e8EU29_YlOo</a></p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;log&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;disabled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;level&quot;</span>: <span class="string">&quot;info&quot;</span>,</span><br><span class="line">    <span class="string">&quot;output&quot;</span>: <span class="string">&quot;sing-box.log&quot;</span>,</span><br><span class="line">    <span class="string">&quot;timestamp&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;dns&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;servers&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;tag&quot;</span>: <span class="string">&quot;alidns&quot;</span>,</span><br><span class="line">        <span class="string">&quot;address&quot;</span>: <span class="string">&quot;https://dns.alidns.com/dns-query&quot;</span>,</span><br><span class="line">        <span class="string">&quot;address_resolver&quot;</span>: <span class="string">&quot;cf&quot;</span>,</span><br><span class="line">        <span class="string">&quot;address_strategy&quot;</span>: <span class="string">&quot;prefer_ipv4&quot;</span>,</span><br><span class="line">        <span class="string">&quot;strategy&quot;</span>: <span class="string">&quot;ipv4_only&quot;</span>,</span><br><span class="line">        <span class="string">&quot;detour&quot;</span>: <span class="string">&quot;direct&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;tag&quot;</span>: <span class="string">&quot;cf&quot;</span>,</span><br><span class="line">        <span class="string">&quot;address&quot;</span>: <span class="string">&quot;https://1.1.1.1/dns-query&quot;</span>,</span><br><span class="line">        <span class="string">&quot;strategy&quot;</span>: <span class="string">&quot;ipv4_only&quot;</span>,</span><br><span class="line">        <span class="string">&quot;detour&quot;</span>: <span class="string">&quot;direct&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;tag&quot;</span>: <span class="string">&quot;block&quot;</span>,</span><br><span class="line">        <span class="string">&quot;address&quot;</span>: <span class="string">&quot;rcode://success&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;rules&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;geosite&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;cn&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;domain&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;myChinaDnsSite.com&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;domain_suffix&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;.cn&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;server&quot;</span>: <span class="string">&quot;alidns&quot;</span>,</span><br><span class="line">        <span class="string">&quot;disable_cache&quot;</span>: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;geosite&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;category-ads-all&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;server&quot;</span>: <span class="string">&quot;block&quot;</span>,</span><br><span class="line">        <span class="string">&quot;disable_cache&quot;</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;final&quot;</span>: <span class="string">&quot;cf&quot;</span>,</span><br><span class="line">    <span class="string">&quot;strategy&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;disable_cache&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;disable_expire&quot;</span>: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;inbounds&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;tag&quot;</span>: <span class="string">&quot;tun-in&quot;</span>,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;tun&quot;</span>,</span><br><span class="line">      <span class="string">&quot;inet4_address&quot;</span>: <span class="string">&quot;172.19.0.1/30&quot;</span>,</span><br><span class="line">      <span class="string">&quot;auto_route&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;strict_route&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;stack&quot;</span>: <span class="string">&quot;gvisor&quot;</span>,</span><br><span class="line">      <span class="string">&quot;mtu&quot;</span>: 9000,</span><br><span class="line">      <span class="string">&quot;sniff&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;sniff_timeout&quot;</span>: <span class="string">&quot;300ms&quot;</span>,</span><br><span class="line">      <span class="string">&quot;domain_strategy&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;udp_timeout&quot;</span>: 300</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;outbounds&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;tag&quot;</span>: <span class="string">&quot;proxy&quot;</span>,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;vless&quot;</span>,</span><br><span class="line">      <span class="string">&quot;server&quot;</span>: <span class="string">&quot;你的服务器IP&quot;</span>,</span><br><span class="line">      <span class="string">&quot;server_port&quot;</span>: 你用的端口,</span><br><span class="line">      <span class="string">&quot;uuid&quot;</span>: <span class="string">&quot;你服务端的用户UUID&quot;</span>,</span><br><span class="line">      <span class="string">&quot;flow&quot;</span>: <span class="string">&quot;xtls-rprx-vision&quot;</span>,</span><br><span class="line">      <span class="string">&quot;network&quot;</span>: <span class="string">&quot;tcp&quot;</span>,</span><br><span class="line">      <span class="string">&quot;packet_encoding&quot;</span>: <span class="string">&quot;xudp&quot;</span>,</span><br><span class="line">      <span class="string">&quot;tls&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;enabled&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;server_name&quot;</span>: <span class="string">&quot;你的服务端设置的serverNames其一&quot;</span>,</span><br><span class="line">        <span class="string">&quot;utls&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;enabled&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="string">&quot;fingerprint&quot;</span>: <span class="string">&quot;chrome&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;reality&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;enabled&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="string">&quot;public_key&quot;</span>: <span class="string">&quot;你服务端生成的公钥&quot;</span>,</span><br><span class="line">          <span class="string">&quot;short_id&quot;</span>: <span class="string">&quot;你服务端shortIds其一，截止发文sing-box必须使用16位的short_id&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;direct&quot;</span>,</span><br><span class="line">      <span class="string">&quot;tag&quot;</span>: <span class="string">&quot;direct&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;block&quot;</span>,</span><br><span class="line">      <span class="string">&quot;tag&quot;</span>: <span class="string">&quot;block&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;dns&quot;</span>,</span><br><span class="line">      <span class="string">&quot;tag&quot;</span>: <span class="string">&quot;dns-out&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;route&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;geoip&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;path&quot;</span>: <span class="string">&quot;geoip.db&quot;</span>,</span><br><span class="line">      <span class="string">&quot;download_url&quot;</span>: <span class="string">&quot;https://github.com/SagerNet/sing-geoip/releases/latest/download/geoip.db&quot;</span>,</span><br><span class="line">      <span class="string">&quot;download_detour&quot;</span>: <span class="string">&quot;direct&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;geosite&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;path&quot;</span>: <span class="string">&quot;geosite.db&quot;</span>,</span><br><span class="line">      <span class="string">&quot;download_url&quot;</span>: <span class="string">&quot;https://github.com/SagerNet/sing-geosite/releases/latest/download/geosite.db&quot;</span>,</span><br><span class="line">      <span class="string">&quot;download_detour&quot;</span>: <span class="string">&quot;direct&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;rules&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;protocol&quot;</span>: <span class="string">&quot;dns&quot;</span>,</span><br><span class="line">        <span class="string">&quot;outbound&quot;</span>: <span class="string">&quot;dns-out&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;domain&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;myProxy.com&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;outbound&quot;</span>: <span class="string">&quot;proxy&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;domain&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;myDirect.com&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;outbound&quot;</span>: <span class="string">&quot;direct&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;geosite&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;cn&quot;</span>,</span><br><span class="line">          <span class="string">&quot;private&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;geoip&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;cn&quot;</span>,</span><br><span class="line">          <span class="string">&quot;private&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;domain_suffix&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;.cn&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;outbound&quot;</span>: <span class="string">&quot;direct&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;geosite&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;category-ads-all&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;outbound&quot;</span>: <span class="string">&quot;block&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;auto_detect_interface&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;final&quot;</span>: <span class="string">&quot;proxy&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;experimental&quot;</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;官方说法是 REALITY 可以&lt;strong&gt;消除服务端 TLS 指纹特征&lt;/strong&gt;，同时保留前向保密性等功能，证书链攻击也无效，安全性超越了常规的 TLS。还有个优点是 REALITY &lt;strong&gt;可以指向别人的网站，无需自己购买域</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
  </entry>
  
  <entry>
    <title>将Nas共享到虚拟局域网内</title>
    <link href="https://blog.lthero.cn/2024/07/04/ShareNasWithZerotier/"/>
    <id>https://blog.lthero.cn/2024/07/04/ShareNasWithZerotier/</id>
    <published>2024-07-04T15:38:11.000Z</published>
    <updated>2024-07-04T15:45:37.144Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>起因：局域网内有个Nas，但没法安装Docker，不能安装Zerotier；</p><p>目的：通过Zerotier创建个虚拟局域网，让Nas被虚拟局域网其它设备使用</p><p>做法：</p><ol><li>把Nas挂载到局域网内的Ubuntu设备上</li><li>Ubuntu上运行Zerotier并加入到虚拟局域网</li><li>Ubuntu上将挂载的目录共享，从而让虚拟局域网内的其它设备访问到这个目录</li></ol></blockquote><h1 id="挂载nas到ubuntu">挂载Nas到ubuntu</h1><blockquote><p>目的：把局域网的Nas设备挂载到Ubuntu电脑上</p></blockquote><h2 id="单次挂载">单次挂载</h2><p>首先在Ubuntu 的 <code>/mnt</code> 目录下新建一个 NAS 挂载目录 <code>nas</code>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /mnt/nas</span><br><span class="line"><span class="comment"># 下面这个命令是为了共享时，允许匿名直接访问，解决权限问题</span></span><br><span class="line">sudo <span class="built_in">chmod</span> 777 /mnt/nas</span><br></pre></td></tr></table></figure><p>安装 <code>cifs-utils</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install cifs-utils</span><br></pre></td></tr></table></figure><p>查看用户的 <code>uid</code> 和 <code>gid</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">id</span> root</span><br></pre></td></tr></table></figure><p>运行下面的命令，完成单次挂载</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -t cifs -o uid=root,username=admin,password=xxxx,iocharset=utf8,file_mode=0777,dir_mode=0777 //192.168.6.154/public /mnt/nas/ </span><br></pre></td></tr></table></figure><ul><li>uid 选择<strong>ubuntu系统上</strong>普通用户或root</li><li>username 是<strong>nas上</strong>的用户名</li><li>password 是<strong>nas上</strong>的密码</li><li>iocharset=utf8 防止有中文路径</li><li><a href="//192.168.6.154/public">//192.168.6.154/public</a> 是nas下的public目录</li><li>/mnt/nas/ 挂载到ubuntu的这个目录下</li><li>file_mode=0777,dir_mode=0777  权限全开</li></ul><h2 id="开机自动挂载">开机自动挂载</h2><p>编辑启动挂载文件 <code>fstab</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/fstab</span><br></pre></td></tr></table></figure><p>在文件最后追加一行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 仅给root用户全部权限</span></span><br><span class="line">//192.168.6.154/public /mnt/nas/ cifs uid=root,username=admin,password=xxx,iocharset=utf8 0 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面这行是将权限全部开放</span></span><br><span class="line">//192.168.6.154/public /mnt/nas cifs uid=root,username=admin,password=xxxx,iocharset=utf8,file_mode=0777,dir_mode=0777 0 0</span><br></pre></td></tr></table></figure><p>在重启之前，你可以手动测试这个配置是否有效。</p><p>首先，卸载之前可能已经手动挂载的共享：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo umount /mnt/nas/</span><br></pre></td></tr></table></figure><p>运行以下命令来挂载所有在<code>/etc/fstab</code>中定义的文件系统：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -a</span><br></pre></td></tr></table></figure><p>如果没有错误提示，说明配置成功。</p><p>重启系统，并检查CIFS共享是否自动挂载了。</p><p>通过上述步骤，每次系统启动时，CIFS共享就会自动挂载到指定的挂载点。如果遇到问题，检查日志文件（如<code>/var/log/syslog</code>）中的错误信息</p><h1 id="ubuntu上运行zerotier">Ubuntu上运行Zerotier</h1><blockquote><p>参考早前的一篇文章</p><p><a href="https://blog.lthero.cn/2024/05/25/install-zeroTier/">https://blog.lthero.cn/2024/05/25/install-zeroTier/</a></p></blockquote><h1 id="ubuntu共享文件">Ubuntu共享文件</h1><blockquote><p>ubuntu共享其目录给局域网内的其它设备</p><p>这里注意下，如果使用了下面的方法，就不要在“桌面版”上进行操作了（对某个目录右键，选择局域网共享，设置名字之类的），<strong>容易冲突</strong></p></blockquote><h2 id="通过-samba-共享目录">通过 Samba 共享目录</h2><p>安装samba</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install samba</span><br></pre></td></tr></table></figure><p>编辑 Samba 配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/samba/smb.conf</span><br></pre></td></tr></table></figure><p>在文件末尾添加以下内容：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[nas]</span><br><span class="line">    path = <span class="regexp">/mnt/</span>nas</span><br><span class="line">    browseable = yes</span><br><span class="line">    read only = no</span><br><span class="line">    guest ok = yes</span><br><span class="line">    force user = nobody</span><br><span class="line">    create mask = <span class="number">0777</span></span><br><span class="line">    directory mask = <span class="number">0777</span></span><br></pre></td></tr></table></figure><h2 id="重启-samba-服务">重启 Samba 服务</h2><p>每次修改配置文件后，都需要重启 Samba 服务以使更改生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart smbd</span><br></pre></td></tr></table></figure><h2 id="测试-samba-共享">测试 Samba 共享</h2><p>你现在可以从其他计算机访问共享目录。比如在 Windows 上，通过文件资源管理器访问：</p><p>（可以从物理局域网内进行访问，也可以直接使用虚拟ip进行访问）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\\your_ubuntu_ip\nas</span><br></pre></td></tr></table></figure><p>在 Linux 上，可以使用以下命令挂载共享目录：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -t cifs //your_ubuntu_ip/nas /path/to/mount -o guest</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;起因：局域网内有个Nas，但没法安装Docker，不能安装Zerotier；&lt;/p&gt;
&lt;p&gt;目的：通过Zerotier创建个虚拟局域网，让Nas被虚拟局域网其它设备使用&lt;/p&gt;
&lt;p&gt;做法：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;把Nas挂载到局域网内的Ubu</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
  </entry>
  
  <entry>
    <title>国外内大模型行业分析报告</title>
    <link href="https://blog.lthero.cn/2024/07/01/AReportAboutLLM/"/>
    <id>https://blog.lthero.cn/2024/07/01/AReportAboutLLM/</id>
    <published>2024-07-01T12:22:11.000Z</published>
    <updated>2024-07-01T12:48:49.028Z</updated>
    
    <content type="html"><![CDATA[<h1 id="大模型的定义">大模型的定义</h1><p>大模型是指具有<strong>大规模参数和复杂计算结构</strong>的机器学习模型，<strong>拥有数十亿甚至数千亿个参数</strong>。</p><p>大模型的设计目的：为了<strong>提高模型的表达能力和预测性能</strong>，能够处理更加复杂的任务和数据。</p><p>大模型在各种领域都有广泛的应用，包括自然语言处理、计算机视觉、语音识别和推荐系统等。</p><h2 id="大模型和小模型有什么区别？">大模型和小模型有什么区别？</h2><p><strong>小模型</strong>通常指参数较少、层数较浅的模型，它们具有轻量级、高效率、易于部署等优点，适用于数据量较小、计算资源有限的场景，例如移动端应用、嵌入式设备、物联网等。</p><p>而当模型的训练数据和参数不断扩大，直到<strong>达到一定的临界规模后</strong>，其表现出了一些未能预测的、更复杂的能力和特性，<strong>模型能够从原始训练数据中自动学习并发现新的、更高层次的特征和模式</strong>，这种能力被称为“<strong>涌现能力</strong>”。</p><blockquote><p><strong>具备涌现能力的机器学习模型</strong>就被认为是独立意义上的大模型，这也是其和小模型最大意义上的区别。</p></blockquote><p><img src="https://cdn.lthero.cn/post_images/course/ML/Chatgpt1.png" alt="AI 大模型的三大特征：泛化性、通用性、涌现性"></p><p>相比小模型，大模型通常参数较多、层数较深，具有更强的表达能力和更高的准确度，但也需要更多的计算资源和时间来训练和推理，适用于数据量较大、计算资源充足的场景，例如云端计算、高性能计算、人工智能等。</p><h2 id="大模型的核心突破是什么？">大模型的核心突破是什么？</h2><p>与传统AI仅能处理单一任务相比，大模型技术通过<strong>其庞大的参数规模、强大的泛化能力</strong>、<strong>对多模态数据的支持</strong>，展现出类似人类的通用智能**“涌现”能力**，能够学习多个领域知识、处理多种数据和任务。</p><p>OpenAI提出的“规模定律”（Scaling Law）驱动了大模型的快速发展，</p><blockquote><p>规模定律即：模型的性能与模型的规模、数据集大小和训练用的计算量之间存在幂律关系，性能会随着这三个因素的指数增加而线性提高</p></blockquote><ol><li><strong>模型参数规模</strong>：随着模型参数数量增加，模型的表现会有显著提升。但这种提升会在一定程度上出现递减效应，即每增加一倍的参数数量所带来的性能提升会逐渐减小。</li><li><strong>计算量</strong>：增加训练计算量（通常通过<strong>增加训练步数或更复杂的模型结构</strong>）也可以提升模型性能。这种提升同样存在递减效应。</li><li><strong>数据量</strong>：<strong>增加训练数据量</strong>同样能够提升模型性能，并且在某些情况下，数据量的增加比增加参数数量或计算量更为有效。</li><li><strong>组合效应</strong>：最理想的情况是同时<strong>增加模型的参数规模、计算量和数据量</strong>，这样可以最大化模型的性能提升。</li></ol><blockquote><p>通俗而言就是“<strong>大力出奇迹</strong>”。</p></blockquote><p>传统AI模型参数量通常在数万至数亿之间，大模型的参数量则至少在亿级，并已发展到过万亿级的规模。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/Chatgpt.png" alt="image-20240701190534784"></p><h1 id="大模型相关概念区分">大模型相关概念区分</h1><p><strong>大模型（Large Model,也称基础模型，即Foundation Model）</strong>，是指具有大量参数和复杂结构的机器学习模型，能够处理海量数据、完成各种复杂的任务，如自然语言处理、计算机视觉、语音识别等。</p><p><strong>超大模型</strong>：超大模型是大模型的一个子集，它们的参数量远超过大模型。</p><p><strong>大语言模型（Large Language Model）</strong>：通常是具有大规模参数和计算能力的自然语言处理模型，例如 OpenAI 的 GPT-3 模型。这些模型可以通过大量的数据和参数进行训练，以生成人类类似的文本或回答自然语言的问题。大型语言模型在自然语言处理、文本生成和智能对话等领域有广泛应用。</p><p><strong>GPT（Generative Pre-trained Transformer</strong>）：GPT 和ChatGPT都是基于Transformer架构的语言模型，但它们在设计和应用上存在区别：GPT模型旨在生成自然语言文本并处理各种自然语言处理任务，如文本生成、翻译、摘要等。它通常在单向生成的情况下使用，即根据给定的文本生成连贯的输出。</p><p><strong>ChatGPT</strong>：ChatGPT则专注于对话和交互式对话。它经过特定的训练，以更好地处理多轮对话和上下文理解。ChatGPT设计用于提供流畅、连贯和有趣的对话体验，以响应用户的输入并生成合适的回复。</p><h1 id="大模型的发展历程">大模型的发展历程</h1><p>大模型的发展历程可以追溯到早期的深度学习模型，并随着计算能力的提升和大数据的积累逐渐演进。以下是大模型发展的几个重要阶段：</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/Hi.png" alt="image-20240701190534784"></p><h2 id="早期深度学习模型">早期深度学习模型</h2><p>在大模型之前，深度学习已经在图像和语音识别等领域取得了显著成果。早期的卷积神经网络（CNN）和递归神经网络（RNN）在特定任务上表现出色，但这些模型的参数数量和复杂度相对较小，主要应用于单一任务。</p><h4 id="代表性模型：">代表性模型：</h4><ul><li>LeNet（1998年）：LeNet是最早的CNN模型之一，主要用于手写数字识别。</li><li>AlexNet（2012年）：AlexNet在ImageNet比赛中取得了突破性胜利，显著推动了深度学习的发展。</li></ul><h2 id="转折点：transformer模型">转折点：Transformer模型</h2><p>2017年，Transformer模型的提出标志着深度学习领域的一个重要转折点。Transformer引入了自注意力机制，极大地提高了模型在处理自然语言任务时的性能，并成为后续大模型的基础架构。</p><h4 id="代表性模型：">代表性模型：</h4><ul><li>Transformer（2017年）：由Vaswani等人提出，引入了自注意力机制和多头注意力机制，显著提升了自然语言处理的效果。</li></ul><h2 id="预训练和微调：bert和gpt">预训练和微调：BERT和GPT</h2><p>Transformer的成功带来了预训练和微调范式的兴起。这一阶段的代表模型包括BERT和GPT系列，它们通过在大规模数据上进行预训练，再在特定任务上进行微调，展示了强大的迁移学习能力。</p><h4 id="代表性模型：">代表性模型：</h4><ul><li>BERT（2018年）：由Google提出，通过双向编码器表示实现了在多个NLP任务上的显著提升。</li><li>GPT（2018年）：由OpenAI提出，采用生成预训练策略，通过单向生成实现了强大的文本生成能力。</li></ul><h2 id="大模型时代的开启：gpt-3">大模型时代的开启：GPT-3</h2><p>2020年，OpenAI发布了GPT-3，标志着大模型时代的正式开启。GPT-3拥有1750亿参数，展示了前所未有的生成和理解能力，使得大模型在NLP领域的应用取得了突破性进展。</p><h4 id="代表性模型：">代表性模型：</h4><ul><li>GPT-3（2020年）：OpenAI的GPT-3模型通过大规模预训练和参数扩展，展示了在多种任务上的强大性能。</li></ul><p><img src="https://cdn.lthero.cn/post_images/course/ML/ChatgptExp.png" alt="解释chatgpt工作原理"></p><h2 id="多模态模型的发展">多模态模型的发展</h2><p>随着大模型技术的不断进步，研究者开始探索多模态模型，这些模型能够处理和理解多种数据形式（如文本、图像、音频等），进一步提升了AI的应用范围和智能水平。</p><h4 id="代表性模型：">代表性模型：</h4><ul><li>DALL-E（2021年）：由OpenAI提出，能够根据文本描述生成图像，展示了文本到图像生成的强大能力。</li><li>CLIP（2021年）：由OpenAI提出，能够同时处理文本和图像，并实现跨模态理解和生成。</li></ul><h2 id="生成式模型的发展">生成式模型的发展</h2><p>生成式模型是大模型的重要分支，通过学习数据的分布来生成新的数据。这些模型在图像生成、文本生成、音频生成等领域展现了强大的能力。</p><h4 id="代表性模型：">代表性模型：</h4><ul><li>Diffusion模型：一种通过逐步添加噪声并逆向去噪的方式生成图像的模型，展示了高质量图像生成的潜力。</li><li>ChatGPT（2022年）：基于GPT架构，专注于对话和交互，通过微调优化对话质量，提供流畅的对话体验。</li></ul><h1 id="国内外大模型对比">国内外大模型对比</h1><h2 id="chatgpt成功原因简要分析">ChatGPT成功原因简要分析</h2><blockquote><p>ChatGPT的成功并非偶然，而是多因素综合作用的结果，凸显了战略方向和执行路径的至关重要性。</p></blockquote><p>首先，OpenAI自非营利向半营利模式转型，为ChatGPT这一明确商业化方向的产品提供了有力的市场导向。其次，OpenAI始终秉持实现安全的通用人工智能（Artificial General Intelligence，AGI）的初心，由创始团队用第一性原理定位研发路线，成功突破各种技术瓶颈，从而确立在通用AI领域的领先地位</p><p>资金投入与发展策略为 ChatGPT成功带来至关重要的影响</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/Chatgpt2-3.png" alt="资金投入与发展策略为 ChatGPT成功带来至关重要的影响"></p><p>在数据方面，GPT-3模型训练了高达45TB的数据，涵盖数千万本文学作品。资金上，从GPT-1到ChatGPT的开发周期中，总投入资金高达数十亿美元，这些资金主要用于数据采集、模型训练、运营以及人力资源。算力方面，OpenAI通过与微软Azure的合作，动用了大约1万块NVIDIA A100 GPU，确保模型能够高效运行。</p><p>更不可或缺的是人才因素。ChatGPT团队由87名全球顶尖的AI专家组成，主要毕业于斯坦福、伯克利和麻省理工等名校，其中5人被评选为2023年度“AI 2000全球人工智能学者”。综上所述，ChatGPT的成功是多维度要素，包括初心、数据、资金、算力和人才，共同作用下的必然结果。</p><blockquote><p>通用基础大语言模型的价值与自研卡点如下</p></blockquote><p><img src="https://cdn.lthero.cn/post_images/course/ML/Chatgpt3-1.png" alt="图3-1 通用基础大语言模型的价值与自研卡点"></p><p>在通用基础大语言模型的研发和应用方面，价值与挑战并存（如图3-1所示）。</p><p>首先，从<strong>价值角度看</strong>，自主可控的模型在全球政治经济格局下具有战略意义，能有效规避数据跨境的合规风险，满足中大型企业和政府的私有化部署需求，同时还能抵御美国科技保护主义的影响。更进一步，<strong>如能成功开发，其将像“超级大脑”一样，成为具有巨大商业价值的资产</strong>。</p><p><strong>面临的主要卡点包括</strong></p><ol><li>美国的芯片禁令导致的高端AI算力不足</li><li>中文高质量数据资源相较于英文的明显不足</li><li>研发过程中必要的技术和工程能力，例如分布式训练和模型蒸馏等</li><li>此外，如何将“know-how”数据有效转化为问答能力，还需要大量的提示工程师投入。</li></ol><p>综合来看，虽有巨大价值等待挖掘，但也需面对一系列复杂的挑战和限制因素。</p><h2 id="中国自研通用基础大语言模型">中国自研通用基础大语言模型</h2><p>在2023年3月，OpenAI发布了具有GPT-4架构的ChatGPT，实现了多模态交互、显著优化了长文本理解与生成能力，并在可控性方面取得了重大突破，此举在全球科技界引发了强烈震荡。</p><p>与此同时，中国的科技与投资界也高度关注这一趋势，<strong>百度紧跟其后，发布了“文心一言”产品</strong>。尽管在产品功能、成熟度和用户并发处理等方面与ChatGPT尚有较大差距，但百度的这一行动标志着中国在新一轮全球“科技军备竞赛”中积极的探索与表态。</p><p>目前，百度已启动了应用程序编程接口的开放测试，并针对B端市场进行战略定位。其它科技巨头如360、阿里、华为、商汤、京东、科大讯飞、字节跳动等也在加速动作，各自从自身业务生态出发，选择了不同的战略路径。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/834e858aee044bfd832117e1d183bf46.png" alt="国内外大模型发展"></p><p>从<strong>全球政治经济局势</strong>看，<strong>自主研发通用预训练大语言模型具有至关重要的战略价值</strong>，它是确保网络安全和信息安全的基础。</p><p>从<strong>自研可行性角度</strong>来看，考虑到算力、数据、算法、人才和资金等多个要素，中国仅有少数头部企业具备进行此类研发的资格。可以预见，未来大模型技术将成为各大企业竞相争夺的关键资源，谁能在这场竞赛中领跑，不仅在应用层有更多的营收话语权，甚至在算力层也将具有明显优势。</p><p>从自研通用预训练大语言模型（Large Language Model，LLM）的<strong>必要性</strong>角度，自主可控是确保网络和信息安全的基础，而自研模型在全球政治经济格局下具有战略意义。</p><p>从<strong>可行性角度</strong>，鉴于研发LLM所需的算力、数据、算法、人才和资金，<strong>仅有少数中国顶级互联网公司具备相应条件</strong>。各大参与者根据自身业务生态选择不同的战略路线，但一个大胆的假设是，未来拥有先进的大模型和生态系统的企业将更有可能在应用层到算力层掌握营收话语权。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/Chatgpt3-2.png" alt="图3-2 中国大语言模型产业价值链"></p><p><img src="https://cdn.lthero.cn/post_images/course/ML/Chatgpt3-2-2.png" alt="图3-2 中国大语言模型产业价值链"></p><p>整个价值链不仅依赖于算法和模型，更离不开算力基础设施和数据基础设施的支持。算力基础设施提供了大模型训练和运行所需的底层能力，而数据基础设施则为模型提供丰富的训练数据和用户反馈，共同构建了一个健壮和高效的大语言模型产业生态系统。</p><h2 id="硬件资源全面对比">硬件资源全面对比</h2><p>OpenAI以其对前沿AI技术的领导地位，使用了<strong>800张NVIDIA A100显卡</strong>，总耗电量达到1500千瓦时，以实现其GPT系列模型的高效训练。</p><p>Google则依靠了自家开发的TPU v4，<strong>部署了1000张显卡</strong>，总耗电量约为1300千瓦时，以支持其各类大规模机器学习项目。</p><p>Meta采用了<strong>NVIDIA的V100显卡，共计900张</strong>，总耗电量达到1400千瓦时，支持其虚拟现实和增强现实等先进技术的研发。</p><p>中国科技巨头百度则选择了<strong>AMD的Instinct MI100显卡，共部署了700张</strong>，耗电量大约1200千瓦时，以推动其自动驾驶和智能搜索等关键业务的进展。</p><p>清华大学也在AI领域发挥了重要作用，<strong>采用了600张NVIDIA的A30显卡</strong>，总耗电量约为1000千瓦时，用于支持各类学术研究和创新项目。</p><p>总体而言，从上述各大公司和机构的硬件资源配置可以看出，显卡类型、数量和耗电量的选择反映了各自的技术方向和战略目标。无论是选择业界领先的显卡产品，还是自主开发硬件，都体现了大语言模型训练领域竞争的激烈和多样化。这一竞赛不仅推动了硬件技术的进步，也为AI的未来发展奠定了坚实的基础。</p><h2 id="研发路径与技术对比">研发路径与技术对比</h2><p>在大语言模型（LLMs）的全球竞技场中，ChatGPT与Google的Gopher、LaMDA，以及Meta的Llama等构成了国际标杆</p><p>而国内则由百度的“文心一言”、360的大语言模型、阿里的“通义千问”和商汤的“商量”等引领潮流。</p><p>从对话和文本生成能力的角度，<strong>ChatGPT暂居优势，但这并非因为技术壁垒不可逾越</strong>。实际上，Google等国外企业因战略和技术理念选择了不同的发展路径，这是其暂时落后的主因。<strong>随着新技术的不断涌现，赶超ChatGPT并非不可能</strong>。相对而言，百度等国内企业在数据集、计算能力和工程化方面存在短板，短期内难以实现对国外模型的迎头赶上，这更多地需要国内AI产业全链条的协同进步。</p><p>在影响大语言模型性能的因素方面，训练数据、模型规模（即参数数量）、生成算法和优化技术被认为是核心变量。</p><p>然而，如何准确量化这些因素对模型性能的具体影响，目前还处于探索阶段，没有明确的结论。总体来看，世界顶级的大语言模型在技术层面上尚未拉开明显的差距。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/Chatgpt3-3-3.png" alt="图3-3 国内外主要大语言模型研发路径与技术对比"></p><h2 id="商业路径对比">商业路径对比</h2><h3 id="chatgpt">ChatGPT</h3><p>在战略业务拓展方面，<strong>ChatGPT</strong>已经形成了明确且差异化的商业路线，<strong>主要围绕API、订阅制和战略合作</strong>（例如与微软的Bing、Office等软件的嵌入合作）三大营收模式（如图3-4所示）。在用户数据积累、产品布局和生态建设等方面已具备明显的先发优势。</p><p>在C端生态布局方面，ChatGPT采取双管齐下的战略。一方面，通过引进各种上游插件来增强应用能力，目标打造成一个super APP以吸引更多用户。另一方面，通过创新软件交互方式将用户纳入生态圈，从而完成C端生态的全面布局。</p><p>对于B端生态，OpenAI通过与微软Azure的合作，间接实现了“模型即服务”的模式，同时也直接提供大模型API，以服务小型B端开发者，进一步完善了B端生态体系。</p><h3 id="google">Google</h3><p>相对之下，<strong>Google由于其主营业务是搜索引擎</strong>，对于聊天机器人等产品的发展相对保守，更注重利用大模型能力来推动“模型即服务”范式，以拓展其在云服务市场的份额。与此同时，谷歌也在积极拉动B端业务，通过多款大模型能力的组合拳来提升市场竞争力。</p><h3 id="百度">百度</h3><p>百度的战略更接近Google，主要针对B端市场，通过全栈优势来构建全链能力</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/Chatgpt3-4.png" alt="图3-4 国内外主要大语言模型厂商商业路径对比"></p><h3 id="商业发展前景">商业发展前景</h3><blockquote><p>AI云侧与端侧大模型满足不同需求，C端用户将成为端侧的主要客群</p></blockquote><p>一方面，面向C端个人用户，云侧大模型提供智能问答、文本生成、图片生成、视频生成等功能。</p><p>另一方面，面向B端企业用户，云侧大模型变革企业传统业务模式，提供营销、客服、会议记录、文本翻译、预算管理等个性化服务。</p><p>端侧大模型具有成本低、移动性强、数据安全等优势,主要应用在手机、PC等终端设备上。<strong>端侧大模型主要面向C端用户</strong>，重塑传统个人设备的使用方式和习惯，提供手机文档搜索、智能识屏、图像创作、生活助手、出行助手等专属服务。</p><p><strong>成本方面</strong>，根据云侧大模型每次调用成本、用户数、用户使用频率不同，云侧大模型服务器每年成本可达数亿或数十亿，高昂的服务器支出成为各大厂商发展大模型的障碍。将大模型端侧化，能把一部分云端计算转移给终端，从而大大降低云端服务器成本。</p><p><strong>安全方面</strong>，由于端侧大模型数据保存在本地，个人数据不需要上传云端，个人隐私数据更加安全。</p><p>丰富的使用场景、较低的模型成本、安全的隐私保护，使得未来大模型端侧化可能成为趋势。</p><p><strong>瑞银预计生成式AI 智能手机出货量将从2023 年的5000 万部增长到2027 年的5.83 亿部，到2027 年收入将达5130 亿美元</strong>。未来面向广大C 端用户的端侧大模型市场前景广阔。</p><h2 id="国内大模型发展缺陷分析">国内大模型发展缺陷分析</h2><h3 id="技术层面">技术层面</h3><p>当前国内技术比ChatGPT主要差在大模型环节，<strong>包括清洗、标注、模型结构设计、训练推理的技术积累</strong>。</p><blockquote><p>ChatGPT背后是文本/跨模态大模型、多轮对话、强化学习等多技术的融合创新，<strong>而国内大部分科技企业、科研院所多聚焦垂直应用，缺乏多技术融合创新能力</strong>。</p></blockquote><p>从落地应用来看，国内头部企业均表示已开展相关技术研发或部分模型进入内测阶段，但仍未出现与ChatGPT抗衡的大模型产品。加之大模型的训练成本较高，技术应用面临着亿元级研发投入和海量训练试错，国内企业投入严重不足，研发推广和产业落地整体落后于海外。</p><h3 id="算力瓶颈">算力瓶颈</h3><blockquote><p>当前，主流大模型所使用的<strong>Transformer 架构存在消耗算力资源大、占用内存储量多等局限性</strong>。</p></blockquote><h4 id="算力需求来源">算力需求来源</h4><p>首先，Transformer架构消耗的算力资源普遍较大。传统Transformer 架构由于算法特性，计算量会随着上下文长度的增加呈平方级上升。假如用户输入的上下文增加32 倍，计算量可能会增加1000倍以上。</p><p>其次，基于Transformer 架构的大模型对存储设备的要求也更高。在训练过程中需要在内存中存储参数的当前值、梯度以及其他优化器状态。模型的参数越多，所需的计算就越多，需要的存储空间就越大。如1000亿个参数的Transformer模型，存储这些参数就需要400GB的空间</p><h4 id="全球主导的芯片">全球主导的芯片</h4><blockquote><p>随着大模型规模呈现指数级增长，<strong>训练大模型越发依赖高性能芯片。</strong></p></blockquote><p>大模型的训练速度、产出质量，都和算力直接相关，对于GPT 这种大语言模型（LLM）来说，算力的要求更高，也决定了模型的“智商”。<strong>目前在全球AI 高性能芯片市场中，主要以英伟达的A100、H100 为代表的高性能芯片应用到主流大模型的训练过程</strong>。英伟达的芯片产品采用最前沿半导体工艺和创新GPU 架构保持行业的领先地位。目前，英伟达的A100 芯片在主流AI 大模型训练中占据重要市场份额，H100 虽性能强劲但难以获取。</p><p>以ChatGPT 为例，<strong>微软Azure 云服务为其提供了1万枚英伟达A100 GPU</strong>，这个算力也正是国内云计算技术人士共识的AI 大模型门槛。</p><p>然而<strong>国内拥有1 万枚GPU 的企业很少，而且单枚GPU 普遍弱于英伟达A100</strong>。由于英伟达A100 及以上性能GPU被列入管制清单，目前中国企业能获取的替代品为英伟达A800，然而A800 也存在缺货和溢价的情况。</p><h4 id="我国芯片产业简介">我国芯片产业简介</h4><p>从我国自研AI芯片来看，中国本土的高性能芯片龙头以华为海思、寒武纪、地平线、昆仑芯等为代表。我国正在高性能芯片领域加大投入并取得极大进展，部分解决方案正替代英伟达成为一些大厂的选择。<strong>但国产芯片性能目前仍与国际顶尖水平存在一定差距。</strong></p><p>在国内，AI 高性能芯片近年来发展速度加快。其中，华为昇腾主要包括310 和910 两款主力芯片，其中昇腾910 采用了7nm 工艺，最高可提供256 TFLOPS的FP16 计算能力，其能效比在行业中处于领先水平。寒武纪是中国具有代表性的另一本土AI 芯片厂商，公司先后推出了思元290 和思元370 芯片及相应的云端智能加速卡系列产品、训练整机。</p><p>总体而言，<strong>国内AI高性能芯片市场受进口限制和国内技术瓶颈的双重影响，大模型产业发展受到算力层面的一些制约。</strong></p><h3 id="数据集">数据集</h3><blockquote><p>高质量的训练数据集仍需扩展</p></blockquote><p>国内的AI大模型数据主要来自互联网、电商、社交、搜索等渠道，存在数据类型不全面，信息可信度不高等问题。</p><h4 id="数据集数量对比">数据集数量对比</h4><p>整体来看，<strong>我国可用于大模型训练的中文数据库体量严重不足</strong>。如悟道语料库，其包括文本、图文和对话数据集，最大的仅5TB，其中开源的文本部分仅为200GB。另外一个开源的中文本数据集CLUECorps 为100G。<strong>相比之下，GPT-3 的训练数据量，以英语为主，达到45TB。</strong></p><h4 id="数量不足原因">数量不足原因</h4><p>国内大模型的<strong>数据还缺乏多数据源的调用</strong>，可供大模型训练的有效<strong>数据源呈现碎片化分散状态</strong>，如<strong>微信公众号的文章仅在搜狗引擎支持调用</strong>，而多数大模型如智谱清言在联网收集数据时无法直接调用微信公众号文章。</p><p>当前，政府部门的权威数据、大型企业掌握的行业或内部数据通常不对外公开。以<strong>阿里巴巴的“通义千问”大模型为例，训练数据来自公开来源的混合数据，中文语料主要来自知乎、百度百科、百度知道等公开网络数据，来源于政府及企业数据较少</strong>。未来，仍需构建高质量的AI 大模型训练数据集，不断扩充数据源提高数据质量。</p><hr>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;大模型的定义&quot;&gt;大模型的定义&lt;/h1&gt;
&lt;p&gt;大模型是指具有&lt;strong&gt;大规模参数和复杂计算结构&lt;/strong&gt;的机器学习模型，&lt;strong&gt;拥有数十亿甚至数千亿个参数&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;大模型的设计目的：为了&lt;strong&gt;提高模型的表达</summary>
      
    
    
    
    <category term="大模型" scheme="https://blog.lthero.cn/categories/%E5%A4%A7%E6%A8%A1%E5%9E%8B/"/>
    
    
    <category term="大模型" scheme="https://blog.lthero.cn/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8B/"/>
    
  </entry>
  
  <entry>
    <title>使用Sunshine软件远程控制Ubuntu</title>
    <link href="https://blog.lthero.cn/2024/06/27/InstallSunshineStreaming/"/>
    <id>https://blog.lthero.cn/2024/06/27/InstallSunshineStreaming/</id>
    <published>2024-06-27T12:59:25.000Z</published>
    <updated>2024-06-27T13:12:26.155Z</updated>
    
    <content type="html"><![CDATA[<p>原打算使用Windows自带的远程控制软件控制Ubuntu，需要在Ubuntu安装xrdp，但最终无法进入桌面（闪退）</p><p>附加一个在ubuntu一键安装与配置xrdp脚本：<a href="https://c-nergy.be/blog/?p=19814">https://c-nergy.be/blog/?p=19814</a></p><blockquote><p>后来想到使用<strong>游戏串流神器sunshine+moonlight</strong>，尝试后发现<strong>安装简单，体验非常好</strong></p><p>如果主控和被控都在同一个局域网或虚拟局域网（直连）下，体验最佳</p></blockquote><h1 id="安装sunshine">安装Sunshine</h1><p>在<strong>被控端</strong>下载sunshine</p><blockquote><p>下载链接：<a href="https://github.com/LizardByte/Sunshine/releases/tag/v0.23.1">https://github.com/LizardByte/Sunshine/releases/tag/v0.23.1</a></p></blockquote><p>安装后打开sunshine，它会跳转到浏览器<code>localhost:47990</code></p><p>简单<strong>配置下账号密码</strong>即可</p><h1 id="安装moonlight">安装Moonlight</h1><p>在<strong>主控端</strong>下载moonlight，支持多平台</p><blockquote><p>官网：<a href="https://moonlight-stream.org/">https://moonlight-stream.org/</a></p><p>PC端下载链接<code>https://github.com/moonlight-stream/moonlight-qt/releases</code></p></blockquote><p>安装后会自动识别局域网内的设备（已经启动了sunshine服务的设备）</p><p>随后需要进行<strong>Pin匹配</strong>，<strong>在被控制端输入pin码即可</strong></p><p>在Moonlight配置中可以设置分辨率、帧数，根据网络情况自行调整即可</p><h1 id="快捷键">快捷键</h1><h3 id="pc客户端">PC客户端</h3><p>PC客户端支持键盘、鼠标和触摸屏输入，以及最多4个游戏控制器（包含大多数常见游戏手柄的映射）。</p><ul><li><strong>Ctrl+Alt+Shift+Q</strong> - 退出流媒体会话（<strong>游戏将在被控主机PC上继续运行</strong>，常用！！！！！）</li><li><strong>Ctrl+Alt+Shift+Z</strong> - 切换鼠标和键盘捕获（<strong>切出到主控端</strong>，常用！！！！！）</li><li><strong>Ctrl+Alt+Shift+X</strong> - 在全屏和窗口模式之间切换</li><li><strong>Ctrl+Alt+Shift+S</strong> - 打开性能统计叠加（不支持Steam Link或Raspberry Pi）</li><li><strong>Ctrl+Alt+Shift+M</strong> - 切换鼠标模式（指针捕获或直接控制）</li><li><strong>Ctrl+Alt+Shift+V</strong> - 在主机上键入剪贴板文本</li><li><strong>Ctrl+Alt+Shift+D</strong> - 最小化流媒体窗口</li><li><strong>Ctrl+Alt+Shift+C</strong> - 在远程桌面鼠标模式下切换本地光标显示（由于GameStream限制，远程光标将始终显示）</li><li><strong>Ctrl+Alt+Shift+L</strong> - 切换将鼠标指针锁定到视频区域（需要启用“优化鼠标用于远程桌面而非游戏”选项）</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;原打算使用Windows自带的远程控制软件控制Ubuntu，需要在Ubuntu安装xrdp，但最终无法进入桌面（闪退）&lt;/p&gt;
&lt;p&gt;附加一个在ubuntu一键安装与配置xrdp脚本：&lt;a href=&quot;https://c-nergy.be/blog/?p=19814&quot;&gt;ht</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
  </entry>
  
  <entry>
    <title>禁用每次开机启动的Python进程</title>
    <link href="https://blog.lthero.cn/2024/06/10/DisableAuto-StartProcesses/"/>
    <id>https://blog.lthero.cn/2024/06/10/DisableAuto-StartProcesses/</id>
    <published>2024-06-10T11:51:29.000Z</published>
    <updated>2024-06-10T11:52:34.564Z</updated>
    
    <content type="html"><![CDATA[<h1 id="禁用每次开机启动的python进程">禁用每次开机启动的Python进程</h1><blockquote><p>Ubuntu系统遇到个问题，每次开机有个python进程（使用ps查到“pt_main_thread”）占用1.5GB显存，下面是查找这个进程的方法</p></blockquote><h2 id="查找工作目录">查找工作目录</h2><p><code>pt_main_thread</code> 可能是某个特定 Python 应用程序或服务的主线程，要禁用这个进程的开机启动，可以进一步排查启动项和服务配置。以下是更详细的步骤：</p><ol><li><p><strong>获取进程 ID (PID)</strong>：<br>如果你已经知道进程 ID，可以直接使用它。如果不知道，可以用以下命令查找：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep pt_main_thread</span><br></pre></td></tr></table></figure></li><li><p><strong>通过 PID 获取执行文件路径</strong>：<br>使用以下命令查看该进程的执行文件路径：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l /proc/&lt;PID&gt;/exe</span><br></pre></td></tr></table></figure><p>将 <code>&lt;PID&gt;</code> 替换为实际的进程 ID。该命令将返回指向执行文件的符号链接。</p></li><li><p><strong>查找进程启动命令和工作目录</strong>：<br>使用以下命令查看进程的启动命令和工作目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/&lt;PID&gt;/cmdline</span><br><span class="line"><span class="built_in">cat</span> /proc/&lt;PID&gt;/cwd</span><br></pre></td></tr></table></figure><p><code>cmdline</code> 文件包含了<strong>进程的启动命令</strong>，<code>cwd</code> 文件包含了进程的当前工作目录。</p></li></ol><p>通过以上步骤，可以确定 <code>pt_main_thread</code> 进程对应的执行文件和启动命令，从而更好地排查其启动来源并进行禁用或删除操作。</p><hr><h2 id="进入应用目录">进入应用目录</h2><p>首先，进入该进程的工作目录，查看其中的内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /proc/2632/cwd</span><br><span class="line"><span class="built_in">ls</span> -la</span><br></pre></td></tr></table></figure><blockquote><p>结合前面的<code>cat /proc/&lt;PID&gt;/cmdline</code>应该就能确定是哪个程序执行的</p></blockquote><h3 id="查找启动脚本或服务">查找启动脚本或服务</h3><ol><li><p><strong>检查 systemd 服务</strong>：<br>进入应用目录后，检查是否有 <code>systemd</code> 服务文件或者启动脚本。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/systemd/system</span><br><span class="line"><span class="built_in">ls</span> -la | grep -i app</span><br></pre></td></tr></table></figure><p>如果找到相关服务文件，可以禁用它：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">disable</span> &lt;service_name&gt;</span><br></pre></td></tr></table></figure></li><li><p><strong>检查 rc.local 文件</strong>：<br>查看 <code>/etc/rc.local</code> 文件，看是否有启动该 Python 脚本的命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/rc.local</span><br></pre></td></tr></table></figure><p>如果有相关命令，将其注释或删除。</p></li><li><p><strong>检查 crontab</strong>：<br>查看是否有与该 Python 脚本相关的 cron 任务：</p><ul><li><p>用户 crontab：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure></li><li><p>系统级别的 crontab：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo crontab -e</span><br></pre></td></tr></table></figure></li></ul><p>查找并删除与该 Python 脚本相关的启动条目。</p></li><li><p><strong>检查用户启动项</strong>：<br>检查 <code>~/.config/autostart</code> 目录，看是否有与该 Python 脚本相关的启动项文件。如果有，将其删除：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> ~/.config/autostart</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;禁用每次开机启动的python进程&quot;&gt;禁用每次开机启动的Python进程&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;Ubuntu系统遇到个问题，每次开机有个python进程（使用ps查到“pt_main_thread”）占用1.5GB显存，下面是查找这个进程的方法</summary>
      
    
    
    
    <category term="运维" scheme="https://blog.lthero.cn/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="运维" scheme="https://blog.lthero.cn/tags/%E8%BF%90%E7%BB%B4/"/>
    
  </entry>
  
  <entry>
    <title>使用pm2管理代码运行</title>
    <link href="https://blog.lthero.cn/2024/06/05/pm2InstallAndUse/"/>
    <id>https://blog.lthero.cn/2024/06/05/pm2InstallAndUse/</id>
    <published>2024-06-05T14:18:07.000Z</published>
    <updated>2024-06-05T14:24:42.903Z</updated>
    
    <content type="html"><![CDATA[<h1 id="使用pm2管理代码运行">使用pm2管理代码运行</h1><blockquote><p>要在conda环境下使用pm2管理运行带有参数<code>--listen 0.0.0.0</code>的<code>main.py</code>脚本，可以按照以下步骤操作</p></blockquote><h2 id="安装pm2">安装pm2</h2><p>如果还没有安装pm2，可以使用npm安装。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pm2 -g</span><br></pre></td></tr></table></figure><h2 id="创建一个启动脚本">创建一个启动脚本</h2><p>可以创建一个shell脚本，比如<code>start.sh</code>，来激活conda环境并运行<code>main.py</code>。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">source</span> activate sdv3</span><br><span class="line">python main.py --listen 0.0.0.0</span><br></pre></td></tr></table></figure><h2 id="给予执行权限">给予执行权限</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x start.sh</span><br></pre></td></tr></table></figure><h2 id="使用pm2管理脚本">使用pm2管理脚本</h2><p>使用<code>pm2</code>启动shell脚本时，使用<code>--interpreter</code>参数指定使用<code>bash</code>来运行该脚本：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 start start.sh --name Comfyui --interpreter bash</span><br></pre></td></tr></table></figure><h2 id="pm2常用命令">pm2常用命令</h2><h3 id="查看所有运行的应用">查看所有运行的应用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 list</span><br></pre></td></tr></table></figure><h3 id="查看运行状态">查看运行状态</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 status</span><br></pre></td></tr></table></figure><h3 id="停止应用">停止应用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 stop Comfyui</span><br></pre></td></tr></table></figure><h3 id="重启应用">重启应用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 restart Comfyui</span><br></pre></td></tr></table></figure><h3 id="查看日志">查看日志</h3><ol><li><p><strong>查看所有应用的实时日志</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 logs</span><br></pre></td></tr></table></figure></li><li><p><strong>查看特定应用的实时日志</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 logs &lt;app-name&gt;</span><br></pre></td></tr></table></figure><p>例如，如果你的应用名为<code>sdv3-app</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 logs sdv3-app</span><br></pre></td></tr></table></figure></li><li><p><strong>查看特定应用的错误日志</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 logs &lt;app-name&gt; --err</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 logs sdv3-app --err</span><br></pre></td></tr></table></figure></li><li><p><strong>查看特定应用的标准输出日志</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 logs &lt;app-name&gt; --out</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 logs sdv3-app --out</span><br></pre></td></tr></table></figure></li><li><p><strong>查看最近的100行日志</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 logs --lines 100</span><br></pre></td></tr></table></figure></li><li><p><strong>查看特定应用的最近100行日志</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 logs &lt;app-name&gt; --lines 100</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 logs sdv3-app --lines 100</span><br></pre></td></tr></table></figure></li><li><p><strong>查看日志文件位置</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 info &lt;app-name&gt;</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 info sdv3-app</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;使用pm2管理代码运行&quot;&gt;使用pm2管理代码运行&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;要在conda环境下使用pm2管理运行带有参数&lt;code&gt;--listen 0.0.0.0&lt;/code&gt;的&lt;code&gt;main.py&lt;/code&gt;脚本，可以按照以下步骤操作</summary>
      
    
    
    
    <category term="机器学习" scheme="https://blog.lthero.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="机器学习" scheme="https://blog.lthero.cn/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>监控GPU是否可用</title>
    <link href="https://blog.lthero.cn/2024/05/26/shell-monitorGPU/"/>
    <id>https://blog.lthero.cn/2024/05/26/shell-monitorGPU/</id>
    <published>2024-05-26T15:28:59.000Z</published>
    <updated>2024-05-27T14:52:58.732Z</updated>
    
    <content type="html"><![CDATA[<h1 id="创建脚本">创建脚本</h1><blockquote><p>脚本功能：脚本监控GPU使用率，并在GPU内存使用率低于20%时执行指定脚本</p></blockquote><p>在任意位置创建<code>mgpu</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim mgpu</span><br></pre></td></tr></table></figure><p>把下面的内容粘贴上去</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">param1=<span class="variable">$1</span></span><br><span class="line">param2=<span class="variable">$2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ANSI color codes</span></span><br><span class="line">GREEN=<span class="string">&quot;\033[0;32m&quot;</span></span><br><span class="line">RED=<span class="string">&quot;\033[0;31m&quot;</span></span><br><span class="line">BLUE=<span class="string">&quot;\033[0;34m&quot;</span></span><br><span class="line">RESET=<span class="string">&quot;\033[0m&quot;</span></span><br><span class="line">threshold=20</span><br><span class="line"></span><br><span class="line">log_file_global=<span class="string">&quot;/home/dongli911/mgpu.log&quot;</span>  <span class="comment"># 全局日志文件路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成一个基于时间戳的唯一ID</span></span><br><span class="line">script_id=$(<span class="built_in">date</span> +%s)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否请求查看当前运行的脚本</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$param1</span>&quot;</span> == <span class="string">&quot;ps&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;BLUE&#125;</span>当前正在运行的脚本:<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line">    grep <span class="string">&quot;Status: Running&quot;</span> <span class="variable">$log_file_global</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果输入了-g参数，根据后续参数生成模板并退出</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$param1</span>&quot;</span> == <span class="string">&quot;-g&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    script_name=<span class="string">&quot;<span class="variable">$&#123;param2:-run_python&#125;</span>&quot;</span></span><br><span class="line">    template_path=<span class="string">&quot;./<span class="variable">$&#123;script_name&#125;</span>.sh&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;正在当前目录<span class="variable">$&#123;template_path&#125;</span>生成 <span class="variable">$&#123;GREEN&#125;</span> <span class="variable">$&#123;script_name&#125;</span>.sh <span class="variable">$&#123;RESET&#125;</span> 模板...&quot;</span></span><br><span class="line">    <span class="built_in">cat</span> &gt; <span class="string">&quot;<span class="variable">$template_path</span>&quot;</span> &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">#!/bin/bash</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 激活 Conda 环境 (不要删除下面这行!)</span></span><br><span class="line"><span class="string">source /opt/anaconda3/etc/profile.d/conda.sh</span></span><br><span class="line"><span class="string"># 选择要激活的环境 (修改下一行以激活你偏好的环境)</span></span><br><span class="line"><span class="string">conda activate sdv3</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 执行 Python 脚本, 后面可以接参数</span></span><br><span class="line"><span class="string">python ~/.wan/aigc/main.py</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">    <span class="built_in">chmod</span> +x <span class="string">&quot;<span class="variable">$template_path</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;GREEN&#125;</span>模板 &#x27;<span class="variable">$&#123;script_name&#125;</span>.sh&#x27; <span class="variable">$&#123;RESET&#125;</span> 已创建并设置为可执行状态，位于当前目录。&quot;</span></span><br><span class="line">    <span class="comment"># 记录生成模板操作</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$script_id</span> - <span class="subst">$(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)</span> - <span class="variable">$&#123;USER&#125;</span> - <span class="variable">$&#123;PWD&#125;</span> - Generated script template: <span class="variable">$&#123;script_name&#125;</span>.sh&quot;</span> &gt;&gt; <span class="variable">$log_file_global</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否有输入参数或者是否输入了 -h</span></span><br><span class="line"><span class="keyword">if</span> [[ -z <span class="string">&quot;<span class="variable">$param1</span>&quot;</span> || <span class="string">&quot;<span class="variable">$param1</span>&quot;</span> == <span class="string">&quot;-h&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;BLUE&#125;</span>此脚本监控GPU使用率，并在GPU内存使用率低于20%时执行指定脚本。<span class="variable">$&#123;RESET&#125;</span>\n&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;生成脚本模板&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;用法: <span class="variable">$&#123;GREEN&#125;</span><span class="variable">$0</span> -g [script_name]<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;  如: <span class="variable">$&#123;GREEN&#125;</span><span class="variable">$0</span> -g lthero<span class="variable">$&#123;RESET&#125;</span>，则生成lthero.sh&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;  如: <span class="variable">$&#123;GREEN&#125;</span><span class="variable">$0</span> -g <span class="variable">$&#123;RESET&#125;</span>，则生成默认名run_python.sh\n&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;运行脚本&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;用法: <span class="variable">$&#123;GREEN&#125;</span><span class="variable">$0</span> &lt;要执行的脚本&gt;<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;  如: <span class="variable">$&#123;GREEN&#125;</span><span class="variable">$0</span> lthero.sh<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;  如: <span class="variable">$&#123;GREEN&#125;</span><span class="variable">$0</span> run_python.sh<span class="variable">$&#123;RESET&#125;</span>\n&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;查看正在运行的脚本&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;用法: <span class="variable">$&#123;GREEN&#125;</span><span class="variable">$0</span> ps<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查文件是否存在</span></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$param1</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;如果GPU可用，将执行脚本 <span class="variable">$&#123;GREEN&#125;</span> $param1<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;RED&#125;</span>错误：未找到脚本 <span class="variable">$param1</span> 或脚本不可执行。<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置日志文件</span></span><br><span class="line">log_file=<span class="string">&quot;./<span class="variable">$&#123;param1%.*&#125;</span>.log&quot;</span></span><br><span class="line">counter=0</span><br><span class="line"><span class="keyword">while</span> [[ -f <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span> ]]; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">let</span> counter+=1</span><br><span class="line">    log_file=<span class="string">&quot;./<span class="variable">$&#123;param1%.*&#125;</span><span class="variable">$counter</span>.log&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录执行脚本操作</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$script_id</span> - <span class="subst">$(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)</span> - <span class="variable">$&#123;USER&#125;</span> - <span class="variable">$&#123;PWD&#125;</span> - Executed script: <span class="variable">$param1</span> - Status: Running&quot;</span> &gt;&gt; <span class="variable">$log_file_global</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 持续检测GPU占用，并将输出重定向到日志文件</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    usage=$(nvidia-smi --query-gpu=memory.used,memory.total --format=csv,noheader,nounits | awk <span class="string">&#x27;&#123;print ($1/$2)*100&#125;&#x27;</span>)</span><br><span class="line">    usage_lt_threshold=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$usage</span> &lt; <span class="variable">$threshold</span> &quot;</span> | bc)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;当前GPU内存使用率为 <span class="variable">$usage</span>%&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$usage_lt_threshold</span>&quot;</span> -eq 1 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;当前GPU内存使用率低于<span class="variable">$&#123;threshold&#125;</span>%，将执行脚本&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br><span class="line">        bash <span class="variable">$param1</span> &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span> 2&gt;&amp;1</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;GREEN&#125;</span>脚本 <span class="variable">$param1</span> 已执行。<span class="variable">$&#123;RESET&#125;</span>&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$log_file</span>&quot;</span></span><br><span class="line">        sed -i <span class="string">&quot;/<span class="variable">$script_id</span>/c\\<span class="variable">$script_id</span> - <span class="subst">$(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)</span> - <span class="variable">$&#123;USER&#125;</span> - <span class="variable">$&#123;PWD&#125;</span> - Executed script: <span class="variable">$param1</span> - Status: Completed&quot;</span> <span class="variable">$log_file_global</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">sleep</span> 60</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">) &amp;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;GREEN&#125;</span>脚本已转至后台运行。<span class="variable">$&#123;RESET&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>随后，放在全局可用的地方</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mv</span> ./mgpu /usr/local/bin/mgpu</span><br></pre></td></tr></table></figure><h1 id="使用脚本">使用脚本</h1><h2 id="说明">说明</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log_file_global=<span class="string">&quot;/home/mgpu.log&quot;</span>  <span class="comment"># 全局日志文件路径</span></span><br></pre></td></tr></table></figure><p>这里设置了全局的日志文件位置，可以修改</p><p>全局日志会记录ID号、运行时刻，运行状态、目录、脚本名等信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1716812372 - 2024-05-27 20:19:32 - dongli911 - /home/ - Executed script: 1picwait4extract.sh - Status: Running</span><br></pre></td></tr></table></figure><h3 id="脚本说明">脚本说明</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mgpu</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">mgpu -h</span><br></pre></td></tr></table></figure><h3 id="生成脚本模板">生成脚本模板</h3><p>​        用法: <code>/usr/local/bin/mgpu -g [script_name]</code><br>​        如 <code>mgpu -g lthero</code> 会生成:lthero.sh<br>​        如 <code>mgpu -g</code>  会生成默认名:run_python.sh</p><h3 id="运行脚本">运行脚本</h3><p>​        用法: <code>/usr/local/bin/mgpu &lt;要执行的脚本&gt;</code><br>​        如 <code>/usr/local/bin/mgpu lthero.sh</code></p><h2 id="举例">举例</h2><blockquote><p>进入要运行的py目录，如~/test/目录下有main.py，需要的conda环境为sdv3</p></blockquote><h3 id="生成脚本模板">生成脚本模板</h3><p>先进入输入<code>mgpu -g</code>，随后在~/test/目录下有<code>run_python.sh</code>文件，打开run_python.sh进行编辑，在第6行修改成需要用的环境，第9行修改成需要运行的main.py代码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 激活 Conda 环境 (不要删除下面这行!)</span></span><br><span class="line"><span class="built_in">source</span> /opt/anaconda3/etc/profile.d/conda.sh</span><br><span class="line"><span class="comment"># 选择要激活的环境 (修改下一行以激活你偏好的环境)</span></span><br><span class="line">conda activate sdv3 <span class="comment"># 修改这行内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行 Python 脚本, 后面可以接参数</span></span><br><span class="line">python ~/.wan/aigc/main.py <span class="comment"># 修改这行内容</span></span><br></pre></td></tr></table></figure><p>修改好后，保存这个<code>run_python.sh</code>文件</p><h3 id="运行定制脚本">运行定制脚本</h3><p>在<code>~/test/</code>目录下运行以下代码即可在后台监控GPU，并空闲时执行代码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mgpu run_python.sh</span><br></pre></td></tr></table></figure><p>代码输出的日志保存在<code>~/test/</code>目录下的run_python.log，如果多次运行，日志会自动排序run_python.log1，run_python.log2……</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;创建脚本&quot;&gt;创建脚本&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;脚本功能：脚本监控GPU使用率，并在GPU内存使用率低于20%时执行指定脚本&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在任意位置创建&lt;code&gt;mgpu&lt;/code&gt;&lt;/p&gt;
&lt;figure cla</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
  </entry>
  
  <entry>
    <title>zeroTier|自建服务器与旁路由使用</title>
    <link href="https://blog.lthero.cn/2024/05/25/install-zeroTier/"/>
    <id>https://blog.lthero.cn/2024/05/25/install-zeroTier/</id>
    <published>2024-05-25T14:54:59.000Z</published>
    <updated>2024-12-24T12:13:57.671Z</updated>
    
    <content type="html"><![CDATA[<h1 id="安装zerotier">安装zerotier</h1><blockquote><p>参考：<a href="https://zhuanlan.zhihu.com/p/123956151">https://zhuanlan.zhihu.com/p/123956151</a></p><p><a href="https://blog.csdn.net/coldboy258/article/details/93133860">https://blog.csdn.net/coldboy258/article/details/93133860</a></p><p><a href="https://post.smzdm.com/p/a7nwn8q9/">https://post.smzdm.com/p/a7nwn8q9/</a></p><p>视频解释：<a href="https://www.bilibili.com/video/BV1Vh411F7Mr/">https://www.bilibili.com/video/BV1Vh411F7Mr/</a></p></blockquote><h2 id="写在前面">写在前面</h2><p>Zerotier服务分为两部分，控制器和root</p><p>Zerotier官方提供了自建的文档，其中web后台属于“controllers控制器”，控制器是开源的，但不提供webui，GitHub上有开源的ui项目，比如zero-ui和ztncui。</p><p><strong>控制器</strong>使用根的API创建和管理网络，不参与流量通信</p><p><strong>根服务器</strong>（Root Server）负责流量转发和P2P通信，根服务器如果是完全自建的话，那就是私服，不参与官方的节点网络，也就是Zerotier中的“Planet（行星节点）”的概念</p><p>如果想<strong>使用官方的Planet的同时使用自己的根服务器</strong>，那就是以<strong>Moon</strong>（月亮节点）的形式加入到网络中。两者用起来其实没有区别，只是标识不同，无论是自建的Planet还是Moon，都可以被自建的控制器调用</p><p>但有一点需要注意，<strong>自建控制器的网络和官方web后台不通用</strong>，你不会在官方web后台看到你在自建控制器上创建的网络，反过来也一样，自建控制器也看不到官方控制器创建的网络。但网络ID的加入是可以通用的，即使你不搭建自己的Moon节点，同样也可以使用自己的控制器+官方的Planet进行通信</p><hr><h2 id="创建虚拟局域网">创建虚拟局域网</h2><p>在zerotier官网 <a href="https://zerotier.com/">https://zerotier.com/</a> 上注册账号，并创建一个虚拟局域网</p><h2 id="下载与自动安装">下载与自动安装</h2><p>zerotier官方提供了比较方便的安装方式,一条命令即可完成:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s https://install.zerotier.com/ | sudo bash</span><br></pre></td></tr></table></figure><h2 id="加入网络">加入网络</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zerotier-cli <span class="built_in">join</span> fadxxxxx5eb45a9</span><br></pre></td></tr></table></figure><p>随后，在zerotier官网上同意这个设备的接入，此设备就加入虚拟局域网成功了</p><h1 id="服务器注册成为moon">服务器注册成为Moon</h1><blockquote><p>这里的Moon是中继服务器，默认用使用官方的中继服务器，但延迟较高；</p><p>Moon只有在直连失败时才会使用中继服务器进行中转服务器</p></blockquote><h2 id="生成moon配置文件">生成moon配置文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装好zerotier后,自动会安装到此目录</span></span><br><span class="line"><span class="built_in">cd</span> /var/lib/zerotier-one </span><br><span class="line"><span class="comment">#该命令将id文件转换为能用于配置的json</span></span><br><span class="line">sudo zerotier-idtool initmoon identity.public &gt; moon.json    </span><br></pre></td></tr></table></figure><h2 id="修改配置文件moon-json">修改配置文件moon.json</h2><ol><li>在防火墙开放9993的udp；默认使用iptables即可</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认使用iptables即可</span></span><br><span class="line"><span class="comment"># 除非你非常清楚使用ufw或firewalld控制；</span></span><br><span class="line"><span class="comment">#iptables</span></span><br><span class="line">iptables -A INPUT -p udp --dport 9993 -j ACCEPT</span><br><span class="line">service iptables save</span><br><span class="line">service iptables restart</span><br><span class="line"></span><br><span class="line"><span class="comment">#firewalld</span></span><br><span class="line">firewall-cmd --zone=public --add-port=9993/udp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment">#ufw</span></span><br><span class="line">ufw allow 9993/udp</span><br></pre></td></tr></table></figure><ol start="2"><li>vim 编辑 <code>/var/lib/zerotier-one/moon.json</code>,主要是添加公网IP，修改内容如下</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;roots&quot;</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="string">&quot;identity&quot;</span>: <span class="string">&quot;xxxx:xxxxxx&quot;</span>,</span><br><span class="line">   <span class="comment"># 修改 23.23.23.23 为 VPS 的公网的 IP，以 IPv4 为例，记得带引号</span></span><br><span class="line">   <span class="comment"># 9993是默认端口，不建议修改</span></span><br><span class="line">   <span class="string">&quot;stableEndpoints&quot;</span>: [ <span class="string">&quot;23.23.23.23/9993&quot;</span> ]</span><br><span class="line">  &#125;</span><br><span class="line"> ],</span><br></pre></td></tr></table></figure><blockquote><p>注:23.23.23.23为公网ip, 一定要配置正确,Zerotier依靠此配置去连接moon.</p><p>后面的端口若没有改变则默认都是9993端口, 且是UDP协议的, 此处在防火墙上需要开放UDP,否则是连接不上Moon的.</p></blockquote><p>该配置里面,有一个id字段,10个字符,如: [ “id”: “18fasd2319” ] 就是moon的id, 在客户端连接时,需要用到它</p><blockquote><p>这里的id还可以通过以下两个命令得到</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line">grep <span class="built_in">id</span> /var/lib/zerotier-one/moon.json | <span class="built_in">head</span> -n 1</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">zerotier-cli info</span><br></pre></td></tr></table></figure><h2 id="生成moon文件">生成moon文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zerotier-idtool genmoon moon.json </span><br></pre></td></tr></table></figure><p>执行该命令后,会在在/var/lib/zerotier-one目录下生成一个类似000000<strong>18fasd2319</strong>.moon的文件…这个文件非常重要,所有的客户端要连接上moon都是依靠该文件关联的…</p><h2 id="使moon配置文件生效">使moon配置文件生效</h2><p>在<code>/var/lib/zerotier-one</code>目录下,新建一个 <code>moons.d</code> 文件夹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> moons.d/</span><br></pre></td></tr></table></figure><p>并将刚生成的<code>moon配置文件</code>放到该文件夹下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> 000000*.moon moons.d</span><br></pre></td></tr></table></figure><h2 id="重新启动moon服务器">重新启动Moon服务器</h2><p>由于使用命令安装时会自动注册为服务,所以可以依靠以下命令完成启动或重启**（执行一个即可）**</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">service zerotier-one restart  <span class="comment">#服务重启命令</span></span><br><span class="line"></span><br><span class="line">/etc/init.d/zerotier-one restart <span class="comment">#服务重启命令</span></span><br><span class="line"></span><br><span class="line">service zerotier-one start <span class="comment">#服务启动命令</span></span><br><span class="line"></span><br><span class="line">zerotier-one -d <span class="comment">#或直接程序启动</span></span><br></pre></td></tr></table></figure><p>经过以上配置,服务器上的moon即配置并应用完闭.</p><h2 id="罗列当前的moons信息">罗列当前的moons信息</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zerotier-cli listmoons</span><br></pre></td></tr></table></figure><h1 id="客户端使用moon">客户端使用Moon</h1><blockquote><p>假设已经“A服务器”为了Moon，此时让&quot;B服务器&quot;设置&quot;A&quot;为其Moon服务器</p><p>接下来就需要在各客户端zerotier上配置,并连接此服务器</p></blockquote><p>有两种方法可以完成.</p><h2 id="方法1-自动">方法1(自动)</h2><p>离开某个orbit</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zerotier-cli deorbit 2xx1229222</span><br></pre></td></tr></table></figure><p>只需执行此命令即可,<strong>此处需要输入两遍id</strong>:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zerotier-cli orbit 18fasd2319 18fasd2319</span><br></pre></td></tr></table></figure><p>此种方法依赖<strong>zerotier的根服务器</strong>,若根服务器连接不上,则会无效</p><h2 id="方法2-手动">方法2(手动)</h2><p><strong>Linux:</strong></p><ol><li>直接在zerotier目录(<code>/var/lib/zerotier-one/</code>)下,创建<code>moons.d</code>文件夹</li><li>并且将生成的000000<strong>18fasd2319</strong>.moon文件拷入</li><li><strong>重启服务</strong>即可</li></ol><p><strong>Windows:</strong></p><ol><li>打开服务程序services.msc, 找到服务&quot;ZeroTier One&quot;</li><li>在属性内找到该服务可执行文件路径,我的环境下为C:\ProgramData\ZeroTier\One\zerotier-one_x64.exe</li><li>打开该文件夹, 并且在其下建立moons.d文件夹</li><li>将moon服务器下生成的000000<strong>18fasd2319</strong>.moon文件,拷贝到此文件夹内…<strong>再重启该服务即可</strong>…</li></ol><blockquote><p>此处<strong>重启的是该项服务</strong>,<strong>不是电脑右下角的图标程序</strong>…网上大多资料都没法特别说明,或者含糊没说清,甚至重启电脑之类的说法都说出来了,比较马虎…右下角任务栏程序路径是在C:\Program Files (x86)\ZeroTier\One目录下,而服务路径却并非在该路径,若将moons.d文件夹放不对位置,是无法连上Moon服务器的.)</p></blockquote><p><strong>安卓:</strong></p><blockquote><p>推荐项目 <a href="https://github.com/kaaass/ZerotierFix">https://github.com/kaaass/ZerotierFix</a> 优点是可以配置moon</p></blockquote><p>下载软件后,在设置中可以添加moon,输入moon对应的ID即可;或者手动导入文件,操作与上述类似</p><h2 id="验证生效">验证生效</h2><p>要验证是否moon生效,只需要在客户端zerotier程序目录下,执行以下命令即可:</p><p><strong>windows/linux通用命令</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看节点状态，留意moon服务器端口是否为9993</span></span><br><span class="line">zerotier-cli listpeers</span><br><span class="line"><span class="comment"># 留意moon服务器是否是“DIRECT”</span></span><br><span class="line">zerotier-cli peers</span><br></pre></td></tr></table></figure><p>若有类似地址（末尾是“MOON”而且ip和端口正常）,即可证明moon连接成功</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">200 listpeers 18fasd2319 23.23.23.23/9993;4242;4038 224 1.2.12 MOON</span><br></pre></td></tr></table></figure><p><strong>安卓</strong></p><p>软件上peers选项卡里可以查看上述内容</p><hr><h1 id="在旁路由使用zerotier">在旁路由使用zerotier</h1><blockquote><p>假设openwrt旁路由的实际局域网为192.168.6.155</p><p>这种方式，必须让<strong>192.168.6.0/24</strong>网段下的设备，设置其网关和DNS为旁路由ip地址</p></blockquote><p>打开openwrt网页中的zerotier软件，填写虚拟局域网ID，点击启用即可，随后保存并应用</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20240525231051219.png" alt="image-20240525231051219"></p><p>随后在zerotier的网站上，允许openwrt系统接入，在旁路由输入以下命令来判断是否加入成功</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zerotier-cli listnetworks</span><br></pre></td></tr></table></figure><p>返回值如下即加入成功，并且虚拟局域网ip为：<strong>172.22.33.155</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">200 listnetworks &lt;nwid&gt; &lt;name&gt; &lt;mac&gt; &lt;status&gt; &lt;<span class="built_in">type</span>&gt; &lt;dev&gt; &lt;ZT assigned ips&gt;</span><br><span class="line">200 listnetworks fada252630165xxx xxxxxx bb:95:e9:ff:ee:64 OK PRIVATE zasdhyt5n4 172.22.33.155/16</span><br></pre></td></tr></table></figure><blockquote><p>为了让旁路由下的所有设备（不下载zerotier）直接可以访问虚拟局域网所有设备</p><p>并且这些<strong>设备本身不要在zerotier加入虚拟局域网，否则会出现环路，如果已经加入了就取消auth</strong></p></blockquote><p><strong>自动允许客户端 NAT</strong> 要打开，随后保存并应用</p><p>随后在zerotier的网站上，<strong>Add Routes</strong>填写以下内容</p><p>Destination写局域网的网段，如<strong>192.168.6.0/24</strong>；Via写旁路由的虚拟ip：<strong>172.22.33.155</strong></p><p><img src="https://cdn.lthero.cn/post_images/course/ML/image-20240525231559150.png" alt="image-20240525231559150"></p><blockquote><p>从而，虚拟局域网所有设备与<strong>192.168.6.0/24</strong>网段下的所有设备互通</p></blockquote><hr><h1 id="查看所有设备">查看所有设备</h1><p>由于ZeroTier的Web管理端做的不是很易用，每次都登录<code>my.zerotier.com</code>查看信息特别不方便。调研了一下，发现ZeroTier官方提供的API接口 <a href="https://docs.zerotier.com/central/v1/#tag/network-member">Returns a list of Members on the network</a>正好能提供我所需要的信息。所以写了一个one-line shell命令在终端用表格展示一下结果。</p><p>首先，安装必备的软件。这行命令需要<code>curl</code>和<code>jq</code>这两个工具。Linux一般默认安装了<code>curl</code>，<code>jq</code>则需要手动安装。安装命令为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># jq官方安装文档：https://stedolan.github.io/jq/download/</span></span><br><span class="line"><span class="comment"># Ubuntu</span></span><br><span class="line">sudo apt-get install jq</span><br><span class="line"><span class="comment"># Arch</span></span><br><span class="line">sudo pacman -S  jq</span><br><span class="line"><span class="comment"># Mac</span></span><br><span class="line">sudo brew install jq</span><br></pre></td></tr></table></figure><p>然后，申请一个ZeroTier的管理Token，在 <a href="https://my.zerotier.com/account">Account</a>页面的<code>API Access Tokens</code>处新建一个Token即可。</p><p>最后，执行下面的one-line脚本：</p><p>请自行替换<Token>和<NetworkID>为你申请的Token和你的网络ID</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># bearer和token中间的空格不能省略。这个是ZeroTier官方指定的。</span></span><br><span class="line">curl -s -X GET -H <span class="string">&quot;Authorization: bearer &lt;Token&gt;&quot;</span> https://my.zerotier.com/api/v1/network/&lt;NetworkID&gt;/member  |  jq -r <span class="string">&#x27;([&quot;   NodeID   &quot;, &quot;Online&quot;, &quot;ZerotierIP&quot;, &quot;  PhysicalIP  &quot;, &quot;Name&quot;] | (., map(length*&quot;-&quot;))),(.[] | [.config.id, .online,.config.ipAssignments[0] , .physicalAddress, .name]) | @tsv&#x27;</span></span><br></pre></td></tr></table></figure><p>输出结果类似于：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   NodeID       Online  ZerotierIP        PhysicalIP    Name</span><br><span class="line">------------    ------  ----------      --------------  ----</span><br><span class="line">f481514ad3      true    10.4.1.1        125.155.212.118 A1</span><br><span class="line">f55176bfa2      false   10.4.1.2        125.157.213.8   A2</span><br><span class="line">f765b69b0a      false   10.4.1.3        125.158.146.205 A3</span><br></pre></td></tr></table></figure><h1 id="问题排查">问题排查</h1><h3 id="确保-ufw-的默认转发策略允许-moon-工作">确保 UFW 的默认转发策略允许 Moon 工作</h3><blockquote><p>建议先关掉ufw <code>ufw disable</code> 观察是否能使用中转服务器中转成功</p><p>并且在其它设备上，使用listpeers，观察中转服务器的端口是否为9993</p></blockquote><p>如果 UFW 阻止了转发流量，请执行以下操作</p><ol><li><p>启用 IP 转发：</p><ul><li><p>检查 <code>/etc/sysctl.conf</code> 中是否有以下设置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure><p>如果没有，添加它。</p></li><li><p>应用更改：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl -p</span><br></pre></td></tr></table></figure></li></ul></li><li><p>允许转发流量： 编辑 <code>/etc/ufw/sysctl.conf</code>，确保以下配置存在或修改为：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net/ipv4/ip_forward=1</span><br></pre></td></tr></table></figure><p>然后编辑 <code>/etc/default/ufw</code> 文件，将以下参数设置为 <code>ACCEPT</code>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DEFAULT_FORWARD_POLICY=<span class="string">&quot;ACCEPT&quot;</span></span><br></pre></td></tr></table></figure><ul><li>重启 UFW：</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw reload</span><br></pre></td></tr></table></figure></li></ol><h3 id="使用-tcpdump-监控实时流量">使用 <code>tcpdump</code> 监控实时流量</h3><p><code>tcpdump</code> 可用于捕获9993端口的实时网络数据包</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tcpdump port 9993</span><br></pre></td></tr></table></figure><p>而<code>netstat</code>可以列出系统中当前所有端口的使用情况</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo netstat -tuln | grep 9993</span><br></pre></td></tr></table></figure><h1 id="附录">附录</h1><blockquote><p>由于很多人对配置服务端的moon都会有修改端口的需求，方法如下，但我没成功</p></blockquote><p><strong>在运行程序同级目录下建立local.conf文件:</strong></p><p><strong>文件内容配置如下,primaryPort即为想要配置的端口:</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;settings&quot;</span>:</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="string">&quot;primaryPort&quot;</span>:9994</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>local.conf 完整配置示例如下:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;physical&quot;: &#123; /* Settings that apply to physical L2/L3 network paths. */</span><br><span class="line">        &quot;NETWORK/bits&quot;: &#123; /* Network e.g. 10.0.0.0/24 or fd00::/32 */</span><br><span class="line">            &quot;blacklist&quot;: true|false, /* If true, blacklist this path for all ZeroTier traffic */</span><br><span class="line">            &quot;trustedPathId&quot;: 0|!0 /* If present and nonzero, define this as a trusted path (see below) */</span><br><span class="line">        &#125; /* ,... additional networks */</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;virtual&quot;: &#123; /* Settings applied to ZeroTier virtual network devices (VL1) */</span><br><span class="line">        &quot;##########&quot;: &#123; /* 10-digit ZeroTier address */</span><br><span class="line">            &quot;try&quot;: [ &quot;IP/port&quot;/*,...*/ ], /* Hints on where to reach this peer if no upstreams/roots are online */</span><br><span class="line">            &quot;blacklist&quot;: [ &quot;NETWORK/bits&quot;/*,...*/ ] /* Blacklist a physical path for only this peer. */</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;settings&quot;: &#123; /* Other global settings */</span><br><span class="line">        &quot;primaryPort&quot;: 0-65535, /* If set, override default port of 9993 and any command line port */</span><br><span class="line">        &quot;portMappingEnabled&quot;: true|false, /* If true (the default), try to use uPnP or NAT-PMP to map ports */</span><br><span class="line">        &quot;softwareUpdate&quot;: &quot;apply&quot;|&quot;download&quot;|&quot;disable&quot;, /* Automatically apply updates, just download, or disable built-in software updates */</span><br><span class="line">        &quot;softwareUpdateChannel&quot;: &quot;release&quot;|&quot;beta&quot;, /* Software update channel */</span><br><span class="line">        &quot;softwareUpdateDist&quot;: true|false, /* If true, distribute software updates (only really useful to ZeroTier, Inc. itself, default is false) */</span><br><span class="line">        &quot;interfacePrefixBlacklist&quot;: [ &quot;XXX&quot;,... ], /* Array of interface name prefixes (e.g. eth for eth#) to blacklist for ZT traffic */</span><br><span class="line">        &quot;allowManagementFrom&quot;: &quot;NETWORK/bits&quot;|null, /* If non-NULL, allow JSON/HTTP management from this IP network. Default is 127.0.0.1 only. */</span><br><span class="line">        &quot;allowTcpFallbackRelay&quot;: true|false /* Allow or disallow establishment of TCP relay connections (true by default) */</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;安装zerotier&quot;&gt;安装zerotier&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;参考：&lt;a href=&quot;https://zhuanlan.zhihu.com/p/123956151&quot;&gt;https://zhuanlan.zhihu.com/p/1239561</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
    <category term="zerotier" scheme="https://blog.lthero.cn/tags/zerotier/"/>
    
    <category term="虚拟局域网" scheme="https://blog.lthero.cn/tags/%E8%99%9A%E6%8B%9F%E5%B1%80%E5%9F%9F%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>服务器上建立画廊</title>
    <link href="https://blog.lthero.cn/2024/05/12/InstallHomeGalleryOnSelfHost/"/>
    <id>https://blog.lthero.cn/2024/05/12/InstallHomeGalleryOnSelfHost/</id>
    <published>2024-05-12T14:22:33.000Z</published>
    <updated>2024-10-21T07:24:44.889Z</updated>
    
    <content type="html"><![CDATA[<h1 id="自建画廊">自建画廊</h1><blockquote><p>home-gallery项目：<a href="https://docs.home-gallery.org/install/">https://docs.home-gallery.org/install/</a></p></blockquote><p>我是将Onedrive挂载到服务器上，再在服务器运行home-gallery</p><p>挂载Onedrive到服务器的教程：<a href="https://blog.lthero.cn/2024/05/12/MountOneDriveUsingRclone/">https://blog.lthero.cn/2024/05/12/MountOneDriveUsingRclone/</a></p><h2 id="docker">Docker</h2><p>HomeGallery 的docker镜像下载 <a href="https://hub.docker.com/r/xemle/home-gallery">xemle/home-gallery</a> (amd64, arm64, arm/v7 and arm/v6 architecture).</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull xemle/home-gallery</span><br></pre></td></tr></table></figure><h3 id="data-volume-structure">Data volume structure</h3><p>The gallery application is located at <code>/app</code> whereas the data is stored in <code>/data</code> within the container. The <code>/data</code> folder has following structure:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">`-- /data - Docker data volume</span><br><span class="line">  +-- sources - Your media file sources or other volumne mounts</span><br><span class="line">  +-- config - File index, database and configuration files</span><br><span class="line">  | `-- gallery.config.yml - Main configuration file</span><br><span class="line">  `-- storage - Preview images and meta data</span><br></pre></td></tr></table></figure><p>The media volumes should be mounted into the <code>/data</code> directory. Eg. mount your host directory <code>~/Pictures</code> to <code>/data/Pictures</code> in the container and add it as source to your <code>gallery.config.yml</code>.</p><p>To avoid user permission problems it is advisable to run the container with your user and group id via <code>-u</code> parameter.</p><h3 id="quickstart">Quickstart</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建home-gallery，保存数据</span></span><br><span class="line"><span class="built_in">mkdir</span> home-gallery</span><br><span class="line"><span class="built_in">cd</span> home-gallery</span><br><span class="line"><span class="built_in">mkdir</span> -p data</span><br><span class="line"><span class="built_in">alias</span> gallery=<span class="string">&quot;docker run -d -ti --rm \</span></span><br><span class="line"><span class="string">  -v <span class="subst">$(pwd)</span>/data:/data \</span></span><br><span class="line"><span class="string">  -v /root/OneDrive/Photos/Z30/:/data/Pictures \</span></span><br><span class="line"><span class="string">  -u <span class="subst">$(id -u)</span>:<span class="subst">$(id -g)</span> \</span></span><br><span class="line"><span class="string">  -p 3000:3000 xemle/home-gallery \</span></span><br><span class="line"><span class="string">  -e GALLERY_WATCH_POLL_INTERVAL=60&quot;</span></span><br><span class="line">gallery run init --<span class="built_in">source</span> /data/Pictures</span><br><span class="line">gallery run server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看日志</span></span><br><span class="line">sudo docker logs -f 容器<span class="built_in">id</span></span><br></pre></td></tr></table></figure><p>把<code>/root/Onedrive/Photos/Z30/</code>修改成本地的相册目录（后面的<code>:/data/Pictures</code>不要动），运行server后，浏览器上打开<a href="http://localhost:3000/">localhost:3000</a>即可</p><blockquote><p>The docker container is configured to poll image sources each 5 minutes for compatibility reasons of slow or large media volumes. Check if inotify through disabled polling by <code>GALLERY_WATCH_POLL_INTERVAL=0</code> is working for you.</p><p>它会在后台生成图像的缩略图，这里有个间隔设置啊(-e GALLERY_WATCH_POLL_INTERVAL=60)，每1分钟会更新一批照片，所以运行了<code>gallery run server</code>后，可以多等一会儿</p></blockquote><h1 id="使用http访问">使用HTTP访问</h1><p>要将运行在Docker容器中的服务通过域名访问，并使用Nginx作为反向代理来转发到宿主机的3000端口，你需要完成几个步骤。这包括设置DNS记录、配置Nginx以及确保网络安全。下面是具体步骤：</p><h2 id="步骤-1-设置dns记录">步骤 1: 设置DNS记录</h2><p>确保你的域名 <code>gallery.lthero.top</code> 的DNS记录指向托管Nginx的服务器的IP地址。这通常在你的域名注册商处进行设置：</p><ul><li><strong>A记录</strong>：将域名指向IPv4地址。</li><li><strong>AAAA记录</strong>：将域名指向IPv6地址（如果适用）。</li></ul><h2 id="步骤-2-安装并启动nginx">步骤 2: 安装并启动Nginx</h2><p>步骤 1: 更新软件包列表</p><p>打开终端，首先使用<code>apt</code>命令更新你的包列表，以确保你安装的是最新版本的Nginx。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><p>步骤 2: 安装Nginx</p><p>使用<code>apt</code>安装Nginx。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure><h2 id="步骤-3-配置nginx">步骤 3: 配置Nginx</h2><p>你需要在Nginx中创建一个新的服务器块（server block），或者在已有的默认配置中修改，以设置反向代理。以下是一个基本的Nginx配置示例，将会把所有到 <code>gallery.lthero.top</code> 的请求转发到本地的3000端口：</p><ol><li><p>打开或创建一个新的Nginx配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/gallery.lthero.top</span><br></pre></td></tr></table></figure></li><li><p>添加以下配置：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> gallery.lthero.top;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:3000;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个配置做了以下几点：</p><ul><li><code>listen 80;</code> 告诉Nginx监听80端口（HTTP标准端口）。</li><li><code>server_name gallery.lthero.top;</code> 设置这个块应当响应的域名。</li><li><code>proxy_pass http://localhost:3000;</code> 指定所有传入的请求转发到本地的3000端口。</li><li><code>proxy_set_header</code> 指令将重要的HTTP头信息转发给后端应用。</li></ul></li><li><p>启用配置文件通过创建一个符号链接(一定要做)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /etc/nginx/sites-available/gallery.lthero.top /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure></li><li><p>检查Nginx配置文件是否有语法错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure></li><li><p>如果没有错误，重启Nginx以应用配置(一定要做)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure></li></ol><h2 id="步骤-4-调整防火墙规则">步骤 4: 调整防火墙规则</h2><p>确保你的服务器的防火墙规则允许HTTP（端口80）和HTTPS（端口443，如果你使用SSL）的流量。如果你正在使用<code>ufw</code>，可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow <span class="string">&#x27;Nginx Full&#x27;</span></span><br><span class="line">sudo ufw reload</span><br></pre></td></tr></table></figure><h2 id="步骤-5-测试配置">步骤 5: 测试配置</h2><p>在浏览器中输入 <code>http://gallery.lthero.top</code> 或使用命令行工具如 <code>curl</code> 来测试你的配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://gallery.lthero.top</span><br></pre></td></tr></table></figure><p>你应该能看到从Docker容器中运行的服务响应的内容。</p><p>这样，你就配置好了Nginx作为反向代理，将域名 <code>gallery.lthero.top</code> 的流量转发到宿主机的3000端口上的服务。如果你希望使用HTTPS，你还需要设置SSL证书，可以考虑使用Let’s Encrypt免费证书并配置HTTPS。</p><h1 id="使用https访问">使用HTTPS访问</h1><p>要让你的域名 <code>gallery.lthero.top</code> 使用 HTTPS，你需要获取 SSL/TLS 证书，并配置 Nginx 以使用这些证书来加密网页内容。以下是详细的步骤，包括如何使用 Let’s Encrypt 提供的免费证书自动化这个过程。</p><h2 id="步骤-1-安装-certbot">步骤 1: 安装 Certbot</h2><p>Certbot 是一个自动获取并安装 Let’s Encrypt 证书的客户端。在 Ubuntu 上安装 Certbot 及其 Nginx 插件非常简单：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install certbot python3-certbot-nginx</span><br></pre></td></tr></table></figure><h2 id="步骤-2-获取和安装证书">步骤 2: 获取和安装证书</h2><p>使用 Certbot 获取并为你的域名安装证书：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx -d gallery.lthero.top</span><br></pre></td></tr></table></figure><p>此命令会自动为指定的域名 <code>gallery.lthero.top</code> 配置 SSL 证书，并更新 Nginx 配置以使用这些证书。Certbot 会询问你一些问题，比如电子邮件地址（用于紧急联系和证书续订提醒），以及是否重定向所有 HTTP 请求到 HTTPS（强烈建议启用）。</p><p>生成的证书位置<code>/etc/letsencrypt/live/</code></p><h2 id="步骤-3-更新-nginx-配置">步骤 3: 更新 Nginx 配置</h2><p>如果你想手动编辑 Nginx 配置文件，可以按以下方式配置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/gallery.lthero.top</span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> gallery.lthero.top;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$server_name</span><span class="variable">$request_uri</span>;  <span class="comment"># 强制重定向所有 HTTP 请求到 HTTPS</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">server_name</span> gallery.lthero.top;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/gallery.lthero.top/fullchain.pem;  <span class="comment"># 证书文件路径</span></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/gallery.lthero.top/privkey.pem;  <span class="comment"># 私钥文件路径</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">1d</span>;</span><br><span class="line">    <span class="attribute">ssl_session_cache</span> shared:MozSSL:<span class="number">10m</span>;  <span class="comment"># 缓存 SSL 会话以提升性能</span></span><br><span class="line">    <span class="attribute">ssl_session_tickets</span> <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 现代加密套件配置</span></span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> <span class="string">&#x27;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384&#x27;</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 其他 SSL 优化设置</span></span><br><span class="line">    <span class="attribute">ssl_stapling</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_stapling_verify</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 允许最大请求体大小为 1000MB</span></span><br><span class="line">    <span class="attribute">client_max_body_size</span> <span class="number">1000m</span>;  </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:3000;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个配置不仅启用了 HTTPS，还包括了一些现代的安全实践，如启用 HTTP/2，配置加密套件和协议等。</p><h2 id="步骤-4-重新加载-nginx">步骤 4: 重新加载 Nginx</h2><p>启用配置文件通过创建一个符号链接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /etc/nginx/sites-available/gallery.lthero.top /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure><p>更改配置后，需要重新加载 Nginx 以应用新的配置：</p><blockquote><p>检查配置文件是否有语法错误，如果有warn!直接看“遇到的问题”部分，重新加载配置是不一定能work的</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查配置文件是否有语法错误</span></span><br><span class="line">sudo nginx -t  </span><br><span class="line"><span class="comment"># 重新加载配置</span></span><br><span class="line">sudo systemctl reload nginx  </span><br><span class="line"><span class="comment"># 如果重新加载配置后无效，可以尝试重启nginx</span></span><br><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure><h2 id="步骤-5-验证-https">步骤 5: 验证 HTTPS</h2><p>在浏览器中访问 <code>https://gallery.lthero.top</code> 来检查是否配置成功。你应该能够看到一个安全锁标志，表明连接是通过 HTTPS 加密的。</p><h2 id="步骤-6-自动续订证书">步骤 6: 自动续订证书</h2><p>Let’s Encrypt 的证书有效期为90天，因此建议设置自动续订：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew</span><br></pre></td></tr></table></figure><p>这个命令会测试证书续订过程。如果这个测试成功，添加定时任务<code>crontab</code>：</p><p><code>crontab -e</code>再填写下面内容，表示每月第一天会自动执行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 * * /usr/local/bin/certbot renew --manual --preferred-challenges dns --manual-auth-hook <span class="string">&quot;alidns&quot;</span> --manual-cleanup-hook <span class="string">&quot;alidns clean&quot;</span> --deploy-hook <span class="string">&quot;nginx -s reload&quot;</span></span><br></pre></td></tr></table></figure><p>续签的证书位置<code>/etc/letsencrypt/renewal</code></p><p>通过以上步骤，你的站点 <code>gallery.lthero.top</code> 现在应该能够安全地使用 HTTPS 进行通信了。</p><p>如果要换编辑器，运行下面的命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select-editor</span><br></pre></td></tr></table></figure><h1 id="遇到的问题">遇到的问题</h1><p>输入了这条命令后<code>sudo nginx -t</code>，发现存在warn</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-sf:~/zfile<span class="comment"># sudo nginx -t</span></span><br><span class="line">nginx: [warn] conflicting server name <span class="string">&quot;gallery.lthero.top&quot;</span> on 0.0.0.0:80, ignored</span><br><span class="line">nginx: [warn] conflicting server name <span class="string">&quot;gallery.lthero.top&quot;</span> on 0.0.0.0:443, ignored</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successfu</span><br></pre></td></tr></table></figure><blockquote><p>问题原因，certbot自动修改了/etc/nginx/sites-available/default文件</p></blockquote><p>解决方法：<a href="https://stackoverflow.com/questions/11426087/nginx-error-conflicting-server-name-ignored">https://stackoverflow.com/questions/11426087/nginx-error-conflicting-server-name-ignored</a></p><p>我的解决方法：</p><p>进入<code>sites-available</code>目录</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/nginx/sites-available</span><br></pre></td></tr></table></figure><p>随后执行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -rnw . -e gallery.lthero.top</span><br></pre></td></tr></table></figure><p>这个命令会输出当前目录下，所有包含“gallery.lthero.top”字段的文件，以及出现的行数，如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-sf:/etc/nginx/sites-available<span class="comment"># grep -rnw . -e gallery.lthero.top</span></span><br><span class="line">./default:115:    server_name gallery.lthero.top; <span class="comment"># managed by Certbot</span></span><br><span class="line">./default:145:    ssl_certificate /etc/letsencrypt/live/gallery.lthero.top/fullchain.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line">./default:146:    ssl_certificate_key /etc/letsencrypt/live/gallery.lthero.top/privkey.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line">./default:152:    <span class="keyword">if</span> (<span class="variable">$host</span> = gallery.lthero.top) &#123;</span><br><span class="line">./default:159:    server_name gallery.lthero.top;</span><br><span class="line">./gallery.lthero.top:3:    server_name gallery.lthero.top;</span><br><span class="line">./gallery.lthero.top:10:    server_name gallery.lthero.top;</span><br></pre></td></tr></table></figure><p>出现的问题是在default中出来了<code>gallery.lthero.top</code>相关的内容</p><p>随后，我把default替换成原来的内容，如下</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment"># You should look at the following URL&#x27;s in order to grasp a solid understanding</span></span><br><span class="line"><span class="comment"># of Nginx configuration files in order to fully unleash the power of Nginx.</span></span><br><span class="line"><span class="comment"># https://www.nginx.com/resources/wiki/start/</span></span><br><span class="line"><span class="comment"># https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/</span></span><br><span class="line"><span class="comment"># https://wiki.debian.org/Nginx/DirectoryStructure</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># In most cases, administrators will remove this file from sites-enabled/ and</span></span><br><span class="line"><span class="comment"># leave it as reference inside of sites-available where it will continue to be</span></span><br><span class="line"><span class="comment"># updated by the nginx packaging team.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This file will automatically load configuration files provided by other</span></span><br><span class="line"><span class="comment"># applications, such as Drupal or Wordpress. These applications will be made</span></span><br><span class="line"><span class="comment"># available underneath a path with that package name, such as /drupal8.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Default server configuration</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span> default_server;</span><br><span class="line"><span class="attribute">listen</span> [::]:<span class="number">80</span> default_server;</span><br><span class="line"></span><br><span class="line"><span class="comment"># SSL configuration</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># listen 443 ssl default_server;</span></span><br><span class="line"><span class="comment"># listen [::]:443 ssl default_server;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note: You should disable gzip for SSL traffic.</span></span><br><span class="line"><span class="comment"># See: https://bugs.debian.org/773332</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Read up on ssl_ciphers to ensure a secure configuration.</span></span><br><span class="line"><span class="comment"># See: https://bugs.debian.org/765782</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Self signed certs generated by the ssl-cert package</span></span><br><span class="line"><span class="comment"># Don&#x27;t use them in a production server!</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># include snippets/snakeoil.conf;</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">root</span> /var/www/html;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add index.php to the list if you are using PHP</span></span><br><span class="line"><span class="attribute">index</span> index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line"><span class="attribute">server_name</span> _;</span><br><span class="line"></span><br><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line"><span class="comment"># First attempt to serve request as file, then</span></span><br><span class="line"><span class="comment"># as directory, then fall back to displaying a 404.</span></span><br><span class="line"><span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># pass PHP scripts to FastCGI server</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line"><span class="comment">#include snippets/fastcgi-php.conf;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## With php-fpm (or other unix sockets):</span></span><br><span class="line"><span class="comment">#fastcgi_pass unix:/run/php/php7.4-fpm.sock;</span></span><br><span class="line"><span class="comment">## With php-cgi (or other tcp sockets):</span></span><br><span class="line"><span class="comment">#fastcgi_pass 127.0.0.1:9000;</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># deny access to .htaccess files, if Apache&#x27;s document root</span></span><br><span class="line"><span class="comment"># concurs with nginx&#x27;s one</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#location ~ /\.ht &#123;</span></span><br><span class="line"><span class="comment">#deny all;</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Virtual Host configuration for example.com</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You can move that to a different file under sites-available/ and symlink that</span></span><br><span class="line"><span class="comment"># to sites-enabled/ to enable it.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#server &#123;</span></span><br><span class="line"><span class="comment">#listen 80;</span></span><br><span class="line"><span class="comment">#listen [::]:80;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#server_name example.com;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#root /var/www/example.com;</span></span><br><span class="line"><span class="comment">#index index.html;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#location / &#123;</span></span><br><span class="line"><span class="comment">#try_files $uri $uri/ =404;</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br></pre></td></tr></table></figure><p>再执行reload和restart就好了</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl reload nginx  <span class="comment"># 重新加载配置</span></span><br><span class="line"><span class="comment"># 如果重新加载配置后无效，可以尝试重启nginx</span></span><br><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;自建画廊&quot;&gt;自建画廊&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;home-gallery项目：&lt;a href=&quot;https://docs.home-gallery.org/install/&quot;&gt;https://docs.home-gallery.org/instal</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
  </entry>
  
  <entry>
    <title>Rclone 挂载 OneDrive 为本地硬盘</title>
    <link href="https://blog.lthero.cn/2024/05/12/MountOneDriveUsingRclone/"/>
    <id>https://blog.lthero.cn/2024/05/12/MountOneDriveUsingRclone/</id>
    <published>2024-05-12T11:49:42.000Z</published>
    <updated>2024-12-16T15:44:30.376Z</updated>
    
    <content type="html"><![CDATA[<h1 id="windows平台下使用-rclone-挂载-onedrive-为本地硬盘">Windows平台下使用 Rclone 挂载 OneDrive 为本地硬盘</h1><blockquote><p>参考：<a href="https://zhuanlan.zhihu.com/p/139200172">https://zhuanlan.zhihu.com/p/139200172</a></p></blockquote><p>Rclone (rsync for cloud storage) 是一个命令行程序,用于同步文件和目录，支持常见的 Amazon Drive 、Google Drive 、OneDrive 、Dropbox 等云存储。本文将演示在 Windows 平台下将 OneDrive 挂载为本地硬盘，并使用跨平台的 Rclone GUI 连接到云盘。</p><h2 id="rclone下载地址">rclone下载地址</h2><p>首先下载适用于 Windows 的 rclone</p><p>官网下载：</p><p><a href="https://rclone.org/downloads/">Rclone downloadsrclone.org/downloads/</a></p><p>GitHub下载：</p><p><a href="https://github.com/ncw/rclone">rclone/rclonegithub.com/ncw/rclone</a></p><p>在<a href="https://rclone.org/downloads/">rclone官网</a>中，Windows 平台下选择下载 AMD64 - 64 Bit</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/v2-dba90fa9447c3ce0c59cd628b099f89a_r.jpg" alt="img"></p><p>或者在<a href="https://github.com/rclone/rclone/releases">github</a>下载。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/v2-6fe076f9b3c1b74e59bafcc454b2457e_r.jpg" alt="img"></p><p>下载后解压到一个英文路径中。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/v2-2c598f613124fd234541d5b64bd5cd35_r.jpg" alt="img"></p><h2 id="必安装">必安装</h2><p>另外在Windows平台使用rclone还需要另一个依赖工具<code>winfsp</code>，下载地址：</p><p><a href="http://www.secfs.net/winfsp/download/">http://www.secfs.net/winfsp/download/www.secfs.net/winfsp/download/</a></p><p>下载后一路安装即可。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/v2-185ca574a84e6ddab1639bc10788db20_r.jpg" alt="img"></p><h2 id="rclone配置环境变量">rclone配置环境变量</h2><ol><li>在电脑桌面右键点击“此电脑”的“属性”选项</li><li>选择“高级系统设置”选项</li><li>在系统变量中找到path，添加刚才解压后的路径</li></ol><p><img src="https://cdn.lthero.cn/post_images/course/ML/v2-3f0af66bf0619eaa28ffc968c41548f7_r.jpg" alt="img"></p><h2 id="检查rclone是否配置成功">检查rclone是否配置成功</h2><p>按<code>win</code>+<code>X</code>，然后按<code>A</code> 打开 <code>powershell</code> ，当然也可以去打开 <code>cmd</code> ，输入<code>rclone --version</code>，如果出现下面的输出则安装成功，否则检查上面步骤的环境变量是否配置正确。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/v2-c8592fd9860d57cd2b88c60ecb932f6c_r.jpg" alt="img"></p><h2 id="开始配置rclone">开始配置rclone</h2><p>在终端中依次输入以下命令行，请根据下的步骤进操作。</p><p>第一步在终端输入 rclone config</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ rclone config</span><br><span class="line"></span><br><span class="line">n) New remote</span><br><span class="line">d) Delete remote</span><br><span class="line">r) <span class="built_in">Rename</span> remote</span><br><span class="line">c) <span class="built_in">Copy</span> remote</span><br><span class="line">s) <span class="built_in">Set</span> configuration password</span><br><span class="line">q) Quit config</span><br></pre></td></tr></table></figure><p>第二步输入n创建新的配置</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ e/n/d/r/c/s/q&gt; n</span><br></pre></td></tr></table></figure><p>第三步 输入一个英文名称，用来表示，中间也不要有空格</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ name&gt; OneDriveLocal</span><br></pre></td></tr></table></figure><p>第四步 输入要配置的网盘类型 因为我们要<strong>配置Microsoft OneDrive 因此输入5</strong>（具体问题具体分析）</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Type</span> of storage to configure.</span><br><span class="line">Enter a string value. Press Enter <span class="keyword">for</span> the default (&quot;&quot;).</span><br><span class="line">Choose a number from below, or <span class="built_in">type</span> <span class="keyword">in</span> your own value</span><br><span class="line"> <span class="number">1</span> / <span class="number">1</span>Fichier</span><br><span class="line"> \ &quot;fichier&quot;</span><br><span class="line"> <span class="number">2</span> / Alias <span class="keyword">for</span> an existing remote</span><br><span class="line"> \ &quot;alias&quot;</span><br><span class="line"> <span class="number">3</span> / Amazon Drive</span><br><span class="line"> \ &quot;amazon cloud drive&quot;</span><br><span class="line"> <span class="number">4</span> / Amazon S3 Compliant Storage Provider (AWS, Alibaba, Ceph, Digital Ocean, Dreamhost, IBM COS, Minio, etc)</span><br><span class="line"> \ &quot;s3&quot;</span><br><span class="line"> <span class="number">5</span> / Microsoft OneDrive</span><br><span class="line"> \ &quot;onedrive&quot;</span><br><span class="line"> Storage&gt; <span class="number">5</span></span><br></pre></td></tr></table></figure><p>第五步 要输入 client_id 时直接回车</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">** See <span class="built_in">help</span> <span class="keyword">for</span> onedrive backend <span class="built_in">at</span>: https://rclone.org/onedrive/ **</span><br><span class="line">Microsoft App Client Id</span><br><span class="line">Leave blank normally.</span><br><span class="line">Enter a string value. Press Enter <span class="keyword">for</span> the default (&quot;&quot;).</span><br><span class="line">client_id&gt; </span><br></pre></td></tr></table></figure><p>第六步 要输入 client_secret 时直接回车</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Microsoft App Client Secret                                  </span><br><span class="line">Leave blank normally.                                        </span><br><span class="line">Enter a string value. Press Enter <span class="keyword">for</span> the default (&quot;&quot;).      </span><br><span class="line">client_secret&gt;</span><br></pre></td></tr></table></figure><p>第七步 输入n 不进行高级配置</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Edit advanced config? (y/n)                                  </span><br><span class="line">y) Yes </span><br><span class="line">n) No (default)                                              </span><br><span class="line">y/n&gt; n </span><br></pre></td></tr></table></figure><p>第八步 输入y 使用自动配置授权</p><blockquote><p>输入y后会打开默认浏览器 登录Microsoft账号后 选择 是 即可</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Remote config                                                </span><br><span class="line">Use auto config? </span><br><span class="line"> * Say Y if not sure </span><br><span class="line"> * Say N if you are working on a remote or headless machine</span><br><span class="line">y) Yes (default) </span><br><span class="line">n) No                                                        </span><br><span class="line">y/n&gt; y </span><br></pre></td></tr></table></figure><p>第九步 输入1 因为现在我配置的是 OneDrive Personal or Business 类型的网盘</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">If</span> your browser doesn&#x27;t open automatically go to the following link: http://<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">53682</span>/auth?state=sUuYaGWtxruA81JiCokJGg</span><br><span class="line">Log <span class="keyword">in</span> and authorize rclone <span class="keyword">for</span> access</span><br><span class="line">Waiting <span class="keyword">for</span> code...</span><br><span class="line">Got code</span><br><span class="line">Choose a number from below, or <span class="built_in">type</span> <span class="keyword">in</span> an existing value</span><br><span class="line"> <span class="number">1</span> / OneDrive Personal or Business</span><br><span class="line"> \ &quot;onedrive&quot;</span><br><span class="line"> <span class="number">2</span> / Root Sharepoint site</span><br><span class="line"> \ &quot;sharepoint&quot;</span><br><span class="line"> <span class="number">3</span> / <span class="built_in">Type</span> <span class="keyword">in</span> driveID</span><br><span class="line"> \ &quot;driveid&quot;</span><br><span class="line"> <span class="number">4</span> / <span class="built_in">Type</span> <span class="keyword">in</span> SiteID</span><br><span class="line"> \ &quot;siteid&quot;</span><br><span class="line"> <span class="number">5</span> / Search a Sharepoint site</span><br><span class="line"> \ &quot;search&quot;</span><br><span class="line">Your choice&gt;<span class="number">1</span>                            </span><br></pre></td></tr></table></figure><p>第十步 输入0</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Found <span class="number">1</span> drives, please select the one you want to use:</span><br><span class="line"><span class="number">0</span>: OneDrive (business) id=b!qDQvcsZUTU-<span class="number">8</span>eoYyKmtyyP1Jc0D8urZLlkATnfH1nWdJ1kkbrLsvQZLzVUTpeTrc</span><br><span class="line">Chose drive to use:&gt; <span class="number">0</span>    </span><br></pre></td></tr></table></figure><p>第十一步 输入y</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Found drive &#x27;root&#x27; of type &#x27;business&#x27;, URL: https://pmjs-my.sharepoint.com/personal/wld_365_w/Documents</span><br><span class="line">Is that okay?</span><br><span class="line">y) Yes (default)</span><br><span class="line">n) No</span><br><span class="line">y/n&gt; y   </span><br></pre></td></tr></table></figure><p>第十二步 输入y</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[OneDrive_local]</span><br><span class="line">type = onedrive</span><br><span class="line">token = &#123;<span class="string">&quot;access_token&quot;</span>:<span class="string">&quot;eyJ0UxjTLIAA&quot;</span>,<span class="string">&quot;expiry&quot;</span>:<span class="string">&quot;2020-02-10T11:32:10.852646+08:00&quot;</span>&#125;</span><br><span class="line">drive_id = b!qDvcsZUTU8eoYyKmtyyP1Jc0D8urZLlkTnH1nWdJ1kbrLsvQZLzVUTpeTrc</span><br><span class="line">drive_type = business</span><br><span class="line">--------------------</span><br><span class="line">y) Yes <span class="keyword">this</span> is <span class="built_in">OK</span> (<span class="keyword">default</span>)</span><br><span class="line">e) Edit <span class="keyword">this</span> remote</span><br><span class="line">d) Delete <span class="keyword">this</span> remote</span><br><span class="line">y/e/d&gt;y</span><br></pre></td></tr></table></figure><p>此时，就会出现刚刚配置好的网盘名称了</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/v2-422d8ec8d0f2041097092c7b04847554_r.jpg" alt="img"></p><p>最后输入q退出配置即可</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">e) Edit existing remote</span><br><span class="line">n) New remote</span><br><span class="line">d) Delete remote</span><br><span class="line">r) Rename remote</span><br><span class="line">c) Copy remote</span><br><span class="line">s) Set configuration password</span><br><span class="line">q) Quit config</span><br><span class="line">e/n/d/r/c/s/q&gt; q </span><br></pre></td></tr></table></figure><p>在 <code>C:\Users\你的用户名\.config\rclone</code>文件夹下就可以看见配置文件 rclone.conf 啦。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/v2-4263f860072c3db97a3a96c28fb30aa0_r.jpg" alt="img"></p><h3 id="5-挂载onedrive为本地硬盘"><strong>5、挂载OneDrive为本地硬盘</strong></h3><p>在 <code>git bash</code> 或 <code>cmd</code> 中输入以下挂载命令：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rclone mount OneDriveLocal:/  Q: --cache-dir E:\OneDrive --vfs-cache-mode writes &amp;</span><br></pre></td></tr></table></figure><p>其中：</p><p><code>OneDriveLocal</code> 替换为你自己前面设置的名称 。</p><p><code>Q:</code> 替换为你想要挂载后硬盘的盘符名称即可，记得不要和本地的C盘、D盘等重复。</p><p><code>E:\OneDrive</code> 为本地缓存目录，可自行设置 。</p><p>出现：<code>The service rclone has been started</code> 则说明挂载成功。</p><p>然后输入 <code>exit</code> 退出终端即可。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/v2-51fc3c785cb9cd4fa0db4ef98a9358a8_r.jpg" alt="img"></p><p>然后就可以看见本地多了一个盘，往里面复制文件就是上传，从里面复制文件到其它盘就是下载。</p><h3 id="6-设置开机自启动挂载">6、设置开机自启动挂载</h3><p>进入<code>C:\Users\用户名\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</code> 中</p><blockquote><p>运行中输入%<strong>appdata</strong>% 后点击确定即可进入</p></blockquote><p>创建一个名称为 <code>startup_rclone.txt</code> 的文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CreateObject(&quot;WScript.Shell&quot;).Run &quot;rclone mount OneDriveLocal:/  Q: --cache-dir E:\OneDriveLocalCache --vfs-cache-mode writes &quot;,0</span><br></pre></td></tr></table></figure><p>保存后改文件后缀.txt为.vbs即可，仅需要修改&quot;&quot;内的东西，最后没有’&amp;’</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/v2-8489b2b53a47c3d5e8f2b29cea9aee79_r.jpg" alt="img"></p><h1 id="linux平台下使用rclon-挂载-onedrive-为本地硬盘">Linux平台下使用Rclon 挂载 OneDrive 为本地硬盘</h1><blockquote><p>参考：<a href="https://blog.csdn.net/qq_46264836/article/details/131964857">https://blog.csdn.net/qq_46264836/article/details/131964857</a></p><p>参考：<a href="https://blog.xms.su/archives/91">https://blog.xms.su/archives/91</a></p></blockquote><h2 id="申请onedrive-api">申请OneDrive API</h2><p>前往<a href="https://portal.azure.com/">Microsoft Azure管理界面</a>，登录你的微软账号，打开“应用注册”服务。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/44bc2f6f5f7246b39dc4c2f14121fd61.png" alt="img"></p><p><img src="https://cdn.lthero.cn/post_images/course/ML/ffde0f48ab52424e84dd95009357d614.png" alt="img"></p><p><img src="https://cdn.lthero.cn/post_images/course/ML/81398282bc8540d0a95836556f02c6a6.png" alt="img"></p><p>注册成功后会跳转到应用首页面，记下图中所示的“应用程序(客户端) ID”，供将来挂载使用。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/6486d810e6ba48819517b84803fdb67b.png" alt="img"></p><p>然后再点击“证书与密码”→“生成客户端密码”。注意，<strong>这里的密码一般是有时间限制，到时需要重新换密码</strong></p><p><img src="https://cdn.lthero.cn/post_images/course/ML/2a933656469e40b8b99152cea7165e10.png" alt="img"></p><p>添加密码后，记录我们刚刚创建的密码值，供将来挂载使用。<strong>注意这里一定要将密码记录下来，因为它只显示一次。</strong></p><p><img src="https://cdn.lthero.cn/post_images/course/ML/b7bedf0bbb9f44b68e246ea58c38afda.png" alt="img"></p><p>接下来，点击“API权限”，为我们的API获取权限。Files中的权限全部勾选就可以了。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/e91181b1d152472bad89dd8f050a70f3.png" alt="img"></p><p>这一步做完我们就获得了OneDrive的API，以及<strong>客户端ID</strong>以及<strong>密码值</strong>。</p><h2 id="自启动挂载onedrive网盘">自启动挂载OneDrive网盘</h2><h3 id="获取认证token">获取认证token</h3><p>可以挂载Windows以及Linux。以下演示Linux（Ubuntu系统）挂载OneDrive</p><p>在<a href="https://rclone.org/downloads/">rclone下载</a>对应操作系统安装包，后面需要登录获取token我<a href="https://so.csdn.net/so/search?q=VPS&amp;spm=1001.2101.3001.7020">VPS</a>没有浏览器因此需要下载安装Windows版本的rclone。</p><ol><li>下载windows系统下的rclone并解压，按win+R调出运行，输入“cmd”。</li><li>输入cd + 解压的文件夹路径，进入rclone文件夹下，再输入以下命令开始授权。（如果是win11，进入目录右键在终端打开）</li></ol><blockquote><p>ID和密码替换成你自己的<br>rclone.exe 或者（ .\rclone.exe ） authorize “onedrive” “客户端ID” “密码值”</p></blockquote><p>此时，浏览器将会自动打开，然后登录会为我们为刚才创建的api授权。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/9c7760dc77754c3fa98226a1ed967182.png" alt="img"></p><p><img src="https://cdn.lthero.cn/post_images/course/ML/c2a46c369d924b438b6ff037233aec5d.png" alt="img"></p><p>接受后页面返回这个就说明成功了，控制台会返回token。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/23589553ad9e4159baa31079fcc5ce1a.png" alt="img"></p><p>token先保留，后面绑定会用到。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/43557fb6dff943a0bf622c1639556c11.png" alt="img"></p><h3 id="安装rclone">安装rclone</h3><p>在Ubuntu安装rclone：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install curl &amp;&amp; apt install fuse3</span><br><span class="line">curl https://rclone.org/install.sh | sudo bash</span><br></pre></td></tr></table></figure><p>安装成功后，命令行输入<code>rclone config</code>挂载OneDrive网盘，输入“n”新建一个云盘，并输入名称。</p><p>这个名称就是挂载后磁盘的名称，我起的是“OneDrive”。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/912888440d2f4e4780a95c9355f10a50.png" alt="img"></p><p>接下来找对应OneDrive的序号，这个随着版本更新序号可能会变动，注意看清楚。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/2d445310342b463cb5cdae5d419bf9dd.png" alt="img"></p><p>输入序号后，就用到前面保存的客户端ID(client ID)、密码值(Value)，不是SecretID。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/00920eb3af674714b9d6faea934bd696.png" alt="img"></p><p>然后是网盘类型。<strong>此处注意区分你的网盘是什么类型，国内大部分都是(1)，部分高校是世纪互联版(4)。</strong></p><p><img src="https://cdn.lthero.cn/post_images/course/ML/6f7034ca06e345839fb56cab4b83a56a.png" alt="img"></p><p>接下来不进行高级配置(n)，也不进行自动配置(n)。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/5913d1f159f94fe48f33023c48dee26d.png" alt="img"></p><p>然后就用到我们上面获取的token了，我们将整个大括号复制填入。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/b53ab2f1b4b44ad49ddca160e88abbb0.png" alt="img"></p><p><img src="https://cdn.lthero.cn/post_images/course/ML/02628bc90ced440289a7b73576e3a789.png" alt="img"></p><p>配置完成后，我们选择类型为OneDrive Personal or Business(1)。再选择OneDrive(1)此时系统会读取网盘路径，我们输入y确认。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/ea340a3586774cc6bc9486f1b62e2504.png" alt="img"></p><p><img src="https://cdn.lthero.cn/post_images/course/ML/33c73efa3bbc454abb69824189c21396.png" alt="img"></p><p>最后，程序还会列出主要信息让你再次确认：</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/31df4ab0288f43a6a8bd0b4a1b48ae6c.png" alt="img"></p><p>此时，我们看到一个&quot;onedrive&quot;类型的、名为“OneDrive”的网盘已经创建好，我们输入q退出程序，准备将这块网盘挂载到本地目录。</p><p><img src="https://cdn.lthero.cn/post_images/course/ML/922554eb940041c086e99788443aefbb.png" alt="img"></p><h5 id="2-3下载rclone自启动挂载脚本">2.3下载rclone自启动挂载脚本</h5><ul><li>下载并编辑自启脚本</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget -N git.io/rcloned </span><br><span class="line">vim rcloned</span><br></pre></td></tr></table></figure><ul><li>修改内容：</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NAME=<span class="string">&quot;OneDrive&quot;</span>  <span class="comment">#rclone 配置时填写的name</span></span><br><span class="line">REMOTE=<span class="string">&#x27;/VPS&#x27;</span>  <span class="comment">#远程文件夹，网盘里的挂载的一个文件夹，留空为整个网盘</span></span><br><span class="line">LOCAL=<span class="string">&#x27;/root/OneDrive&#x27;</span>  <span class="comment">#挂载地址，VPS本地挂载目录</span></span><br></pre></td></tr></table></figure><ul><li>设置开机自启</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> rcloned /etc/init.d/rcloned</span><br><span class="line"><span class="built_in">chmod</span> +x /etc/init.d/rcloned</span><br><span class="line">update-rc.d -f rcloned defaults <span class="comment"># Debian/Ubuntu</span></span><br><span class="line">chkconfig rcloned on <span class="comment"># CentOS</span></span><br><span class="line">bash /etc/init.d/rcloned start</span><br></pre></td></tr></table></figure><p>看到 <code>[信息] rclone 启动成功 !</code> 即可。</p><p>查看挂载磁盘</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure><p><img src="https://cdn.lthero.cn/post_images/course/ML/581b051a9464410ea74de7f7a99a76bc.png" alt="img"></p><p><strong>这样就可以了，遇到问题可以留言评论看到就会回复！</strong></p><h5 id="管理">管理</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#开始挂载 </span></span><br><span class="line">bash /etc/init.d/rcloned start</span><br><span class="line"></span><br><span class="line"><span class="comment">#停止挂载</span></span><br><span class="line">bash /etc/init.d/rcloned stop</span><br><span class="line"></span><br><span class="line"><span class="comment">#重新挂载 </span></span><br><span class="line">bash /etc/init.d/rcloned restart</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看日志 </span></span><br><span class="line"><span class="built_in">tail</span> -f /<span class="variable">$HOME</span>/.rclone/rcloned.log</span><br></pre></td></tr></table></figure><h5 id="卸载自启挂载">卸载自启挂载</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bash /etc/init.d/rcloned stop</span><br><span class="line"></span><br><span class="line">update-rc.d -f rcloned remove <span class="comment"># Debian/Ubuntu</span></span><br><span class="line"></span><br><span class="line">chkconfig rcloned off <span class="comment"># CentOS</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -f /etc/init.d/rcloned</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;windows平台下使用-rclone-挂载-onedrive-为本地硬盘&quot;&gt;Windows平台下使用 Rclone 挂载 OneDrive 为本地硬盘&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;参考：&lt;a href=&quot;https://zhuanlan.zhihu</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
  </entry>
  
  <entry>
    <title>服务器安装集成云盘</title>
    <link href="https://blog.lthero.cn/2024/05/11/How2install-zfile/"/>
    <id>https://blog.lthero.cn/2024/05/11/How2install-zfile/</id>
    <published>2024-05-11T14:38:48.000Z</published>
    <updated>2024-11-25T06:33:12.925Z</updated>
    
    <content type="html"><![CDATA[<h1 id="下载安装zfile">下载安装zfile</h1><blockquote><p>项目：<a href="https://docs.zfile.vip/install/os-linux">https://docs.zfile.vip/install/os-linux</a></p></blockquote><h2 id="安装依赖">安装依赖</h2><p>首次部署才需要安装依赖，更新部署见下方：更新版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install -y openjdk-8-jre-headless unzip</span><br></pre></td></tr></table></figure><h2 id="下载并解压">下载并解压</h2><p>安装说明</p><p>下面命令中第一行表示默认安装到用户目录下: <code>~/zfile</code> 下。</p><p>对于 <code>root</code> 用户, <code>~</code> = <code>/root</code>, <code>~/zfile</code> 表示在 <code>/root/zfile</code> 路径下。</p><p>对于其他用户, <code>~</code> = <code>/home/用户名</code> 表示在 <code>/home/用户名/</code> 路径下。如对于 <code>oracle</code> 用户, <code>~/zfile</code> 则表示安装在 <code>/home/oracle/zfile</code> 下。</p><p>如需更改安装路径, 请自行修改，如 <code>export ZFILE_INSTALL_PATH=/data/zfile</code>，表示安装在 <code>/data/zfile</code> 路径下。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ZFILE_INSTALL_PATH=~/zfile</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$ZFILE_INSTALL_PATH</span> &amp;&amp; <span class="built_in">cd</span> <span class="variable">$ZFILE_INSTALL_PATH</span></span><br><span class="line">wget --no-check-certificate https://c.jun6.net/ZFILE/zfile-release.war</span><br><span class="line">unzip zfile-release.war &amp;&amp; <span class="built_in">rm</span> -rf zfile-release.war</span><br><span class="line"><span class="built_in">chmod</span> +x <span class="variable">$ZFILE_INSTALL_PATH</span>/bin/*.sh</span><br></pre></td></tr></table></figure><h2 id="启动项目">启动项目</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/zfile/bin/start.sh</span><br></pre></td></tr></table></figure><p>启动后浏览器访问 <strong><code>http://ip:8080</code></strong> 即可，如启动后无法访问，请检查 <strong><code>端口是否冲突</code></strong> 或 <strong><code>防火墙/安全组是否开启</code></strong>。</p><p>简单检查方式为在服务器执行 <code>curl http://127.0.0.1:8080</code></p><ul><li>如返回 <code>curl: (7) Failed connect to 127.0.0.1:8080; Connection refused</code> 表示未启动成功。</li><li>如返回 <code>&lt;!DOCTYPE html&gt; &lt;html lang=&quot;zh-CN&quot;&gt;……</code> 等字样表示启动成功，如启动成功但通过服务器 IP 无法访问，那一般就是防火墙/安全组未放行端口问题。</li></ul><h2 id="其他命令">其他命令</h2><p>以下为默认未修改安装路径下的情况，<strong>如修改了安装路径请自行更改命令所在路径</strong>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动</span></span><br><span class="line">~/zfile/bin/start.sh   </span><br><span class="line"><span class="comment"># 停止</span></span><br><span class="line">~/zfile/bin/stop.sh        </span><br></pre></td></tr></table></figure><h2 id="配置文件路径">配置文件路径</h2><p>如需修改配置文件，配置文件路径为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/zfile/WEB-INF/classes/application.properties</span><br></pre></td></tr></table></figure><h2 id="更新版本">更新版本</h2><p>警告</p><p>更新程序前务必停止程序再进行操作，命令见下方黄色高亮部分。</p><p>如果没修改过安装路径，则停止程序后，删除安装文件夹即可，默认命令为：</p><p>如修改过安装路径，则替换下方命令中的 <code>~/zfile</code> 部分为你的安装路径即可，见下方蓝色高亮部分：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~/zfile/bin/stop.sh                                                 <span class="comment"># 停止程序</span></span><br><span class="line"><span class="built_in">rm</span> -rf ~/zfile                                                      <span class="comment"># 删除安装文件夹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新下载安装最新版</span></span><br><span class="line"><span class="built_in">export</span> ZFILE_INSTALL_PATH=~/zfile                                   <span class="comment"># 声明安装到的路径</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$ZFILE_INSTALL_PATH</span> &amp;&amp; <span class="built_in">cd</span> <span class="variable">$ZFILE_INSTALL_PATH</span>              <span class="comment"># 创建文件夹并进入</span></span><br><span class="line">wget --no-check-certificate https://c.jun6.net/ZFILE/zfile-release.war                     <span class="comment"># 下载 zfile 最新版</span></span><br><span class="line">unzip zfile-release.war &amp;&amp; <span class="built_in">rm</span> -rf zfile-release.war                 <span class="comment"># 解压并删除压缩包</span></span><br><span class="line"><span class="built_in">chmod</span> +x <span class="variable">$ZFILE_INSTALL_PATH</span>/bin/*.sh                               <span class="comment"># 授权启动停止脚本</span></span><br><span class="line"></span><br><span class="line">~/zfile/bin/start.sh                                                <span class="comment"># 启动项目</span></span><br></pre></td></tr></table></figure><h1 id="使用http访问">使用HTTP访问</h1><p>要将运行在Docker容器中的服务通过域名访问，并使用Nginx作为反向代理来转发到宿主机的8080端口，你需要完成几个步骤。这包括设置DNS记录、配置Nginx以及确保网络安全。下面是具体步骤：</p><h2 id="步骤-1-设置dns记录">步骤 1: 设置DNS记录</h2><p>确保你的域名 <code>cloud.lthero.top</code> 的DNS记录指向托管Nginx的服务器的IP地址。这通常在你的域名注册商处进行设置：</p><ul><li><strong>A记录</strong>：将域名指向IPv4地址。</li><li><strong>AAAA记录</strong>：将域名指向IPv6地址（如果适用）。</li></ul><h2 id="步骤-2-安装并启动nginx">步骤 2: 安装并启动Nginx</h2><p>步骤 1: 更新软件包列表</p><p>打开终端，首先使用<code>apt</code>命令更新你的包列表，以确保你安装的是最新版本的Nginx。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><p>步骤 2: 安装Nginx</p><p>使用<code>apt</code>安装Nginx。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure><h2 id="步骤-3-配置nginx">步骤 3: 配置Nginx</h2><p>你需要在Nginx中创建一个新的服务器块（server block），或者在已有的默认配置中修改，以设置反向代理。以下是一个基本的Nginx配置示例，将会把所有到 <code>cloud.lthero.top</code> 的请求转发到本地的8080端口：</p><ol><li><p>打开或创建一个新的Nginx配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/cloud.lthero.top</span><br></pre></td></tr></table></figure></li><li><p>添加以下配置：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> cloud.lthero.top;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:8080;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个配置做了以下几点：</p><ul><li><code>listen 80;</code> 告诉Nginx监听80端口（HTTP标准端口）。</li><li><code>server_name cloud.lthero.top;</code> 设置这个块应当响应的域名。</li><li><code>proxy_pass http://localhost:8080;</code> 指定所有传入的请求转发到本地的8080端口。</li><li><code>proxy_set_header</code> 指令将重要的HTTP头信息转发给后端应用。</li></ul></li><li><p>启用配置文件通过创建一个符号链接(一定要做)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /etc/nginx/sites-available/cloud.lthero.top /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure></li><li><p>检查Nginx配置文件是否有语法错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure></li><li><p>如果没有错误，重启Nginx以应用配置(一定要做)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure></li></ol><h2 id="步骤-4-调整防火墙规则">步骤 4: 调整防火墙规则</h2><p>确保你的服务器的防火墙规则允许HTTP（端口80）和HTTPS（端口443，如果你使用SSL）的流量。如果你正在使用<code>ufw</code>，可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow <span class="string">&#x27;Nginx Full&#x27;</span></span><br><span class="line">sudo ufw reload</span><br></pre></td></tr></table></figure><h2 id="步骤-5-测试配置">步骤 5: 测试配置</h2><p>在浏览器中输入 <code>http://cloud.lthero.top</code> 或使用命令行工具如 <code>curl</code> 来测试你的配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://cloud.lthero.top</span><br></pre></td></tr></table></figure><p>你应该能看到从Docker容器中运行的服务响应的内容。</p><p>这样，你就配置好了Nginx作为反向代理，将域名 <code>cloud.lthero.top</code> 的流量转发到宿主机的8080端口上的服务。如果你希望使用HTTPS，你还需要设置SSL证书，可以考虑使用Let’s Encrypt免费证书并配置HTTPS。</p><h1 id="使用https访问">使用HTTPS访问</h1><p>要让你的域名 <code>cloud.lthero.top</code> 使用 HTTPS，你需要获取 SSL/TLS 证书，并配置 Nginx 以使用这些证书来加密网页内容。以下是详细的步骤，包括如何使用 Let’s Encrypt 提供的免费证书自动化这个过程。</p><h2 id="步骤-1-安装-certbot">步骤 1: 安装 Certbot</h2><p>Certbot 是一个自动获取并安装 Let’s Encrypt 证书的客户端。在 Ubuntu 上安装 Certbot 及其 Nginx 插件非常简单：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install certbot python3-certbot-nginx</span><br></pre></td></tr></table></figure><h2 id="步骤-2-获取和安装证书">步骤 2: 获取和安装证书</h2><p>使用 Certbot 获取并为你的域名安装证书：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx -d cloud.lthero.top</span><br></pre></td></tr></table></figure><p>此命令会自动为指定的域名 <code>cloud.lthero.top</code> 配置 SSL 证书，并更新 Nginx 配置以使用这些证书。Certbot 会询问你一些问题，比如电子邮件地址（用于紧急联系和证书续订提醒），以及是否重定向所有 HTTP 请求到 HTTPS（强烈建议启用）。</p><p>生成的证书位置<code>/etc/letsencrypt/live/</code></p><h2 id="步骤-3-更新-nginx-配置">步骤 3: 更新 Nginx 配置</h2><p>如果你想手动编辑 Nginx 配置文件，可以按以下方式配置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/cloud.lthero.top</span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> cloud.lthero.top;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$server_name</span><span class="variable">$request_uri</span>;  <span class="comment"># 强制重定向所有 HTTP 请求到 HTTPS</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">    <span class="attribute">server_name</span> cloud.lthero.top;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/cloud.lthero.top/fullchain.pem;  <span class="comment"># 证书文件路径</span></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/cloud.lthero.top/privkey.pem;  <span class="comment"># 私钥文件路径</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">1d</span>;</span><br><span class="line">    <span class="attribute">ssl_session_cache</span> shared:MozSSL:<span class="number">10m</span>;  <span class="comment"># 缓存 SSL 会话以提升性能</span></span><br><span class="line">    <span class="attribute">ssl_session_tickets</span> <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 现代加密套件配置</span></span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> <span class="string">&#x27;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384&#x27;</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 其他 SSL 优化设置</span></span><br><span class="line">    <span class="attribute">ssl_stapling</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_stapling_verify</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 允许最大请求体大小为 1000MB</span></span><br><span class="line">    <span class="attribute">client_max_body_size</span> <span class="number">1000m</span>;  </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:8080;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个配置不仅启用了 HTTPS，还包括了一些现代的安全实践，如启用 HTTP/2，配置加密套件和协议等。</p><h2 id="步骤-4-重新加载-nginx">步骤 4: 重新加载 Nginx</h2><p>启用配置文件通过创建一个符号链接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /etc/nginx/sites-available/cloud.lthero.top /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure><p>更改配置后，需要重新加载 Nginx 以应用新的配置：</p><blockquote><p>检查配置文件是否有语法错误，如果有warn!直接看“遇到的问题”部分，重新加载配置是不一定能work的</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查配置文件是否有语法错误</span></span><br><span class="line">sudo nginx -t  </span><br><span class="line"><span class="comment"># 重新加载配置</span></span><br><span class="line">sudo systemctl reload nginx  </span><br><span class="line"><span class="comment"># 如果重新加载配置后无效，可以尝试重启nginx</span></span><br><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure><h2 id="步骤-5-验证-https">步骤 5: 验证 HTTPS</h2><p>在浏览器中访问 <code>https://cloud.lthero.top</code> 来检查是否配置成功。你应该能够看到一个安全锁标志，表明连接是通过 HTTPS 加密的。</p><h2 id="步骤-6-自动续订证书">步骤 6: 自动续订证书</h2><p>Let’s Encrypt 的证书有效期为90天，因此建议设置自动续订：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew</span><br></pre></td></tr></table></figure><p>这个命令会测试证书续订过程。如果这个测试成功，添加定时任务<code>crontab</code>：</p><p><code>crontab -e</code>再填写下面内容，表示每月第一天会自动执行</p><p>先用<code>which certbot</code>查看软件位置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 * * /usr/local/bin/certbot renew --manual --preferred-challenges dns --manual-auth-hook <span class="string">&quot;alidns&quot;</span> --manual-cleanup-hook <span class="string">&quot;alidns clean&quot;</span> --deploy-hook <span class="string">&quot;nginx -s reload&quot;</span></span><br></pre></td></tr></table></figure><p>续签的证书位置<code>/etc/letsencrypt/renewal</code></p><p>通过以上步骤，你的站点 <code>cloud.lthero.top</code> 现在应该能够安全地使用 HTTPS 进行通信了。</p><p>如果要换编辑器，运行下面的命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select-editor</span><br></pre></td></tr></table></figure><h1 id="遇到的问题">遇到的问题</h1><p>输入了这条命令后<code>sudo nginx -t</code>，发现存在warn</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-sf:~/zfile<span class="comment"># sudo nginx -t</span></span><br><span class="line">nginx: [warn] conflicting server name <span class="string">&quot;cloud.lthero.top&quot;</span> on 0.0.0.0:80, ignored</span><br><span class="line">nginx: [warn] conflicting server name <span class="string">&quot;cloud.lthero.top&quot;</span> on 0.0.0.0:443, ignored</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successfu</span><br></pre></td></tr></table></figure><p>解决方法：<a href="https://stackoverflow.com/questions/11426087/nginx-error-conflicting-server-name-ignored">https://stackoverflow.com/questions/11426087/nginx-error-conflicting-server-name-ignored</a></p><p>我的解决方法：</p><p>进入<code>sites-available</code>目录</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/nginx/sites-available</span><br></pre></td></tr></table></figure><p>随后执行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -rnw . -e cloud.lthero.top</span><br></pre></td></tr></table></figure><p>这个命令会输出当前目录下，所有包含“cloud.lthero.top”字段的文件，以及出现的行数，如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-sf:/etc/nginx/sites-available<span class="comment"># grep -rnw . -e cloud.lthero.top</span></span><br><span class="line">./default:115:    server_name cloud.lthero.top; <span class="comment"># managed by Certbot</span></span><br><span class="line">./default:145:    ssl_certificate /etc/letsencrypt/live/cloud.lthero.top/fullchain.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line">./default:146:    ssl_certificate_key /etc/letsencrypt/live/cloud.lthero.top/privkey.pem; <span class="comment"># managed by Certbot</span></span><br><span class="line">./default:152:    <span class="keyword">if</span> (<span class="variable">$host</span> = cloud.lthero.top) &#123;</span><br><span class="line">./default:159:    server_name cloud.lthero.top;</span><br><span class="line">./cloud.lthero.top:3:    server_name cloud.lthero.top;</span><br><span class="line">./cloud.lthero.top:10:    server_name cloud.lthero.top;</span><br></pre></td></tr></table></figure><p>出现的问题是在default中出来了<code>cloud.lthero.top</code>相关的内容</p><p>随后，我把default替换成原来的内容，如下</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment"># You should look at the following URL&#x27;s in order to grasp a solid understanding</span></span><br><span class="line"><span class="comment"># of Nginx configuration files in order to fully unleash the power of Nginx.</span></span><br><span class="line"><span class="comment"># https://www.nginx.com/resources/wiki/start/</span></span><br><span class="line"><span class="comment"># https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/</span></span><br><span class="line"><span class="comment"># https://wiki.debian.org/Nginx/DirectoryStructure</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># In most cases, administrators will remove this file from sites-enabled/ and</span></span><br><span class="line"><span class="comment"># leave it as reference inside of sites-available where it will continue to be</span></span><br><span class="line"><span class="comment"># updated by the nginx packaging team.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This file will automatically load configuration files provided by other</span></span><br><span class="line"><span class="comment"># applications, such as Drupal or Wordpress. These applications will be made</span></span><br><span class="line"><span class="comment"># available underneath a path with that package name, such as /drupal8.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Default server configuration</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span> default_server;</span><br><span class="line"><span class="attribute">listen</span> [::]:<span class="number">80</span> default_server;</span><br><span class="line"></span><br><span class="line"><span class="comment"># SSL configuration</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># listen 443 ssl default_server;</span></span><br><span class="line"><span class="comment"># listen [::]:443 ssl default_server;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note: You should disable gzip for SSL traffic.</span></span><br><span class="line"><span class="comment"># See: https://bugs.debian.org/773332</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Read up on ssl_ciphers to ensure a secure configuration.</span></span><br><span class="line"><span class="comment"># See: https://bugs.debian.org/765782</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Self signed certs generated by the ssl-cert package</span></span><br><span class="line"><span class="comment"># Don&#x27;t use them in a production server!</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># include snippets/snakeoil.conf;</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">root</span> /var/www/html;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add index.php to the list if you are using PHP</span></span><br><span class="line"><span class="attribute">index</span> index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line"><span class="attribute">server_name</span> _;</span><br><span class="line"></span><br><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line"><span class="comment"># First attempt to serve request as file, then</span></span><br><span class="line"><span class="comment"># as directory, then fall back to displaying a 404.</span></span><br><span class="line"><span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># pass PHP scripts to FastCGI server</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line"><span class="comment">#include snippets/fastcgi-php.conf;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">## With php-fpm (or other unix sockets):</span></span><br><span class="line"><span class="comment">#fastcgi_pass unix:/run/php/php7.4-fpm.sock;</span></span><br><span class="line"><span class="comment">## With php-cgi (or other tcp sockets):</span></span><br><span class="line"><span class="comment">#fastcgi_pass 127.0.0.1:9000;</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># deny access to .htaccess files, if Apache&#x27;s document root</span></span><br><span class="line"><span class="comment"># concurs with nginx&#x27;s one</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#location ~ /\.ht &#123;</span></span><br><span class="line"><span class="comment">#deny all;</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Virtual Host configuration for example.com</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You can move that to a different file under sites-available/ and symlink that</span></span><br><span class="line"><span class="comment"># to sites-enabled/ to enable it.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#server &#123;</span></span><br><span class="line"><span class="comment">#listen 80;</span></span><br><span class="line"><span class="comment">#listen [::]:80;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#server_name example.com;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#root /var/www/example.com;</span></span><br><span class="line"><span class="comment">#index index.html;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#location / &#123;</span></span><br><span class="line"><span class="comment">#try_files $uri $uri/ =404;</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br></pre></td></tr></table></figure><p>再执行reload和restart就好了</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl reload nginx  <span class="comment"># 重新加载配置</span></span><br><span class="line"><span class="comment"># 如果重新加载配置后无效，可以尝试重启nginx</span></span><br><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;下载安装zfile&quot;&gt;下载安装zfile&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;项目：&lt;a href=&quot;https://docs.zfile.vip/install/os-linux&quot;&gt;https://docs.zfile.vip/install/os-lin</summary>
      
    
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="折腾" scheme="https://blog.lthero.cn/tags/%E6%8A%98%E8%85%BE/"/>
    
  </entry>
  
</feed>
